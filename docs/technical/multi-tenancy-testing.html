<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-technical/multi-tenancy-testing" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Multi-Tenancy Testing Framework | Open Register</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://openregisters.app/docs/technical/multi-tenancy-testing"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Multi-Tenancy Testing Framework | Open Register"><meta data-rh="true" name="description" content="This document covers the comprehensive testing framework developed for OpenRegister&#x27;s multi-tenancy implementation. The testing suite ensures reliability, security, and performance across all multi-tenancy features."><meta data-rh="true" property="og:description" content="This document covers the comprehensive testing framework developed for OpenRegister&#x27;s multi-tenancy implementation. The testing suite ensures reliability, security, and performance across all multi-tenancy features."><link data-rh="true" rel="canonical" href="https://openregisters.app/docs/technical/multi-tenancy-testing"><link data-rh="true" rel="alternate" href="https://openregisters.app/docs/technical/multi-tenancy-testing" hreflang="en"><link data-rh="true" rel="alternate" href="https://openregisters.app/docs/technical/multi-tenancy-testing" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.3a202f4d.css">
<script src="/assets/js/runtime~main.e0c01f02.js" defer="defer"></script>
<script src="/assets/js/main.6aa8ac6b.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Open Register Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="Open Register Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Open Register</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/Development/Services">Documentation</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/api">API Documentation</a><a href="https://github.com/conductionnl/openregister" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/Development/Services">Development</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/Features">Core Features</a><button aria-label="Expand sidebar category &#x27;Core Features&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/Technical/vectorization-architecture">Technical</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/UseCases/clientRegisters">UseCases</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/api/bulk-operations">api</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/developers/external-app-optimization">developers</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/development/tool-registration">development</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/features/organisation-roles">features</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/fixes">Fixes Documentation</a><button aria-label="Expand sidebar category &#x27;Fixes Documentation&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/technical/MultiTenancyImplementationStatus">technical</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/technical/MultiTenancyImplementationStatus">Multi-Tenancy Implementation Status</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/technical/MultiTenancyTestingResults">Multi-Tenancy API Testing Results</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/technical/MultiTenancy_Implementation_Summary">Multi-Tenancy Implementation Summary</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/technical/MultiTenancy_Test_Results">Multi-Tenancy Object Access Test Results</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/technical/api-caching">API Caching System</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/technical/array-faceting">Array Faceting</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/technical/bulk-operations-implementation">Bulk Operations Implementation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/technical/cache-invalidation-system">Cache Invalidation System</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/technical/file-processing-formats">File Processing: Supported Formats and Limits</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/technical/import-export-implementation">Import/Export Implementation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/technical/import-export">Import and Export</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/technical/import-service">Import Service</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/technical/multi-tenancy-testing">Multi-Tenancy Testing Framework</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/technical/php">php</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/technical/schema-based-facets">Schema-Based Faceting</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/technical/solr-dashboard-management">SOLR Dashboard Management - Technical Implementation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/technical/solr-guzzle-migration">SOLR Guzzle Migration Progress</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/technical/solr-published-only-indexing">Solr Published-Only Indexing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/technical/solr-setup-configuration">SOLR Setup and Configuration Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/technical/unified-faceting-system">Unified Faceting System</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/user/ai-conversations">user</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/user-guide/importing-data">user-guide</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">technical</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Multi-Tenancy Testing Framework</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Multi-Tenancy Testing Framework</h1></header>
<p>This document covers the comprehensive testing framework developed for OpenRegister&#x27;s multi-tenancy implementation. The testing suite ensures reliability, security, and performance across all multi-tenancy features.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview">​</a></h2>
<p>The multi-tenancy testing framework provides:</p>
<ul>
<li><strong>113 comprehensive test cases</strong> covering all scenarios</li>
<li><strong>10 specialized test files</strong> organized by functionality</li>
<li><strong>Unit testing with PHPUnit</strong> integration</li>
<li><strong>Mock-based testing</strong> for reliable, fast execution</li>
<li><strong>Performance and scalability testing</strong></li>
<li><strong>Security and edge case validation</strong></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="test-architecture">Test Architecture<a href="#test-architecture" class="hash-link" aria-label="Direct link to Test Architecture" title="Direct link to Test Architecture">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="test-organization">Test Organization<a href="#test-organization" class="hash-link" aria-label="Direct link to Test Organization" title="Direct link to Test Organization">​</a></h3>
<div class="language-mermaid codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-mermaid codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">graph TD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    A[Multi-Tenancy Tests] --&gt; B[Default Organisation Management]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    A --&gt; C[Organisation CRUD Operations]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    A --&gt; D[User-Organisation Relationships] </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    A --&gt; E[Active Organisation Management]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    A --&gt; F[Entity Organisation Assignment]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    A --&gt; G[Data Migration Tests]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    A --&gt; H[Session Cache Management]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    A --&gt; I[Performance &amp; Scalability]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    A --&gt; J[Edge Cases &amp; Error Handling]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    A --&gt; K[Integration Tests]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    B --&gt; B1[6 Tests]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    C --&gt; C1[11 Tests]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    D --&gt; D1[11 Tests]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    E --&gt; E1[10 Tests]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    F --&gt; F1[9 Tests]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    G --&gt; G1[3 Tests]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    H --&gt; H1[4 Tests]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I --&gt; I1[6 Tests]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    J --&gt; J1[8 Tests]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    K --&gt; K1[5 Tests]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="test-file-structure">Test File Structure<a href="#test-file-structure" class="hash-link" aria-label="Direct link to Test File Structure" title="Direct link to Test File Structure">​</a></h3>
<p>Each test file follows a consistent structure:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;?php</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * [Feature] Unit Tests</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * Test Coverage:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * - Test X.1: [Scenario Description]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * - Test X.2: [Scenario Description]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * Key Features Tested:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * - [Feature 1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * - [Feature 2]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @category Test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @package  OCA\OpenRegister\Tests\Unit\Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @author   Conduction Development Team &lt;dev@conduction.nl&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">namespace OCA\OpenRegister\Tests\Unit\Service;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use PHPUnit\Framework\TestCase;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use PHPUnit\Framework\MockObject\MockObject;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class [Feature]Test extends TestCase</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Test setup, execution, and assertions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="test-coverage">Test Coverage<a href="#test-coverage" class="hash-link" aria-label="Direct link to Test Coverage" title="Direct link to Test Coverage">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-default-organisation-management-tests-11-13">1. Default Organisation Management (Tests 1.1-1.3)<a href="#1-default-organisation-management-tests-11-13" class="hash-link" aria-label="Direct link to 1. Default Organisation Management (Tests 1.1-1.3)" title="Direct link to 1. Default Organisation Management (Tests 1.1-1.3)">​</a></h3>
<p><strong>File</strong>: &#x27;DefaultOrganisationManagementTest.php&#x27;<br>
<strong>Tests</strong>: 6 comprehensive test methods</p>
<table><thead><tr><th>Test ID</th><th>Scenario</th><th>Test Method</th></tr></thead><tbody><tr><td>1.1</td><td>Default organisation creation on empty database</td><td>&#x27;testDefaultOrganisationCreationOnEmptyDatabase()&#x27;</td></tr><tr><td>1.2</td><td>User auto-assignment to default organisation</td><td>&#x27;testUserAutoAssignmentToDefaultOrganisation()&#x27;</td></tr><tr><td>1.3</td><td>Multiple default organisations prevention</td><td>&#x27;testMultipleDefaultOrganisationsPrevention()&#x27;</td></tr></tbody></table>
<p><strong>Status</strong>: ✅ <strong>6/6 PASSING</strong> - Fully validated and working</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-organisation-crud-operations-tests-21-27">2. Organisation CRUD Operations (Tests 2.1-2.7)<a href="#2-organisation-crud-operations-tests-21-27" class="hash-link" aria-label="Direct link to 2. Organisation CRUD Operations (Tests 2.1-2.7)" title="Direct link to 2. Organisation CRUD Operations (Tests 2.1-2.7)">​</a></h3>
<p><strong>File</strong>: &#x27;OrganisationCrudTest.php&#x27;<br>
<strong>Tests</strong>: 11 comprehensive test methods</p>
<table><thead><tr><th>Test ID</th><th>Scenario</th><th>Test Method</th></tr></thead><tbody><tr><td>2.1</td><td>Create new organisation</td><td><code>testCreateNewOrganisation()</code></td></tr><tr><td>2.2</td><td>Get organisation details</td><td><code>testGetOrganisationDetails()</code></td></tr><tr><td>2.3</td><td>Update organisation</td><td><code>testUpdateOrganisation()</code></td></tr><tr><td>2.4</td><td>Search organisations</td><td><code>testSearchOrganisations()</code></td></tr><tr><td>2.5</td><td>Create organisation with empty name (negative)</td><td><code>testCreateOrganisationWithEmptyName()</code></td></tr><tr><td>2.6</td><td>Access organisation without membership (negative)</td><td><code>testAccessOrganisationWithoutMembership()</code></td></tr><tr><td>2.7</td><td>Update organisation without access (negative)</td><td><code>testUpdateOrganisationWithoutAccess()</code></td></tr></tbody></table>
<p><strong>Additional Tests</strong>: Creation metadata, search multiple results, not found handling</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-user-organisation-relationships-tests-31-36">3. User-Organisation Relationships (Tests 3.1-3.6)<a href="#3-user-organisation-relationships-tests-31-36" class="hash-link" aria-label="Direct link to 3. User-Organisation Relationships (Tests 3.1-3.6)" title="Direct link to 3. User-Organisation Relationships (Tests 3.1-3.6)">​</a></h3>
<p><strong>File</strong>: <code>UserOrganisationRelationshipTest.php</code><br>
<strong>Tests</strong>: 11 comprehensive test methods</p>
<table><thead><tr><th>Test ID</th><th>Scenario</th><th>Test Method</th></tr></thead><tbody><tr><td>3.1</td><td>Join organisation</td><td><code>testJoinOrganisation()</code></td></tr><tr><td>3.2</td><td>Multiple organisation membership</td><td><code>testMultipleOrganisationMembership()</code></td></tr><tr><td>3.3</td><td>Leave organisation (non-last)</td><td><code>testLeaveOrganisationNonLast()</code></td></tr><tr><td>3.4</td><td>Join non-existent organisation (negative)</td><td><code>testJoinNonExistentOrganisation()</code></td></tr><tr><td>3.5</td><td>Leave last organisation (negative)</td><td><code>testLeaveLastOrganisation()</code></td></tr><tr><td>3.6</td><td>Join already member organisation (negative)</td><td><code>testJoinAlreadyMemberOrganisation()</code></td></tr></tbody></table>
<p><strong>Additional Tests</strong>: Membership validation, statistics, concurrent operations, role validation</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-active-organisation-management-tests-41-46">4. Active Organisation Management (Tests 4.1-4.6)<a href="#4-active-organisation-management-tests-41-46" class="hash-link" aria-label="Direct link to 4. Active Organisation Management (Tests 4.1-4.6)" title="Direct link to 4. Active Organisation Management (Tests 4.1-4.6)">​</a></h3>
<p><strong>File</strong>: <code>ActiveOrganisationManagementTest.php</code><br>
<strong>Tests</strong>: 10 comprehensive test methods</p>
<table><thead><tr><th>Test ID</th><th>Scenario</th><th>Test Method</th></tr></thead><tbody><tr><td>4.1</td><td>Get active organisation (auto-set)</td><td><code>testGetActiveOrganisationAutoSet()</code></td></tr><tr><td>4.2</td><td>Set active organisation</td><td><code>testSetActiveOrganisation()</code></td></tr><tr><td>4.3</td><td>Active organisation persistence</td><td><code>testActiveOrganisationPersistence()</code></td></tr><tr><td>4.4</td><td>Active organisation auto-switch on leave</td><td><code>testActiveOrganisationAutoSwitchOnLeave()</code></td></tr><tr><td>4.5</td><td>Set non-member organisation as active (negative)</td><td><code>testSetNonMemberOrganisationAsActive()</code></td></tr><tr><td>4.6</td><td>Set non-existent organisation as active (negative)</td><td><code>testSetNonExistentOrganisationAsActive()</code></td></tr></tbody></table>
<p><strong>Additional Tests</strong>: Controller endpoints, cache clearing, validation, auto-selection</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="5-entity-organisation-assignment-tests-51-56">5. Entity Organisation Assignment (Tests 5.1-5.6)<a href="#5-entity-organisation-assignment-tests-51-56" class="hash-link" aria-label="Direct link to 5. Entity Organisation Assignment (Tests 5.1-5.6)" title="Direct link to 5. Entity Organisation Assignment (Tests 5.1-5.6)">​</a></h3>
<p><strong>File</strong>: <code>EntityOrganisationAssignmentTest.php</code><br>
<strong>Tests</strong>: 9 comprehensive test methods</p>
<table><thead><tr><th>Test ID</th><th>Scenario</th><th>Test Method</th></tr></thead><tbody><tr><td>5.1</td><td>Register creation with active organisation</td><td><code>testRegisterCreationWithActiveOrganisation()</code></td></tr><tr><td>5.2</td><td>Schema creation with active organisation</td><td><code>testSchemaCreationWithActiveOrganisation()</code></td></tr><tr><td>5.3</td><td>Object creation with active organisation</td><td><code>testObjectCreationWithActiveOrganisation()</code></td></tr><tr><td>5.4</td><td>Entity access within same organisation</td><td><code>testEntityAccessWithinSameOrganisation()</code></td></tr><tr><td>5.5</td><td>Entity access across organisations (negative)</td><td><code>testEntityAccessAcrossOrganisations()</code></td></tr><tr><td>5.6</td><td>Cross-organisation object creation (negative)</td><td><code>testCrossOrganisationObjectCreation()</code></td></tr></tbody></table>
<p><strong>Additional Tests</strong>: Assignment validation, bulk operations, entity inheritance</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="6-data-migration-tests-61-63">6. Data Migration (Tests 6.1-6.3)<a href="#6-data-migration-tests-61-63" class="hash-link" aria-label="Direct link to 6. Data Migration (Tests 6.1-6.3)" title="Direct link to 6. Data Migration (Tests 6.1-6.3)">​</a></h3>
<p><strong>File</strong>: <code>DataMigrationTest.php</code><br>
<strong>Tests</strong>: 3 focused test methods</p>
<table><thead><tr><th>Test ID</th><th>Scenario</th><th>Test Method</th></tr></thead><tbody><tr><td>6.1</td><td>Existing data migration to default organisation</td><td><code>testExistingDataMigrationToDefaultOrganisation()</code></td></tr><tr><td>6.2</td><td>Mandatory organisation and owner fields</td><td><code>testMandatoryOrganisationAndOwnerFields()</code></td></tr><tr><td>6.3</td><td>Invalid organisation reference prevention</td><td><code>testInvalidOrganisationReferencePrevention()</code></td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="7-session-cache-management-tests-71-74">7. Session Cache Management (Tests 7.1-7.4)<a href="#7-session-cache-management-tests-71-74" class="hash-link" aria-label="Direct link to 7. Session Cache Management (Tests 7.1-7.4)" title="Direct link to 7. Session Cache Management (Tests 7.1-7.4)">​</a></h3>
<p><strong>File</strong>: <code>SessionCacheManagementTest.php</code><br>
<strong>Tests</strong>: 4 focused test methods</p>
<table><thead><tr><th>Test ID</th><th>Scenario</th><th>Test Method</th></tr></thead><tbody><tr><td>7.1</td><td>Session persistence</td><td><code>testSessionPersistence()</code></td></tr><tr><td>7.2</td><td>Cache performance</td><td><code>testCachePerformance()</code></td></tr><tr><td>7.3</td><td>Manual cache clear</td><td><code>testManualCacheClear()</code></td></tr><tr><td>7.4</td><td>Cross-user session isolation</td><td><code>testCrossUserSessionIsolation()</code></td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="8-performance--scalability-tests-81-83">8. Performance &amp; Scalability (Tests 8.1-8.3)<a href="#8-performance--scalability-tests-81-83" class="hash-link" aria-label="Direct link to 8. Performance &amp; Scalability (Tests 8.1-8.3)" title="Direct link to 8. Performance &amp; Scalability (Tests 8.1-8.3)">​</a></h3>
<p><strong>File</strong>: <code>PerformanceScalabilityTest.php</code><br>
<strong>Tests</strong>: 6 performance test methods</p>
<table><thead><tr><th>Test ID</th><th>Scenario</th><th>Test Method</th></tr></thead><tbody><tr><td>8.1</td><td>Large organisation with many users (100+)</td><td><code>testLargeOrganisationWithManyUsers()</code></td></tr><tr><td>8.2</td><td>User with many organisations (50+)</td><td><code>testUserWithManyOrganisations()</code></td></tr><tr><td>8.3</td><td>Concurrent active organisation changes</td><td><code>testConcurrentActiveOrganisationChanges()</code></td></tr></tbody></table>
<p><strong>Additional Tests</strong>: Database optimization, memory usage, cache effectiveness</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="9-edge-cases--error-handling-tests-91-95">9. Edge Cases &amp; Error Handling (Tests 9.1-9.5)<a href="#9-edge-cases--error-handling-tests-91-95" class="hash-link" aria-label="Direct link to 9. Edge Cases &amp; Error Handling (Tests 9.1-9.5)" title="Direct link to 9. Edge Cases &amp; Error Handling (Tests 9.1-9.5)">​</a></h3>
<p><strong>File</strong>: <code>EdgeCasesErrorHandlingTest.php</code><br>
<strong>Tests</strong>: 8 security and error test methods</p>
<table><thead><tr><th>Test ID</th><th>Scenario</th><th>Test Method</th></tr></thead><tbody><tr><td>9.1</td><td>Unauthenticated requests</td><td><code>testUnauthenticatedRequests()</code></td></tr><tr><td>9.2</td><td>Malformed JSON requests</td><td><code>testMalformedJsonRequests()</code></td></tr><tr><td>9.3</td><td>SQL injection attempts</td><td><code>testSqlInjectionAttempts()</code></td></tr><tr><td>9.4</td><td>Very long organisation names</td><td><code>testVeryLongOrganisationNames()</code></td></tr><tr><td>9.5</td><td>Unicode and special characters</td><td><code>testUnicodeAndSpecialCharacters()</code></td></tr></tbody></table>
<p><strong>Additional Tests</strong>: Null value handling, exception logging, rate limiting</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="10-integration-tests-tests-101-103">10. Integration Tests (Tests 10.1-10.3)<a href="#10-integration-tests-tests-101-103" class="hash-link" aria-label="Direct link to 10. Integration Tests (Tests 10.1-10.3)" title="Direct link to 10. Integration Tests (Tests 10.1-10.3)">​</a></h3>
<p><strong>File</strong>: <code>IntegrationTest.php</code><br>
<strong>Tests</strong>: 5 integration test methods</p>
<table><thead><tr><th>Test ID</th><th>Scenario</th><th>Test Method</th></tr></thead><tbody><tr><td>10.1</td><td>RBAC integration with multi-tenancy</td><td><code>testRbacIntegrationWithMultiTenancy()</code></td></tr><tr><td>10.2</td><td>Search filtering by organisation</td><td><code>testSearchFilteringByOrganisation()</code></td></tr><tr><td>10.3</td><td>Audit trail organisation context</td><td><code>testAuditTrailOrganisationContext()</code></td></tr></tbody></table>
<p><strong>Additional Tests</strong>: Cross-organisation access prevention, complex relationships</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="test-execution">Test Execution<a href="#test-execution" class="hash-link" aria-label="Direct link to Test Execution" title="Direct link to Test Execution">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="running-tests">Running Tests<a href="#running-tests" class="hash-link" aria-label="Direct link to Running Tests" title="Direct link to Running Tests">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="prerequisites">Prerequisites<a href="#prerequisites" class="hash-link" aria-label="Direct link to Prerequisites" title="Direct link to Prerequisites">​</a></h4>
<ul>
<li>Docker environment running</li>
<li>PHPUnit 10.5+ installed</li>
<li>Nextcloud test environment configured</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="basic-test-execution">Basic Test Execution<a href="#basic-test-execution" class="hash-link" aria-label="Direct link to Basic Test Execution" title="Direct link to Basic Test Execution">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Run all multi-tenancy tests</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker exec -u 33 master-nextcloud-1 bash -c &quot;cd /var/www/html/apps-extra/openregister &amp;&amp; php vendor/bin/phpunit tests/Unit/Service/ --testdox&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Run specific test file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker exec -u 33 master-nextcloud-1 bash -c &quot;cd /var/www/html/apps-extra/openregister &amp;&amp; php vendor/bin/phpunit tests/Unit/Service/DefaultOrganisationManagementTest.php --testdox&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Run with verbose output</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker exec -u 33 master-nextcloud-1 bash -c &quot;cd /var/www/html/apps-extra/openregister &amp;&amp; php vendor/bin/phpunit tests/Unit/Service/ --verbose&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="advanced-options">Advanced Options<a href="#advanced-options" class="hash-link" aria-label="Direct link to Advanced Options" title="Direct link to Advanced Options">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Run with coverage report</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker exec -u 33 master-nextcloud-1 bash -c &quot;cd /var/www/html/apps-extra/openregister &amp;&amp; php vendor/bin/phpunit tests/Unit/Service/ --coverage-html coverage&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Run specific test method</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker exec -u 33 master-nextcloud-1 bash -c &quot;cd /var/www/html/apps-extra/openregister &amp;&amp; php vendor/bin/phpunit --filter testDefaultOrganisationCreationOnEmptyDatabase&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Run with memory profiling</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker exec -u 33 master-nextcloud-1 bash -c &quot;cd /var/www/html/apps-extra/openregister &amp;&amp; php -d memory_limit=256M vendor/bin/phpunit tests/Unit/Service/&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="test-results-interpretation">Test Results Interpretation<a href="#test-results-interpretation" class="hash-link" aria-label="Direct link to Test Results Interpretation" title="Direct link to Test Results Interpretation">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="success-example">Success Example<a href="#success-example" class="hash-link" aria-label="Direct link to Success Example" title="Direct link to Success Example">​</a></h4>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Default Organisation Management (OCA\OpenRegister\Tests\Unit\Service\DefaultOrganisationManagement)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ✔ Default organisation creation on empty database</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ✔ User auto assignment to default organisation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ✔ Multiple default organisations prevention</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ✔ Database constraint prevention of multiple defaults</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ✔ Active organisation auto setting with default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ✔ Default organisation metadata validation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OK, but there were issues!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Tests: 6, Assertions: 36, PHPUnit Deprecations: 1.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="failure-analysis">Failure Analysis<a href="#failure-analysis" class="hash-link" aria-label="Direct link to Failure Analysis" title="Direct link to Failure Analysis">​</a></h4>
<p>Common failure patterns and solutions:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">✘ Create new organisation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │ Failed asserting that 201 matches expected 200.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │ Solution: Update expected HTTP status code to match API implementation</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">✘ Get organisation details</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │ Error: Call to undefined method OrganisationService::getOrganisation()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │ Solution: Update test to use correct method name from actual service</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="test-development">Test Development<a href="#test-development" class="hash-link" aria-label="Direct link to Test Development" title="Direct link to Test Development">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="writing-new-tests">Writing New Tests<a href="#writing-new-tests" class="hash-link" aria-label="Direct link to Writing New Tests" title="Direct link to Writing New Tests">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="test-structure-template">Test Structure Template<a href="#test-structure-template" class="hash-link" aria-label="Direct link to Test Structure Template" title="Direct link to Test Structure Template">​</a></h4>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * Test X.Y: [Test Description]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * Scenario: [What situation is being tested]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * Expected: [What should happen]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @return void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public function testScenarioName(): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Arrange: Set up test data and mocks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $user = $this-&gt;createMock(IUser::class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $user-&gt;method(&#x27;getUID&#x27;)-&gt;willReturn(&#x27;testuser&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $this-&gt;userSession-&gt;method(&#x27;getUser&#x27;)-&gt;willReturn($user);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Mock expected behavior</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $this-&gt;organisationMapper</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        -&gt;expects($this-&gt;once())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        -&gt;method(&#x27;methodName&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        -&gt;with($this-&gt;equalTo(&#x27;expectedParameter&#x27;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        -&gt;willReturn($expectedResult);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Act: Execute the functionality being tested</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $result = $this-&gt;organisationService-&gt;methodUnderTest(&#x27;parameter&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Assert: Verify the results</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $this-&gt;assertInstanceOf(Organisation::class, $result);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $this-&gt;assertEquals(&#x27;expectedValue&#x27;, $result-&gt;getProperty());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="mock-configuration-best-practices">Mock Configuration Best Practices<a href="#mock-configuration-best-practices" class="hash-link" aria-label="Direct link to Mock Configuration Best Practices" title="Direct link to Mock Configuration Best Practices">​</a></h4>
<ol>
<li><strong>User Session Mocking</strong>:</li>
</ol>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$this-&gt;mockUser-&gt;method(&#x27;getUID&#x27;)-&gt;willReturn(&#x27;alice&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$this-&gt;userSession-&gt;method(&#x27;getUser&#x27;)-&gt;willReturn($this-&gt;mockUser);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="2">
<li><strong>Session Data Mocking</strong>:</li>
</ol>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$this-&gt;session-&gt;method(&#x27;get&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;with(&#x27;openregister_active_organisation_alice&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;willReturn(&#x27;organisation-uuid-123&#x27;);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="3">
<li><strong>Database Mocking</strong>:</li>
</ol>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$this-&gt;organisationMapper</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;expects($this-&gt;once())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;method(&#x27;findByUuid&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;with(&#x27;organisation-uuid-123&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;willReturn($expectedOrganisation);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="performance-testing-guidelines">Performance Testing Guidelines<a href="#performance-testing-guidelines" class="hash-link" aria-label="Direct link to Performance Testing Guidelines" title="Direct link to Performance Testing Guidelines">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="memory-usage-testing">Memory Usage Testing<a href="#memory-usage-testing" class="hash-link" aria-label="Direct link to Memory Usage Testing" title="Direct link to Memory Usage Testing">​</a></h4>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public function testMemoryUsageWithLargeDataset(): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Arrange: Create large dataset</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $memoryBefore = memory_get_usage();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Act: Execute memory-intensive operation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $result = $this-&gt;performLargeOperation();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Assert: Memory usage within acceptable bounds</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $memoryAfter = memory_get_usage();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $memoryDelta = $memoryAfter - $memoryBefore;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $this-&gt;assertLessThan(1024 * 1024, $memoryDelta); // Less than 1MB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="performance-timing">Performance Timing<a href="#performance-timing" class="hash-link" aria-label="Direct link to Performance Timing" title="Direct link to Performance Timing">​</a></h4>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public function testPerformanceWithLargeDataset(): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Arrange: Prepare performance test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $startTime = microtime(true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Act: Execute operation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $result = $this-&gt;performOperation();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Assert: Performance within acceptable bounds</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $endTime = microtime(true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $executionTime = $endTime - $startTime;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $this-&gt;assertLessThan(1.0, $executionTime); // Under 1 second</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="continuous-integration">Continuous Integration<a href="#continuous-integration" class="hash-link" aria-label="Direct link to Continuous Integration" title="Direct link to Continuous Integration">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="automated-test-execution">Automated Test Execution<a href="#automated-test-execution" class="hash-link" aria-label="Direct link to Automated Test Execution" title="Direct link to Automated Test Execution">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="github-actions-configuration">GitHub Actions Configuration<a href="#github-actions-configuration" class="hash-link" aria-label="Direct link to GitHub Actions Configuration" title="Direct link to GitHub Actions Configuration">​</a></h4>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Multi</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Tenancy Tests</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">push</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">branches</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> main</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> develop </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">pull_request</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">branches</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> main </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">jobs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">test</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">runs-on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ubuntu</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">services</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">mysql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> mysql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">8.0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">env</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">MYSQL_ROOT_PASSWORD</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> password</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">MYSQL_DATABASE</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nextcloud</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">options</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">health</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">cmd=&quot;mysqladmin ping&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">health</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">interval=10s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">health</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">timeout=5s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">health</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">retries=3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">steps</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> actions/checkout@v3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Setup PHP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> shivammathur/setup</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">php@v2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">with</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">php-version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;8.1&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">extensions</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> mbstring</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> intl</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> gd</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> xml</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> zip</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> curl</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> mysql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Install dependencies</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> composer install</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Run Multi</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Tenancy Tests</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> php vendor/bin/phpunit tests/Unit/Service/ </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">testdox</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="quality-gates">Quality Gates<a href="#quality-gates" class="hash-link" aria-label="Direct link to Quality Gates" title="Direct link to Quality Gates">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="test-coverage-requirements">Test Coverage Requirements<a href="#test-coverage-requirements" class="hash-link" aria-label="Direct link to Test Coverage Requirements" title="Direct link to Test Coverage Requirements">​</a></h4>
<ul>
<li><strong>Minimum Coverage</strong>: 85% line coverage</li>
<li><strong>Critical Paths</strong>: 100% coverage for security-related code</li>
<li><strong>Performance Tests</strong>: Must complete within time limits</li>
<li><strong>Edge Cases</strong>: All error conditions must be tested</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="code-quality-metrics">Code Quality Metrics<a href="#code-quality-metrics" class="hash-link" aria-label="Direct link to Code Quality Metrics" title="Direct link to Code Quality Metrics">​</a></h4>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// PHPUnit configuration (phpunit.xml)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;coverage&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;include&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;directory&gt;lib/Service/OrganisationService.php&lt;/directory&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;directory&gt;lib/Db/OrganisationMapper.php&lt;/directory&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;directory&gt;lib/Controller/OrganisationController.php&lt;/directory&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;/include&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;report&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;html outputDirectory=&quot;coverage-html&quot;/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;text outputFile=&quot;coverage.txt&quot;/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;/report&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/coverage&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="test-data-management">Test Data Management<a href="#test-data-management" class="hash-link" aria-label="Direct link to Test Data Management" title="Direct link to Test Data Management">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="mock-data-factories">Mock Data Factories<a href="#mock-data-factories" class="hash-link" aria-label="Direct link to Mock Data Factories" title="Direct link to Mock Data Factories">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="organisation-factory">Organisation Factory<a href="#organisation-factory" class="hash-link" aria-label="Direct link to Organisation Factory" title="Direct link to Organisation Factory">​</a></h4>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">class OrganisationTestFactory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static function create(array $overrides = []): Organisation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $organisation = new Organisation();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $organisation-&gt;setName($overrides[&#x27;name&#x27;] ?? &#x27;Test Organisation&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $organisation-&gt;setDescription($overrides[&#x27;description&#x27;] ?? &#x27;Test Description&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $organisation-&gt;setUuid($overrides[&#x27;uuid&#x27;] ?? &#x27;test-uuid-123&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $organisation-&gt;setOwner($overrides[&#x27;owner&#x27;] ?? &#x27;testuser&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $organisation-&gt;setUsers($overrides[&#x27;users&#x27;] ?? [&#x27;testuser&#x27;]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $organisation-&gt;setIsDefault($overrides[&#x27;isDefault&#x27;] ?? false);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return $organisation;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="usage-example">Usage Example<a href="#usage-example" class="hash-link" aria-label="Direct link to Usage Example" title="Direct link to Usage Example">​</a></h4>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public function testOrganisationCreation(): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Arrange</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $testOrg = OrganisationTestFactory::create([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;name&#x27; =&gt; &#x27;ACME Corp&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;owner&#x27; =&gt; &#x27;alice&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;users&#x27; =&gt; [&#x27;alice&#x27;, &#x27;bob&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Test implementation continues...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="test-database-seeding">Test Database Seeding<a href="#test-database-seeding" class="hash-link" aria-label="Direct link to Test Database Seeding" title="Direct link to Test Database Seeding">​</a></h3>
<p>For integration tests that require database state:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">protected function seedTestData(): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Create default organisation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $defaultOrg = OrganisationTestFactory::create([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;name&#x27; =&gt; &#x27;Default Organisation&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;isDefault&#x27; =&gt; true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;owner&#x27; =&gt; &#x27;system&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $this-&gt;organisationMapper-&gt;insert($defaultOrg);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="debugging-test-failures">Debugging Test Failures<a href="#debugging-test-failures" class="hash-link" aria-label="Direct link to Debugging Test Failures" title="Direct link to Debugging Test Failures">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="common-issues-and-solutions">Common Issues and Solutions<a href="#common-issues-and-solutions" class="hash-link" aria-label="Direct link to Common Issues and Solutions" title="Direct link to Common Issues and Solutions">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="1-mock-expectation-failures">1. Mock Expectation Failures<a href="#1-mock-expectation-failures" class="hash-link" aria-label="Direct link to 1. Mock Expectation Failures" title="Direct link to 1. Mock Expectation Failures">​</a></h4>
<p><strong>Issue</strong>: <code>Expectation failed for method name is &quot;methodName&quot; when invoked 1 time</code></p>
<p><strong>Solution</strong>: Verify method is called with correct parameters</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Debug: Add logging to see actual calls</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$this-&gt;organisationMapper</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;expects($this-&gt;once())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;method(&#x27;findByUuid&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;with($this-&gt;callback(function($uuid) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Validation callback for UUID parameter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;willReturn($expectedResult);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="2-session-key-mismatches">2. Session Key Mismatches<a href="#2-session-key-mismatches" class="hash-link" aria-label="Direct link to 2. Session Key Mismatches" title="Direct link to 2. Session Key Mismatches">​</a></h4>
<p><strong>Issue</strong>: Session keys don&#x27;t match expected format</p>
<p><strong>Solution</strong>: Check actual session key naming in service</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Debug: Check actual session keys</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$this-&gt;session-&gt;method(&#x27;get&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -&gt;willReturnCallback(function($key) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Track session key requests for debugging</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    });</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3-http-status-code-mismatches">3. HTTP Status Code Mismatches<a href="#3-http-status-code-mismatches" class="hash-link" aria-label="Direct link to 3. HTTP Status Code Mismatches" title="Direct link to 3. HTTP Status Code Mismatches">​</a></h4>
<p><strong>Issue</strong>: Expected 200 but got 201/400/403</p>
<p><strong>Solution</strong>: Check actual API responses and update expectations</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Debug: Inspect actual response</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$response = $this-&gt;controller-&gt;create($data);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Use assertions to verify response instead of logging</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$this-&gt;assertEquals(200, $response-&gt;getStatus());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$this-&gt;assertArrayHasKey(&#x27;uuid&#x27;, $response-&gt;getData());</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="test-debugging-tools">Test Debugging Tools<a href="#test-debugging-tools" class="hash-link" aria-label="Direct link to Test Debugging Tools" title="Direct link to Test Debugging Tools">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="logging-configuration">Logging Configuration<a href="#logging-configuration" class="hash-link" aria-label="Direct link to Logging Configuration" title="Direct link to Logging Configuration">​</a></h4>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// In test setUp()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (getenv(&#x27;DEBUG_TESTS&#x27;)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $this-&gt;logger = new ConsoleLogger();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $this-&gt;logger = $this-&gt;createMock(LoggerInterface::class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="memory-profiling">Memory Profiling<a href="#memory-profiling" class="hash-link" aria-label="Direct link to Memory Profiling" title="Direct link to Memory Profiling">​</a></h4>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public function tearDown(): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (getenv(&#x27;PROFILE_MEMORY&#x27;)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        echo &quot;Memory usage: &quot; . memory_get_usage() . &quot; bytes\n&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        echo &quot;Peak memory: &quot; . memory_get_peak_usage() . &quot; bytes\n&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parent::tearDown();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="test-maintenance">Test Maintenance<a href="#test-maintenance" class="hash-link" aria-label="Direct link to Test Maintenance" title="Direct link to Test Maintenance">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="keeping-tests-current">Keeping Tests Current<a href="#keeping-tests-current" class="hash-link" aria-label="Direct link to Keeping Tests Current" title="Direct link to Keeping Tests Current">​</a></h3>
<ol>
<li><strong>API Changes</strong>: Update tests when API signatures change</li>
<li><strong>New Features</strong>: Add tests for new functionality</li>
<li><strong>Bug Fixes</strong>: Add regression tests for fixed bugs</li>
<li><strong>Performance Changes</strong>: Update performance expectations</li>
<li><strong>Dependencies</strong>: Update mocks when dependencies change</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="test-review-checklist">Test Review Checklist<a href="#test-review-checklist" class="hash-link" aria-label="Direct link to Test Review Checklist" title="Direct link to Test Review Checklist">​</a></h3>
<ul class="contains-task-list containsTaskList_mC6p">
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->All test methods have descriptive names</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Test scenarios match requirements</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Assertions are meaningful and specific</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Mocks are properly configured</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Error cases are tested</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Performance implications considered</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Documentation updated</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Tests pass consistently</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="refactoring-guidelines">Refactoring Guidelines<a href="#refactoring-guidelines" class="hash-link" aria-label="Direct link to Refactoring Guidelines" title="Direct link to Refactoring Guidelines">​</a></h3>
<p>When refactoring tests:</p>
<ol>
<li><strong>Maintain Test Intent</strong>: Keep the same test scenarios</li>
<li><strong>Update Implementation</strong>: Change only how tests execute</li>
<li><strong>Preserve Coverage</strong>: Ensure coverage doesn&#x27;t decrease</li>
<li><strong>Document Changes</strong>: Note why changes were made</li>
<li><strong>Verify Results</strong>: Ensure tests still validate intended behavior</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="best-practices-summary">Best Practices Summary<a href="#best-practices-summary" class="hash-link" aria-label="Direct link to Best Practices Summary" title="Direct link to Best Practices Summary">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="test-design">Test Design<a href="#test-design" class="hash-link" aria-label="Direct link to Test Design" title="Direct link to Test Design">​</a></h3>
<ol>
<li><strong>Follow AAA Pattern</strong>: Arrange, Act, Assert</li>
<li><strong>One Concept Per Test</strong>: Each test should verify one specific behavior</li>
<li><strong>Descriptive Names</strong>: Test names should clearly describe the scenario</li>
<li><strong>Fast Execution</strong>: Tests should run quickly for rapid feedback</li>
<li><strong>Independent Tests</strong>: Tests should not depend on each other</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="mock-usage">Mock Usage<a href="#mock-usage" class="hash-link" aria-label="Direct link to Mock Usage" title="Direct link to Mock Usage">​</a></h3>
<ol>
<li><strong>Mock External Dependencies</strong>: Don&#x27;t test external systems</li>
<li><strong>Verify Interactions</strong>: Use mocks to verify method calls</li>
<li><strong>Control Responses</strong>: Use mocks to control return values</li>
<li><strong>Isolate System Under Test</strong>: Mock everything except what you&#x27;re testing</li>
<li><strong>Reset State</strong>: Clear mocks between tests</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="test-organization-1">Test Organization<a href="#test-organization-1" class="hash-link" aria-label="Direct link to Test Organization" title="Direct link to Test Organization">​</a></h3>
<ol>
<li><strong>Logical Grouping</strong>: Group related tests in the same class</li>
<li><strong>Consistent Structure</strong>: Follow the same pattern across all tests</li>
<li><strong>Clear Documentation</strong>: Document test purpose and scenarios</li>
<li><strong>Maintainable Code</strong>: Write tests that are easy to modify</li>
<li><strong>Comprehensive Coverage</strong>: Cover both happy path and edge cases</li>
</ol>
<p>The multi-tenancy testing framework provides comprehensive validation of all system functionality, ensuring reliability, security, and performance at scale.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/conductionnl/openregister/tree/main/website/docs/technical/multi-tenancy-testing.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/technical/import-service"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Import Service</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/technical/php"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">php</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#test-architecture" class="table-of-contents__link toc-highlight">Test Architecture</a><ul><li><a href="#test-organization" class="table-of-contents__link toc-highlight">Test Organization</a></li><li><a href="#test-file-structure" class="table-of-contents__link toc-highlight">Test File Structure</a></li></ul></li><li><a href="#test-coverage" class="table-of-contents__link toc-highlight">Test Coverage</a><ul><li><a href="#1-default-organisation-management-tests-11-13" class="table-of-contents__link toc-highlight">1. Default Organisation Management (Tests 1.1-1.3)</a></li><li><a href="#2-organisation-crud-operations-tests-21-27" class="table-of-contents__link toc-highlight">2. Organisation CRUD Operations (Tests 2.1-2.7)</a></li><li><a href="#3-user-organisation-relationships-tests-31-36" class="table-of-contents__link toc-highlight">3. User-Organisation Relationships (Tests 3.1-3.6)</a></li><li><a href="#4-active-organisation-management-tests-41-46" class="table-of-contents__link toc-highlight">4. Active Organisation Management (Tests 4.1-4.6)</a></li><li><a href="#5-entity-organisation-assignment-tests-51-56" class="table-of-contents__link toc-highlight">5. Entity Organisation Assignment (Tests 5.1-5.6)</a></li><li><a href="#6-data-migration-tests-61-63" class="table-of-contents__link toc-highlight">6. Data Migration (Tests 6.1-6.3)</a></li><li><a href="#7-session-cache-management-tests-71-74" class="table-of-contents__link toc-highlight">7. Session Cache Management (Tests 7.1-7.4)</a></li><li><a href="#8-performance--scalability-tests-81-83" class="table-of-contents__link toc-highlight">8. Performance &amp; Scalability (Tests 8.1-8.3)</a></li><li><a href="#9-edge-cases--error-handling-tests-91-95" class="table-of-contents__link toc-highlight">9. Edge Cases &amp; Error Handling (Tests 9.1-9.5)</a></li><li><a href="#10-integration-tests-tests-101-103" class="table-of-contents__link toc-highlight">10. Integration Tests (Tests 10.1-10.3)</a></li></ul></li><li><a href="#test-execution" class="table-of-contents__link toc-highlight">Test Execution</a><ul><li><a href="#running-tests" class="table-of-contents__link toc-highlight">Running Tests</a></li><li><a href="#test-results-interpretation" class="table-of-contents__link toc-highlight">Test Results Interpretation</a></li></ul></li><li><a href="#test-development" class="table-of-contents__link toc-highlight">Test Development</a><ul><li><a href="#writing-new-tests" class="table-of-contents__link toc-highlight">Writing New Tests</a></li><li><a href="#performance-testing-guidelines" class="table-of-contents__link toc-highlight">Performance Testing Guidelines</a></li></ul></li><li><a href="#continuous-integration" class="table-of-contents__link toc-highlight">Continuous Integration</a><ul><li><a href="#automated-test-execution" class="table-of-contents__link toc-highlight">Automated Test Execution</a></li><li><a href="#quality-gates" class="table-of-contents__link toc-highlight">Quality Gates</a></li></ul></li><li><a href="#test-data-management" class="table-of-contents__link toc-highlight">Test Data Management</a><ul><li><a href="#mock-data-factories" class="table-of-contents__link toc-highlight">Mock Data Factories</a></li><li><a href="#test-database-seeding" class="table-of-contents__link toc-highlight">Test Database Seeding</a></li></ul></li><li><a href="#debugging-test-failures" class="table-of-contents__link toc-highlight">Debugging Test Failures</a><ul><li><a href="#common-issues-and-solutions" class="table-of-contents__link toc-highlight">Common Issues and Solutions</a></li><li><a href="#test-debugging-tools" class="table-of-contents__link toc-highlight">Test Debugging Tools</a></li></ul></li><li><a href="#test-maintenance" class="table-of-contents__link toc-highlight">Test Maintenance</a><ul><li><a href="#keeping-tests-current" class="table-of-contents__link toc-highlight">Keeping Tests Current</a></li><li><a href="#test-review-checklist" class="table-of-contents__link toc-highlight">Test Review Checklist</a></li><li><a href="#refactoring-guidelines" class="table-of-contents__link toc-highlight">Refactoring Guidelines</a></li></ul></li><li><a href="#best-practices-summary" class="table-of-contents__link toc-highlight">Best Practices Summary</a><ul><li><a href="#test-design" class="table-of-contents__link toc-highlight">Test Design</a></li><li><a href="#mock-usage" class="table-of-contents__link toc-highlight">Mock Usage</a></li><li><a href="#test-organization-1" class="table-of-contents__link toc-highlight">Test Organization</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Documentation</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/conductionnl/openregister" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 for <a href="https://openwebconcept.nl">Open Webconcept</a> by <a href="https://conduction.nl">Conduction B.V.</a></div></div></div></footer></div>
</body>
</html>