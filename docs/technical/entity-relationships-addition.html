<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-technical/entity-relationships-addition" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Entity Relationships Addition | Open Register</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://openregisters.app/docs/technical/entity-relationships-addition"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Entity Relationships Addition | Open Register"><meta data-rh="true" name="description" content="Overview"><meta data-rh="true" property="og:description" content="Overview"><link data-rh="true" rel="canonical" href="https://openregisters.app/docs/technical/entity-relationships-addition"><link data-rh="true" rel="alternate" href="https://openregisters.app/docs/technical/entity-relationships-addition" hreflang="en"><link data-rh="true" rel="alternate" href="https://openregisters.app/docs/technical/entity-relationships-addition" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.3a202f4d.css">
<script src="/assets/js/runtime~main.7c9b7be8.js" defer="defer"></script>
<script src="/assets/js/main.8e6b3835.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Open Register Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="Open Register Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Open Register</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/Integrations">Documentation</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/api">API Documentation</a><a href="https://github.com/conductionnl/openregister" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/Integrations">Integrations Overview</a><button aria-label="Expand sidebar category &#x27;Integrations Overview&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/Development/Services">Development</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/Features">Core Features</a><button aria-label="Expand sidebar category &#x27;Core Features&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/Technical/vectorization-architecture">Technical</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/UseCases/clientRegisters">UseCases</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/api/bulk-operations">api</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/developers/external-app-optimization">developers</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/development/deeplinking-spot">development</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/features/ai">features</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/technical/vector-search-backends">technical</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/technical/vector-search-backends">Vector Search Backends</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/technical/text-extraction-implementation">Text Extraction Implementation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/technical/schemas">Schema Technical Documentation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/technical/faceting-performance">Hyper-Performant Faceting System</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/technical/authorization-exceptions-performance">Authorization Exceptions Performance</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/technical/text-extraction-entities">Text Extraction Database Entities</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/technical/property-validation">Property Validation Test Matrix</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/technical/enhanced-text-extraction-implementation-plan">Enhanced Text Extraction Implementation Plan</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/technical/entity-relationship-model-updated">Entity Relationship Model Update</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/technical/entity-relationships-addition">Entity Relationships Addition</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/technical/entity-relationships-corrected">Entity Relationships Correction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/technical/text-extraction-readme">Text Extraction Quick Start</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/technical/MultiTenancyImplementationStatus">Multi-Tenancy Implementation Status</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/technical/MultiTenancyTestingResults">Multi-Tenancy API Testing Results</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/technical/MultiTenancy_Implementation_Summary">Multi-Tenancy Implementation Summary</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/technical/MultiTenancy_Test_Results">Multi-Tenancy Object Access Test Results</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/technical/api-caching">API Caching System</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/technical/array-faceting">Array Faceting</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/technical/bulk-operations-implementation">Bulk Operations Implementation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/technical/cache-invalidation-system">Cache Invalidation System</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/technical/file-processing-formats">File Processing: Supported Formats and Limits</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/technical/import-export-implementation">Import/Export Implementation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/technical/import-export">Import and Export</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/technical/import-service">Import Service</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/technical/multi-tenancy-testing">Multi-Tenancy Testing Framework</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/technical/organization-filter-consolidation">Organization Filter Consolidation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/technical/php">php</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/technical/schema-based-facets">Schema-Based Faceting</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/technical/solr-dashboard-management">SOLR Dashboard Management - Technical Implementation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/technical/solr-guzzle-migration">SOLR Guzzle Migration Progress</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/technical/solr-published-only-indexing">Solr Published-Only Indexing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/technical/solr-setup-configuration">SOLR Setup and Configuration Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/technical/unified-faceting-system">Unified Faceting System</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/user/ai-conversations">user</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/user-guide/configuration/api-tokens">user-guide</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">technical</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Entity Relationships Addition</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Entity Relationships Model - Updated Structure</h1></header>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview">​</a></h2>
<p><strong>Updated</strong> the entity relationship model to use a more efficient <strong>parent-child structure</strong> with <code>belongs_to_entity_id</code> field on entities, plus <strong>role-based GDPR compliance</strong> and <strong>source tracking</strong> on entity relations.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="key-improvements">Key Improvements<a href="#key-improvements" class="hash-link" aria-label="Direct link to Key Improvements" title="Direct link to Key Improvements">​</a></h2>
<ol>
<li><strong>BelongsTo Field</strong>: Direct parent reference on child entities (phone/email/address → person/organization)</li>
<li><strong>Role Field</strong>: Track entity context for GDPR anonymization decisions (public_figure, employee, private_individual, etc.)</li>
<li><strong>Source Tracking</strong>: Track ultimate source document (file_id, object_id, email_id) for complete audit trail</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-was-changed">What Was Changed<a href="#what-was-changed" class="hash-link" aria-label="Direct link to What Was Changed" title="Direct link to What Was Changed">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-entity-table-added-belongs_to_entity_id">1. Entity Table: Added belongs_to_entity_id<a href="#1-entity-table-added-belongs_to_entity_id" class="hash-link" aria-label="Direct link to 1. Entity Table: Added belongs_to_entity_id" title="Direct link to 1. Entity Table: Added belongs_to_entity_id">​</a></h3>
<p><strong>Purpose</strong>: Direct parent-child relationships for contact information ownership.</p>
<p><strong>Schema Changes</strong>:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">ALTER</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> oc_openregister_entities </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">ADD</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">COLUMN</span><span class="token plain"> belongs_to_entity_id </span><span class="token keyword" style="color:#00009f">BIGINT</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">ADD</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INDEX</span><span class="token plain"> idx_belongs_to </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">belongs_to_entity_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">ADD</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">FOREIGN</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">KEY</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">belongs_to_entity_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">REFERENCES</span><span class="token plain"> oc_openregister_entities</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">ON</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DELETE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">SET</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Replaces</strong>: EntityLink table for &#x27;belongs_to&#x27; relationships (many-to-many → many-to-one)</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-entityrelation-table-added-role-and-source-tracking">2. EntityRelation Table: Added role and source tracking<a href="#2-entityrelation-table-added-role-and-source-tracking" class="hash-link" aria-label="Direct link to 2. EntityRelation Table: Added role and source tracking" title="Direct link to 2. EntityRelation Table: Added role and source tracking">​</a></h3>
<p><strong>Purpose</strong>: Track entity context and original source documents for GDPR compliance.</p>
<p><strong>Schema Changes</strong>:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">ALTER</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> oc_openregister_entity_relations</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">ADD</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">COLUMN</span><span class="token plain"> role </span><span class="token keyword" style="color:#00009f">VARCHAR</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">50</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">ADD</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">COLUMN</span><span class="token plain"> file_id </span><span class="token keyword" style="color:#00009f">BIGINT</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">ADD</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">COLUMN</span><span class="token plain"> object_id </span><span class="token keyword" style="color:#00009f">BIGINT</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">ADD</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">COLUMN</span><span class="token plain"> email_id </span><span class="token keyword" style="color:#00009f">BIGINT</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">ADD</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INDEX</span><span class="token plain"> idx_role </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">role</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">ADD</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INDEX</span><span class="token plain"> idx_file </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">ADD</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INDEX</span><span class="token plain"> idx_object </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">object_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">ADD</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INDEX</span><span class="token plain"> idx_email </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">email_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>New Fields</strong>:</p>
<ul>
<li><strong>role</strong>: Context of entity (&#x27;public_figure&#x27;, &#x27;employee&#x27;, &#x27;private_individual&#x27;, &#x27;customer&#x27;, &#x27;contractor&#x27;, &#x27;author&#x27;, &#x27;recipient&#x27;, &#x27;mentioned&#x27;)</li>
<li><strong>file_id</strong>: Original file containing this entity</li>
<li><strong>object_id</strong>: Original object containing this entity</li>
<li><strong>email_id</strong>: Original email containing this entity</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-relationship-pattern-parent-child">3. Relationship Pattern: Parent-Child<a href="#3-relationship-pattern-parent-child" class="hash-link" aria-label="Direct link to 3. Relationship Pattern: Parent-Child" title="Direct link to 3. Relationship Pattern: Parent-Child">​</a></h3>
<p><strong>BelongsTo</strong> creates direct parent-child relationships:</p>
<ul>
<li><strong>Phone</strong> → belongs to → <strong>Person</strong> (phone.belongs_to_entity_id = person.id)</li>
<li><strong>Email</strong> → belongs to → <strong>Person</strong> (email.belongs_to_entity_id = person.id)</li>
<li><strong>Address</strong> → belongs to → <strong>Organization</strong> (address.belongs_to_entity_id = organization.id)</li>
<li><strong>Phone</strong> → belongs to → <strong>Organization</strong> (phone.belongs_to_entity_id = organization.id)</li>
</ul>
<p><strong>Query Pattern</strong>:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">-- Get all contact info for a person</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> oc_openregister_entities </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> belongs_to_entity_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> {person_id}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- Get parent entity for a phone</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> parent</span><span class="token punctuation" style="color:#393A34">.</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> oc_openregister_entities child</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">JOIN</span><span class="token plain"> oc_openregister_entities parent </span><span class="token keyword" style="color:#00009f">ON</span><span class="token plain"> child</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">belongs_to_entity_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> parent</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> child</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> {phone_id}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Note</strong>: We do NOT track person-to-person (family) or person-to-organization (employment) relationships. Only attributes/contact info belonging to entities.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-role-based-gdpr-compliance">4. Role-Based GDPR Compliance<a href="#4-role-based-gdpr-compliance" class="hash-link" aria-label="Direct link to 4. Role-Based GDPR Compliance" title="Direct link to 4. Role-Based GDPR Compliance">​</a></h3>
<p><strong>Role Types</strong>:</p>
<ul>
<li><strong>public_figure</strong>: May not require anonymization (e.g., CEO in press release)</li>
<li><strong>employee</strong>: In official capacity, may not require anonymization</li>
<li><strong>private_individual</strong>: Always requires anonymization</li>
<li><strong>customer</strong>: Context-dependent anonymization</li>
<li><strong>contractor</strong>: Context-dependent anonymization</li>
<li><strong>author</strong>: Document creator, context-dependent</li>
<li><strong>recipient</strong>: Document recipient, context-dependent</li>
<li><strong>mentioned</strong>: Mentioned in passing, context-dependent</li>
</ul>
<p><strong>Anonymization Logic</strong>:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public function requiresAnonymization(): bool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $nonPrivateRoles = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self::ROLE_PUBLIC_FIGURE,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self::ROLE_EMPLOYEE,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if ($this-&gt;role &amp;&amp; in_array($this-&gt;role, $nonPrivateRoles)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return false; // May not require anonymization</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if ($this-&gt;role === self::ROLE_PRIVATE_INDIVIDUAL) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return true; // Always requires anonymization</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return true; // Default: require anonymization for safety</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="5-source-tracking-benefits">5. Source Tracking Benefits<a href="#5-source-tracking-benefits" class="hash-link" aria-label="Direct link to 5. Source Tracking Benefits" title="Direct link to 5. Source Tracking Benefits">​</a></h3>
<p><strong>Why track file_id/object_id/email_id?</strong></p>
<ol>
<li><strong>Chunks may change</strong>: Re-chunking, content updates</li>
<li><strong>GDPR requests</strong>: Need original source documents</li>
<li><strong>Anonymization</strong>: Must trace back to original files</li>
<li><strong>Audit trails</strong>: Require source document references</li>
</ol>
<p><strong>Example</strong>:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Entity: John Doe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Found in:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- File #100 (contract.pdf) as role=&#x27;employee&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Object #500 (customer record) as role=&#x27;mentioned&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Email #300 (thread) as role=&#x27;recipient&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- File #150 (personal letter) as role=&#x27;private_individual&#x27; ← REQUIRES ANONYMIZATION</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="6-php-entity-classes-updated">6. PHP Entity Classes Updated<a href="#6-php-entity-classes-updated" class="hash-link" aria-label="Direct link to 6. PHP Entity Classes Updated" title="Direct link to 6. PHP Entity Classes Updated">​</a></h3>
<p><strong>GdprEntity class</strong> now includes:</p>
<ul>
<li><code>belongs_to_entity_id</code> property</li>
<li><code>getParent()</code> method</li>
<li><code>getChildren()</code> method (via mapper)</li>
<li><code>canHaveChildren()</code> helper method</li>
</ul>
<p><strong>EntityRelation class</strong> now includes:</p>
<ul>
<li><code>role</code> property with role constants</li>
<li><code>file_id</code>, <code>object_id</code>, <code>email_id</code> properties</li>
<li><code>requiresAnonymization()</code> method</li>
<li><code>getSourceType()</code> and <code>getSourceId()</code> helper methods</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="7-use-cases">7. Use Cases<a href="#7-use-cases" class="hash-link" aria-label="Direct link to 7. Use Cases" title="Direct link to 7. Use Cases">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="use-case-1-complete-gdpr-profile">Use Case 1: Complete GDPR Profile<a href="#use-case-1-complete-gdpr-profile" class="hash-link" aria-label="Direct link to Use Case 1: Complete GDPR Profile" title="Direct link to Use Case 1: Complete GDPR Profile">​</a></h4>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Find person</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$person = $entityMapper-&gt;findByValue(&#x27;John Doe&#x27;, GdprEntity::TYPE_PERSON);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Get all contact info (simple query with belongs_to_entity_id)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$contactInfo = $entityMapper-&gt;findByBelongsTo($person-&gt;getId());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Get all occurrences with role and source information</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$relations = $entityRelationMapper-&gt;findByEntityId($person-&gt;getId());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">foreach ($relations as $relation) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    echo &quot;Role: {$relation-&gt;getRole()}\n&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    echo &quot;Source: {$relation-&gt;getSourceType()} #{$relation-&gt;getSourceId()}\n&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    echo &quot;Requires anonymization: &quot; . ($relation-&gt;requiresAnonymization() ? &#x27;Yes&#x27; : &#x27;No&#x27;) . &quot;\n&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Output</strong>:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Contact Information:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Phone: +31612345678</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Phone: +31687654321</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Email: john.doe@example.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Email: j.doe@company.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Address: 123 Main St, Amsterdam</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Found In:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- File #100 (contract.pdf): role=employee, anonymization=No</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Object #500 (customer record): role=mentioned, anonymization=Yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Email #300 (email thread): role=recipient, anonymization=Yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- File #150 (personal letter): role=private_individual, anonymization=Yes</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="use-case-2-role-based-anonymization">Use Case 2: Role-Based Anonymization<a href="#use-case-2-role-based-anonymization" class="hash-link" aria-label="Direct link to Use Case 2: Role-Based Anonymization" title="Direct link to Use Case 2: Role-Based Anonymization">​</a></h4>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Find all private individual occurrences</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$relations = $entityRelationMapper-&gt;findByRole(EntityRelation::ROLE_PRIVATE_INDIVIDUAL);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">foreach ($relations as $relation) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if ($relation-&gt;requiresAnonymization()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $entity = $entityMapper-&gt;find($relation-&gt;getEntityId());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Anonymize this occurrence</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $anonymizedValue = $this-&gt;anonymizeEntity($entity-&gt;getType(), $entity-&gt;getValue());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $relation-&gt;setAnonymized(true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $relation-&gt;setAnonymizedValue($anonymizedValue);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $entityRelationMapper-&gt;update($relation);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="use-case-3-source-document-retrieval">Use Case 3: Source Document Retrieval<a href="#use-case-3-source-document-retrieval" class="hash-link" aria-label="Direct link to Use Case 3: Source Document Retrieval" title="Direct link to Use Case 3: Source Document Retrieval">​</a></h4>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// GDPR request: All documents containing John Doe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$person = $entityMapper-&gt;findByValue(&#x27;John Doe&#x27;, GdprEntity::TYPE_PERSON);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$relations = $entityRelationMapper-&gt;findByEntityId($person-&gt;getId());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$sources = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;files&#x27; =&gt; [],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;objects&#x27; =&gt; [],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;emails&#x27; =&gt; []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">foreach ($relations as $relation) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $sourceType = $relation-&gt;getSourceType();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $sourceId = $relation-&gt;getSourceId();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if ($sourceType === &#x27;file&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $sources[&#x27;files&#x27;][] = $sourceId;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } elseif ($sourceType === &#x27;object&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $sources[&#x27;objects&#x27;][] = $sourceId;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } elseif ($sourceType === &#x27;email&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $sources[&#x27;emails&#x27;][] = $sourceId;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Retrieve actual documents</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$files = $fileMapper-&gt;findByIds(array_unique($sources[&#x27;files&#x27;]));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$objects = $objectMapper-&gt;findByIds(array_unique($sources[&#x27;objects&#x27;]));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$emails = $emailMapper-&gt;findByIds(array_unique($sources[&#x27;emails&#x27;]));</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="use-case-4-entity-deduplication">Use Case 4: Entity Deduplication<a href="#use-case-4-entity-deduplication" class="hash-link" aria-label="Direct link to Use Case 4: Entity Deduplication" title="Direct link to Use Case 4: Entity Deduplication">​</a></h4>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Find phone number shared by multiple persons</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$phone = $entityMapper-&gt;findByValue(&#x27;+31612345678&#x27;, GdprEntity::TYPE_PHONE);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$potentialParents = $entityMapper-&gt;findAll(); // Filter by type=person with same phone</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Check if phone belongs to multiple persons (data quality issue)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$personsWithThisPhone = [];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">foreach ($potentialParents as $person) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if ($phone-&gt;getBelongsToEntityId() === $person-&gt;getId()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $personsWithThisPhone[] = $person;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// If &gt;1 person, may need deduplication</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (count($personsWithThisPhone) &gt; 1) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Merge logic...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="8-query-patterns">8. Query Patterns<a href="#8-query-patterns" class="hash-link" aria-label="Direct link to 8. Query Patterns" title="Direct link to 8. Query Patterns">​</a></h3>
<p><strong>Get all contact info for a person</strong> (Simple!):</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> oc_openregister_entities </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> belongs_to_entity_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> {person_id}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Get parent entity for contact info</strong>:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> parent</span><span class="token punctuation" style="color:#393A34">.</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> oc_openregister_entities child</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">JOIN</span><span class="token plain"> oc_openregister_entities parent </span><span class="token keyword" style="color:#00009f">ON</span><span class="token plain"> child</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">belongs_to_entity_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> parent</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> child</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> {contact_id}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Find all entities requiring anonymization</strong>:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DISTINCT</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">.</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> oc_openregister_entities e</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">JOIN</span><span class="token plain"> oc_openregister_entity_relations er </span><span class="token keyword" style="color:#00009f">ON</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> er</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">entity_id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> er</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">role </span><span class="token operator" style="color:#393A34">IN</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;private_individual&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;customer&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">AND</span><span class="token plain"> er</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">anonymized </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">FALSE</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Find all documents containing a specific entity</strong>:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    er</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">file_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    er</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">object_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    er</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">email_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    er</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">role</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    er</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">confidence</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> oc_openregister_entities e</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">JOIN</span><span class="token plain"> oc_openregister_entity_relations er </span><span class="token keyword" style="color:#00009f">ON</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> er</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">entity_id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">value</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;John Doe&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">AND</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;person&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="9-api-endpoints">9. API Endpoints<a href="#9-api-endpoints" class="hash-link" aria-label="Direct link to 9. API Endpoints" title="Direct link to 9. API Endpoints">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">GET  /api/entities/{id}/contact-info</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - Get all contact information for a person/organization</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GET  /api/entities/{id}/parent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - Get parent entity (person/org) for contact info</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GET  /api/entities/{id}/occurrences</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - Get all occurrences with role and source tracking</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GET  /api/gdpr/profile/{entityId}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - Complete GDPR profile with contact info and sources</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GET  /api/gdpr/documents/{entityId}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - All source documents containing this entity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GET  /api/gdpr/anonymization-required</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - List of entities requiring anonymization (by role)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="benefits">Benefits<a href="#benefits" class="hash-link" aria-label="Direct link to Benefits" title="Direct link to Benefits">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-simpler-data-model">1. Simpler Data Model<a href="#1-simpler-data-model" class="hash-link" aria-label="Direct link to 1. Simpler Data Model" title="Direct link to 1. Simpler Data Model">​</a></h3>
<ul>
<li>✅ Direct foreign key instead of join table (belongs_to_entity_id)</li>
<li>✅ One query to get all contact info for a person</li>
<li>✅ Intuitive parent-child structure</li>
<li>✅ Better performance on common queries</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-gdpr-compliance">2. GDPR Compliance<a href="#2-gdpr-compliance" class="hash-link" aria-label="Direct link to 2. GDPR Compliance" title="Direct link to 2. GDPR Compliance">​</a></h3>
<ul>
<li>✅ Role-based anonymization decisions</li>
<li>✅ Context-aware entity handling (public figure vs private individual)</li>
<li>✅ Complete data subject profiles</li>
<li>✅ All contact information properly linked</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-robust-source-tracking">3. Robust Source Tracking<a href="#3-robust-source-tracking" class="hash-link" aria-label="Direct link to 3. Robust Source Tracking" title="Direct link to 3. Robust Source Tracking">​</a></h3>
<ul>
<li>✅ Always trace back to original document</li>
<li>✅ Survives re-chunking operations</li>
<li>✅ Complete audit trail</li>
<li>✅ GDPR request support (all documents containing entity)</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-flexible-anonymization">4. Flexible Anonymization<a href="#4-flexible-anonymization" class="hash-link" aria-label="Direct link to 4. Flexible Anonymization" title="Direct link to 4. Flexible Anonymization">​</a></h3>
<ul>
<li>✅ Public figures may not require anonymization</li>
<li>✅ Employees in official capacity handled appropriately</li>
<li>✅ Private individuals always protected</li>
<li>✅ Context-dependent decisions</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="5-query-performance">5. Query Performance<a href="#5-query-performance" class="hash-link" aria-label="Direct link to 5. Query Performance" title="Direct link to 5. Query Performance">​</a></h3>
<ul>
<li>✅ Indexed belongs_to lookups</li>
<li>✅ Indexed role-based queries</li>
<li>✅ Indexed source-based queries</li>
<li>✅ Efficient parent-child traversal</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="example-complete-entity-structure">Example: Complete Entity Structure<a href="#example-complete-entity-structure" class="hash-link" aria-label="Direct link to Example: Complete Entity Structure" title="Direct link to Example: Complete Entity Structure">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="database-structure">Database Structure<a href="#database-structure" class="hash-link" aria-label="Direct link to Database Structure" title="Direct link to Database Structure">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">oc_openregister_entities:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">id | type         | value                    | belongs_to_entity_id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---|--------------|--------------------------|--------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1  | person       | John Doe                 | NULL (root entity)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2  | phone        | +31612345678             | 1 (belongs to John)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3  | phone        | +31687654321             | 1 (belongs to John)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4  | email        | john.doe@example.com     | 1 (belongs to John)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">5  | email        | j.doe@company.com        | 1 (belongs to John)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">6  | address      | 123 Main St, Amsterdam   | 1 (belongs to John)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">10 | organization | Acme Corp                | NULL (root entity)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">11 | phone        | +31201234567             | 10 (belongs to Acme)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">12 | email        | info@acme.com            | 10 (belongs to Acme)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">13 | email        | sales@acme.com           | 10 (belongs to Acme)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">14 | address      | 456 Business Park        | 10 (belongs to Acme)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">oc_openregister_entity_relations:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">id | entity_id | chunk_id | role              | file_id | confidence</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---|-----------|----------|-------------------|---------|----------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1  | 1         | 100      | employee          | 50      | 0.92</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2  | 2         | 100      | employee          | 50      | 0.85</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3  | 1         | 200      | private_individual| 75      | 0.88</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4  | 4         | 200      | private_individual| 75      | 0.90</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">5  | 10        | 300      | mentioned         | NULL    | 0.95 (object_id=25)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="visual-hierarchy">Visual Hierarchy<a href="#visual-hierarchy" class="hash-link" aria-label="Direct link to Visual Hierarchy" title="Direct link to Visual Hierarchy">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Person: John Doe (id=1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├─ Phone: +31612345678 (id=2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │  └─ Occurrences:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │     └─ File #50 (contract.pdf) as employee</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├─ Phone: +31687654321 (id=3)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├─ Email: john.doe@example.com (id=4)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │  └─ Occurrences:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │     └─ File #75 (personal.pdf) as private_individual ← REQUIRES ANONYMIZATION</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├─ Email: j.doe@company.com (id=5)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  └─ Address: 123 Main St, Amsterdam (id=6)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Organization: Acme Corp (id=10)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├─ Phone: +31201234567 (id=11)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├─ Email: info@acme.com (id=12)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├─ Email: sales@acme.com (id=13)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  └─ Address: 456 Business Park (id=14)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="detection-example">Detection Example<a href="#detection-example" class="hash-link" aria-label="Direct link to Detection Example" title="Direct link to Detection Example">​</a></h2>
<p><strong>Input Text</strong> (from contract.pdf, file_id=100):</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Contact Information:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">John Doe, Sales Manager</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Acme Corporation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Phone: +31612345678</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Email: john.doe@acme.com</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Entities Created</strong>:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1. Person: John Doe (id=1, belongs_to_entity_id=NULL)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2. Organization: Acme Corporation (id=2, belongs_to_entity_id=NULL)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3. Phone: +31612345678 (id=3, belongs_to_entity_id=1) ← belongs to John</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4. Email: john.doe@acme.com (id=4, belongs_to_entity_id=1) ← belongs to John</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>EntityRelation Records</strong>:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1. entity_id=1 (John), chunk_id=50, role=&#x27;employee&#x27;, file_id=100, conf=0.92</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2. entity_id=2 (Acme), chunk_id=50, role=&#x27;mentioned&#x27;, file_id=100, conf=0.95</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3. entity_id=3 (Phone), chunk_id=50, role=&#x27;employee&#x27;, file_id=100, conf=0.85</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4. entity_id=4 (Email), chunk_id=50, role=&#x27;employee&#x27;, file_id=100, conf=0.90</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Anonymization Decision</strong>:</p>
<ul>
<li>All entities have role=&#x27;employee&#x27; → May NOT require anonymization (business context)</li>
<li>If same person appears in personal letter with role=&#x27;private_individual&#x27; → WOULD require anonymization</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="implementation-notes">Implementation Notes<a href="#implementation-notes" class="hash-link" aria-label="Direct link to Implementation Notes" title="Direct link to Implementation Notes">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="storage-considerations">Storage Considerations<a href="#storage-considerations" class="hash-link" aria-label="Direct link to Storage Considerations" title="Direct link to Storage Considerations">​</a></h3>
<p><strong>Per 10,000 documents</strong>:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Entities: ~1,000 unique entities × 600 bytes = 600 KB (with belongs_to_entity_id)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EntityRelations: ~50,000 occurrences × 250 bytes = 12.5 MB (with role and source fields)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Total: ~13 MB (minimal overhead)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="performance-improvements">Performance Improvements<a href="#performance-improvements" class="hash-link" aria-label="Direct link to Performance Improvements" title="Direct link to Performance Improvements">​</a></h3>
<ul>
<li><strong>Get Contact Info</strong>: ~5-20ms (single indexed query on belongs_to_entity_id)</li>
<li><strong>Role-Based Query</strong>: ~10-50ms (indexed on role)</li>
<li><strong>Source Document Query</strong>: ~10-50ms (indexed on file_id/object_id/email_id)</li>
<li><strong>GDPR Profile</strong>: ~50-200ms for complete profile (faster than join table)</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="database-indexes">Database Indexes<a href="#database-indexes" class="hash-link" aria-label="Direct link to Database Indexes" title="Direct link to Database Indexes">​</a></h3>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">-- Entity table</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INDEX</span><span class="token plain"> idx_belongs_to </span><span class="token keyword" style="color:#00009f">ON</span><span class="token plain"> oc_openregister_entities</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">belongs_to_entity_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INDEX</span><span class="token plain"> idx_type </span><span class="token keyword" style="color:#00009f">ON</span><span class="token plain"> oc_openregister_entities</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">type</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- EntityRelation table</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INDEX</span><span class="token plain"> idx_role </span><span class="token keyword" style="color:#00009f">ON</span><span class="token plain"> oc_openregister_entity_relations</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">role</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INDEX</span><span class="token plain"> idx_file </span><span class="token keyword" style="color:#00009f">ON</span><span class="token plain"> oc_openregister_entity_relations</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INDEX</span><span class="token plain"> idx_object </span><span class="token keyword" style="color:#00009f">ON</span><span class="token plain"> oc_openregister_entity_relations</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">object_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INDEX</span><span class="token plain"> idx_email </span><span class="token keyword" style="color:#00009f">ON</span><span class="token plain"> oc_openregister_entity_relations</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">email_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="integration-with-existing-features">Integration with Existing Features<a href="#integration-with-existing-features" class="hash-link" aria-label="Direct link to Integration with Existing Features" title="Direct link to Integration with Existing Features">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="entity-extraction">Entity Extraction<a href="#entity-extraction" class="hash-link" aria-label="Direct link to Entity Extraction" title="Direct link to Entity Extraction">​</a></h3>
<p>When entities are extracted:</p>
<ol>
<li>Detect entities in chunk</li>
<li>Create Entity records</li>
<li><strong>NEW</strong>: Detect relationships and set belongs_to_entity_id</li>
<li>Create EntityRelation records with <strong>role</strong> and <strong>source tracking</strong></li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="gdpr-reports">GDPR Reports<a href="#gdpr-reports" class="hash-link" aria-label="Direct link to GDPR Reports" title="Direct link to GDPR Reports">​</a></h3>
<p>Enhanced reports now include:</p>
<ul>
<li>Complete contact profiles (via belongs_to_entity_id)</li>
<li>Role-based categorization</li>
<li>Source document references</li>
<li>Anonymization requirements per occurrence</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="anonymization-future">Anonymization (Future)<a href="#anonymization-future" class="hash-link" aria-label="Direct link to Anonymization (Future)" title="Direct link to Anonymization (Future)">​</a></h3>
<p>Context-aware anonymization:</p>
<ul>
<li>Check role for each occurrence</li>
<li>Public figures/employees may be excluded</li>
<li>Private individuals always anonymized</li>
<li>Trace back to source documents for replacement</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="documentation-updated">Documentation Updated<a href="#documentation-updated" class="hash-link" aria-label="Direct link to Documentation Updated" title="Direct link to Documentation Updated">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="files-modified">Files Modified<a href="#files-modified" class="hash-link" aria-label="Direct link to Files Modified" title="Direct link to Files Modified">​</a></h3>
<ol>
<li>
<p><strong><a href="/docs/technical/text-extraction-entities">Text Extraction Database Entities</a></strong></p>
<ul>
<li>Updated Entity table schema with belongs_to_entity_id field</li>
<li>Updated EntityRelation table schema with role and source tracking fields</li>
<li>Complete PHP class updates with new methods</li>
<li>Updated ERD diagram</li>
<li>Query examples and use cases</li>
<li>~600 lines of comprehensive documentation</li>
</ul>
</li>
<li>
<p><strong><a href="/docs/technical/entity-relationship-model-updated">Entity Relationship Model Update</a></strong></p>
<ul>
<li>NEW comprehensive guide to the updated model</li>
<li>Detailed rationale for changes</li>
<li>Complete examples and use cases</li>
<li>Migration strategy from EntityLink table</li>
<li>PHP code examples</li>
</ul>
</li>
<li>
<p><strong>Entity Relationship Diagram (ERD)</strong></p>
<ul>
<li>Updated to show belongs_to_entity_id relationship</li>
<li>Shows parent-child structure clearly</li>
</ul>
</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="total-database-tables">Total Database Tables<a href="#total-database-tables" class="hash-link" aria-label="Direct link to Total Database Tables" title="Direct link to Total Database Tables">​</a></h2>
<p><strong>Text Extraction &amp; GDPR (5 tables)</strong>:</p>
<ol>
<li><code>oc_openregister_file_texts</code> (existing, unchanged)</li>
<li><code>oc_openregister_object_texts</code> (new)</li>
<li><code>oc_openregister_chunks</code> (new)</li>
<li><code>oc_openregister_entities</code> (new, <strong>with belongs_to_entity_id</strong>)</li>
<li><code>oc_openregister_entity_relations</code> (new, <strong>with role and source tracking</strong>)</li>
</ol>
<p><strong>Entity Relationships</strong>:</p>
<ul>
<li><strong>REMOVED</strong>: <code>oc_openregister_entity_links</code> table (replaced by belongs_to_entity_id field)</li>
</ul>
<p><strong>Archiving &amp; Metadata (4 tables)</strong> - Future:
6. <code>oc_openregister_classifications</code>
7. <code>oc_openregister_taxonomies</code>
8. <code>oc_openregister_suggestions</code>
9. <code>oc_openregister_metadata</code></p>
<p><strong>Total</strong>: 9 tables across all features (simplified from original 10)</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="next-steps">Next Steps<a href="#next-steps" class="hash-link" aria-label="Direct link to Next Steps" title="Direct link to Next Steps">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="implementation-priority">Implementation Priority<a href="#implementation-priority" class="hash-link" aria-label="Direct link to Implementation Priority" title="Direct link to Implementation Priority">​</a></h3>
<ol>
<li><strong>Phase 1</strong>: Add belongs_to_entity_id to Entity table</li>
<li><strong>Phase 2</strong>: Add role, file_id, object_id, email_id to EntityRelation table</li>
<li><strong>Phase 3</strong>: Implement relationship detection (proximity-based)</li>
<li><strong>Phase 4</strong>: Implement role detection (LLM or pattern-based)</li>
<li><strong>Phase 5</strong>: Add source tracking in extraction pipeline</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="testing-strategy">Testing Strategy<a href="#testing-strategy" class="hash-link" aria-label="Direct link to Testing Strategy" title="Direct link to Testing Strategy">​</a></h3>
<ul>
<li>Unit tests for Entity.getChildren() and Entity.getParent()</li>
<li>Unit tests for EntityRelation.requiresAnonymization()</li>
<li>Integration tests for relationship detection</li>
<li>Performance tests for belongs_to queries</li>
<li>GDPR profile generation tests with role-based filtering</li>
<li>Source tracking tests (re-chunking scenarios)</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="migration-strategy">Migration Strategy<a href="#migration-strategy" class="hash-link" aria-label="Direct link to Migration Strategy" title="Direct link to Migration Strategy">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="from-entitylink-table-if-exists">From EntityLink Table (if exists)<a href="#from-entitylink-table-if-exists" class="hash-link" aria-label="Direct link to From EntityLink Table (if exists)" title="Direct link to From EntityLink Table (if exists)">​</a></h3>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">-- Migrate &#x27;belongs_to&#x27; relationships to Entity.belongs_to_entity_id</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">UPDATE</span><span class="token plain"> oc_openregister_entities e</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">JOIN</span><span class="token plain"> oc_openregister_entity_links el </span><span class="token keyword" style="color:#00009f">ON</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> el</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">source_entity_id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SET</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">belongs_to_entity_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> el</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">target_entity_id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> el</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">relationship_type </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;belongs_to&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- Verify migration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">COUNT</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> oc_openregister_entities </span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> belongs_to_entity_id </span><span class="token operator" style="color:#393A34">IS</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- Drop EntityLink table if no other relationship types are needed</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">DROP</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">IF</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">EXISTS</span><span class="token plain"> oc_openregister_entity_links</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="questions-for-stakeholders">Questions for Stakeholders<a href="#questions-for-stakeholders" class="hash-link" aria-label="Direct link to Questions for Stakeholders" title="Direct link to Questions for Stakeholders">​</a></h3>
<ol>
<li><strong>Role Detection</strong>: Should we use LLM, pattern matching, or manual assignment for roles?</li>
<li><strong>Anonymization Policy</strong>: Should public figures be automatically excluded from anonymization?</li>
<li><strong>Source Tracking</strong>: Should we track chat/comment sources in addition to file/object/email?</li>
<li><strong>Relationship Confidence</strong>: What threshold for auto-setting belongs_to_entity_id?</li>
<li><strong>UI Visualization</strong>: Should we show entity hierarchies in the interface?</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">​</a></h2>
<p><strong>Entity relationship model updated</strong> with more efficient structure and GDPR compliance features:</p>
<p>✅ <strong>Simpler Model</strong>: <code>belongs_to_entity_id</code> field replaces EntityLink table for parent-child relationships<br>
<!-- -->✅ <strong>Role-Based GDPR</strong>: Context-aware anonymization (public figure, employee, private individual)<br>
<!-- -->✅ <strong>Source Tracking</strong>: Complete audit trail with file_id/object_id/email_id fields<br>
<!-- -->✅ <strong>Better Performance</strong>: Direct foreign key queries instead of join table<br>
<!-- -->✅ <strong>PHP Classes Updated</strong>: GdprEntity and EntityRelation with new methods<br>
<!-- -->✅ <strong>Complete Use Cases</strong>: GDPR profiles, anonymization, source retrieval<br>
<!-- -->✅ <strong>API Endpoints</strong>: Simplified queries for common patterns<br>
<!-- -->✅ <strong>~800 lines</strong> of comprehensive documentation across 3 files</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="key-improvements-over-original-design">Key Improvements Over Original Design<a href="#key-improvements-over-original-design" class="hash-link" aria-label="Direct link to Key Improvements Over Original Design" title="Direct link to Key Improvements Over Original Design">​</a></h3>
<ol>
<li><strong>Simplified</strong>: 9 tables instead of 10 (removed EntityLink table)</li>
<li><strong>Faster</strong>: Single query to get contact info (5-20ms vs 50-200ms)</li>
<li><strong>Smarter</strong>: Role-based anonymization decisions</li>
<li><strong>Traceable</strong>: Always know which document contains which entity</li>
<li><strong>Compliant</strong>: Full GDPR data subject request support</li>
</ol>
<p>This updated model provides a solid foundation for enterprise-grade GDPR entity management with optimal performance and maintainability.</p>
<hr>
<p><strong>Documentation Status</strong>: ✅ Complete and ready for implementation</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/conductionnl/openregister/tree/main/website/docs/technical/entity-relationships-addition.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/technical/entity-relationship-model-updated"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Entity Relationship Model Update</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/technical/entity-relationships-corrected"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Entity Relationships Correction</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#key-improvements" class="table-of-contents__link toc-highlight">Key Improvements</a></li><li><a href="#what-was-changed" class="table-of-contents__link toc-highlight">What Was Changed</a><ul><li><a href="#1-entity-table-added-belongs_to_entity_id" class="table-of-contents__link toc-highlight">1. Entity Table: Added belongs_to_entity_id</a></li><li><a href="#2-entityrelation-table-added-role-and-source-tracking" class="table-of-contents__link toc-highlight">2. EntityRelation Table: Added role and source tracking</a></li><li><a href="#3-relationship-pattern-parent-child" class="table-of-contents__link toc-highlight">3. Relationship Pattern: Parent-Child</a></li><li><a href="#4-role-based-gdpr-compliance" class="table-of-contents__link toc-highlight">4. Role-Based GDPR Compliance</a></li><li><a href="#5-source-tracking-benefits" class="table-of-contents__link toc-highlight">5. Source Tracking Benefits</a></li><li><a href="#6-php-entity-classes-updated" class="table-of-contents__link toc-highlight">6. PHP Entity Classes Updated</a></li><li><a href="#7-use-cases" class="table-of-contents__link toc-highlight">7. Use Cases</a></li><li><a href="#8-query-patterns" class="table-of-contents__link toc-highlight">8. Query Patterns</a></li><li><a href="#9-api-endpoints" class="table-of-contents__link toc-highlight">9. API Endpoints</a></li></ul></li><li><a href="#benefits" class="table-of-contents__link toc-highlight">Benefits</a><ul><li><a href="#1-simpler-data-model" class="table-of-contents__link toc-highlight">1. Simpler Data Model</a></li><li><a href="#2-gdpr-compliance" class="table-of-contents__link toc-highlight">2. GDPR Compliance</a></li><li><a href="#3-robust-source-tracking" class="table-of-contents__link toc-highlight">3. Robust Source Tracking</a></li><li><a href="#4-flexible-anonymization" class="table-of-contents__link toc-highlight">4. Flexible Anonymization</a></li><li><a href="#5-query-performance" class="table-of-contents__link toc-highlight">5. Query Performance</a></li></ul></li><li><a href="#example-complete-entity-structure" class="table-of-contents__link toc-highlight">Example: Complete Entity Structure</a><ul><li><a href="#database-structure" class="table-of-contents__link toc-highlight">Database Structure</a></li><li><a href="#visual-hierarchy" class="table-of-contents__link toc-highlight">Visual Hierarchy</a></li></ul></li><li><a href="#detection-example" class="table-of-contents__link toc-highlight">Detection Example</a></li><li><a href="#implementation-notes" class="table-of-contents__link toc-highlight">Implementation Notes</a><ul><li><a href="#storage-considerations" class="table-of-contents__link toc-highlight">Storage Considerations</a></li><li><a href="#performance-improvements" class="table-of-contents__link toc-highlight">Performance Improvements</a></li><li><a href="#database-indexes" class="table-of-contents__link toc-highlight">Database Indexes</a></li></ul></li><li><a href="#integration-with-existing-features" class="table-of-contents__link toc-highlight">Integration with Existing Features</a><ul><li><a href="#entity-extraction" class="table-of-contents__link toc-highlight">Entity Extraction</a></li><li><a href="#gdpr-reports" class="table-of-contents__link toc-highlight">GDPR Reports</a></li><li><a href="#anonymization-future" class="table-of-contents__link toc-highlight">Anonymization (Future)</a></li></ul></li><li><a href="#documentation-updated" class="table-of-contents__link toc-highlight">Documentation Updated</a><ul><li><a href="#files-modified" class="table-of-contents__link toc-highlight">Files Modified</a></li></ul></li><li><a href="#total-database-tables" class="table-of-contents__link toc-highlight">Total Database Tables</a></li><li><a href="#next-steps" class="table-of-contents__link toc-highlight">Next Steps</a><ul><li><a href="#implementation-priority" class="table-of-contents__link toc-highlight">Implementation Priority</a></li><li><a href="#testing-strategy" class="table-of-contents__link toc-highlight">Testing Strategy</a></li></ul></li><li><a href="#migration-strategy" class="table-of-contents__link toc-highlight">Migration Strategy</a><ul><li><a href="#from-entitylink-table-if-exists" class="table-of-contents__link toc-highlight">From EntityLink Table (if exists)</a></li><li><a href="#questions-for-stakeholders" class="table-of-contents__link toc-highlight">Questions for Stakeholders</a></li></ul></li><li><a href="#conclusion" class="table-of-contents__link toc-highlight">Conclusion</a><ul><li><a href="#key-improvements-over-original-design" class="table-of-contents__link toc-highlight">Key Improvements Over Original Design</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Documentation</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/conductionnl/openregister" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 for <a href="https://openwebconcept.nl">Open Webconcept</a> by <a href="https://conduction.nl">Conduction B.V.</a></div></div></div></footer></div>
</body>
</html>