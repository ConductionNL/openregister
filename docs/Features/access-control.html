<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-Features/access-control" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Acces Control | Open Register</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://openregisters.app/docs/Features/access-control"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Acces Control | Open Register"><meta data-rh="true" name="description" content="An overview of how core concepts in Open Register interact with each other."><meta data-rh="true" property="og:description" content="An overview of how core concepts in Open Register interact with each other."><meta data-rh="true" name="keywords" content="Open Register,Core Concepts,Relationships"><link data-rh="true" rel="canonical" href="https://openregisters.app/docs/Features/access-control"><link data-rh="true" rel="alternate" href="https://openregisters.app/docs/Features/access-control" hreflang="en"><link data-rh="true" rel="alternate" href="https://openregisters.app/docs/Features/access-control" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.ee795deb.css">
<script src="/assets/js/runtime~main.4b882c54.js" defer="defer"></script>
<script src="/assets/js/main.fd0dd4e2.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Open Register Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="Open Register Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Open Register</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/Integrations">Documentation</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/api">API Documentation</a><a href="https://github.com/conductionnl/openregister" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/Integrations">Integrations Overview</a><button aria-label="Expand sidebar category &#x27;Integrations Overview&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/Development/Services">Development</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/Features">Core Features</a><button aria-label="Collapse sidebar category &#x27;Core Features&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Features/registers">Register</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Features/schemas">Schemas</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Features/objects">Objects</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Features/sources">Sources</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Features/ai">AI Chat Interface</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Features/search">Search</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Features/events">Core Features</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Features/files">Files</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/Features/access-control">Acces Control</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Features/enhanced-validation-errors">Enhanced Validation Errors</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Features/organisations">Organisations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Features/applications">Applications</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Features/documentation-system">Documentation System</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Features/archiving-and-metadata-feature-summary">Archiving &amp; Metadata Feature Summary</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Features/configurations">Configurations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Features/faceting">Comprehensive Faceting System</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Features/multi-tenancy">Multi-Tenancy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Features/webhooks">Webhooks</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/Technical/vectorization-architecture">Technical</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/UseCases/clientRegisters">UseCases</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/api/bulk-operations">api</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/developers/external-app-optimization">developers</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/development/deeplinking-spot">development</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/features/ai">features</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/technical/vector-search-backends">technical</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/user/ai-conversations">user</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/user-guide/configuration/api-tokens">user-guide</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/Features"><span itemprop="name">Core Features</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Acces Control</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Access Control</h1></header>
<p>Access Control provides enterprise-grade permissions management through integration with Nextcloud RBAC (Role-Based Access Control) and Keycloak.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview">​</a></h2>
<p>The access control system integrates with:</p>
<ul>
<li>ADFS (Active Directory Federation Services) for user and group management via Keycloak</li>
<li>Nextcloud RBAC for role-based permissions</li>
<li>FCS (Federal Cloud Services) compliance requirements</li>
<li>Verwerkingen registers for process tracking</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="permission-levels">Permission Levels<a href="#permission-levels" class="hash-link" aria-label="Direct link to Permission Levels" title="Direct link to Permission Levels">​</a></h2>
<p>Access can be controlled at multiple levels:</p>
<ul>
<li>Register level - Control access to entire registers</li>
<li>Schema level - Manage permissions for specific register/schema combinations</li>
<li>Object level - Set permissions on individual objects</li>
<li>Property level - Fine-grained control over specific object properties</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="permission-types">Permission Types<a href="#permission-types" class="hash-link" aria-label="Direct link to Permission Types" title="Direct link to Permission Types">​</a></h2>
<p>Permissions are granted through:</p>
<ol>
<li>
<p><strong>User Rights</strong></p>
<ul>
<li>CRUD (Create, Read, Update, Delete) operations</li>
<li>Inherited from ADFS groups via Keycloak</li>
<li>Role-based access control through Nextcloud</li>
</ul>
</li>
<li>
<p><strong>Contract Rights</strong></p>
<ul>
<li>Application-level permissions</li>
<li>Process-specific authorizations</li>
<li>Compliance with FCS requirements</li>
<li>Integration with verwerkingen registers</li>
</ul>
</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="implementation">Implementation<a href="#implementation" class="hash-link" aria-label="Direct link to Implementation" title="Direct link to Implementation">​</a></h2>
<p>Access control is implemented through:</p>
<ol>
<li>
<p><strong>User Authentication</strong></p>
<ul>
<li>Direct integration with Keycloak for identity management</li>
<li>ADFS synchronization for user and group information</li>
<li>Single Sign-On (SSO) capabilities</li>
</ul>
</li>
<li>
<p><strong>Permission Management</strong></p>
<ul>
<li>CRUD-level permissions for all system entities</li>
<li>Hierarchical permission inheritance</li>
<li>Fine-grained access control at multiple levels</li>
</ul>
</li>
<li>
<p><strong>Process Integration</strong></p>
<ul>
<li>Compliance with FCS guidelines</li>
<li>Integration with verwerkingen registers for process tracking</li>
<li>Application-specific permission contracts</li>
</ul>
</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="technical-implementation">Technical Implementation<a href="#technical-implementation" class="hash-link" aria-label="Direct link to Technical Implementation" title="Direct link to Technical Implementation">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="architecture-overview">Architecture Overview<a href="#architecture-overview" class="hash-link" aria-label="Direct link to Architecture Overview" title="Direct link to Architecture Overview">​</a></h3>
<!-- -->
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="authorization-flow">Authorization Flow<a href="#authorization-flow" class="hash-link" aria-label="Direct link to Authorization Flow" title="Direct link to Authorization Flow">​</a></h3>
<!-- -->
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="schema-authorization-configuration">Schema Authorization Configuration<a href="#schema-authorization-configuration" class="hash-link" aria-label="Direct link to Schema Authorization Configuration" title="Direct link to Schema Authorization Configuration">​</a></h3>
<!-- -->
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="authorization-exception-system">Authorization Exception System<a href="#authorization-exception-system" class="hash-link" aria-label="Direct link to Authorization Exception System" title="Direct link to Authorization Exception System">​</a></h3>
<!-- -->
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="rbac-query-filtering-process">RBAC Query Filtering Process<a href="#rbac-query-filtering-process" class="hash-link" aria-label="Direct link to RBAC Query Filtering Process" title="Direct link to RBAC Query Filtering Process">​</a></h3>
<!-- -->
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="database-schema">Database Schema<a href="#database-schema" class="hash-link" aria-label="Direct link to Database Schema" title="Direct link to Database Schema">​</a></h3>
<p><strong>Authorization Exception Table: <code>oc_openregister_authorization_exceptions</code></strong></p>
<table><thead><tr><th>Column</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>id</code></td><td>INTEGER</td><td>Primary key</td></tr><tr><td><code>uuid</code></td><td>VARCHAR(36)</td><td>Unique identifier</td></tr><tr><td><code>type</code></td><td>VARCHAR(20)</td><td>Exception type: <code>inclusion</code> or <code>exclusion</code></td></tr><tr><td><code>subject_type</code></td><td>VARCHAR(20)</td><td>Subject type: <code>user</code> or <code>group</code></td></tr><tr><td><code>subject_id</code></td><td>VARCHAR(255)</td><td>User ID or Group ID</td></tr><tr><td><code>schema_uuid</code></td><td>VARCHAR(36)</td><td>Schema UUID (nullable for global)</td></tr><tr><td><code>register_uuid</code></td><td>VARCHAR(36)</td><td>Register UUID (nullable)</td></tr><tr><td><code>organization_uuid</code></td><td>VARCHAR(36)</td><td>Organisation UUID (nullable)</td></tr><tr><td><code>action</code></td><td>VARCHAR(20)</td><td>CRUD action: <code>create</code>, <code>read</code>, <code>update</code>, <code>delete</code></td></tr><tr><td><code>priority</code></td><td>INTEGER</td><td>Priority for resolution (higher = more important)</td></tr><tr><td><code>active</code></td><td>BOOLEAN</td><td>Whether exception is active</td></tr><tr><td><code>description</code></td><td>TEXT</td><td>Human-readable description</td></tr><tr><td><code>created_by</code></td><td>VARCHAR(255)</td><td>User who created the exception</td></tr><tr><td><code>created_at</code></td><td>DATETIME</td><td>Creation timestamp</td></tr><tr><td><code>updated_at</code></td><td>DATETIME</td><td>Last update timestamp</td></tr></tbody></table>
<p><strong>Schema Authorization Field:</strong></p>
<ul>
<li>Stored in <code>oc_openregister_schemas.authorization</code> (JSON)</li>
<li>Format:</li>
</ul>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;create&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;admin&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;editors&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;read&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;admin&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;editors&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;viewers&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;public&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;update&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;admin&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;editors&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;delete&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;admin&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Object Authorization Field:</strong></p>
<ul>
<li>Stored in <code>oc_openregister_objects.authorization</code> (JSON)</li>
<li>Inherits from schema but can be overridden per-object</li>
<li>Same format as schema authorization</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="permission-resolution-algorithm">Permission Resolution Algorithm<a href="#permission-resolution-algorithm" class="hash-link" aria-label="Direct link to Permission Resolution Algorithm" title="Direct link to Permission Resolution Algorithm">​</a></h3>
<!-- -->
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="code-examples">Code Examples<a href="#code-examples" class="hash-link" aria-label="Direct link to Code Examples" title="Direct link to Code Examples">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="schema-authorization-configuration-1">Schema Authorization Configuration<a href="#schema-authorization-configuration-1" class="hash-link" aria-label="Direct link to Schema Authorization Configuration" title="Direct link to Schema Authorization Configuration">​</a></h4>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Setting authorization on a schema</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$schema-&gt;setAuthorization([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;create&#x27; =&gt; [&#x27;admin&#x27;, &#x27;editors&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;read&#x27; =&gt; [&#x27;admin&#x27;, &#x27;editors&#x27;, &#x27;viewers&#x27;, &#x27;public&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;update&#x27; =&gt; [&#x27;admin&#x27;, &#x27;editors&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;delete&#x27; =&gt; [&#x27;admin&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Checking if a user has permission</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$hasPermission = $schema-&gt;hasPermission(&#x27;read&#x27;, $userGroups);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="creating-authorization-exceptions">Creating Authorization Exceptions<a href="#creating-authorization-exceptions" class="hash-link" aria-label="Direct link to Creating Authorization Exceptions" title="Direct link to Creating Authorization Exceptions">​</a></h4>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use OCA\OpenRegister\Db\AuthorizationException;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Create an inclusion exception (grant extra permission)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$inclusion = new AuthorizationException();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$inclusion-&gt;setType(AuthorizationException::TYPE_INCLUSION);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$inclusion-&gt;setSubjectType(AuthorizationException::SUBJECT_TYPE_USER);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$inclusion-&gt;setSubjectId(&#x27;user123&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$inclusion-&gt;setSchemaUuid($schemaUuid);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$inclusion-&gt;setAction(AuthorizationException::ACTION_UPDATE);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$inclusion-&gt;setPriority(10);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$inclusion-&gt;setActive(true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$inclusion-&gt;setDescription(&#x27;Allow user123 to update objects in this schema&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Create an exclusion exception (deny permission)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$exclusion = new AuthorizationException();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$exclusion-&gt;setType(AuthorizationException::TYPE_EXCLUSION);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$exclusion-&gt;setSubjectType(AuthorizationException::SUBJECT_TYPE_GROUP);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$exclusion-&gt;setSubjectId(&#x27;restricted_group&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$exclusion-&gt;setRegisterUuid($registerUuid);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$exclusion-&gt;setAction(AuthorizationException::ACTION_DELETE);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$exclusion-&gt;setPriority(20);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$exclusion-&gt;setActive(true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$exclusion-&gt;setDescription(&#x27;Prevent restricted_group from deleting objects in this register&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Check if an exception matches criteria</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$matches = $exception-&gt;matches(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    subjectType: &#x27;user&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    subjectId: &#x27;user123&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    action: &#x27;update&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    schemaUuid: $schemaUuid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="rbac-query-filtering-magicmapper">RBAC Query Filtering (MagicMapper)<a href="#rbac-query-filtering-magicmapper" class="hash-link" aria-label="Direct link to RBAC Query Filtering (MagicMapper)" title="Direct link to RBAC Query Filtering (MagicMapper)">​</a></h4>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use OCA\OpenRegister\Service\MagicMapperHandlers\MagicRbacHandler;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Apply RBAC filters to a dynamic table query</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$rbacHandler-&gt;applyRbacFilters(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    qb: $queryBuilder,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    register: $register,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    schema: $schema,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tableAlias: &#x27;t&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    userId: $currentUserId,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rbac: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Check if current user is admin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$isAdmin = $rbacHandler-&gt;isCurrentUserAdmin();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Get current user&#x27;s groups</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$userGroups = $rbacHandler-&gt;getCurrentUserGroups();</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="object-level-authorization">Object-Level Authorization<a href="#object-level-authorization" class="hash-link" aria-label="Direct link to Object-Level Authorization" title="Direct link to Object-Level Authorization">​</a></h4>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Get object authorization (inherits from schema if not set)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$objectAuth = $object-&gt;getAuthorization();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Override schema authorization for specific object</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$object-&gt;setAuthorization([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;read&#x27; =&gt; [&#x27;admin&#x27;, &#x27;special_viewers&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;update&#x27; =&gt; [&#x27;admin&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="rbac-configuration">RBAC Configuration<a href="#rbac-configuration" class="hash-link" aria-label="Direct link to RBAC Configuration" title="Direct link to RBAC Configuration">​</a></h3>
<p>RBAC can be configured in Nextcloud app settings:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;enabled&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;adminOverride&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li><strong><code>enabled</code></strong>: Master switch for RBAC system</li>
<li><strong><code>adminOverride</code></strong>: Allow users in &#x27;admin&#x27; group to bypass all RBAC checks</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="performance-optimizations">Performance Optimizations<a href="#performance-optimizations" class="hash-link" aria-label="Direct link to Performance Optimizations" title="Direct link to Performance Optimizations">​</a></h3>
<ol>
<li>
<p><strong>Lazy Group Loading</strong></p>
<ul>
<li>User groups are only fetched when RBAC is enabled</li>
<li>Results are cached within the request lifecycle</li>
</ul>
</li>
<li>
<p><strong>Admin Fast Path</strong></p>
<ul>
<li>Admin users bypass permission checks entirely when override is enabled</li>
<li>Reduces database queries for administrative operations</li>
</ul>
</li>
<li>
<p><strong>Query-Level Filtering</strong></p>
<ul>
<li>RBAC filters are applied at the database query level</li>
<li>Prevents loading unauthorized objects into memory</li>
</ul>
</li>
<li>
<p><strong>Authorization Config Caching</strong></p>
<ul>
<li>Schema authorization configs are cached with schema entities</li>
<li>Reduces redundant JSON parsing</li>
</ul>
</li>
<li>
<p><strong>Exception Priority Indexing</strong></p>
<ul>
<li>Database index on <code>priority</code> field for fast exception sorting</li>
<li>Composite index on <code>(subject_type, subject_id, action, active)</code> for fast matching</li>
</ul>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="integration-points">Integration Points<a href="#integration-points" class="hash-link" aria-label="Direct link to Integration Points" title="Direct link to Integration Points">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="1-objectentitymapper">1. ObjectEntityMapper<a href="#1-objectentitymapper" class="hash-link" aria-label="Direct link to 1. ObjectEntityMapper" title="Direct link to 1. ObjectEntityMapper">​</a></h4>
<ul>
<li>Applies RBAC filters to all object queries via <code>findAll()</code>, <code>find()</code>, <code>count()</code></li>
<li>Respects <code>rbac</code> parameter (default: true)</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="2-magicmapper-dynamic-tables">2. MagicMapper (Dynamic Tables)<a href="#2-magicmapper-dynamic-tables" class="hash-link" aria-label="Direct link to 2. MagicMapper (Dynamic Tables)" title="Direct link to 2. MagicMapper (Dynamic Tables)">​</a></h4>
<ul>
<li>Uses <code>MagicRbacHandler</code> for schema-specific table filtering</li>
<li>Consistent security across schema-generated tables</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3-solr-search">3. Solr Search<a href="#3-solr-search" class="hash-link" aria-label="Direct link to 3. Solr Search" title="Direct link to 3. Solr Search">​</a></h4>
<ul>
<li>RBAC filtering applied via <code>applyAdditionalFilters()</code> in <code>GuzzleSolrService</code></li>
<li>Currently logs RBAC application but full implementation pending</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="4-api-controllers">4. API Controllers<a href="#4-api-controllers" class="hash-link" aria-label="Direct link to 4. API Controllers" title="Direct link to 4. API Controllers">​</a></h4>
<ul>
<li>RBAC checks in <code>ObjectsController</code>, <code>RegistersController</code>, <code>SchemasController</code></li>
<li>Validates permissions before CRUD operations</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="best-practices">Best Practices<a href="#best-practices" class="hash-link" aria-label="Direct link to Best Practices" title="Direct link to Best Practices">​</a></h3>
<ol>
<li>
<p><strong>Use Schema-Level Authorization</strong></p>
<ul>
<li>Define authorization at the schema level for consistency</li>
<li>Only override at object level when necessary</li>
</ul>
</li>
<li>
<p><strong>Leverage Group-Based Permissions</strong></p>
<ul>
<li>Use Nextcloud groups for role management</li>
<li>Avoid user-specific permissions unless absolutely required</li>
</ul>
</li>
<li>
<p><strong>Authorization Exceptions as Last Resort</strong></p>
<ul>
<li>Use exceptions sparingly for edge cases</li>
<li>Document the reason for each exception</li>
<li>Set appropriate priorities to avoid conflicts</li>
</ul>
</li>
<li>
<p><strong>Test Permission Scenarios</strong></p>
<ul>
<li>Test unauthenticated access</li>
<li>Test group membership changes</li>
<li>Test admin override behavior</li>
<li>Test exception priority resolution</li>
</ul>
</li>
<li>
<p><strong>Monitor Authorization Exceptions</strong></p>
<ul>
<li>Regularly audit active exceptions</li>
<li>Deactivate or delete obsolete exceptions</li>
<li>Review exception conflicts (overlapping priorities)</li>
</ul>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="debugging--monitoring">Debugging &amp; Monitoring<a href="#debugging--monitoring" class="hash-link" aria-label="Direct link to Debugging &amp; Monitoring" title="Direct link to Debugging &amp; Monitoring">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="enable-debug-logging">Enable Debug Logging<a href="#enable-debug-logging" class="hash-link" aria-label="Direct link to Enable Debug Logging" title="Direct link to Enable Debug Logging">​</a></h4>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// In GuzzleSolrService</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$this-&gt;logger-&gt;debug(&#x27;[SOLR] RBAC filtering applied&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// In MagicRbacHandler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$this-&gt;logger-&gt;debug(&#x27;Applying RBAC filters&#x27;, [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;user_id&#x27; =&gt; $userId,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;user_groups&#x27; =&gt; $userGroups,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;schema_uuid&#x27; =&gt; $schema-&gt;getUuid()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="check-authorization-config">Check Authorization Config<a href="#check-authorization-config" class="hash-link" aria-label="Direct link to Check Authorization Config" title="Direct link to Check Authorization Config">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Query schema authorization</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker exec -u 33 master-nextcloud-1 php -r &quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">\$schema = \OC::$server-&gt;get(\OCA\OpenRegister\Db\SchemaMapper::class)-&gt;find(1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var_dump(\$schema-&gt;getAuthorization());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="query-authorization-exceptions">Query Authorization Exceptions<a href="#query-authorization-exceptions" class="hash-link" aria-label="Direct link to Query Authorization Exceptions" title="Direct link to Query Authorization Exceptions">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># List active exceptions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker exec -it master-database-mysql-1 mysql -u nextcloud -pnextcloud nextcloud -e &quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SELECT type, subject_type, subject_id, action, priority, description </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FROM oc_openregister_authorization_exceptions </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WHERE active = 1 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ORDER BY priority DESC;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="security-considerations">Security Considerations<a href="#security-considerations" class="hash-link" aria-label="Direct link to Security Considerations" title="Direct link to Security Considerations">​</a></h3>
<ol>
<li>
<p><strong>Default Deny</strong></p>
<ul>
<li>When authorization is configured, default behavior is to deny access</li>
<li>Explicitly configure &#x27;public&#x27; in read permissions for public access</li>
</ul>
</li>
<li>
<p><strong>Admin Override</strong></p>
<ul>
<li>Admin override can be disabled for high-security environments</li>
<li>When disabled, even admins must have explicit permissions</li>
</ul>
</li>
<li>
<p><strong>Authorization Inheritance</strong></p>
<ul>
<li>Objects inherit authorization from schemas</li>
<li>Object-level overrides take precedence</li>
</ul>
</li>
<li>
<p><strong>Exception Priority</strong></p>
<ul>
<li>Exclusions should have higher priority than inclusions to ensure security</li>
<li>Use priority &gt; 50 for security-critical exclusions</li>
</ul>
</li>
<li>
<p><strong>Unauthenticated Access</strong></p>
<ul>
<li>Unauthenticated users only see objects with &#x27;public&#x27; in read permissions</li>
<li>Fallback to published object filtering can be enabled (currently disabled)</li>
</ul>
</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="authorization-exceptions">Authorization Exceptions<a href="#authorization-exceptions" class="hash-link" aria-label="Direct link to Authorization Exceptions" title="Direct link to Authorization Exceptions">​</a></h2>
<p>The Authorization Exception System provides a flexible way to override the standard Role-Based Access Control (RBAC) system. It allows for fine-grained control over permissions by defining specific inclusions and exclusions that take precedence over normal authorization rules.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="exception-types">Exception Types<a href="#exception-types" class="hash-link" aria-label="Direct link to Exception Types" title="Direct link to Exception Types">​</a></h3>
<ol>
<li><strong>Inclusions</strong>: Grant additional permissions to users or groups that they wouldn&#x27;t normally have</li>
<li><strong>Exclusions</strong>: Deny permissions to users or groups even if they would normally have access through RBAC</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="subject-types">Subject Types<a href="#subject-types" class="hash-link" aria-label="Direct link to Subject Types" title="Direct link to Subject Types">​</a></h3>
<ul>
<li><strong>User</strong>: Exceptions that apply to specific individual users</li>
<li><strong>Group</strong>: Exceptions that apply to all members of a specific group</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="priority-system">Priority System<a href="#priority-system" class="hash-link" aria-label="Direct link to Priority System" title="Direct link to Priority System">​</a></h3>
<p>Authorization exceptions use a priority system to resolve conflicts:</p>
<ol>
<li><strong>Exclusions</strong> (highest priority) - Always deny access if applicable</li>
<li><strong>Inclusions</strong> (medium priority) - Grant access if no exclusions apply</li>
<li><strong>Normal RBAC</strong> (lowest priority) - Default system behavior</li>
</ol>
<p>Within each type, exceptions with higher numerical priority values take precedence.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="database-schema-1">Database Schema<a href="#database-schema-1" class="hash-link" aria-label="Direct link to Database Schema" title="Direct link to Database Schema">​</a></h3>
<p>The <code>oc_openregister_authorization_exceptions</code> table stores authorization exceptions with the following key fields:</p>
<ul>
<li><code>type</code>: &#x27;inclusion&#x27; or &#x27;exclusion&#x27;</li>
<li><code>subject_type</code>: &#x27;user&#x27; or &#x27;group&#x27;</li>
<li><code>subject_id</code>: The actual user ID or group ID</li>
<li><code>action</code>: CRUD operation (&#x27;create&#x27;, &#x27;read&#x27;, &#x27;update&#x27;, &#x27;delete&#x27;)</li>
<li><code>schema_uuid</code>: Optional - limits exception to specific schema</li>
<li><code>register_uuid</code>: Optional - limits exception to specific register</li>
<li><code>organization_uuid</code>: Optional - limits exception to specific organization</li>
<li><code>priority</code>: Integer priority for conflict resolution</li>
<li><code>active</code>: Boolean to enable/disable exceptions</li>
<li><code>description</code>: Human-readable description</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="usage-examples">Usage Examples<a href="#usage-examples" class="hash-link" aria-label="Direct link to Usage Examples" title="Direct link to Usage Examples">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="example-1-group-cross-organization-access">Example 1: Group Cross-Organization Access<a href="#example-1-group-cross-organization-access" class="hash-link" aria-label="Direct link to Example 1: Group Cross-Organization Access" title="Direct link to Example 1: Group Cross-Organization Access">​</a></h4>
<p>Allow users in the &#x27;ambtenaar&#x27; group to read &#x27;gebruik&#x27; objects from all organizations:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$exception = new AuthorizationException();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$exception-&gt;setType(AuthorizationException::TYPE_INCLUSION);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$exception-&gt;setSubjectType(AuthorizationException::SUBJECT_TYPE_GROUP);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$exception-&gt;setSubjectId(&#x27;ambtenaar&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$exception-&gt;setAction(AuthorizationException::ACTION_READ);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$exception-&gt;setSchemaUuid(&#x27;gebruik-schema-uuid&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$exception-&gt;setPriority(20); // High priority to override multi-tenancy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$exception-&gt;setDescription(&#x27;Allow ambtenaar group to read gebruik objects from all organizations&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$authService-&gt;createException(/* parameters */);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="example-2-user-exclusion">Example 2: User Exclusion<a href="#example-2-user-exclusion" class="hash-link" aria-label="Direct link to Example 2: User Exclusion" title="Direct link to Example 2: User Exclusion">​</a></h4>
<p>Deny a specific user update access despite group membership:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$exception = new AuthorizationException();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$exception-&gt;setType(AuthorizationException::TYPE_EXCLUSION);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$exception-&gt;setSubjectType(AuthorizationException::SUBJECT_TYPE_USER);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$exception-&gt;setSubjectId(&#x27;problematic-user&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$exception-&gt;setAction(AuthorizationException::ACTION_UPDATE);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$exception-&gt;setSchemaUuid(&#x27;sensitive-schema-uuid&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$exception-&gt;setPriority(15);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$exception-&gt;setDescription(&#x27;Deny user update access due to security concerns&#x27;);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="api-usage">API Usage<a href="#api-usage" class="hash-link" aria-label="Direct link to API Usage" title="Direct link to API Usage">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="creating-exceptions">Creating Exceptions<a href="#creating-exceptions" class="hash-link" aria-label="Direct link to Creating Exceptions" title="Direct link to Creating Exceptions">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Create user inclusion</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl -X POST http://localhost/index.php/apps/openregister/api/authorization-exceptions \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -u &#x27;admin:admin&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -H &#x27;Content-Type: application/json&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -H &#x27;OCS-APIREQUEST: true&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -d &#x27;{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;type&quot;: &quot;inclusion&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;subject_type&quot;: &quot;user&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;subject_id&quot;: &quot;special-user&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;action&quot;: &quot;read&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;schema_uuid&quot;: &quot;confidential-schema-uuid&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;priority&quot;: 10,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;description&quot;: &quot;Allow special user to read confidential data&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="listing-exceptions">Listing Exceptions<a href="#listing-exceptions" class="hash-link" aria-label="Direct link to Listing Exceptions" title="Direct link to Listing Exceptions">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># List all exceptions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl http://localhost/index.php/apps/openregister/api/authorization-exceptions \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -u &#x27;admin:admin&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -H &#x27;OCS-APIREQUEST: true&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Filter by criteria</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl &#x27;http://localhost/index.php/apps/openregister/api/authorization-exceptions?type=inclusion&amp;active=true&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -u &#x27;admin:admin&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -H &#x27;OCS-APIREQUEST: true&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="integration-with-rbac">Integration with RBAC<a href="#integration-with-rbac" class="hash-link" aria-label="Direct link to Integration with RBAC" title="Direct link to Integration with RBAC">​</a></h3>
<p>The authorization exception system integrates seamlessly with the existing RBAC system:</p>
<ol>
<li><strong>Query Level</strong>: The <code>ObjectEntityMapper::applyRbacFilters()</code> method checks for exceptions before applying normal RBAC rules</li>
<li><strong>Object Level</strong>: The <code>ObjectEntityMapper::checkObjectPermission()</code> method evaluates exceptions first, then falls back to standard permission checks</li>
<li><strong>Evaluation Order</strong>: Exclusions → Inclusions → Normal RBAC → Object ownership → Publication status</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="best-practices-1">Best Practices<a href="#best-practices-1" class="hash-link" aria-label="Direct link to Best Practices" title="Direct link to Best Practices">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="1-use-specific-scope">1. Use Specific Scope<a href="#1-use-specific-scope" class="hash-link" aria-label="Direct link to 1. Use Specific Scope" title="Direct link to 1. Use Specific Scope">​</a></h4>
<p>Always limit exceptions to the most specific scope possible:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Good - specific to schema and organization</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$exception-&gt;setSchemaUuid(&#x27;specific-schema&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$exception-&gt;setOrganizationUuid(&#x27;specific-org&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Avoid - too broad, affects everything</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// (leaving schema_uuid and organization_uuid as null)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="2-set-appropriate-priorities">2. Set Appropriate Priorities<a href="#2-set-appropriate-priorities" class="hash-link" aria-label="Direct link to 2. Set Appropriate Priorities" title="Direct link to 2. Set Appropriate Priorities">​</a></h4>
<p>Use priority levels consistently:</p>
<ul>
<li><strong>1-10</strong>: Low priority inclusions</li>
<li><strong>11-20</strong>: Medium priority inclusions</li>
<li><strong>21-30</strong>: High priority inclusions</li>
<li><strong>31-40</strong>: Low priority exclusions</li>
<li><strong>41-50</strong>: Medium priority exclusions</li>
<li><strong>51+</strong>: High priority exclusions</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3-document-exceptions">3. Document Exceptions<a href="#3-document-exceptions" class="hash-link" aria-label="Direct link to 3. Document Exceptions" title="Direct link to 3. Document Exceptions">​</a></h4>
<p>Always provide clear descriptions explaining why the exception exists:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$exception-&gt;setDescription(&#x27;Allow support team to read customer data for troubleshooting purposes - ticket #12345&#x27;);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="4-regular-audits">4. Regular Audits<a href="#4-regular-audits" class="hash-link" aria-label="Direct link to 4. Regular Audits" title="Direct link to 4. Regular Audits">​</a></h4>
<p>Regularly review authorization exceptions to ensure they&#x27;re still needed:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Find old exceptions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$oldExceptions = $mapper-&gt;findByCriteria([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;created_at&#x27; =&gt; &#x27;&lt;&#x27; . (new DateTime(&#x27;-6 months&#x27;))-&gt;format(&#x27;Y-m-d&#x27;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;active&#x27; =&gt; true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="troubleshooting">Troubleshooting<a href="#troubleshooting" class="hash-link" aria-label="Direct link to Troubleshooting" title="Direct link to Troubleshooting">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="exception-not-working">Exception Not Working<a href="#exception-not-working" class="hash-link" aria-label="Direct link to Exception Not Working" title="Direct link to Exception Not Working">​</a></h4>
<ol>
<li>
<p>Check if exception is active:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$exception = $mapper-&gt;findByUuid($uuid);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var_dump($exception-&gt;getActive());</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Verify priority is high enough:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$exceptions = $service-&gt;getUserExceptions($userId);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">usort($exceptions, fn($a, $b) =&gt; $b-&gt;getPriority() &lt;=&gt; $a-&gt;getPriority());</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Check scope matching:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$result = $exception-&gt;matches($subjectType, $subjectId, $action, $schemaUuid);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="security-considerations-1">Security Considerations<a href="#security-considerations-1" class="hash-link" aria-label="Direct link to Security Considerations" title="Direct link to Security Considerations">​</a></h3>
<ol>
<li><strong>Audit Trail</strong>: All exception creation/modification is logged with user information</li>
<li><strong>Admin Only</strong>: Only administrators should create/modify authorization exceptions</li>
<li><strong>Regular Review</strong>: Exceptions should be reviewed quarterly to ensure they&#x27;re still appropriate</li>
<li><strong>Principle of Least Privilege</strong>: Use the most restrictive scope possible for each exception</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="future-enhancements">Future Enhancements<a href="#future-enhancements" class="hash-link" aria-label="Direct link to Future Enhancements" title="Direct link to Future Enhancements">​</a></h3>
<ol>
<li>
<p><strong>Field-Level Authorization</strong></p>
<ul>
<li>Control access to specific object properties</li>
<li>Redact sensitive fields based on user permissions</li>
</ul>
</li>
<li>
<p><strong>Time-Based Permissions</strong></p>
<ul>
<li>Temporary permission grants with expiration</li>
<li>Scheduled permission changes</li>
</ul>
</li>
<li>
<p><strong>Audit Logging</strong></p>
<ul>
<li>Log all authorization decisions</li>
<li>Track permission changes over time</li>
</ul>
</li>
<li>
<p><strong>Permission Testing Tool</strong></p>
<ul>
<li>UI for testing user permissions</li>
<li>Visualize effective permissions for users/groups</li>
</ul>
</li>
<li>
<p><strong>RBAC Analytics</strong></p>
<ul>
<li>Permission usage statistics</li>
<li>Identify over-privileged users</li>
<li>Suggest permission optimizations</li>
</ul>
</li>
</ol></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/conductionnl/openregister/tree/main/website/docs/Features/access-control.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/Features/files"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Files</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/Features/enhanced-validation-errors"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Enhanced Validation Errors</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#permission-levels" class="table-of-contents__link toc-highlight">Permission Levels</a></li><li><a href="#permission-types" class="table-of-contents__link toc-highlight">Permission Types</a></li><li><a href="#implementation" class="table-of-contents__link toc-highlight">Implementation</a></li><li><a href="#technical-implementation" class="table-of-contents__link toc-highlight">Technical Implementation</a><ul><li><a href="#architecture-overview" class="table-of-contents__link toc-highlight">Architecture Overview</a></li><li><a href="#authorization-flow" class="table-of-contents__link toc-highlight">Authorization Flow</a></li><li><a href="#schema-authorization-configuration" class="table-of-contents__link toc-highlight">Schema Authorization Configuration</a></li><li><a href="#authorization-exception-system" class="table-of-contents__link toc-highlight">Authorization Exception System</a></li><li><a href="#rbac-query-filtering-process" class="table-of-contents__link toc-highlight">RBAC Query Filtering Process</a></li><li><a href="#database-schema" class="table-of-contents__link toc-highlight">Database Schema</a></li><li><a href="#permission-resolution-algorithm" class="table-of-contents__link toc-highlight">Permission Resolution Algorithm</a></li><li><a href="#code-examples" class="table-of-contents__link toc-highlight">Code Examples</a></li><li><a href="#rbac-configuration" class="table-of-contents__link toc-highlight">RBAC Configuration</a></li><li><a href="#performance-optimizations" class="table-of-contents__link toc-highlight">Performance Optimizations</a></li><li><a href="#integration-points" class="table-of-contents__link toc-highlight">Integration Points</a></li><li><a href="#best-practices" class="table-of-contents__link toc-highlight">Best Practices</a></li><li><a href="#debugging--monitoring" class="table-of-contents__link toc-highlight">Debugging &amp; Monitoring</a></li><li><a href="#security-considerations" class="table-of-contents__link toc-highlight">Security Considerations</a></li></ul></li><li><a href="#authorization-exceptions" class="table-of-contents__link toc-highlight">Authorization Exceptions</a><ul><li><a href="#exception-types" class="table-of-contents__link toc-highlight">Exception Types</a></li><li><a href="#subject-types" class="table-of-contents__link toc-highlight">Subject Types</a></li><li><a href="#priority-system" class="table-of-contents__link toc-highlight">Priority System</a></li><li><a href="#database-schema-1" class="table-of-contents__link toc-highlight">Database Schema</a></li><li><a href="#usage-examples" class="table-of-contents__link toc-highlight">Usage Examples</a></li><li><a href="#api-usage" class="table-of-contents__link toc-highlight">API Usage</a></li><li><a href="#integration-with-rbac" class="table-of-contents__link toc-highlight">Integration with RBAC</a></li><li><a href="#best-practices-1" class="table-of-contents__link toc-highlight">Best Practices</a></li><li><a href="#troubleshooting" class="table-of-contents__link toc-highlight">Troubleshooting</a></li><li><a href="#security-considerations-1" class="table-of-contents__link toc-highlight">Security Considerations</a></li><li><a href="#future-enhancements" class="table-of-contents__link toc-highlight">Future Enhancements</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Documentation</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/conductionnl/openregister" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 for <a href="https://openwebconcept.nl">Open Webconcept</a> by <a href="https://conduction.nl">Conduction B.V.</a></div></div></div></footer></div>
</body>
</html>