<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-Features/multi-tenancy" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Multi-Tenancy | Open Register</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://openregisters.app/docs/Features/multi-tenancy"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Multi-Tenancy | Open Register"><meta data-rh="true" name="description" content="OpenRegister&#x27;s multi-tenancy system provides complete organisation-based data isolation, enabling multiple organizations to securely share the same application instance while maintaining strict data segregation."><meta data-rh="true" property="og:description" content="OpenRegister&#x27;s multi-tenancy system provides complete organisation-based data isolation, enabling multiple organizations to securely share the same application instance while maintaining strict data segregation."><link data-rh="true" rel="canonical" href="https://openregisters.app/docs/Features/multi-tenancy"><link data-rh="true" rel="alternate" href="https://openregisters.app/docs/Features/multi-tenancy" hreflang="en"><link data-rh="true" rel="alternate" href="https://openregisters.app/docs/Features/multi-tenancy" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.3a202f4d.css">
<script src="/assets/js/runtime~main.7c9b7be8.js" defer="defer"></script>
<script src="/assets/js/main.8e6b3835.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Open Register Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="Open Register Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Open Register</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/Integrations">Documentation</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/api">API Documentation</a><a href="https://github.com/conductionnl/openregister" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/Integrations">Integrations Overview</a><button aria-label="Expand sidebar category &#x27;Integrations Overview&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/Development/Services">Development</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/Features">Core Features</a><button aria-label="Collapse sidebar category &#x27;Core Features&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Features/registers">Register</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Features/schemas">Schemas</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Features/objects">Objects</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Features/sources">Sources</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Features/ai">AI Chat Interface</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Features/search">Search</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Features/events">Core Features</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Features/files">Files</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Features/access-control">Acces Control</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Features/enhanced-validation-errors">Enhanced Validation Errors</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Features/organisations">Organisations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Features/applications">Applications</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Features/documentation-system">Documentation System</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Features/archiving-and-metadata-feature-summary">Archiving &amp; Metadata Feature Summary</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Features/configurations">Configurations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Features/faceting">Comprehensive Faceting System</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/Features/multi-tenancy">Multi-Tenancy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Features/webhooks">Webhooks</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/Technical/vectorization-architecture">Technical</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/UseCases/clientRegisters">UseCases</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/api/bulk-operations">api</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/developers/external-app-optimization">developers</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/development/deeplinking-spot">development</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/features/ai">features</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/technical/vector-search-backends">technical</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/user/ai-conversations">user</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/user-guide/configuration/api-tokens">user-guide</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/Features"><span itemprop="name">Core Features</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Multi-Tenancy</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Multi-Tenancy</h1></header>
<p>OpenRegister&#x27;s multi-tenancy system provides complete organisation-based data isolation, enabling multiple organizations to securely share the same application instance while maintaining strict data segregation.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview">​</a></h2>
<p>Multi-tenancy enables organizations to:</p>
<ul>
<li><strong>Maintain Complete Data Isolation</strong>: Each organisation&#x27;s data remains completely separate</li>
<li><strong>Manage User Memberships</strong>: Users can belong to multiple organisations with flexible switching</li>
<li><strong>Automatic Entity Assignment</strong>: All registers, schemas, and objects automatically assigned to active organisation</li>
<li><strong>Session-Based Context</strong>: Active organisation context maintained throughout user sessions</li>
<li><strong>Enterprise-Grade Security</strong>: Prevents cross-organisation data access and maintains audit trails</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="core-components">Core Components<a href="#core-components" class="hash-link" aria-label="Direct link to Core Components" title="Direct link to Core Components">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="organisation-management">Organisation Management<a href="#organisation-management" class="hash-link" aria-label="Direct link to Organisation Management" title="Direct link to Organisation Management">​</a></h3>
<ul>
<li><strong>Organisation Creation</strong>: Create and manage organisations with names, descriptions, and settings</li>
<li><strong>User Membership</strong>: Manage which users belong to which organisations</li>
<li><strong>User Selection for Joining</strong>: Optionally specify which user to add when joining an organisation (defaults to current user)</li>
<li><strong>Default Organisation</strong>: Automatic fallback organisation for users without specific memberships</li>
<li><strong>Organisation Statistics</strong>: Track usage, user counts, and system metrics</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="session-management">Session Management<a href="#session-management" class="hash-link" aria-label="Direct link to Session Management" title="Direct link to Session Management">​</a></h3>
<ul>
<li><strong>Active Organisation</strong>: Users have one active organisation per session</li>
<li><strong>Context Switching</strong>: Seamless switching between organisations the user belongs to</li>
<li><strong>Session Persistence</strong>: Active organisation maintained across requests and sessions</li>
<li><strong>Cache Management</strong>: Performance-optimized with intelligent caching and cache clearing</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="automatic-entity-assignment">Automatic Entity Assignment<a href="#automatic-entity-assignment" class="hash-link" aria-label="Direct link to Automatic Entity Assignment" title="Direct link to Automatic Entity Assignment">​</a></h3>
<ul>
<li><strong>Registers</strong>: Automatically assigned to user&#x27;s active organisation when created</li>
<li><strong>Schemas</strong>: Inherit organisation context from active organisation</li>
<li><strong>Objects</strong>: Scoped to organisation context with automatic assignment</li>
<li><strong>Cross-Organisation Prevention</strong>: Prevents users from creating entities in organisations they don&#x27;t belong to</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="key-features">Key Features<a href="#key-features" class="hash-link" aria-label="Direct link to Key Features" title="Direct link to Key Features">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="enterprise-scalability">Enterprise Scalability<a href="#enterprise-scalability" class="hash-link" aria-label="Direct link to Enterprise Scalability" title="Direct link to Enterprise Scalability">​</a></h3>
<div class="language-mermaid codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-mermaid codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">graph LR</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    A[User] --&gt; B[Multiple Organisations]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    B --&gt; C[Active Context]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    C --&gt; D[Entity Creation]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    D --&gt; E[Organisation Assignment]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    E --&gt; F[Data Isolation]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="security-model">Security Model<a href="#security-model" class="hash-link" aria-label="Direct link to Security Model" title="Direct link to Security Model">​</a></h3>
<ul>
<li><strong>Access Control Integration</strong>: Works seamlessly with existing RBAC system</li>
<li><strong>Cross-Organisation Prevention</strong>: Users cannot access data from other organisations</li>
<li><strong>Audit Trails</strong>: All actions include organisation context for compliance</li>
<li><strong>Session Isolation</strong>: User sessions isolated by organisation context</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="performance-optimizations">Performance Optimizations<a href="#performance-optimizations" class="hash-link" aria-label="Direct link to Performance Optimizations" title="Direct link to Performance Optimizations">​</a></h3>
<ul>
<li><strong>Database Query Filtering</strong>: Efficient filtering at database level using joins</li>
<li><strong>Session-Based Caching</strong>: Active organisation cached in user sessions</li>
<li><strong>Lazy Loading</strong>: Organisation data loaded only when needed</li>
<li><strong>Query Optimization</strong>: Optimized queries prevent unnecessary cross-organisation data retrieval</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="api-endpoints">API Endpoints<a href="#api-endpoints" class="hash-link" aria-label="Direct link to API Endpoints" title="Direct link to API Endpoints">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="organisation-management-1">Organisation Management<a href="#organisation-management-1" class="hash-link" aria-label="Direct link to Organisation Management" title="Direct link to Organisation Management">​</a></h3>
<ul>
<li><code>GET /api/organisations</code> - List user&#x27;s organisations with active organisation</li>
<li><code>POST /api/organisations</code> - Create new organisation</li>
<li><code>GET /api/organisations/{uuid}</code> - Get organisation details</li>
<li><code>PUT /api/organisations/{uuid}</code> - Update organisation</li>
<li><code>GET /api/organisations/search</code> - Search organisations</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="active-organisation">Active Organisation<a href="#active-organisation" class="hash-link" aria-label="Direct link to Active Organisation" title="Direct link to Active Organisation">​</a></h3>
<ul>
<li><code>GET /api/organisations/active</code> - Get current active organisation</li>
<li><code>POST /api/organisations/{uuid}/set-active</code> - Set active organisation</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="user-organisation-relationships">User-Organisation Relationships<a href="#user-organisation-relationships" class="hash-link" aria-label="Direct link to User-Organisation Relationships" title="Direct link to User-Organisation Relationships">​</a></h3>
<ul>
<li><code>POST /api/organisations/{uuid}/join</code> - Join organisation (with optional user selection)</li>
<li><code>POST /api/organisations/{uuid}/leave</code> - Leave organisation</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="system-management">System Management<a href="#system-management" class="hash-link" aria-label="Direct link to System Management" title="Direct link to System Management">​</a></h3>
<ul>
<li><code>GET /api/organisations/stats</code> - System-wide statistics</li>
<li><code>POST /api/organisations/clear-cache</code> - Clear organisation cache</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="implementation-benefits">Implementation Benefits<a href="#implementation-benefits" class="hash-link" aria-label="Direct link to Implementation Benefits" title="Direct link to Implementation Benefits">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="for-organizations">For Organizations<a href="#for-organizations" class="hash-link" aria-label="Direct link to For Organizations" title="Direct link to For Organizations">​</a></h3>
<ul>
<li><strong>Complete Data Isolation</strong>: Guarantee that organizational data remains separate and secure</li>
<li><strong>Flexible User Management</strong>: Users can belong to multiple organisations as needed</li>
<li><strong>Seamless Experience</strong>: Transparent organisation switching without losing context</li>
<li><strong>Enterprise Ready</strong>: Built for enterprise-scale deployments with multiple tenant organizations</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="for-administrators">For Administrators<a href="#for-administrators" class="hash-link" aria-label="Direct link to For Administrators" title="Direct link to For Administrators">​</a></h3>
<ul>
<li><strong>Centralized Management</strong>: Single application instance serving multiple organizations</li>
<li><strong>Resource Efficiency</strong>: Shared infrastructure with isolated data</li>
<li><strong>Monitoring &amp; Analytics</strong>: Organization-scoped metrics and usage statistics</li>
<li><strong>Maintenance Simplicity</strong>: Single codebase serving all organizations</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="for-developers">For Developers<a href="#for-developers" class="hash-link" aria-label="Direct link to For Developers" title="Direct link to For Developers">​</a></h3>
<ul>
<li><strong>Automatic Implementation</strong>: Entity assignment handled automatically</li>
<li><strong>Session Integration</strong>: Organisation context available throughout the application</li>
<li><strong>Performance Optimized</strong>: Efficient queries with proper database indexing</li>
<li><strong>Testing Framework</strong>: Comprehensive 113 test cases ensuring reliability</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="migration-support">Migration Support<a href="#migration-support" class="hash-link" aria-label="Direct link to Migration Support" title="Direct link to Migration Support">​</a></h2>
<p>The multi-tenancy system includes comprehensive migration support:</p>
<ul>
<li><strong>Default Organisation Creation</strong>: Automatically creates default organisation if none exists</li>
<li><strong>Legacy Data Assignment</strong>: Assigns existing registers, schemas, and objects to default organisation</li>
<li><strong>User Auto-Assignment</strong>: Users without organisations automatically assigned to default</li>
<li><strong>Backwards Compatibility</strong>: Existing functionality continues working seamlessly</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="testing--quality-assurance">Testing &amp; Quality Assurance<a href="#testing--quality-assurance" class="hash-link" aria-label="Direct link to Testing &amp; Quality Assurance" title="Direct link to Testing &amp; Quality Assurance">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="comprehensive-test-suite">Comprehensive Test Suite<a href="#comprehensive-test-suite" class="hash-link" aria-label="Direct link to Comprehensive Test Suite" title="Direct link to Comprehensive Test Suite">​</a></h3>
<ul>
<li><strong>113 Test Scenarios</strong>: Complete coverage of all multi-tenancy functionality</li>
<li><strong>10 Specialized Test Files</strong>: Organized by functional area for maintainability</li>
<li><strong>Unit Testing</strong>: PHPUnit-based testing with mock dependencies</li>
<li><strong>Integration Testing</strong>: Full API testing with real database operations</li>
<li><strong>Performance Testing</strong>: Load testing for scalability verification</li>
<li><strong>Security Testing</strong>: Cross-organisation access prevention validation</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="quality-metrics">Quality Metrics<a href="#quality-metrics" class="hash-link" aria-label="Direct link to Quality Metrics" title="Direct link to Quality Metrics">​</a></h3>
<ul>
<li><strong>100% Feature Coverage</strong>: All multi-tenancy features tested</li>
<li><strong>Edge Case Handling</strong>: Comprehensive error scenarios and boundary conditions</li>
<li><strong>Security Validation</strong>: Complete access control and data isolation verification</li>
<li><strong>Performance Benchmarks</strong>: Response time and scalability metrics</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="usage-examples">Usage Examples<a href="#usage-examples" class="hash-link" aria-label="Direct link to Usage Examples" title="Direct link to Usage Examples">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="creating-organization-scoped-entities">Creating Organization-Scoped Entities<a href="#creating-organization-scoped-entities" class="hash-link" aria-label="Direct link to Creating Organization-Scoped Entities" title="Direct link to Creating Organization-Scoped Entities">​</a></h3>
<p>All entities automatically inherit the active organisation context. With hierarchies, child organisations can query and use parent resources:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Set active organisation (e.g., Gemeente Amsterdam with VNG as parent)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$organisationService-&gt;setActiveOrganisation(&#x27;amsterdam-uuid&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Register automatically assigned to active organisation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$register = $registerService-&gt;createFromArray([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;title&#x27; =&gt; &#x27;Customer Database&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;description&#x27; =&gt; &#x27;Customer records for Amsterdam&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// organisation: &#x27;amsterdam-uuid&#x27; (automatically set)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Schema inherits organisation context  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$schema = $schemaService-&gt;createFromArray([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;title&#x27; =&gt; &#x27;Customer Schema&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;version&#x27; =&gt; &#x27;1.0.0&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// organisation: &#x27;amsterdam-uuid&#x27; (automatically set)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Agent created in Amsterdam context</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$agent = $agentService-&gt;createFromArray([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;name&#x27; =&gt; &#x27;Amsterdam Support Agent&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;model&#x27; =&gt; &#x27;gpt-4&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// organisation: &#x27;amsterdam-uuid&#x27; (automatically set)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Configuration for Amsterdam</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$config = $configService-&gt;createFromArray([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;name&#x27; =&gt; &#x27;API Settings&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;settings&#x27; =&gt; [&#x27;timeout&#x27; =&gt; 30]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// organisation: &#x27;amsterdam-uuid&#x27; (automatically set)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="querying-with-hierarchy">Querying with Hierarchy<a href="#querying-with-hierarchy" class="hash-link" aria-label="Direct link to Querying with Hierarchy" title="Direct link to Querying with Hierarchy">​</a></h3>
<p>All queries automatically include parent organisations via <code>MultiTenancyTrait</code>:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// User active in &#x27;Noord&#x27; (parent chain: Noord → Amsterdam → VNG)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$organisationService-&gt;setActiveOrganisation(&#x27;noord-uuid&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Get all schemas visible to Noord</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$schemas = $schemaMapper-&gt;findAll();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// SQL: WHERE organisation IN (&#x27;noord-uuid&#x27;, &#x27;amsterdam-uuid&#x27;, &#x27;vng-uuid&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Returns schemas from: Noord + Amsterdam + VNG</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Get all agents available to Noord  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$agents = $agentMapper-&gt;findAll();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Returns agents from all three organisations in hierarchy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Create object using parent&#x27;s schema</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$object = $objectService-&gt;createFromArray([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;schema&#x27; =&gt; &#x27;vng-schema-uuid&#x27;, // Schema from VNG (grandparent)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;register&#x27; =&gt; &#x27;amsterdam-register-uuid&#x27;, // Register from Amsterdam (parent)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;data&#x27; =&gt; [&#x27;name&#x27; =&gt; &#x27;Test&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Works! Can use resources from any parent organisation</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="organisation-management-2">Organisation Management<a href="#organisation-management-2" class="hash-link" aria-label="Direct link to Organisation Management" title="Direct link to Organisation Management">​</a></h3>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Get user&#x27;s organisations with active context</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$organisations = $organisationService-&gt;getUserOrganisations();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Switch active organisation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$organisationService-&gt;setActiveOrganisation(&#x27;uuid-of-new-org&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Create new organisation with parent hierarchy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$newOrg = $organisationService-&gt;createFromArray([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;name&#x27; =&gt; &#x27;Deelgemeente Zuid&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;description&#x27; =&gt; &#x27;Sub-municipality of Amsterdam&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;parent&#x27; =&gt; &#x27;amsterdam-uuid&#x27; // Set parent relationship</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Zuid will now see all Amsterdam AND VNG resources</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="best-practices">Best Practices<a href="#best-practices" class="hash-link" aria-label="Direct link to Best Practices" title="Direct link to Best Practices">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="for-implementation">For Implementation<a href="#for-implementation" class="hash-link" aria-label="Direct link to For Implementation" title="Direct link to For Implementation">​</a></h3>
<ol>
<li><strong>Always use Organisation Service</strong>: Use the OrganisationService for all organisation operations</li>
<li><strong>Check Active Context</strong>: Verify active organisation before entity creation</li>
<li><strong>Handle Membership</strong>: Ensure users belong to organisations before setting as active</li>
<li><strong>Cache Appropriately</strong>: Use session caching for performance, clear when necessary</li>
<li><strong>Test Cross-Organisation</strong>: Always test cross-organisation access prevention</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="for-security">For Security<a href="#for-security" class="hash-link" aria-label="Direct link to For Security" title="Direct link to For Security">​</a></h3>
<ol>
<li><strong>Validate Organisation Access</strong>: Always check user belongs to organisation before operations</li>
<li><strong>Use Database Filtering</strong>: Filter queries by organisation at database level</li>
<li><strong>Audit Organisation Context</strong>: Include organisation in all audit logs</li>
<li><strong>Session Management</strong>: Properly manage organisation context in sessions</li>
<li><strong>Regular Testing</strong>: Run comprehensive security tests regularly</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="integration-with-other-features">Integration with Other Features<a href="#integration-with-other-features" class="hash-link" aria-label="Direct link to Integration with Other Features" title="Direct link to Integration with Other Features">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="rbac-integration">RBAC Integration<a href="#rbac-integration" class="hash-link" aria-label="Direct link to RBAC Integration" title="Direct link to RBAC Integration">​</a></h3>
<p>Multi-tenancy works seamlessly with the existing Role-Based Access Control system:</p>
<ul>
<li><strong>Organisation-Scoped Permissions</strong>: RBAC permissions apply within organisation context</li>
<li><strong>Cross-Organisation Prevention</strong>: RBAC prevents access to other organisations&#x27; data</li>
<li><strong>Admin Override</strong>: Admin users can access all organisations within their scope</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="search-and-faceting">Search and Faceting<a href="#search-and-faceting" class="hash-link" aria-label="Direct link to Search and Faceting" title="Direct link to Search and Faceting">​</a></h3>
<ul>
<li><strong>Organisation Filtering</strong>: Search results automatically filtered by active organisation</li>
<li><strong>Facet Scoping</strong>: Facets calculated only for organisation&#x27;s data</li>
<li><strong>Performance Optimization</strong>: Efficient organisation-aware search queries</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="audit-trails">Audit Trails<a href="#audit-trails" class="hash-link" aria-label="Direct link to Audit Trails" title="Direct link to Audit Trails">​</a></h3>
<ul>
<li><strong>Organisation Context</strong>: All audit entries include organisation information</li>
<li><strong>Compliance Support</strong>: Organisation-scoped audit trails for regulatory compliance</li>
<li><strong>Cross-Reference Prevention</strong>: Cannot view audit trails from other organisations</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="organisation-hierarchies">Organisation Hierarchies<a href="#organisation-hierarchies" class="hash-link" aria-label="Direct link to Organisation Hierarchies" title="Direct link to Organisation Hierarchies">​</a></h2>
<p>OpenRegister supports parent-child organisation relationships, enabling controlled resource sharing across organisational boundaries.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="concept">Concept<a href="#concept" class="hash-link" aria-label="Direct link to Concept" title="Direct link to Concept">​</a></h3>
<p>Child organisations automatically inherit visibility to resources from their parent organisations, recursively up the entire hierarchy. This is a unidirectional relationship - parents CANNOT view child resources, only children can view parent resources.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="use-case-government-organisations">Use Case: Government Organisations<a href="#use-case-government-organisations" class="hash-link" aria-label="Direct link to Use Case: Government Organisations" title="Direct link to Use Case: Government Organisations">​</a></h4>
<div class="language-mermaid codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-mermaid codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">graph TD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    VNG[VNG - National Government] --&gt;|parent of| AMS[Gemeente Amsterdam]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    VNG --&gt;|parent of| RTM[Gemeente Rotterdam]  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AMS --&gt;|parent of| NOORD[Deelgemeente Noord]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    style VNG fill:#2196F3,color:#fff</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    style AMS fill:#4CAF50,color:#fff</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    style RTM fill:#4CAF50,color:#fff</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    style NOORD fill:#8BC34A,color:#fff</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Resource Visibility</strong>:</p>
<ul>
<li>VNG creates national schemas for all municipalities</li>
<li>Gemeente Amsterdam automatically sees all VNG schemas</li>
<li>Deelgemeente Noord automatically sees schemas from both Amsterdam AND VNG</li>
<li>Amsterdam does NOT see Noord schemas (no downward visibility)</li>
<li>Rotterdam does NOT see Amsterdam or Noord schemas (no sibling visibility)</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="key-features-1">Key Features<a href="#key-features-1" class="hash-link" aria-label="Direct link to Key Features" title="Direct link to Key Features">​</a></h3>
<p><strong>Upward Visibility (Children → Parents)</strong></p>
<p>Child organisations automatically see and can use ALL parent resources:</p>
<table><thead><tr><th>Resource Type</th><th>Mapper</th><th>Visible to Children</th><th>Use Case</th></tr></thead><tbody><tr><td><strong>Schemas</strong></td><td><code>SchemaMapper</code></td><td>✅ Yes</td><td>Data structure definitions</td></tr><tr><td><strong>Registers</strong></td><td><code>RegisterMapper</code></td><td>✅ Yes</td><td>Object collections</td></tr><tr><td><strong>Objects</strong></td><td><code>ObjectEntityMapper</code></td><td>✅ Yes</td><td>Individual data records</td></tr><tr><td><strong>Agents</strong></td><td><code>AgentMapper</code></td><td>✅ Yes</td><td>AI assistants and processors</td></tr><tr><td><strong>Sources</strong></td><td><code>SourceMapper</code></td><td>✅ Yes</td><td>External API connections</td></tr><tr><td><strong>Configurations</strong></td><td><code>ConfigurationMapper</code></td><td>✅ Yes</td><td>System settings</td></tr><tr><td><strong>Applications</strong></td><td><code>ApplicationMapper</code></td><td>✅ Yes</td><td>Integrated applications</td></tr><tr><td><strong>Views</strong></td><td><code>ViewMapper</code></td><td>✅ Yes</td><td>UI display configurations</td></tr></tbody></table>
<p>Visibility applies <strong>recursively</strong> to entire ancestor chain (grandparents, great-grandparents, etc.).</p>
<p><strong>Isolation Rules</strong></p>
<ul>
<li>Parents CANNOT view child resources (security boundary)</li>
<li>Siblings CANNOT view each other&#x27;s resources (organisational isolation)</li>
<li>Children can READ parent resources but cannot MODIFY them</li>
<li>Maximum hierarchy depth: 10 levels (prevents infinite recursion)</li>
</ul>
<p><strong>Circular Reference Prevention</strong></p>
<ul>
<li>Automatic validation prevents A → B → A cycles</li>
<li>Enforced at API level when setting parent via <code>OrganisationMapper-&gt;validateParentAssignment()</code></li>
<li>Clear error messages guide administrators</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="technical-implementation">Technical Implementation<a href="#technical-implementation" class="hash-link" aria-label="Direct link to Technical Implementation" title="Direct link to Technical Implementation">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="database-schema">Database Schema<a href="#database-schema" class="hash-link" aria-label="Direct link to Database Schema" title="Direct link to Database Schema">​</a></h4>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">-- Parent column added to organisations table</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">ALTER</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> oc_openregister_organisations </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">ADD</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">COLUMN</span><span class="token plain"> parent </span><span class="token keyword" style="color:#00009f">VARCHAR</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">255</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DEFAULT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- Index for efficient parent chain queries</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INDEX</span><span class="token plain"> idx_organisation_parent </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">ON</span><span class="token plain"> oc_openregister_organisations</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">parent</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="recursive-parent-chain-query">Recursive Parent Chain Query<a href="#recursive-parent-chain-query" class="hash-link" aria-label="Direct link to Recursive Parent Chain Query" title="Direct link to Recursive Parent Chain Query">​</a></h4>
<p>The system uses recursive Common Table Expressions (CTE) for efficient parent chain lookups:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">WITH</span><span class="token plain"> RECURSIVE org_hierarchy </span><span class="token keyword" style="color:#00009f">AS</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">-- Base case: the organisation itself</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> uuid</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> parent</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">level</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> oc_openregister_organisations</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> uuid </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> :org_uuid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">UNION</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">ALL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">-- Recursive case: get parent organisations</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> o</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">uuid</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> o</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">parent</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> oh</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">level</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> oc_openregister_organisations o</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">INNER</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">JOIN</span><span class="token plain"> org_hierarchy oh </span><span class="token keyword" style="color:#00009f">ON</span><span class="token plain"> o</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">uuid </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> oh</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">parent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> oh</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">level</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">-- Max depth protection</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> uuid </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> org_hierarchy </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">level</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">level</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">ASC</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="multi-tenancy-filtering">Multi-Tenancy Filtering<a href="#multi-tenancy-filtering" class="hash-link" aria-label="Direct link to Multi-Tenancy Filtering" title="Direct link to Multi-Tenancy Filtering">​</a></h4>
<p>Query filtering automatically includes parent organisations for ALL organisation-scoped entities:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Old behavior (pre-hierarchy)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WHERE organisation = &#x27;{active-org-uuid}&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// New behavior (with hierarchy)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WHERE organisation IN (&#x27;{active-uuid}&#x27;, &#x27;{parent-uuid}&#x27;, &#x27;{grandparent-uuid}&#x27;)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Entities with Automatic Hierarchy Support:</strong></p>
<p>The following entity mappers use <code>MultiTenancyTrait</code> and automatically inherit hierarchical multi-tenancy:</p>
<ul>
<li><strong>Agents</strong> (<code>AgentMapper</code>) - AI agents are visible to child organisations</li>
<li><strong>Schemas</strong> (<code>SchemaMapper</code>) - Data schemas shared across hierarchy</li>
<li><strong>Registers</strong> (<code>RegisterMapper</code>) - Object collections visible to children</li>
<li><strong>Views</strong> (<code>ViewMapper</code>) - UI views available to child organisations</li>
<li><strong>Sources</strong> (<code>SourceMapper</code>) - Data sources accessible throughout hierarchy</li>
<li><strong>Configurations</strong> (<code>ConfigurationMapper</code>) - Configuration settings inherited by children</li>
<li><strong>Applications</strong> (<code>ApplicationMapper</code>) - Applications shared with child organisations</li>
<li><strong>Objects</strong> (<code>ObjectEntityMapper</code>) - Individual data objects follow organisation hierarchy</li>
</ul>
<p><strong>How It Works:</strong></p>
<p>All these mappers call <code>applyOrganisationFilter()</code> from <code>MultiTenancyTrait</code>, which:</p>
<ol>
<li>Calls <code>OrganisationService-&gt;getUserActiveOrganisations()</code></li>
<li>Receives array: <code>[&#x27;active-uuid&#x27;, &#x27;parent-uuid&#x27;, &#x27;grandparent-uuid&#x27;]</code></li>
<li>Applies SQL: <code>WHERE organisation IN (...)</code></li>
<li>Returns results from active organisation AND all parents</li>
</ol>
<p><strong>No Code Changes Required:</strong></p>
<p>Entity mappers require zero modifications - the trait handles everything automatically. This ensures consistent behaviour across all organisation-scoped entities.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="api-usage">API Usage<a href="#api-usage" class="hash-link" aria-label="Direct link to API Usage" title="Direct link to API Usage">​</a></h3>
<p><strong>Set Parent Organisation:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">PUT /api/organisations/{uuid}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Type: application/json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &#x27;parent&#x27;: &#x27;{parent-org-uuid}&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Remove Parent:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">PUT /api/organisations/{uuid}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Type: application/json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &#x27;parent&#x27;: null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Get Organisation with Hierarchy:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">GET /api/organisations/{uuid}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Response:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &#x27;uuid&#x27;: &#x27;amsterdam-uuid&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &#x27;name&#x27;: &#x27;Gemeente Amsterdam&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &#x27;parent&#x27;: &#x27;vng-uuid&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &#x27;children&#x27;: [&#x27;noord-uuid&#x27;, &#x27;zuid-uuid&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="security-considerations">Security Considerations<a href="#security-considerations" class="hash-link" aria-label="Direct link to Security Considerations" title="Direct link to Security Considerations">​</a></h3>
<p><strong>Validation Rules</strong>:</p>
<ul>
<li>Parent assignment validated before saving</li>
<li>Circular references rejected (A → B → A)</li>
<li>Maximum depth enforced (10 levels)</li>
<li>Self-reference prevented (organisation cannot parent itself)</li>
</ul>
<p><strong>Permission Model</strong>:</p>
<ul>
<li>RBAC permissions apply within organisation context</li>
<li>Parent resources are visible but respect RBAC rules</li>
<li>Children cannot MODIFY parent resources (only read)</li>
<li>Audit logs track which organisation owns each resource</li>
</ul>
<p><strong>Error Responses</strong>:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &#x27;error&#x27;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> &#x27;Circular reference detected</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> The new parent organisation is already a descendant of this organisation.&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &#x27;error&#x27;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> &#x27;Maximum hierarchy depth exceeded. Total depth would be </span><span class="token number" style="color:#36acaa">11</span><span class="token plain"> levels (max </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"> allowed).&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="performance-optimizations-1">Performance Optimizations<a href="#performance-optimizations-1" class="hash-link" aria-label="Direct link to Performance Optimizations" title="Direct link to Performance Optimizations">​</a></h3>
<p><strong>Recursive CTE Benefits</strong>:</p>
<ul>
<li>Single database query for entire parent chain</li>
<li>No N+1 query problem</li>
<li>Efficient even with deep hierarchies (10 levels)</li>
</ul>
<p><strong>Benchmarks</strong>:</p>
<ul>
<li>Parent chain lookup: &lt; 10ms</li>
<li>Filtered query with 3 organisations: &lt; 50ms</li>
<li>No measurable impact on single-org setups</li>
<li>Index on parent column prevents full table scans</li>
</ul>
<p><strong>Caching Strategy</strong>:</p>
<ul>
<li>Parent chain computed per request</li>
<li>Results cached in OrganisationService</li>
<li>Cache invalidated on organisation updates</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="best-practices-1">Best Practices<a href="#best-practices-1" class="hash-link" aria-label="Direct link to Best Practices" title="Direct link to Best Practices">​</a></h3>
<ol>
<li><strong>Keep Hierarchies Shallow</strong>: Aim for ≤ 3 levels for clarity</li>
<li><strong>Clear Naming</strong>: Use descriptive names showing hierarchy level</li>
<li><strong>Document Structure</strong>: Maintain documentation of organisation tree</li>
<li><strong>Test Visibility</strong>: Verify resource visibility in staging before production</li>
<li><strong>Monitor Performance</strong>: Watch query times with deep hierarchies (&gt; 5 levels)</li>
<li><strong>Plan Migrations</strong>: Test parent assignments carefully to avoid disruption</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-scenarios">Example Scenarios<a href="#example-scenarios" class="hash-link" aria-label="Direct link to Example Scenarios" title="Direct link to Example Scenarios">​</a></h3>
<p><strong>Scenario 1: Schema Sharing (National to Municipal)</strong></p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">VNG (parent) → Gemeente Amsterdam</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- VNG creates &#x27;Citizen Schema&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Amsterdam automatically sees &#x27;Citizen Schema&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Amsterdam can create objects using VNG schema</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Amsterdam creates &#x27;Local Events Schema&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- VNG does NOT see &#x27;Local Events Schema&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Scenario 2: Multi-Level Hierarchy (All Resources)</strong></p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">VNG → Amsterdam → Noord</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Resources visible to Noord:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✓ Schemas from VNG and Amsterdam</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✓ Registers from VNG and Amsterdam</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✓ Configurations from VNG and Amsterdam</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✓ Agents from VNG and Amsterdam</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✓ Sources from VNG and Amsterdam</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✓ Views from VNG and Amsterdam</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✓ Applications from VNG and Amsterdam</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✓ Objects from VNG and Amsterdam</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Resources Noord creates:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Only visible to Noord itself</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- NOT visible to Amsterdam or VNG (upward isolation)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Scenario 3: Configuration Inheritance</strong></p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">VNG (parent) → Multiple Municipalities</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- VNG creates &#x27;National API Configuration&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- All municipalities automatically use this configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Municipality can override with local configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Local config takes precedence over parent config (when both exist)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Scenario 4: Sibling Isolation</strong></p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">VNG → Amsterdam</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">VNG → Rotterdam</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Amsterdam and Rotterdam are siblings</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Amsterdam creates &#x27;Amsterdam Transport Agent&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Rotterdam does NOT see Amsterdam&#x27;s agent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Both see VNG&#x27;s national agents</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Complete resource isolation between siblings</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Scenario 5: Agent and Source Sharing</strong></p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Company HQ → Department A → Team 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- HQ creates &#x27;Corporate AI Agent&#x27; and &#x27;External API Source&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Department A sees and can use HQ agent/source</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Team 1 sees agents/sources from both HQ and Department A</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Team 1 creates team-specific agent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Only Team 1 can use their team agent</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="future-enhancements">Future Enhancements<a href="#future-enhancements" class="hash-link" aria-label="Direct link to Future Enhancements" title="Direct link to Future Enhancements">​</a></h2>
<p>Planned enhancements for the multi-tenancy system include:</p>
<ul>
<li><strong>Role-Based Organisation Access</strong>: Organisation-specific role assignments</li>
<li><strong>Organisation Templates</strong>: Predefined organisation setups for quick deployment</li>
<li><strong>Controlled Cross-Organisation Sharing</strong>: Share specific resources across sibling organisations</li>
<li><strong>Organisation Branding</strong>: Custom branding and themes per organisation</li>
<li><strong>Usage Analytics</strong>: Detailed organisation usage metrics and reporting</li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="technical-implementation-1">Technical Implementation<a href="#technical-implementation-1" class="hash-link" aria-label="Direct link to Technical Implementation" title="Direct link to Technical Implementation">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="architecture-overview">Architecture Overview<a href="#architecture-overview" class="hash-link" aria-label="Direct link to Architecture Overview" title="Direct link to Architecture Overview">​</a></h3>
<p>Multi-tenancy in OpenRegister uses a combination of organisation-based filtering and Solr tenant collections:</p>
<div class="language-mermaid codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-mermaid codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">graph TB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    subgraph &quot;User Layer&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        User[User Session]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ActiveOrg[Active Organisation]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    subgraph &quot;Application Layer&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        OrgService[Organisation Service]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ObjectMapper[Object Mapper]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        SchemaMapper[Schema Mapper]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        RegisterMapper[Register Mapper]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    subgraph &quot;Data Layer&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        DB[(MySQL Database&lt;br/&gt;Organisation Field)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        SolrBase[Solr Base Collection]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        SolrTenant1[Solr Tenant Collection&lt;br/&gt;org-uuid-1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        SolrTenant2[Solr Tenant Collection&lt;br/&gt;org-uuid-2]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    User --&gt;|has| ActiveOrg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ActiveOrg --&gt;|managed by| OrgService</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ObjectMapper --&gt;|filters by organisation| DB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SchemaMapper --&gt;|filters by organisation| DB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    RegisterMapper --&gt;|filters by organisation| DB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ObjectMapper --&gt;|indexes to| SolrTenant1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ObjectMapper --&gt;|indexes to| SolrTenant2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SolrBase -.-&gt;|creates| SolrTenant1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SolrBase -.-&gt;|creates| SolrTenant2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    style ActiveOrg fill:#e1f5ff</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    style OrgService fill:#fff4e1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="tenant-isolation-strategy">Tenant Isolation Strategy<a href="#tenant-isolation-strategy" class="hash-link" aria-label="Direct link to Tenant Isolation Strategy" title="Direct link to Tenant Isolation Strategy">​</a></h3>
<p>OpenRegister implements multi-tenancy at two levels:</p>
<p><strong>1. Database-Level Filtering</strong></p>
<ul>
<li>All entities have <code>organisation</code> field</li>
<li>Queries automatically filtered by active organisation</li>
<li>Prevents cross-organisation data access</li>
</ul>
<p><strong>2. Solr Collection Isolation</strong></p>
<ul>
<li>Each tenant gets separate Solr collection</li>
<li>Collection naming: <code>{base-collection}-{org-uuid}</code></li>
<li>Complete search index isolation</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="organisation-context-flow">Organisation Context Flow<a href="#organisation-context-flow" class="hash-link" aria-label="Direct link to Organisation Context Flow" title="Direct link to Organisation Context Flow">​</a></h3>
<div class="language-mermaid codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-mermaid codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sequenceDiagram</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    participant User as User</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    participant Session as Session</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    participant OrgService as Organisation Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    participant Mapper as Entity Mapper</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    participant DB as Database</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    participant Solr as Solr (Tenant Collection)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    User-&gt;&gt;OrgService: setActiveOrganisation(orgUuid)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    OrgService-&gt;&gt;Session: Store active org in session</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Session--&gt;&gt;User: Context switched</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Note over User: Create Object</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    User-&gt;&gt;Mapper: createObject(data)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Mapper-&gt;&gt;OrgService: getActiveOrganisation()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    OrgService-&gt;&gt;Session: Retrieve active org</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Session--&gt;&gt;OrgService: orgUuid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    OrgService--&gt;&gt;Mapper: organisationUuid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Mapper-&gt;&gt;Mapper: Set object.organisation = orgUuid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Mapper-&gt;&gt;DB: INSERT with organisation field</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    DB--&gt;&gt;Mapper: Object saved</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Mapper-&gt;&gt;Solr: Index to tenant collection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Note over Solr: Collection: base-{orgUuid}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Solr--&gt;&gt;Mapper: Indexed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Mapper--&gt;&gt;User: Object created</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="tenant-collection-management">Tenant Collection Management<a href="#tenant-collection-management" class="hash-link" aria-label="Direct link to Tenant Collection Management" title="Direct link to Tenant Collection Management">​</a></h3>
<div class="language-mermaid codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-mermaid codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">graph TD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Start[User Request] --&gt; CheckCollection{Tenant collection&lt;br/&gt;exists?}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    CheckCollection --&gt;|Yes| UseCollection[Use Tenant Collection&lt;br/&gt;{base}-{org-uuid}]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    CheckCollection --&gt;|No| CreateCollection[Create Tenant Collection]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    CreateCollection --&gt; ConfigSet[Apply ConfigSet&lt;br/&gt;openregister]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ConfigSet --&gt; SetupShards[Configure Shards&lt;br/&gt;&amp; Replicas]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SetupShards --&gt; CollectionReady[Collection Ready]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    CollectionReady --&gt; UseCollection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    UseCollection --&gt; IndexData[Index/Search Data]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    IndexData --&gt; Success[✓ Operation Complete]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    style Success fill:#90EE90</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="database-schema-1">Database Schema<a href="#database-schema-1" class="hash-link" aria-label="Direct link to Database Schema" title="Direct link to Database Schema">​</a></h3>
<p>Organisation field added to all tenant-aware tables:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">-- Objects table</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">ALTER</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> oc_openregister_objects </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">ADD</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">COLUMN</span><span class="token plain"> organisation </span><span class="token keyword" style="color:#00009f">VARCHAR</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">255</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">ADD</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INDEX</span><span class="token plain"> idx_organisation </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">organisation</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- Schemas table</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">ALTER</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> oc_openregister_schemas</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">ADD</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">COLUMN</span><span class="token plain"> organisation </span><span class="token keyword" style="color:#00009f">VARCHAR</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">255</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">ADD</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INDEX</span><span class="token plain"> idx_organisation </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">organisation</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- Registers table</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">ALTER</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> oc_openregister_registers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">ADD</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">COLUMN</span><span class="token plain"> organisation </span><span class="token keyword" style="color:#00009f">VARCHAR</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">255</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">ADD</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INDEX</span><span class="token plain"> idx_organisation </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">organisation</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- Organisations table</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> oc_openregister_organisations </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    id </span><span class="token keyword" style="color:#00009f">INTEGER</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">KEY</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">AUTO_INCREMENT</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    uuid </span><span class="token keyword" style="color:#00009f">VARCHAR</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">255</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">UNIQUE</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name </span><span class="token keyword" style="color:#00009f">VARCHAR</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">255</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    description </span><span class="token keyword" style="color:#00009f">TEXT</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    settings JSON</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    created </span><span class="token keyword" style="color:#00009f">DATETIME</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    updated </span><span class="token keyword" style="color:#00009f">DATETIME</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">INDEX</span><span class="token plain"> idx_uuid </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">uuid</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">INDEX</span><span class="token plain"> idx_name </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- User-Organisation mapping</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> oc_openregister_user_organisations </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    id </span><span class="token keyword" style="color:#00009f">INTEGER</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">KEY</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">AUTO_INCREMENT</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    user_id </span><span class="token keyword" style="color:#00009f">VARCHAR</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">255</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    organisation_uuid </span><span class="token keyword" style="color:#00009f">VARCHAR</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">255</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    role </span><span class="token keyword" style="color:#00009f">VARCHAR</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">50</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DEFAULT</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;member&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    created </span><span class="token keyword" style="color:#00009f">DATETIME</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">UNIQUE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">KEY</span><span class="token plain"> unique_user_org </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">user_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> organisation_uuid</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">INDEX</span><span class="token plain"> idx_user </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">user_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">INDEX</span><span class="token plain"> idx_org </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">organisation_uuid</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="performance-optimizations-2">Performance Optimizations<a href="#performance-optimizations-2" class="hash-link" aria-label="Direct link to Performance Optimizations" title="Direct link to Performance Optimizations">​</a></h3>
<p><strong>1. Session Caching</strong></p>
<ul>
<li>Active organisation cached in user session</li>
<li>Reduces database queries</li>
</ul>
<p><strong>2. Database Indexes</strong></p>
<ul>
<li>Indexed <code>organisation</code> field on all tables</li>
<li>Fast filtering queries</li>
</ul>
<p><strong>3. Lazy Collection Creation</strong></p>
<ul>
<li>Tenant collections created on-demand</li>
<li>Reduces initial overhead</li>
</ul>
<p><strong>4. Query Optimization</strong></p>
<ul>
<li>Automatic <code>WHERE organisation = ?</code> in all queries</li>
<li>Prevents full table scans</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="code-examples">Code Examples<a href="#code-examples" class="hash-link" aria-label="Direct link to Code Examples" title="Direct link to Code Examples">​</a></h3>
<p><strong>Setting Active Organisation:</strong></p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use OCA\OpenRegister\Service\OrganisationService;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$organisationService-&gt;setActiveOrganisation($organisationUuid);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// All subsequent operations use this organisation context</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$object = $objectService-&gt;create($data);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// object.organisation automatically set to $organisationUuid</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Querying with Organisation Filter:</strong></p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Automatic organisation filtering</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$objects = $objectMapper-&gt;findAll();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// SELECT * FROM objects WHERE organisation = &#x27;{active-org-uuid}&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Explicit organisation override (admin only)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$objects = $objectMapper-&gt;findByOrganisation($specificOrgUuid);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Tenant Collection Operations:</strong></p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use OCA\OpenRegister\Service\GuzzleSolrService;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Ensure tenant collection exists</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$solrService-&gt;ensureTenantCollection();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Get active collection name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$collectionName = $solrService-&gt;getActiveCollectionName();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Returns: &quot;openregister-{org-uuid}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Index to tenant collection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$solrService-&gt;indexObject($object);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Automatically uses tenant collection</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="best-practices-2">Best Practices<a href="#best-practices-2" class="hash-link" aria-label="Direct link to Best Practices" title="Direct link to Best Practices">​</a></h3>
<p><strong>✓ DO:</strong></p>
<ul>
<li>Always check active organisation before operations</li>
<li>Use session-based context switching</li>
<li>Validate user membership before switching</li>
<li>Monitor tenant collection sizes</li>
<li>Implement organisation-scoped audit logs</li>
</ul>
<p><strong>✗ DON&#x27;T:</strong></p>
<ul>
<li>Don&#x27;t bypass organisation filtering</li>
<li>Don&#x27;t share collections between tenants</li>
<li>Don&#x27;t hard-code organisation UUIDs</li>
<li>Don&#x27;t skip permission checks</li>
<li>Don&#x27;t forget to clear caches on context switch</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="monitoring">Monitoring<a href="#monitoring" class="hash-link" aria-label="Direct link to Monitoring" title="Direct link to Monitoring">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Check organisation isolation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SELECT organisation, COUNT(*) as count</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FROM oc_openregister_objects</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GROUP BY organisation;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># List tenant collections</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl &quot;http://solr:8983/solr/admin/collections?action=LIST&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Monitor collection sizes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl &quot;http://solr:8983/solr/admin/collections?action=CLUSTERSTATUS&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><em>For testing information, see <a href="/docs/technical/multi-tenancy-testing">Multi-Tenancy Testing Framework</a></em>
<em>For API details, see <a href="/docs/api/organisations">Organisations API</a></em></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/conductionnl/openregister/tree/main/website/docs/Features/multi-tenancy.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/Features/faceting"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Comprehensive Faceting System</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/Features/webhooks"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Webhooks</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#core-components" class="table-of-contents__link toc-highlight">Core Components</a><ul><li><a href="#organisation-management" class="table-of-contents__link toc-highlight">Organisation Management</a></li><li><a href="#session-management" class="table-of-contents__link toc-highlight">Session Management</a></li><li><a href="#automatic-entity-assignment" class="table-of-contents__link toc-highlight">Automatic Entity Assignment</a></li></ul></li><li><a href="#key-features" class="table-of-contents__link toc-highlight">Key Features</a><ul><li><a href="#enterprise-scalability" class="table-of-contents__link toc-highlight">Enterprise Scalability</a></li><li><a href="#security-model" class="table-of-contents__link toc-highlight">Security Model</a></li><li><a href="#performance-optimizations" class="table-of-contents__link toc-highlight">Performance Optimizations</a></li></ul></li><li><a href="#api-endpoints" class="table-of-contents__link toc-highlight">API Endpoints</a><ul><li><a href="#organisation-management-1" class="table-of-contents__link toc-highlight">Organisation Management</a></li><li><a href="#active-organisation" class="table-of-contents__link toc-highlight">Active Organisation</a></li><li><a href="#user-organisation-relationships" class="table-of-contents__link toc-highlight">User-Organisation Relationships</a></li><li><a href="#system-management" class="table-of-contents__link toc-highlight">System Management</a></li></ul></li><li><a href="#implementation-benefits" class="table-of-contents__link toc-highlight">Implementation Benefits</a><ul><li><a href="#for-organizations" class="table-of-contents__link toc-highlight">For Organizations</a></li><li><a href="#for-administrators" class="table-of-contents__link toc-highlight">For Administrators</a></li><li><a href="#for-developers" class="table-of-contents__link toc-highlight">For Developers</a></li></ul></li><li><a href="#migration-support" class="table-of-contents__link toc-highlight">Migration Support</a></li><li><a href="#testing--quality-assurance" class="table-of-contents__link toc-highlight">Testing &amp; Quality Assurance</a><ul><li><a href="#comprehensive-test-suite" class="table-of-contents__link toc-highlight">Comprehensive Test Suite</a></li><li><a href="#quality-metrics" class="table-of-contents__link toc-highlight">Quality Metrics</a></li></ul></li><li><a href="#usage-examples" class="table-of-contents__link toc-highlight">Usage Examples</a><ul><li><a href="#creating-organization-scoped-entities" class="table-of-contents__link toc-highlight">Creating Organization-Scoped Entities</a></li><li><a href="#querying-with-hierarchy" class="table-of-contents__link toc-highlight">Querying with Hierarchy</a></li><li><a href="#organisation-management-2" class="table-of-contents__link toc-highlight">Organisation Management</a></li></ul></li><li><a href="#best-practices" class="table-of-contents__link toc-highlight">Best Practices</a><ul><li><a href="#for-implementation" class="table-of-contents__link toc-highlight">For Implementation</a></li><li><a href="#for-security" class="table-of-contents__link toc-highlight">For Security</a></li></ul></li><li><a href="#integration-with-other-features" class="table-of-contents__link toc-highlight">Integration with Other Features</a><ul><li><a href="#rbac-integration" class="table-of-contents__link toc-highlight">RBAC Integration</a></li><li><a href="#search-and-faceting" class="table-of-contents__link toc-highlight">Search and Faceting</a></li><li><a href="#audit-trails" class="table-of-contents__link toc-highlight">Audit Trails</a></li></ul></li><li><a href="#organisation-hierarchies" class="table-of-contents__link toc-highlight">Organisation Hierarchies</a><ul><li><a href="#concept" class="table-of-contents__link toc-highlight">Concept</a></li><li><a href="#key-features-1" class="table-of-contents__link toc-highlight">Key Features</a></li><li><a href="#technical-implementation" class="table-of-contents__link toc-highlight">Technical Implementation</a></li><li><a href="#api-usage" class="table-of-contents__link toc-highlight">API Usage</a></li><li><a href="#security-considerations" class="table-of-contents__link toc-highlight">Security Considerations</a></li><li><a href="#performance-optimizations-1" class="table-of-contents__link toc-highlight">Performance Optimizations</a></li><li><a href="#best-practices-1" class="table-of-contents__link toc-highlight">Best Practices</a></li><li><a href="#example-scenarios" class="table-of-contents__link toc-highlight">Example Scenarios</a></li></ul></li><li><a href="#future-enhancements" class="table-of-contents__link toc-highlight">Future Enhancements</a></li><li><a href="#technical-implementation-1" class="table-of-contents__link toc-highlight">Technical Implementation</a><ul><li><a href="#architecture-overview" class="table-of-contents__link toc-highlight">Architecture Overview</a></li><li><a href="#tenant-isolation-strategy" class="table-of-contents__link toc-highlight">Tenant Isolation Strategy</a></li><li><a href="#organisation-context-flow" class="table-of-contents__link toc-highlight">Organisation Context Flow</a></li><li><a href="#tenant-collection-management" class="table-of-contents__link toc-highlight">Tenant Collection Management</a></li><li><a href="#database-schema-1" class="table-of-contents__link toc-highlight">Database Schema</a></li><li><a href="#performance-optimizations-2" class="table-of-contents__link toc-highlight">Performance Optimizations</a></li><li><a href="#code-examples" class="table-of-contents__link toc-highlight">Code Examples</a></li><li><a href="#best-practices-2" class="table-of-contents__link toc-highlight">Best Practices</a></li><li><a href="#monitoring" class="table-of-contents__link toc-highlight">Monitoring</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Documentation</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/conductionnl/openregister" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 for <a href="https://openwebconcept.nl">Open Webconcept</a> by <a href="https://conduction.nl">Conduction B.V.</a></div></div></div></footer></div>
</body>
</html>