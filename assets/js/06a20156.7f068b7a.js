"use strict";(self.webpackChunkopen_catalogi_docs=self.webpackChunkopen_catalogi_docs||[]).push([[5152],{27162:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>o,frontMatter:()=>r,metadata:()=>s,toc:()=>h});const s=JSON.parse('{"id":"technical/text-extraction-implementation","title":"Text Extraction Implementation","description":"Complete implementation guide for file text extraction, chunking, and processing pipeline","source":"@site/docs/technical/text-extraction-implementation.md","sourceDirName":"technical","slug":"/technical/text-extraction-implementation","permalink":"/docs/technical/text-extraction-implementation","draft":false,"unlisted":false,"editUrl":"https://github.com/conductionnl/openregister/tree/main/website/docs/technical/text-extraction-implementation.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"title":"Text Extraction Implementation","sidebar_position":3,"description":"Complete implementation guide for file text extraction, chunking, and processing pipeline","keywords":["Open Register","Text Extraction","File Processing","Chunking"]},"sidebar":"tutorialSidebar","previous":{"title":"Vector Search Backends","permalink":"/docs/technical/vector-search-backends"},"next":{"title":"Schema Technical Documentation","permalink":"/docs/technical/schemas"}}');var t=i(74848),l=i(28453);const r={title:"Text Extraction Implementation",sidebar_position:3,description:"Complete implementation guide for file text extraction, chunking, and processing pipeline",keywords:["Open Register","Text Extraction","File Processing","Chunking"]},c="Text Extraction Implementation",d={},h=[{value:"Overview",id:"overview",level:2},{value:"Architecture",id:"architecture",level:2},{value:"3-Stage Pipeline",id:"3-stage-pipeline",level:3},{value:"Database Schema",id:"database-schema",level:2},{value:"Table: <code>oc_openregister_file_texts</code>",id:"table-oc_openregister_file_texts",level:3},{value:"Services Architecture",id:"services-architecture",level:2},{value:"FileTextService",id:"filetextservice",level:3},{value:"TextExtractionService",id:"textextractionservice",level:3},{value:"Event Listener",id:"event-listener",level:2},{value:"FileChangeListener",id:"filechangelistener",level:3},{value:"API Endpoints",id:"api-endpoints",level:2},{value:"File Text Management",id:"file-text-management",level:3},{value:"SOLR File Indexing",id:"solr-file-indexing",level:3},{value:"File Search",id:"file-search",level:3},{value:"Processing Flow",id:"processing-flow",level:2},{value:"Automatic Processing",id:"automatic-processing",level:3},{value:"Change Detection",id:"change-detection",level:2},{value:"Chunking Strategy",id:"chunking-strategy",level:2},{value:"Chunk Structure",id:"chunk-structure",level:3},{value:"Chunking Options",id:"chunking-options",level:3},{value:"Performance",id:"performance",level:2},{value:"Extraction Times",id:"extraction-times",level:3},{value:"Bulk Processing",id:"bulk-processing",level:3},{value:"Error Handling",id:"error-handling",level:2},{value:"Extraction Errors",id:"extraction-errors",level:3},{value:"Statistics",id:"statistics",level:2},{value:"Available Statistics",id:"available-statistics",level:3},{value:"Testing",id:"testing",level:2},{value:"Test Results",id:"test-results",level:3},{value:"Test Results",id:"test-results-1",level:2},{value:"File Upload Test",id:"file-upload-test",level:3},{value:"File Update Test",id:"file-update-test",level:3},{value:"Bulk Processing Test",id:"bulk-processing-test",level:3},{value:"Performance Metrics",id:"performance-metrics",level:2},{value:"Extraction Times",id:"extraction-times-1",level:3},{value:"Bulk Processing",id:"bulk-processing-1",level:3},{value:"Related Documentation",id:"related-documentation",level:2}];function a(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"text-extraction-implementation",children:"Text Extraction Implementation"})}),"\n",(0,t.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,t.jsx)(n.p,{children:"OpenRegister implements a complete 3-stage file processing pipeline for text extraction, chunking, and vectorization to enable SOLR indexing and AI-powered semantic search."}),"\n",(0,t.jsx)(n.h2,{id:"architecture",children:"Architecture"}),"\n",(0,t.jsx)(n.h3,{id:"3-stage-pipeline",children:"3-Stage Pipeline"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 STAGE 1: TEXT EXTRACTION \u2705 COMPLETE                           \u2502\n\u2502                                                                 \u2502\n\u2502 File Upload \u2192 Event Listener \u2192 Text Extraction \u2192 Store in DB  \u2502\n\u2502                                                                 \u2502\n\u2502 Benefits:                                                       \u2502\n\u2502 \u2022 No re-parsing of files                                       \u2502\n\u2502 \u2022 Fast SOLR indexing (text already extracted)                 \u2502\n\u2502 \u2022 Change detection via checksum                                \u2502\n\u2502 \u2022 Ready for chunking & vectorization                           \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                            \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 STAGE 2: TEXT CHUNKING \u2705 COMPLETE                            \u2502\n\u2502                                                                 \u2502\n\u2502 Stored Text \u2192 Chunk Splitter \u2192 SOLR File Collection           \u2502\n\u2502                                                                 \u2502\n\u2502 Enables:                                                       \u2502\n\u2502 \u2022 Full-text search in SOLR                                     \u2502\n\u2502 \u2022 Faceting by file type/metadata                               \u2502\n\u2502 \u2022 Large file support (chunked indexing)                        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                            \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 STAGE 3: VECTORIZATION \u2705 COMPLETE                             \u2502\n\u2502                                                                 \u2502\n\u2502 Text Chunks \u2192 Embedding Generator \u2192 Vector DB                  \u2502\n\u2502                                                                 \u2502\n\u2502 Enables:                                                       \u2502\n\u2502 \u2022 Semantic search ("find contracts about liability")          \u2502\n\u2502 \u2022 Document Q&A with LLMs                                       \u2502\n\u2502 \u2022 Similar document recommendations                             \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n'})}),"\n",(0,t.jsx)(n.h2,{id:"database-schema",children:"Database Schema"}),"\n",(0,t.jsxs)(n.h3,{id:"table-oc_openregister_file_texts",children:["Table: ",(0,t.jsx)(n.code,{children:"oc_openregister_file_texts"})]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Purpose:"})," Store extracted text content from files for fast search without re-parsing."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Columns:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"id"})," (BIGINT) - Primary key"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"file_id"})," (BIGINT) - Nextcloud file ID from oc_filecache [UNIQUE]"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"file_path"})," (STRING) - Full path in Nextcloud"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"file_name"})," (STRING) - Filename with extension"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"mime_type"})," (STRING) - MIME type"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"file_size"})," (BIGINT) - File size in bytes"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"file_checksum"})," (STRING) - For change detection"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"text_content"})," (MEDIUMTEXT) - Extracted text (16MB max)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"text_length"})," (INT) - Character count"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"extraction_method"})," (STRING) - text_extract, ocr, tika, api"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"extraction_status"})," (STRING) - pending, processing, completed, failed, skipped"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"extraction_error"})," (TEXT) - Error message if failed"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"chunked"})," (BOOLEAN) - Whether chunked"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"chunk_count"})," (INT) - Number of chunks"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"chunks_json"})," (TEXT) - JSON array of chunks with metadata"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"indexed_in_solr"})," (BOOLEAN) - In SOLR index"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"vectorized"})," (BOOLEAN) - Has embeddings"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"created_at"})," (DATETIME)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"updated_at"})," (DATETIME)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"extracted_at"})," (DATETIME)"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Indexes:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Primary: ",(0,t.jsx)(n.code,{children:"id"})]}),"\n",(0,t.jsxs)(n.li,{children:["Unique: ",(0,t.jsx)(n.code,{children:"file_id"})]}),"\n",(0,t.jsxs)(n.li,{children:["Performance: ",(0,t.jsx)(n.code,{children:"extraction_status"}),", ",(0,t.jsx)(n.code,{children:"mime_type"}),", ",(0,t.jsx)(n.code,{children:"indexed_in_solr"}),", ",(0,t.jsx)(n.code,{children:"vectorized"}),", ",(0,t.jsx)(n.code,{children:"created_at"})]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"services-architecture",children:"Services Architecture"}),"\n",(0,t.jsx)(n.h3,{id:"filetextservice",children:"FileTextService"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Location:"})," ",(0,t.jsx)(n.code,{children:"lib/Service/FileTextService.php"})]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Purpose:"})," Manage file text extraction and storage lifecycle."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Key Methods:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"extractAndStoreFileText(int $fileId): array"})," - Extract and persist text"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"getFileText(int $fileId): ?array"})," - Retrieve stored text"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"needsExtraction(int $fileId): bool"})," - Check if extraction needed"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"updateExtractionStatus(int $fileId, string $status, ?string $error = null): void"})," - Update processing status"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"processPendingFiles(int $limit = 100): array"})," - Bulk processing"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"getStats(): array"})," - Extraction statistics"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Supported File Types:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Text: ",(0,t.jsx)(n.code,{children:".txt"}),", ",(0,t.jsx)(n.code,{children:".md"}),", ",(0,t.jsx)(n.code,{children:".html"}),", ",(0,t.jsx)(n.code,{children:".csv"}),", ",(0,t.jsx)(n.code,{children:".json"}),", ",(0,t.jsx)(n.code,{children:".xml"})]}),"\n",(0,t.jsxs)(n.li,{children:["Documents: ",(0,t.jsx)(n.code,{children:".pdf"}),", ",(0,t.jsx)(n.code,{children:".docx"}),", ",(0,t.jsx)(n.code,{children:".xlsx"}),", ",(0,t.jsx)(n.code,{children:".pptx"}),", ",(0,t.jsx)(n.code,{children:".doc"}),", ",(0,t.jsx)(n.code,{children:".xls"}),", ",(0,t.jsx)(n.code,{children:".ppt"})]}),"\n",(0,t.jsxs)(n.li,{children:["OpenDocument: ",(0,t.jsx)(n.code,{children:".odt"}),", ",(0,t.jsx)(n.code,{children:".ods"})]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Features:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Checksum-based change detection"}),"\n",(0,t.jsx)(n.li,{children:"Automatic re-extraction on file update"}),"\n",(0,t.jsx)(n.li,{children:"Error handling and status tracking"}),"\n",(0,t.jsxs)(n.li,{children:["Integration with existing ",(0,t.jsx)(n.code,{children:"SolrFileService"})]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"textextractionservice",children:"TextExtractionService"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Location:"})," ",(0,t.jsx)(n.code,{children:"lib/Service/TextExtractionService.php"})]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Purpose:"})," Handle text extraction, chunking, and language detection."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Key Methods:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"extractTextFromFile(string $filePath): string"})," - Extract text from file"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"chunkDocument(string $text, array $options = []): array"})," - Split text into chunks"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"detectLanguage(string $text): array"})," - Detect text language"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"processFile(int $fileId, array $metadata = []): array"})," - Complete file processing"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Chunking Options:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"chunkSize"}),": Maximum characters per chunk (default: 1000)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"chunkOverlap"}),": Overlap between chunks (default: 200)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"preserveSentences"}),": Keep sentence boundaries (default: true)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"preserveParagraphs"}),": Keep paragraph boundaries (default: true)"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"event-listener",children:"Event Listener"}),"\n",(0,t.jsx)(n.h3,{id:"filechangelistener",children:"FileChangeListener"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Location:"})," ",(0,t.jsx)(n.code,{children:"lib/Listener/FileChangeListener.php"})]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Purpose:"})," Automatically process files on upload/update."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Events:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"NodeCreatedEvent"})," - File uploaded"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"NodeWrittenEvent"})," - File updated"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Behavior:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Checks if extraction is needed (checksum comparison)"}),"\n",(0,t.jsx)(n.li,{children:"Triggers text extraction automatically"}),"\n",(0,t.jsx)(n.li,{children:"Updates extraction status"}),"\n",(0,t.jsx)(n.li,{children:"Full error handling and logging"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Registration:"}),"\nRegistered in ",(0,t.jsx)(n.code,{children:"Application.php"})," with service container integration."]}),"\n",(0,t.jsx)(n.h2,{id:"api-endpoints",children:"API Endpoints"}),"\n",(0,t.jsx)(n.h3,{id:"file-text-management",children:"File Text Management"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"GET    /api/files/{fileId}/text         - Get extracted text\nPOST   /api/files/{fileId}/extract      - Force re-extraction\nPOST   /api/files/extract/bulk          - Bulk extract files\nGET    /api/files/extraction/stats      - Get statistics\nDELETE /api/files/{fileId}/text         - Delete file text\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Controller:"})," ",(0,t.jsx)(n.code,{children:"FileTextController.php"})]}),"\n",(0,t.jsx)(n.h3,{id:"solr-file-indexing",children:"SOLR File Indexing"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"POST /api/solr/warmup/files             - Warmup file collection\nPOST /api/solr/files/{fileId}/index     - Index single file\nPOST /api/solr/files/reindex            - Reindex all files\nGET  /api/solr/files/stats              - Get index statistics\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Controller:"})," ",(0,t.jsx)(n.code,{children:"SettingsController.php"})]}),"\n",(0,t.jsx)(n.h3,{id:"file-search",children:"File Search"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"POST /api/search/files/keyword          - Keyword search\nPOST /api/search/files/semantic         - Semantic search\nPOST /api/search/files/hybrid           - Hybrid search\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Controller:"})," ",(0,t.jsx)(n.code,{children:"FileSearchController.php"})]}),"\n",(0,t.jsx)(n.h2,{id:"processing-flow",children:"Processing Flow"}),"\n",(0,t.jsx)(n.h3,{id:"automatic-processing",children:"Automatic Processing"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"File Upload/Update"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Nextcloud fires ",(0,t.jsx)(n.code,{children:"NodeCreatedEvent"})," or ",(0,t.jsx)(n.code,{children:"NodeWrittenEvent"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"FileChangeListener"})," receives event"]}),"\n",(0,t.jsx)(n.li,{children:"Checks if extraction needed (checksum comparison)"}),"\n",(0,t.jsxs)(n.li,{children:["Calls ",(0,t.jsx)(n.code,{children:"FileTextService::extractAndStoreFileText()"})]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Text Extraction"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"FileTextService"})," calls ",(0,t.jsx)(n.code,{children:"SolrFileService::extractTextFromFile()"})]}),"\n",(0,t.jsx)(n.li,{children:"Text extracted using appropriate method (LLPhant, OCR, etc.)"}),"\n",(0,t.jsxs)(n.li,{children:["Text stored in ",(0,t.jsx)(n.code,{children:"oc_openregister_file_texts"})," table"]}),"\n",(0,t.jsxs)(n.li,{children:["Status set to ",(0,t.jsx)(n.code,{children:"completed"})]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Chunking"})," (Optional, triggered manually or via API)"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"TextExtractionService::chunkDocument()"})," splits text"]}),"\n",(0,t.jsxs)(n.li,{children:["Chunks stored in ",(0,t.jsx)(n.code,{children:"chunks_json"})," field"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"chunked"})," flag set to ",(0,t.jsx)(n.code,{children:"true"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"chunk_count"})," updated"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"SOLR Indexing"})," (Optional, triggered manually or via API)"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Chunks indexed to SOLR file collection"}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"indexed_in_solr"})," flag set to ",(0,t.jsx)(n.code,{children:"true"})]}),"\n",(0,t.jsx)(n.li,{children:"Full-text search enabled"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Vectorization"})," (Optional, triggered manually or via API)"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Chunks converted to embeddings"}),"\n",(0,t.jsx)(n.li,{children:"Vectors stored in database or SOLR"}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"vectorized"})," flag set to ",(0,t.jsx)(n.code,{children:"true"})]}),"\n",(0,t.jsx)(n.li,{children:"Semantic search enabled"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"change-detection",children:"Change Detection"}),"\n",(0,t.jsx)(n.p,{children:"The system uses MD5 checksums to detect file changes:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"// Calculate checksum\n$checksum = md5_file($filePath);\n\n// Compare with stored checksum\nif ($storedChecksum !== $checksum) {\n    // File changed, re-extract\n    $this->extractAndStoreFileText($fileId);\n}\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Benefits:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Avoids unnecessary re-extraction"}),"\n",(0,t.jsx)(n.li,{children:"Efficient change detection"}),"\n",(0,t.jsx)(n.li,{children:"Automatic updates on file modification"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"chunking-strategy",children:"Chunking Strategy"}),"\n",(0,t.jsx)(n.h3,{id:"chunk-structure",children:"Chunk Structure"}),"\n",(0,t.jsx)(n.p,{children:"Each chunk includes:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"text"}),": Chunk text content"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"index"}),": Chunk index (0-based)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"start_offset"}),": Character offset in original text"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"end_offset"}),": Character offset in original text"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"length"}),": Character count"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"metadata"}),": Additional metadata (language, etc.)"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"chunking-options",children:"Chunking Options"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Default Settings:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"chunkSize"}),": 1000 characters"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"chunkOverlap"}),": 200 characters"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"preserveSentences"}),": true"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"preserveParagraphs"}),": true"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Customization:"}),"\nChunking options can be configured per extraction via API or service calls."]}),"\n",(0,t.jsx)(n.h2,{id:"performance",children:"Performance"}),"\n",(0,t.jsx)(n.h3,{id:"extraction-times",children:"Extraction Times"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"File Type"}),(0,t.jsx)(n.th,{children:"Size"}),(0,t.jsx)(n.th,{children:"Extraction Time"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Text (.txt)"}),(0,t.jsx)(n.td,{children:"< 1MB"}),(0,t.jsx)(n.td,{children:"< 1s"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"PDF"}),(0,t.jsx)(n.td,{children:"< 5MB"}),(0,t.jsx)(n.td,{children:"1-3s"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"DOCX"}),(0,t.jsx)(n.td,{children:"< 5MB"}),(0,t.jsx)(n.td,{children:"1-2s"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"XLSX"}),(0,t.jsx)(n.td,{children:"< 5MB"}),(0,t.jsx)(n.td,{children:"2-5s"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Images (OCR)"}),(0,t.jsx)(n.td,{children:"< 5MB"}),(0,t.jsx)(n.td,{children:"3-10s"})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"bulk-processing",children:"Bulk Processing"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Batch Size"}),": 100 files per batch (configurable)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Parallel Processing"}),": Supported for multiple files"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Progress Tracking"}),": Real-time status updates"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,t.jsx)(n.h3,{id:"extraction-errors",children:"Extraction Errors"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Common Errors:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Unsupported file type \u2192 Status: ",(0,t.jsx)(n.code,{children:"skipped"})]}),"\n",(0,t.jsxs)(n.li,{children:["Extraction failure \u2192 Status: ",(0,t.jsx)(n.code,{children:"failed"}),", error message stored"]}),"\n",(0,t.jsxs)(n.li,{children:["File not found \u2192 Status: ",(0,t.jsx)(n.code,{children:"failed"}),", error logged"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Recovery:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Failed extractions can be retried via API"}),"\n",(0,t.jsx)(n.li,{children:"Error messages stored for debugging"}),"\n",(0,t.jsx)(n.li,{children:"Automatic retry on file update"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"statistics",children:"Statistics"}),"\n",(0,t.jsx)(n.h3,{id:"available-statistics",children:"Available Statistics"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Total files processed"}),"\n",(0,t.jsx)(n.li,{children:"Files by status (pending, completed, failed, skipped)"}),"\n",(0,t.jsx)(n.li,{children:"Total text extracted (characters)"}),"\n",(0,t.jsx)(n.li,{children:"Average extraction time"}),"\n",(0,t.jsx)(n.li,{children:"Files indexed in SOLR"}),"\n",(0,t.jsx)(n.li,{children:"Files vectorized"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"API:"})," ",(0,t.jsx)(n.code,{children:"GET /api/files/extraction/stats"})]}),"\n",(0,t.jsx)(n.h2,{id:"testing",children:"Testing"}),"\n",(0,t.jsx)(n.h3,{id:"test-results",children:"Test Results"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Test 1: File Upload"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u2705 File uploaded \u2192 Text extracted in < 1s"}),"\n",(0,t.jsx)(n.li,{children:"\u2705 Database verified with actual data"}),"\n",(0,t.jsxs)(n.li,{children:["\u2705 Status set to ",(0,t.jsx)(n.code,{children:"completed"})]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Test 2: File Update"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u2705 Change detected via checksum"}),"\n",(0,t.jsx)(n.li,{children:"\u2705 Re-extraction triggered automatically"}),"\n",(0,t.jsx)(n.li,{children:"\u2705 Updated text stored correctly"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Test 3: Bulk Processing"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u2705 100 files processed successfully"}),"\n",(0,t.jsx)(n.li,{children:"\u2705 Status tracking working correctly"}),"\n",(0,t.jsx)(n.li,{children:"\u2705 Error handling functional"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"test-results-1",children:"Test Results"}),"\n",(0,t.jsx)(n.h3,{id:"file-upload-test",children:"File Upload Test"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u2705 File uploaded \u2192 Text extracted in < 1s"}),"\n",(0,t.jsx)(n.li,{children:"\u2705 Database verified with actual data"}),"\n",(0,t.jsxs)(n.li,{children:["\u2705 Status set to ",(0,t.jsx)(n.code,{children:"completed"})]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"file-update-test",children:"File Update Test"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u2705 Change detected via checksum"}),"\n",(0,t.jsx)(n.li,{children:"\u2705 Re-extraction triggered automatically"}),"\n",(0,t.jsx)(n.li,{children:"\u2705 Updated text stored correctly"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"bulk-processing-test",children:"Bulk Processing Test"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u2705 100 files processed successfully"}),"\n",(0,t.jsx)(n.li,{children:"\u2705 Status tracking working correctly"}),"\n",(0,t.jsx)(n.li,{children:"\u2705 Error handling functional"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"performance-metrics",children:"Performance Metrics"}),"\n",(0,t.jsx)(n.h3,{id:"extraction-times-1",children:"Extraction Times"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"File Type"}),(0,t.jsx)(n.th,{children:"Size"}),(0,t.jsx)(n.th,{children:"Extraction Time"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Text (.txt)"}),(0,t.jsx)(n.td,{children:"< 1MB"}),(0,t.jsx)(n.td,{children:"< 1s"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"PDF"}),(0,t.jsx)(n.td,{children:"< 5MB"}),(0,t.jsx)(n.td,{children:"1-3s"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"DOCX"}),(0,t.jsx)(n.td,{children:"< 5MB"}),(0,t.jsx)(n.td,{children:"1-2s"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"XLSX"}),(0,t.jsx)(n.td,{children:"< 5MB"}),(0,t.jsx)(n.td,{children:"2-5s"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Images (OCR)"}),(0,t.jsx)(n.td,{children:"< 5MB"}),(0,t.jsx)(n.td,{children:"3-10s"})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"bulk-processing-1",children:"Bulk Processing"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Batch Size"}),": 100 files per batch (configurable)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Parallel Processing"}),": Supported for multiple files"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Progress Tracking"}),": Real-time status updates"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/docs/technical/text-extraction-readme",children:"Text Extraction Quick Start"})," - Quick reference guide"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/docs/technical/text-extraction-entities",children:"Text Extraction Entities"})," - Database schema details"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/docs/technical/enhanced-text-extraction-implementation-plan",children:"Enhanced Text Extraction Plan"})," - Future enhancements"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/docs/Technical/vectorization-architecture",children:"Vectorization Architecture"})," - Vector embedding details"]}),"\n"]})]})}function o(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>r,x:()=>c});var s=i(96540);const t={},l=s.createContext(t);function r(e){const n=s.useContext(l);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),s.createElement(l.Provider,{value:n},e.children)}}}]);