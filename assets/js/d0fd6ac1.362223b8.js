"use strict";(self.webpackChunkopen_catalogi_docs=self.webpackChunkopen_catalogi_docs||[]).push([[4642],{28453:(e,n,s)=>{s.d(n,{R:()=>d,x:()=>a});var r=s(96540);const i={},t=r.createContext(i);function d(e){const n=r.useContext(t);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:d(e.components),r.createElement(t.Provider,{value:n},e.children)}},34551:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>a,default:()=>h,frontMatter:()=>d,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"api/conversations","title":"Conversations API","description":"Overview","source":"@site/docs/api/conversations.md","sourceDirName":"api","slug":"/api/conversations","permalink":"/docs/api/conversations","draft":false,"unlisted":false,"editUrl":"https://github.com/conductionnl/openregister/tree/main/website/docs/api/conversations.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Bulk Operations API","permalink":"/docs/api/bulk-operations"},"next":{"title":"Events API Reference","permalink":"/docs/api/events-reference"}}');var i=s(74848),t=s(28453);const d={},a="Conversations API",o={},l=[{value:"Overview",id:"overview",level:2},{value:"Data Flow",id:"data-flow",level:2},{value:"Base Endpoint",id:"base-endpoint",level:2},{value:"Authentication",id:"authentication",level:2},{value:"Endpoints",id:"endpoints",level:2},{value:"List Conversations",id:"list-conversations",level:3},{value:"Query Parameters",id:"query-parameters",level:4},{value:"Response",id:"response",level:4},{value:"Status Codes",id:"status-codes",level:4},{value:"Get Conversation",id:"get-conversation",level:3},{value:"Path Parameters",id:"path-parameters",level:4},{value:"Response",id:"response-1",level:4},{value:"Status Codes",id:"status-codes-1",level:4},{value:"Create Conversation",id:"create-conversation",level:3},{value:"Request Body",id:"request-body",level:4},{value:"Response",id:"response-2",level:4},{value:"Status Codes",id:"status-codes-2",level:4},{value:"Update Conversation",id:"update-conversation",level:3},{value:"Path Parameters",id:"path-parameters-1",level:4},{value:"Request Body",id:"request-body-1",level:4},{value:"Response",id:"response-3",level:4},{value:"Status Codes",id:"status-codes-3",level:4},{value:"Delete Conversation (Soft)",id:"delete-conversation-soft",level:3},{value:"Path Parameters",id:"path-parameters-2",level:4},{value:"Response",id:"response-4",level:4},{value:"Status Codes",id:"status-codes-4",level:4},{value:"Restore Conversation",id:"restore-conversation",level:3},{value:"Path Parameters",id:"path-parameters-3",level:4},{value:"Response",id:"response-5",level:4},{value:"Status Codes",id:"status-codes-5",level:4},{value:"Delete Conversation (Permanent)",id:"delete-conversation-permanent",level:3},{value:"Path Parameters",id:"path-parameters-4",level:4},{value:"Response",id:"response-6",level:4},{value:"Status Codes",id:"status-codes-6",level:4},{value:"List Archived Conversations",id:"list-archived-conversations",level:3},{value:"Query Parameters",id:"query-parameters-1",level:4},{value:"Response",id:"response-7",level:4},{value:"Status Codes",id:"status-codes-7",level:4},{value:"Access Control",id:"access-control",level:2},{value:"Conversation Ownership",id:"conversation-ownership",level:3},{value:"Permission Rules",id:"permission-rules",level:3},{value:"Examples",id:"examples",level:2},{value:"Creating and Using a Conversation",id:"creating-and-using-a-conversation",level:3},{value:"Managing Archives",id:"managing-archives",level:3},{value:"Related APIs",id:"related-apis",level:2},{value:"Database Schema",id:"database-schema",level:2},{value:"Conversations Table",id:"conversations-table",level:3},{value:"Messages Table",id:"messages-table",level:3}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",mermaid:"mermaid",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"conversations-api",children:"Conversations API"})}),"\n",(0,i.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsx)(n.p,{children:"The Conversations API provides endpoints for managing AI chat conversations, including creating, retrieving, updating, and archiving conversations."}),"\n",(0,i.jsx)(n.h2,{id:"data-flow",children:"Data Flow"}),"\n",(0,i.jsx)(n.mermaid,{value:"sequenceDiagram\n    participant User\n    participant Frontend\n    participant ConversationController\n    participant ChatService\n    participant AgentMapper\n    participant LLM\n    participant VectorDB\n    \n    User->>Frontend: Start new conversation\n    Frontend->>ConversationController: POST /api/conversations\n    ConversationController->>ConversationController: Create Conversation\n    ConversationController--\x3e>Frontend: Return conversation UUID\n    \n    User->>Frontend: Send message\n    Frontend->>ChatService: POST /api/chat/message\n    ChatService->>AgentMapper: Get agent configuration\n    AgentMapper--\x3e>ChatService: Agent (views, search settings)\n    ChatService->>VectorDB: Retrieve context (filtered by views)\n    VectorDB--\x3e>ChatService: Relevant sources\n    ChatService->>LLM: Generate response with context\n    LLM--\x3e>ChatService: Response\n    ChatService->>ConversationController: Store message + response\n    ChatService--\x3e>Frontend: Return response with sources"}),"\n",(0,i.jsx)(n.h2,{id:"base-endpoint",children:"Base Endpoint"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"/index.php/apps/openregister/api/conversations\n"})}),"\n",(0,i.jsx)(n.h2,{id:"authentication",children:"Authentication"}),"\n",(0,i.jsx)(n.p,{children:"All endpoints require authentication via Nextcloud session or app password."}),"\n",(0,i.jsx)(n.h2,{id:"endpoints",children:"Endpoints"}),"\n",(0,i.jsx)(n.h3,{id:"list-conversations",children:"List Conversations"}),"\n",(0,i.jsx)(n.p,{children:"Retrieve all active conversations for the current user in their active organisation."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-http",children:"GET /index.php/apps/openregister/api/conversations\n"})}),"\n",(0,i.jsx)(n.h4,{id:"query-parameters",children:"Query Parameters"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Parameter"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Required"}),(0,i.jsx)(n.th,{children:"Default"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"limit"})}),(0,i.jsx)(n.td,{children:"integer"}),(0,i.jsx)(n.td,{children:"No"}),(0,i.jsx)(n.td,{children:"50"}),(0,i.jsx)(n.td,{children:"Maximum number of conversations to return"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"offset"})}),(0,i.jsx)(n.td,{children:"integer"}),(0,i.jsx)(n.td,{children:"No"}),(0,i.jsx)(n.td,{children:"0"}),(0,i.jsx)(n.td,{children:"Number of conversations to skip (for pagination)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"includeDeleted"})}),(0,i.jsx)(n.td,{children:"boolean"}),(0,i.jsx)(n.td,{children:"No"}),(0,i.jsx)(n.td,{children:"false"}),(0,i.jsx)(n.td,{children:"Include soft-deleted conversations"})]})]})]}),"\n",(0,i.jsx)(n.h4,{id:"response",children:"Response"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "results": [\n    {\n      "id": 1,\n      "uuid": "550e8400-e29b-41d4-a716-446655440001",\n      "title": "Customer Support Query",\n      "userId": "admin",\n      "organisation": 1,\n      "agentId": 5,\n      "metadata": {\n        "source": "web",\n        "tags": ["support", "billing"]\n      },\n      "deletedAt": null,\n      "created": "2024-11-05T10:00:00Z",\n      "updated": "2024-11-05T10:30:00Z",\n      "messageCount": 8\n    }\n  ],\n  "total": 15,\n  "limit": 50,\n  "offset": 0\n}\n'})}),"\n",(0,i.jsx)(n.h4,{id:"status-codes",children:"Status Codes"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"200 OK"}),": Conversations retrieved successfully"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"500 Internal Server Error"}),": Server error occurred"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"get-conversation",children:"Get Conversation"}),"\n",(0,i.jsx)(n.p,{children:"Retrieve a single conversation with all its messages."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-http",children:"GET /index.php/apps/openregister/api/conversations/{uuid}\n"})}),"\n",(0,i.jsx)(n.h4,{id:"path-parameters",children:"Path Parameters"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Parameter"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Required"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsx)(n.tbody,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"uuid"})}),(0,i.jsx)(n.td,{children:"string"}),(0,i.jsx)(n.td,{children:"Yes"}),(0,i.jsx)(n.td,{children:"Conversation UUID"})]})})]}),"\n",(0,i.jsx)(n.h4,{id:"response-1",children:"Response"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "id": 1,\n  "uuid": "550e8400-e29b-41d4-a716-446655440001",\n  "title": "Customer Support Query",\n  "userId": "admin",\n  "organisation": 1,\n  "agentId": 5,\n  "metadata": {\n    "source": "web",\n    "tags": ["support", "billing"]\n  },\n  "deletedAt": null,\n  "created": "2024-11-05T10:00:00Z",\n  "updated": "2024-11-05T10:30:00Z",\n  "messages": [\n    {\n      "id": 1,\n      "uuid": "660e8400-e29b-41d4-a716-446655440001",\n      "conversationId": 1,\n      "role": "user",\n      "content": "How do I update my billing information?",\n      "sources": [],\n      "created": "2024-11-05T10:00:00Z"\n    },\n    {\n      "id": 2,\n      "uuid": "660e8400-e29b-41d4-a716-446655440002",\n      "conversationId": 1,\n      "role": "assistant",\n      "content": "To update your billing information, navigate to...",\n      "sources": [\n        {\n          "type": "file",\n          "id": "doc-001",\n          "name": "billing-guide.pdf",\n          "relevance": 0.95\n        }\n      ],\n      "created": "2024-11-05T10:00:15Z"\n    }\n  ],\n  "messageCount": 8\n}\n'})}),"\n",(0,i.jsx)(n.h4,{id:"status-codes-1",children:"Status Codes"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"200 OK"}),": Conversation retrieved successfully"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"403 Forbidden"}),": User doesn't have access to this conversation"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"404 Not Found"}),": Conversation not found"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"500 Internal Server Error"}),": Server error occurred"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"create-conversation",children:"Create Conversation"}),"\n",(0,i.jsx)(n.p,{children:"Create a new conversation with a specific agent."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-http",children:"POST /index.php/apps/openregister/api/conversations\n"})}),"\n",(0,i.jsx)(n.h4,{id:"request-body",children:"Request Body"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "agentUuid": "450e8400-e29b-41d4-a716-446655440010",\n  "title": "Optional custom title"\n}\n'})}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Field"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Required"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"agentUuid"})}),(0,i.jsx)(n.td,{children:"string"}),(0,i.jsx)(n.td,{children:"Yes"}),(0,i.jsx)(n.td,{children:"UUID of the agent to use for this conversation"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"title"})}),(0,i.jsx)(n.td,{children:"string"}),(0,i.jsx)(n.td,{children:"No"}),(0,i.jsx)(n.td,{children:"Custom title (auto-generated if not provided)"})]})]})]}),"\n",(0,i.jsx)(n.h4,{id:"response-2",children:"Response"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "id": 10,\n  "uuid": "550e8400-e29b-41d4-a716-446655440010",\n  "title": "New Conversation",\n  "userId": "admin",\n  "organisation": 1,\n  "agentId": 5,\n  "metadata": {},\n  "deletedAt": null,\n  "created": "2024-11-05T11:00:00Z",\n  "updated": "2024-11-05T11:00:00Z"\n}\n'})}),"\n",(0,i.jsx)(n.h4,{id:"status-codes-2",children:"Status Codes"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"201 Created"}),": Conversation created successfully"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"400 Bad Request"}),": Invalid request data or agent not found"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"500 Internal Server Error"}),": Server error occurred"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"update-conversation",children:"Update Conversation"}),"\n",(0,i.jsx)(n.p,{children:"Update a conversation's title or metadata."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-http",children:"PATCH /index.php/apps/openregister/api/conversations/{uuid}\n"})}),"\n",(0,i.jsx)(n.h4,{id:"path-parameters-1",children:"Path Parameters"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Parameter"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Required"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsx)(n.tbody,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"uuid"})}),(0,i.jsx)(n.td,{children:"string"}),(0,i.jsx)(n.td,{children:"Yes"}),(0,i.jsx)(n.td,{children:"Conversation UUID"})]})})]}),"\n",(0,i.jsx)(n.h4,{id:"request-body-1",children:"Request Body"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "title": "Updated Title",\n  "metadata": {\n    "priority": "high",\n    "category": "technical"\n  }\n}\n'})}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Field"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Required"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"title"})}),(0,i.jsx)(n.td,{children:"string"}),(0,i.jsx)(n.td,{children:"No"}),(0,i.jsx)(n.td,{children:"New conversation title"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"metadata"})}),(0,i.jsx)(n.td,{children:"object"}),(0,i.jsx)(n.td,{children:"No"}),(0,i.jsx)(n.td,{children:"New or updated metadata"})]})]})]}),"\n",(0,i.jsx)(n.h4,{id:"response-3",children:"Response"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "id": 1,\n  "uuid": "550e8400-e29b-41d4-a716-446655440001",\n  "title": "Updated Title",\n  "userId": "admin",\n  "organisation": 1,\n  "agentId": 5,\n  "metadata": {\n    "priority": "high",\n    "category": "technical"\n  },\n  "deletedAt": null,\n  "created": "2024-11-05T10:00:00Z",\n  "updated": "2024-11-05T11:05:00Z"\n}\n'})}),"\n",(0,i.jsx)(n.h4,{id:"status-codes-3",children:"Status Codes"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"200 OK"}),": Conversation updated successfully"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"403 Forbidden"}),": User doesn't have permission to modify this conversation"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"404 Not Found"}),": Conversation not found"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"500 Internal Server Error"}),": Server error occurred"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"delete-conversation-soft",children:"Delete Conversation (Soft)"}),"\n",(0,i.jsx)(n.p,{children:"Soft delete a conversation, moving it to the archive."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-http",children:"DELETE /index.php/apps/openregister/api/conversations/{uuid}\n"})}),"\n",(0,i.jsx)(n.h4,{id:"path-parameters-2",children:"Path Parameters"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Parameter"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Required"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsx)(n.tbody,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"uuid"})}),(0,i.jsx)(n.td,{children:"string"}),(0,i.jsx)(n.td,{children:"Yes"}),(0,i.jsx)(n.td,{children:"Conversation UUID"})]})})]}),"\n",(0,i.jsx)(n.h4,{id:"response-4",children:"Response"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "message": "Conversation deleted successfully",\n  "uuid": "550e8400-e29b-41d4-a716-446655440001"\n}\n'})}),"\n",(0,i.jsx)(n.h4,{id:"status-codes-4",children:"Status Codes"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"200 OK"}),": Conversation soft deleted successfully"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"403 Forbidden"}),": User doesn't have permission to delete this conversation"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"404 Not Found"}),": Conversation not found"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"500 Internal Server Error"}),": Server error occurred"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"restore-conversation",children:"Restore Conversation"}),"\n",(0,i.jsx)(n.p,{children:"Restore a soft-deleted conversation from the archive."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-http",children:"POST /index.php/apps/openregister/api/conversations/{uuid}/restore\n"})}),"\n",(0,i.jsx)(n.h4,{id:"path-parameters-3",children:"Path Parameters"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Parameter"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Required"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsx)(n.tbody,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"uuid"})}),(0,i.jsx)(n.td,{children:"string"}),(0,i.jsx)(n.td,{children:"Yes"}),(0,i.jsx)(n.td,{children:"Conversation UUID"})]})})]}),"\n",(0,i.jsx)(n.h4,{id:"response-5",children:"Response"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "id": 1,\n  "uuid": "550e8400-e29b-41d4-a716-446655440001",\n  "title": "Restored Conversation",\n  "userId": "admin",\n  "organisation": 1,\n  "agentId": 5,\n  "metadata": {},\n  "deletedAt": null,\n  "created": "2024-11-05T10:00:00Z",\n  "updated": "2024-11-05T11:10:00Z"\n}\n'})}),"\n",(0,i.jsx)(n.h4,{id:"status-codes-5",children:"Status Codes"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"200 OK"}),": Conversation restored successfully"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"403 Forbidden"}),": User doesn't have permission to restore this conversation"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"404 Not Found"}),": Conversation not found"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"500 Internal Server Error"}),": Server error occurred"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"delete-conversation-permanent",children:"Delete Conversation (Permanent)"}),"\n",(0,i.jsx)(n.p,{children:"Permanently delete a conversation and all its messages."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-http",children:"DELETE /index.php/apps/openregister/api/conversations/{uuid}/permanent\n"})}),"\n",(0,i.jsx)(n.h4,{id:"path-parameters-4",children:"Path Parameters"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Parameter"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Required"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsx)(n.tbody,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"uuid"})}),(0,i.jsx)(n.td,{children:"string"}),(0,i.jsx)(n.td,{children:"Yes"}),(0,i.jsx)(n.td,{children:"Conversation UUID"})]})})]}),"\n",(0,i.jsx)(n.h4,{id:"response-6",children:"Response"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "message": "Conversation permanently deleted",\n  "uuid": "550e8400-e29b-41d4-a716-446655440001"\n}\n'})}),"\n",(0,i.jsx)(n.h4,{id:"status-codes-6",children:"Status Codes"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"200 OK"}),": Conversation permanently deleted"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"403 Forbidden"}),": User doesn't have permission to delete this conversation"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"404 Not Found"}),": Conversation not found"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"500 Internal Server Error"}),": Server error occurred"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"list-archived-conversations",children:"List Archived Conversations"}),"\n",(0,i.jsx)(n.p,{children:"Retrieve all soft-deleted conversations for the current user."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-http",children:"GET /index.php/apps/openregister/api/conversations/archive\n"})}),"\n",(0,i.jsx)(n.h4,{id:"query-parameters-1",children:"Query Parameters"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Parameter"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Required"}),(0,i.jsx)(n.th,{children:"Default"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"limit"})}),(0,i.jsx)(n.td,{children:"integer"}),(0,i.jsx)(n.td,{children:"No"}),(0,i.jsx)(n.td,{children:"50"}),(0,i.jsx)(n.td,{children:"Maximum number of conversations to return"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"offset"})}),(0,i.jsx)(n.td,{children:"integer"}),(0,i.jsx)(n.td,{children:"No"}),(0,i.jsx)(n.td,{children:"0"}),(0,i.jsx)(n.td,{children:"Number of conversations to skip (for pagination)"})]})]})]}),"\n",(0,i.jsx)(n.h4,{id:"response-7",children:"Response"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "results": [\n    {\n      "id": 3,\n      "uuid": "550e8400-e29b-41d4-a716-446655440003",\n      "title": "Archived Conversation",\n      "userId": "admin",\n      "organisation": 1,\n      "agentId": 2,\n      "metadata": {},\n      "deletedAt": "2024-11-05T09:00:00Z",\n      "created": "2024-11-04T14:00:00Z",\n      "updated": "2024-11-05T09:00:00Z",\n      "messageCount": 5\n    }\n  ],\n  "total": 3,\n  "limit": 50,\n  "offset": 0\n}\n'})}),"\n",(0,i.jsx)(n.h4,{id:"status-codes-7",children:"Status Codes"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"200 OK"}),": Archived conversations retrieved successfully"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"500 Internal Server Error"}),": Server error occurred"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"access-control",children:"Access Control"}),"\n",(0,i.jsx)(n.h3,{id:"conversation-ownership",children:"Conversation Ownership"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Users can only access conversations they own (",(0,i.jsx)(n.code,{children:"userId"})," matches)"]}),"\n",(0,i.jsx)(n.li,{children:"Conversations are scoped to the user's current organisation"}),"\n",(0,i.jsx)(n.li,{children:"When switching organisations, conversations from other organisations become inaccessible"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"permission-rules",children:"Permission Rules"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Action"}),(0,i.jsx)(n.th,{children:"Permission Required"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"List conversations"}),(0,i.jsx)(n.td,{children:"User must be in the conversation's organisation"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"View conversation"}),(0,i.jsx)(n.td,{children:"User must be the owner"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Create conversation"}),(0,i.jsx)(n.td,{children:"User must have access to the specified agent"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Update conversation"}),(0,i.jsx)(n.td,{children:"User must be the owner"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Delete conversation"}),(0,i.jsx)(n.td,{children:"User must be the owner"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Restore conversation"}),(0,i.jsx)(n.td,{children:"User must be the owner"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"examples",children:"Examples"}),"\n",(0,i.jsx)(n.h3,{id:"creating-and-using-a-conversation",children:"Creating and Using a Conversation"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"// 1. Create a new conversation\nconst createResponse = await fetch('/index.php/apps/openregister/api/conversations', {\n  method: 'POST',\n  headers: { 'Content-Type': 'application/json' },\n  body: JSON.stringify({\n    agentUuid: 'agent-uuid-here'\n  })\n});\n\nconst conversation = await createResponse.json();\n\n// 2. Send a message (see Chat API)\nconst chatResponse = await fetch('/index.php/apps/openregister/api/chat/send', {\n  method: 'POST',\n  headers: { 'Content-Type': 'application/json' },\n  body: JSON.stringify({\n    conversationUuid: conversation.uuid,\n    message: 'Hello, can you help me?'\n  })\n});\n\n// 3. Get conversation with messages\nconst getResponse = await fetch(\n  `/index.php/apps/openregister/api/conversations/${conversation.uuid}`\n);\nconst conversationWithMessages = await getResponse.json();\n"})}),"\n",(0,i.jsx)(n.h3,{id:"managing-archives",children:"Managing Archives"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"// Soft delete a conversation\nawait fetch(`/index.php/apps/openregister/api/conversations/${uuid}`, {\n  method: 'DELETE'\n});\n\n// List archived conversations\nconst archiveResponse = await fetch('/index.php/apps/openregister/api/conversations/archive');\nconst archived = await archiveResponse.json();\n\n// Restore from archive\nawait fetch(`/index.php/apps/openregister/api/conversations/${uuid}/restore`, {\n  method: 'POST'\n});\n\n// Permanently delete\nawait fetch(`/index.php/apps/openregister/api/conversations/${uuid}/permanent`, {\n  method: 'DELETE'\n});\n"})}),"\n",(0,i.jsx)(n.h2,{id:"related-apis",children:"Related APIs"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/features/chat-rag-deepdive",children:"Chat & RAG Deep Dive"})," - How chat and RAG work"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/features/agents",children:"AI Agents"})," - Manage and configure AI agents"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/features/ai",children:"AI Configuration"})," - LLM setup and configuration"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"database-schema",children:"Database Schema"}),"\n",(0,i.jsx)(n.h3,{id:"conversations-table",children:"Conversations Table"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE openregister_conversations (\n  id BIGINT PRIMARY KEY AUTO_INCREMENT,\n  uuid VARCHAR(255) UNIQUE NOT NULL,\n  title VARCHAR(255),\n  user_id VARCHAR(255) NOT NULL,\n  organisation INT,\n  agent_id INT NOT NULL,\n  metadata LONGTEXT,  -- JSON\n  deleted_at DATETIME NULL,\n  created DATETIME NOT NULL,\n  updated DATETIME NOT NULL,\n  INDEX idx_user_org (user_id, organisation),\n  INDEX idx_agent (agent_id),\n  INDEX idx_deleted (deleted_at)\n);\n"})}),"\n",(0,i.jsx)(n.h3,{id:"messages-table",children:"Messages Table"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE openregister_messages (\n  id BIGINT PRIMARY KEY AUTO_INCREMENT,\n  uuid VARCHAR(255) UNIQUE NOT NULL,\n  conversation_id BIGINT NOT NULL,\n  role VARCHAR(50) NOT NULL,  -- 'user', 'assistant', 'system'\n  content LONGTEXT NOT NULL,\n  sources LONGTEXT,  -- JSON\n  created DATETIME NOT NULL,\n  INDEX idx_conversation (conversation_id),\n  FOREIGN KEY (conversation_id) REFERENCES openregister_conversations(id) ON DELETE CASCADE\n);\n"})})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}}}]);