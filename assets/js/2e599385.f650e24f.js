"use strict";(self.webpackChunkopen_catalogi_docs=self.webpackChunkopen_catalogi_docs||[]).push([[1655],{28453:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>c});var t=s(96540);const i={},r=t.createContext(i);function a(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),t.createElement(r.Provider,{value:n},e.children)}},72250:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>a,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"technical/multi-tenancy-testing","title":"Multi-Tenancy Testing Framework","description":"This document covers the comprehensive testing framework developed for OpenRegister\'s multi-tenancy implementation. The testing suite ensures reliability, security, and performance across all multi-tenancy features.","source":"@site/docs/technical/multi-tenancy-testing.md","sourceDirName":"technical","slug":"/technical/multi-tenancy-testing","permalink":"/docs/technical/multi-tenancy-testing","draft":false,"unlisted":false,"editUrl":"https://github.com/conductionnl/openregister/tree/main/website/docs/technical/multi-tenancy-testing.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Import Service","permalink":"/docs/technical/import-service"},"next":{"title":"Organization Filter Consolidation","permalink":"/docs/technical/organization-filter-consolidation"}}');var i=s(74848),r=s(28453);const a={},c="Multi-Tenancy Testing Framework",l={},d=[{value:"Overview",id:"overview",level:2},{value:"Test Architecture",id:"test-architecture",level:2},{value:"Test Organization",id:"test-organization",level:3},{value:"Test File Structure",id:"test-file-structure",level:3},{value:"Test Coverage",id:"test-coverage",level:2},{value:"1. Default Organisation Management (Tests 1.1-1.3)",id:"1-default-organisation-management-tests-11-13",level:3},{value:"2. Organisation CRUD Operations (Tests 2.1-2.7)",id:"2-organisation-crud-operations-tests-21-27",level:3},{value:"3. User-Organisation Relationships (Tests 3.1-3.6)",id:"3-user-organisation-relationships-tests-31-36",level:3},{value:"4. Active Organisation Management (Tests 4.1-4.6)",id:"4-active-organisation-management-tests-41-46",level:3},{value:"5. Entity Organisation Assignment (Tests 5.1-5.6)",id:"5-entity-organisation-assignment-tests-51-56",level:3},{value:"6. Data Migration (Tests 6.1-6.3)",id:"6-data-migration-tests-61-63",level:3},{value:"7. Session Cache Management (Tests 7.1-7.4)",id:"7-session-cache-management-tests-71-74",level:3},{value:"8. Performance &amp; Scalability (Tests 8.1-8.3)",id:"8-performance--scalability-tests-81-83",level:3},{value:"9. Edge Cases &amp; Error Handling (Tests 9.1-9.5)",id:"9-edge-cases--error-handling-tests-91-95",level:3},{value:"10. Integration Tests (Tests 10.1-10.3)",id:"10-integration-tests-tests-101-103",level:3},{value:"Test Execution",id:"test-execution",level:2},{value:"Running Tests",id:"running-tests",level:3},{value:"Prerequisites",id:"prerequisites",level:4},{value:"Basic Test Execution",id:"basic-test-execution",level:4},{value:"Advanced Options",id:"advanced-options",level:4},{value:"Test Results Interpretation",id:"test-results-interpretation",level:3},{value:"Success Example",id:"success-example",level:4},{value:"Failure Analysis",id:"failure-analysis",level:4},{value:"Test Development",id:"test-development",level:2},{value:"Writing New Tests",id:"writing-new-tests",level:3},{value:"Test Structure Template",id:"test-structure-template",level:4},{value:"Mock Configuration Best Practices",id:"mock-configuration-best-practices",level:4},{value:"Performance Testing Guidelines",id:"performance-testing-guidelines",level:3},{value:"Memory Usage Testing",id:"memory-usage-testing",level:4},{value:"Performance Timing",id:"performance-timing",level:4},{value:"Continuous Integration",id:"continuous-integration",level:2},{value:"Automated Test Execution",id:"automated-test-execution",level:3},{value:"GitHub Actions Configuration",id:"github-actions-configuration",level:4},{value:"Quality Gates",id:"quality-gates",level:3},{value:"Test Coverage Requirements",id:"test-coverage-requirements",level:4},{value:"Code Quality Metrics",id:"code-quality-metrics",level:4},{value:"Test Data Management",id:"test-data-management",level:2},{value:"Mock Data Factories",id:"mock-data-factories",level:3},{value:"Organisation Factory",id:"organisation-factory",level:4},{value:"Usage Example",id:"usage-example",level:4},{value:"Test Database Seeding",id:"test-database-seeding",level:3},{value:"Debugging Test Failures",id:"debugging-test-failures",level:2},{value:"Common Issues and Solutions",id:"common-issues-and-solutions",level:3},{value:"1. Mock Expectation Failures",id:"1-mock-expectation-failures",level:4},{value:"2. Session Key Mismatches",id:"2-session-key-mismatches",level:4},{value:"3. HTTP Status Code Mismatches",id:"3-http-status-code-mismatches",level:4},{value:"Test Debugging Tools",id:"test-debugging-tools",level:3},{value:"Logging Configuration",id:"logging-configuration",level:4},{value:"Memory Profiling",id:"memory-profiling",level:4},{value:"Test Maintenance",id:"test-maintenance",level:2},{value:"Keeping Tests Current",id:"keeping-tests-current",level:3},{value:"Test Review Checklist",id:"test-review-checklist",level:3},{value:"Refactoring Guidelines",id:"refactoring-guidelines",level:3},{value:"Best Practices Summary",id:"best-practices-summary",level:2},{value:"Test Design",id:"test-design",level:3},{value:"Mock Usage",id:"mock-usage",level:3},{value:"Test Organization",id:"test-organization-1",level:3}];function o(e){const n={br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",input:"input",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"multi-tenancy-testing-framework",children:"Multi-Tenancy Testing Framework"})}),"\n",(0,i.jsx)(n.p,{children:"This document covers the comprehensive testing framework developed for OpenRegister's multi-tenancy implementation. The testing suite ensures reliability, security, and performance across all multi-tenancy features."}),"\n",(0,i.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsx)(n.p,{children:"The multi-tenancy testing framework provides:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"113 comprehensive test cases"})," covering all scenarios"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"10 specialized test files"})," organized by functionality"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Unit testing with PHPUnit"})," integration"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Mock-based testing"})," for reliable, fast execution"]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"Performance and scalability testing"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"Security and edge case validation"})}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"test-architecture",children:"Test Architecture"}),"\n",(0,i.jsx)(n.h3,{id:"test-organization",children:"Test Organization"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-mermaid",children:"graph TD\n    A[Multi-Tenancy Tests] --\x3e B[Default Organisation Management]\n    A --\x3e C[Organisation CRUD Operations]\n    A --\x3e D[User-Organisation Relationships] \n    A --\x3e E[Active Organisation Management]\n    A --\x3e F[Entity Organisation Assignment]\n    A --\x3e G[Data Migration Tests]\n    A --\x3e H[Session Cache Management]\n    A --\x3e I[Performance & Scalability]\n    A --\x3e J[Edge Cases & Error Handling]\n    A --\x3e K[Integration Tests]\n    \n    B --\x3e B1[6 Tests]\n    C --\x3e C1[11 Tests]\n    D --\x3e D1[11 Tests]\n    E --\x3e E1[10 Tests]\n    F --\x3e F1[9 Tests]\n    G --\x3e G1[3 Tests]\n    H --\x3e H1[4 Tests]\n    I --\x3e I1[6 Tests]\n    J --\x3e J1[8 Tests]\n    K --\x3e K1[5 Tests]\n"})}),"\n",(0,i.jsx)(n.h3,{id:"test-file-structure",children:"Test File Structure"}),"\n",(0,i.jsx)(n.p,{children:"Each test file follows a consistent structure:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"<?php\n/**\n * [Feature] Unit Tests\n *\n * Test Coverage:\n * - Test X.1: [Scenario Description]\n * - Test X.2: [Scenario Description]\n * \n * Key Features Tested:\n * - [Feature 1]\n * - [Feature 2]\n *\n * @category Test\n * @package  OCA\\OpenRegister\\Tests\\Unit\\Service\n * @author   Conduction Development Team <dev@conduction.nl>\n */\n\nnamespace OCA\\OpenRegister\\Tests\\Unit\\Service;\n\nuse PHPUnit\\Framework\\TestCase;\nuse PHPUnit\\Framework\\MockObject\\MockObject;\n\nclass [Feature]Test extends TestCase\n{\n    // Test setup, execution, and assertions\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"test-coverage",children:"Test Coverage"}),"\n",(0,i.jsx)(n.h3,{id:"1-default-organisation-management-tests-11-13",children:"1. Default Organisation Management (Tests 1.1-1.3)"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"File"}),": 'DefaultOrganisationManagementTest.php'",(0,i.jsx)(n.br,{}),"\n",(0,i.jsx)(n.strong,{children:"Tests"}),": 6 comprehensive test methods"]}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Test ID"}),(0,i.jsx)(n.th,{children:"Scenario"}),(0,i.jsx)(n.th,{children:"Test Method"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"1.1"}),(0,i.jsx)(n.td,{children:"Default organisation creation on empty database"}),(0,i.jsx)(n.td,{children:"'testDefaultOrganisationCreationOnEmptyDatabase()'"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"1.2"}),(0,i.jsx)(n.td,{children:"User auto-assignment to default organisation"}),(0,i.jsx)(n.td,{children:"'testUserAutoAssignmentToDefaultOrganisation()'"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"1.3"}),(0,i.jsx)(n.td,{children:"Multiple default organisations prevention"}),(0,i.jsx)(n.td,{children:"'testMultipleDefaultOrganisationsPrevention()'"})]})]})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Status"}),": \u2705 ",(0,i.jsx)(n.strong,{children:"6/6 PASSING"})," - Fully validated and working"]}),"\n",(0,i.jsx)(n.h3,{id:"2-organisation-crud-operations-tests-21-27",children:"2. Organisation CRUD Operations (Tests 2.1-2.7)"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"File"}),": 'OrganisationCrudTest.php'",(0,i.jsx)(n.br,{}),"\n",(0,i.jsx)(n.strong,{children:"Tests"}),": 11 comprehensive test methods"]}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Test ID"}),(0,i.jsx)(n.th,{children:"Scenario"}),(0,i.jsx)(n.th,{children:"Test Method"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"2.1"}),(0,i.jsx)(n.td,{children:"Create new organisation"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"testCreateNewOrganisation()"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"2.2"}),(0,i.jsx)(n.td,{children:"Get organisation details"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"testGetOrganisationDetails()"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"2.3"}),(0,i.jsx)(n.td,{children:"Update organisation"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"testUpdateOrganisation()"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"2.4"}),(0,i.jsx)(n.td,{children:"Search organisations"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"testSearchOrganisations()"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"2.5"}),(0,i.jsx)(n.td,{children:"Create organisation with empty name (negative)"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"testCreateOrganisationWithEmptyName()"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"2.6"}),(0,i.jsx)(n.td,{children:"Access organisation without membership (negative)"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"testAccessOrganisationWithoutMembership()"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"2.7"}),(0,i.jsx)(n.td,{children:"Update organisation without access (negative)"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"testUpdateOrganisationWithoutAccess()"})})]})]})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Additional Tests"}),": Creation metadata, search multiple results, not found handling"]}),"\n",(0,i.jsx)(n.h3,{id:"3-user-organisation-relationships-tests-31-36",children:"3. User-Organisation Relationships (Tests 3.1-3.6)"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"File"}),": ",(0,i.jsx)(n.code,{children:"UserOrganisationRelationshipTest.php"}),(0,i.jsx)(n.br,{}),"\n",(0,i.jsx)(n.strong,{children:"Tests"}),": 11 comprehensive test methods"]}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Test ID"}),(0,i.jsx)(n.th,{children:"Scenario"}),(0,i.jsx)(n.th,{children:"Test Method"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"3.1"}),(0,i.jsx)(n.td,{children:"Join organisation"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"testJoinOrganisation()"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"3.2"}),(0,i.jsx)(n.td,{children:"Multiple organisation membership"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"testMultipleOrganisationMembership()"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"3.3"}),(0,i.jsx)(n.td,{children:"Leave organisation (non-last)"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"testLeaveOrganisationNonLast()"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"3.4"}),(0,i.jsx)(n.td,{children:"Join non-existent organisation (negative)"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"testJoinNonExistentOrganisation()"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"3.5"}),(0,i.jsx)(n.td,{children:"Leave last organisation (negative)"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"testLeaveLastOrganisation()"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"3.6"}),(0,i.jsx)(n.td,{children:"Join already member organisation (negative)"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"testJoinAlreadyMemberOrganisation()"})})]})]})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Additional Tests"}),": Membership validation, statistics, concurrent operations, role validation"]}),"\n",(0,i.jsx)(n.h3,{id:"4-active-organisation-management-tests-41-46",children:"4. Active Organisation Management (Tests 4.1-4.6)"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"File"}),": ",(0,i.jsx)(n.code,{children:"ActiveOrganisationManagementTest.php"}),(0,i.jsx)(n.br,{}),"\n",(0,i.jsx)(n.strong,{children:"Tests"}),": 10 comprehensive test methods"]}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Test ID"}),(0,i.jsx)(n.th,{children:"Scenario"}),(0,i.jsx)(n.th,{children:"Test Method"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"4.1"}),(0,i.jsx)(n.td,{children:"Get active organisation (auto-set)"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"testGetActiveOrganisationAutoSet()"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"4.2"}),(0,i.jsx)(n.td,{children:"Set active organisation"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"testSetActiveOrganisation()"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"4.3"}),(0,i.jsx)(n.td,{children:"Active organisation persistence"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"testActiveOrganisationPersistence()"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"4.4"}),(0,i.jsx)(n.td,{children:"Active organisation auto-switch on leave"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"testActiveOrganisationAutoSwitchOnLeave()"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"4.5"}),(0,i.jsx)(n.td,{children:"Set non-member organisation as active (negative)"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"testSetNonMemberOrganisationAsActive()"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"4.6"}),(0,i.jsx)(n.td,{children:"Set non-existent organisation as active (negative)"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"testSetNonExistentOrganisationAsActive()"})})]})]})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Additional Tests"}),": Controller endpoints, cache clearing, validation, auto-selection"]}),"\n",(0,i.jsx)(n.h3,{id:"5-entity-organisation-assignment-tests-51-56",children:"5. Entity Organisation Assignment (Tests 5.1-5.6)"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"File"}),": ",(0,i.jsx)(n.code,{children:"EntityOrganisationAssignmentTest.php"}),(0,i.jsx)(n.br,{}),"\n",(0,i.jsx)(n.strong,{children:"Tests"}),": 9 comprehensive test methods"]}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Test ID"}),(0,i.jsx)(n.th,{children:"Scenario"}),(0,i.jsx)(n.th,{children:"Test Method"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"5.1"}),(0,i.jsx)(n.td,{children:"Register creation with active organisation"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"testRegisterCreationWithActiveOrganisation()"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"5.2"}),(0,i.jsx)(n.td,{children:"Schema creation with active organisation"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"testSchemaCreationWithActiveOrganisation()"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"5.3"}),(0,i.jsx)(n.td,{children:"Object creation with active organisation"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"testObjectCreationWithActiveOrganisation()"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"5.4"}),(0,i.jsx)(n.td,{children:"Entity access within same organisation"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"testEntityAccessWithinSameOrganisation()"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"5.5"}),(0,i.jsx)(n.td,{children:"Entity access across organisations (negative)"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"testEntityAccessAcrossOrganisations()"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"5.6"}),(0,i.jsx)(n.td,{children:"Cross-organisation object creation (negative)"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"testCrossOrganisationObjectCreation()"})})]})]})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Additional Tests"}),": Assignment validation, bulk operations, entity inheritance"]}),"\n",(0,i.jsx)(n.h3,{id:"6-data-migration-tests-61-63",children:"6. Data Migration (Tests 6.1-6.3)"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"File"}),": ",(0,i.jsx)(n.code,{children:"DataMigrationTest.php"}),(0,i.jsx)(n.br,{}),"\n",(0,i.jsx)(n.strong,{children:"Tests"}),": 3 focused test methods"]}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Test ID"}),(0,i.jsx)(n.th,{children:"Scenario"}),(0,i.jsx)(n.th,{children:"Test Method"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"6.1"}),(0,i.jsx)(n.td,{children:"Existing data migration to default organisation"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"testExistingDataMigrationToDefaultOrganisation()"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"6.2"}),(0,i.jsx)(n.td,{children:"Mandatory organisation and owner fields"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"testMandatoryOrganisationAndOwnerFields()"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"6.3"}),(0,i.jsx)(n.td,{children:"Invalid organisation reference prevention"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"testInvalidOrganisationReferencePrevention()"})})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"7-session-cache-management-tests-71-74",children:"7. Session Cache Management (Tests 7.1-7.4)"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"File"}),": ",(0,i.jsx)(n.code,{children:"SessionCacheManagementTest.php"}),(0,i.jsx)(n.br,{}),"\n",(0,i.jsx)(n.strong,{children:"Tests"}),": 4 focused test methods"]}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Test ID"}),(0,i.jsx)(n.th,{children:"Scenario"}),(0,i.jsx)(n.th,{children:"Test Method"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"7.1"}),(0,i.jsx)(n.td,{children:"Session persistence"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"testSessionPersistence()"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"7.2"}),(0,i.jsx)(n.td,{children:"Cache performance"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"testCachePerformance()"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"7.3"}),(0,i.jsx)(n.td,{children:"Manual cache clear"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"testManualCacheClear()"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"7.4"}),(0,i.jsx)(n.td,{children:"Cross-user session isolation"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"testCrossUserSessionIsolation()"})})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"8-performance--scalability-tests-81-83",children:"8. Performance & Scalability (Tests 8.1-8.3)"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"File"}),": ",(0,i.jsx)(n.code,{children:"PerformanceScalabilityTest.php"}),(0,i.jsx)(n.br,{}),"\n",(0,i.jsx)(n.strong,{children:"Tests"}),": 6 performance test methods"]}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Test ID"}),(0,i.jsx)(n.th,{children:"Scenario"}),(0,i.jsx)(n.th,{children:"Test Method"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"8.1"}),(0,i.jsx)(n.td,{children:"Large organisation with many users (100+)"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"testLargeOrganisationWithManyUsers()"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"8.2"}),(0,i.jsx)(n.td,{children:"User with many organisations (50+)"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"testUserWithManyOrganisations()"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"8.3"}),(0,i.jsx)(n.td,{children:"Concurrent active organisation changes"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"testConcurrentActiveOrganisationChanges()"})})]})]})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Additional Tests"}),": Database optimization, memory usage, cache effectiveness"]}),"\n",(0,i.jsx)(n.h3,{id:"9-edge-cases--error-handling-tests-91-95",children:"9. Edge Cases & Error Handling (Tests 9.1-9.5)"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"File"}),": ",(0,i.jsx)(n.code,{children:"EdgeCasesErrorHandlingTest.php"}),(0,i.jsx)(n.br,{}),"\n",(0,i.jsx)(n.strong,{children:"Tests"}),": 8 security and error test methods"]}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Test ID"}),(0,i.jsx)(n.th,{children:"Scenario"}),(0,i.jsx)(n.th,{children:"Test Method"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"9.1"}),(0,i.jsx)(n.td,{children:"Unauthenticated requests"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"testUnauthenticatedRequests()"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"9.2"}),(0,i.jsx)(n.td,{children:"Malformed JSON requests"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"testMalformedJsonRequests()"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"9.3"}),(0,i.jsx)(n.td,{children:"SQL injection attempts"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"testSqlInjectionAttempts()"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"9.4"}),(0,i.jsx)(n.td,{children:"Very long organisation names"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"testVeryLongOrganisationNames()"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"9.5"}),(0,i.jsx)(n.td,{children:"Unicode and special characters"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"testUnicodeAndSpecialCharacters()"})})]})]})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Additional Tests"}),": Null value handling, exception logging, rate limiting"]}),"\n",(0,i.jsx)(n.h3,{id:"10-integration-tests-tests-101-103",children:"10. Integration Tests (Tests 10.1-10.3)"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"File"}),": ",(0,i.jsx)(n.code,{children:"IntegrationTest.php"}),(0,i.jsx)(n.br,{}),"\n",(0,i.jsx)(n.strong,{children:"Tests"}),": 5 integration test methods"]}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Test ID"}),(0,i.jsx)(n.th,{children:"Scenario"}),(0,i.jsx)(n.th,{children:"Test Method"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"10.1"}),(0,i.jsx)(n.td,{children:"RBAC integration with multi-tenancy"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"testRbacIntegrationWithMultiTenancy()"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"10.2"}),(0,i.jsx)(n.td,{children:"Search filtering by organisation"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"testSearchFilteringByOrganisation()"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"10.3"}),(0,i.jsx)(n.td,{children:"Audit trail organisation context"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"testAuditTrailOrganisationContext()"})})]})]})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Additional Tests"}),": Cross-organisation access prevention, complex relationships"]}),"\n",(0,i.jsx)(n.h2,{id:"test-execution",children:"Test Execution"}),"\n",(0,i.jsx)(n.h3,{id:"running-tests",children:"Running Tests"}),"\n",(0,i.jsx)(n.h4,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Docker environment running"}),"\n",(0,i.jsx)(n.li,{children:"PHPUnit 10.5+ installed"}),"\n",(0,i.jsx)(n.li,{children:"Nextcloud test environment configured"}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"basic-test-execution",children:"Basic Test Execution"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# Run all multi-tenancy tests\ndocker exec -u 33 master-nextcloud-1 bash -c "cd /var/www/html/apps-extra/openregister && php vendor/bin/phpunit tests/Unit/Service/ --testdox"\n\n# Run specific test file\ndocker exec -u 33 master-nextcloud-1 bash -c "cd /var/www/html/apps-extra/openregister && php vendor/bin/phpunit tests/Unit/Service/DefaultOrganisationManagementTest.php --testdox"\n\n# Run with verbose output\ndocker exec -u 33 master-nextcloud-1 bash -c "cd /var/www/html/apps-extra/openregister && php vendor/bin/phpunit tests/Unit/Service/ --verbose"\n'})}),"\n",(0,i.jsx)(n.h4,{id:"advanced-options",children:"Advanced Options"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# Run with coverage report\ndocker exec -u 33 master-nextcloud-1 bash -c "cd /var/www/html/apps-extra/openregister && php vendor/bin/phpunit tests/Unit/Service/ --coverage-html coverage"\n\n# Run specific test method\ndocker exec -u 33 master-nextcloud-1 bash -c "cd /var/www/html/apps-extra/openregister && php vendor/bin/phpunit --filter testDefaultOrganisationCreationOnEmptyDatabase"\n\n# Run with memory profiling\ndocker exec -u 33 master-nextcloud-1 bash -c "cd /var/www/html/apps-extra/openregister && php -d memory_limit=256M vendor/bin/phpunit tests/Unit/Service/"\n'})}),"\n",(0,i.jsx)(n.h3,{id:"test-results-interpretation",children:"Test Results Interpretation"}),"\n",(0,i.jsx)(n.h4,{id:"success-example",children:"Success Example"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Default Organisation Management (OCA\\OpenRegister\\Tests\\Unit\\Service\\DefaultOrganisationManagement)\n \u2714 Default organisation creation on empty database\n \u2714 User auto assignment to default organisation\n \u2714 Multiple default organisations prevention\n \u2714 Database constraint prevention of multiple defaults\n \u2714 Active organisation auto setting with default\n \u2714 Default organisation metadata validation\n\nOK, but there were issues!\nTests: 6, Assertions: 36, PHPUnit Deprecations: 1.\n"})}),"\n",(0,i.jsx)(n.h4,{id:"failure-analysis",children:"Failure Analysis"}),"\n",(0,i.jsx)(n.p,{children:"Common failure patterns and solutions:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"\u2718 Create new organisation\n  \u2502\n  \u2502 Failed asserting that 201 matches expected 200.\n  \u2502\n  \u2502 Solution: Update expected HTTP status code to match API implementation\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"\u2718 Get organisation details\n  \u2502\n  \u2502 Error: Call to undefined method OrganisationService::getOrganisation()\n  \u2502\n  \u2502 Solution: Update test to use correct method name from actual service\n"})}),"\n",(0,i.jsx)(n.h2,{id:"test-development",children:"Test Development"}),"\n",(0,i.jsx)(n.h3,{id:"writing-new-tests",children:"Writing New Tests"}),"\n",(0,i.jsx)(n.h4,{id:"test-structure-template",children:"Test Structure Template"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"/**\n * Test X.Y: [Test Description]\n *\n * Scenario: [What situation is being tested]\n * Expected: [What should happen]\n *\n * @return void\n */\npublic function testScenarioName(): void\n{\n    // Arrange: Set up test data and mocks\n    $user = $this->createMock(IUser::class);\n    $user->method('getUID')->willReturn('testuser');\n    $this->userSession->method('getUser')->willReturn($user);\n    \n    // Mock expected behavior\n    $this->organisationMapper\n        ->expects($this->once())\n        ->method('methodName')\n        ->with($this->equalTo('expectedParameter'))\n        ->willReturn($expectedResult);\n    \n    // Act: Execute the functionality being tested\n    $result = $this->organisationService->methodUnderTest('parameter');\n    \n    // Assert: Verify the results\n    $this->assertInstanceOf(Organisation::class, $result);\n    $this->assertEquals('expectedValue', $result->getProperty());\n}\n"})}),"\n",(0,i.jsx)(n.h4,{id:"mock-configuration-best-practices",children:"Mock Configuration Best Practices"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"User Session Mocking"}),":"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$this->mockUser->method('getUID')->willReturn('alice');\n$this->userSession->method('getUser')->willReturn($this->mockUser);\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"2",children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Session Data Mocking"}),":"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$this->session->method('get')\n    ->with('openregister_active_organisation_alice')\n    ->willReturn('organisation-uuid-123');\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"3",children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Database Mocking"}),":"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$this->organisationMapper\n    ->expects($this->once())\n    ->method('findByUuid')\n    ->with('organisation-uuid-123')\n    ->willReturn($expectedOrganisation);\n"})}),"\n",(0,i.jsx)(n.h3,{id:"performance-testing-guidelines",children:"Performance Testing Guidelines"}),"\n",(0,i.jsx)(n.h4,{id:"memory-usage-testing",children:"Memory Usage Testing"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"public function testMemoryUsageWithLargeDataset(): void\n{\n    // Arrange: Create large dataset\n    $memoryBefore = memory_get_usage();\n    \n    // Act: Execute memory-intensive operation\n    $result = $this->performLargeOperation();\n    \n    // Assert: Memory usage within acceptable bounds\n    $memoryAfter = memory_get_usage();\n    $memoryDelta = $memoryAfter - $memoryBefore;\n    $this->assertLessThan(1024 * 1024, $memoryDelta); // Less than 1MB\n}\n"})}),"\n",(0,i.jsx)(n.h4,{id:"performance-timing",children:"Performance Timing"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"public function testPerformanceWithLargeDataset(): void\n{\n    // Arrange: Prepare performance test\n    $startTime = microtime(true);\n    \n    // Act: Execute operation\n    $result = $this->performOperation();\n    \n    // Assert: Performance within acceptable bounds\n    $endTime = microtime(true);\n    $executionTime = $endTime - $startTime;\n    $this->assertLessThan(1.0, $executionTime); // Under 1 second\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"continuous-integration",children:"Continuous Integration"}),"\n",(0,i.jsx)(n.h3,{id:"automated-test-execution",children:"Automated Test Execution"}),"\n",(0,i.jsx)(n.h4,{id:"github-actions-configuration",children:"GitHub Actions Configuration"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"name: Multi-Tenancy Tests\n\non:\n  push:\n    branches: [ main, develop ]\n  pull_request:\n    branches: [ main ]\n\njobs:\n  test:\n    runs-on: ubuntu-latest\n    \n    services:\n      mysql:\n        image: mysql:8.0\n        env:\n          MYSQL_ROOT_PASSWORD: password\n          MYSQL_DATABASE: nextcloud\n        options: >-\n          --health-cmd=\"mysqladmin ping\"\n          --health-interval=10s\n          --health-timeout=5s\n          --health-retries=3\n    \n    steps:\n      - uses: actions/checkout@v3\n      \n      - name: Setup PHP\n        uses: shivammathur/setup-php@v2\n        with:\n          php-version: '8.1'\n          extensions: mbstring, intl, gd, xml, zip, curl, mysql\n          \n      - name: Install dependencies\n        run: composer install\n        \n      - name: Run Multi-Tenancy Tests\n        run: php vendor/bin/phpunit tests/Unit/Service/ --testdox\n"})}),"\n",(0,i.jsx)(n.h3,{id:"quality-gates",children:"Quality Gates"}),"\n",(0,i.jsx)(n.h4,{id:"test-coverage-requirements",children:"Test Coverage Requirements"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Minimum Coverage"}),": 85% line coverage"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Critical Paths"}),": 100% coverage for security-related code"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Performance Tests"}),": Must complete within time limits"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Edge Cases"}),": All error conditions must be tested"]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"code-quality-metrics",children:"Code Quality Metrics"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:'// PHPUnit configuration (phpunit.xml)\n<coverage>\n    <include>\n        <directory>lib/Service/OrganisationService.php</directory>\n        <directory>lib/Db/OrganisationMapper.php</directory>\n        <directory>lib/Controller/OrganisationController.php</directory>\n    </include>\n    <report>\n        <html outputDirectory="coverage-html"/>\n        <text outputFile="coverage.txt"/>\n    </report>\n</coverage>\n'})}),"\n",(0,i.jsx)(n.h2,{id:"test-data-management",children:"Test Data Management"}),"\n",(0,i.jsx)(n.h3,{id:"mock-data-factories",children:"Mock Data Factories"}),"\n",(0,i.jsx)(n.h4,{id:"organisation-factory",children:"Organisation Factory"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"class OrganisationTestFactory\n{\n    public static function create(array $overrides = []): Organisation\n    {\n        $organisation = new Organisation();\n        $organisation->setName($overrides['name'] ?? 'Test Organisation');\n        $organisation->setDescription($overrides['description'] ?? 'Test Description');\n        $organisation->setUuid($overrides['uuid'] ?? 'test-uuid-123');\n        $organisation->setOwner($overrides['owner'] ?? 'testuser');\n        $organisation->setUsers($overrides['users'] ?? ['testuser']);\n        $organisation->setIsDefault($overrides['isDefault'] ?? false);\n        \n        return $organisation;\n    }\n}\n"})}),"\n",(0,i.jsx)(n.h4,{id:"usage-example",children:"Usage Example"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"public function testOrganisationCreation(): void\n{\n    // Arrange\n    $testOrg = OrganisationTestFactory::create([\n        'name' => 'ACME Corp',\n        'owner' => 'alice',\n        'users' => ['alice', 'bob']\n    ]);\n    \n    // Test implementation continues...\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"test-database-seeding",children:"Test Database Seeding"}),"\n",(0,i.jsx)(n.p,{children:"For integration tests that require database state:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"protected function seedTestData(): void\n{\n    // Create default organisation\n    $defaultOrg = OrganisationTestFactory::create([\n        'name' => 'Default Organisation',\n        'isDefault' => true,\n        'owner' => 'system'\n    ]);\n    \n    $this->organisationMapper->insert($defaultOrg);\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"debugging-test-failures",children:"Debugging Test Failures"}),"\n",(0,i.jsx)(n.h3,{id:"common-issues-and-solutions",children:"Common Issues and Solutions"}),"\n",(0,i.jsx)(n.h4,{id:"1-mock-expectation-failures",children:"1. Mock Expectation Failures"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Issue"}),": ",(0,i.jsx)(n.code,{children:'Expectation failed for method name is "methodName" when invoked 1 time'})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Solution"}),": Verify method is called with correct parameters"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// Debug: Add logging to see actual calls\n$this->organisationMapper\n    ->expects($this->once())\n    ->method('findByUuid')\n    ->with($this->callback(function($uuid) {\n        // Validation callback for UUID parameter\n        return true;\n    }))\n    ->willReturn($expectedResult);\n"})}),"\n",(0,i.jsx)(n.h4,{id:"2-session-key-mismatches",children:"2. Session Key Mismatches"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Issue"}),": Session keys don't match expected format"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Solution"}),": Check actual session key naming in service"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// Debug: Check actual session keys\n$this->session->method('get')\n    ->willReturnCallback(function($key) {\n        // Track session key requests for debugging\n        return null;\n    });\n"})}),"\n",(0,i.jsx)(n.h4,{id:"3-http-status-code-mismatches",children:"3. HTTP Status Code Mismatches"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Issue"}),": Expected 200 but got 201/400/403"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Solution"}),": Check actual API responses and update expectations"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// Debug: Inspect actual response\n$response = $this->controller->create($data);\n// Use assertions to verify response instead of logging\n$this->assertEquals(200, $response->getStatus());\n$this->assertArrayHasKey('uuid', $response->getData());\n"})}),"\n",(0,i.jsx)(n.h3,{id:"test-debugging-tools",children:"Test Debugging Tools"}),"\n",(0,i.jsx)(n.h4,{id:"logging-configuration",children:"Logging Configuration"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// In test setUp()\nif (getenv('DEBUG_TESTS')) {\n    $this->logger = new ConsoleLogger();\n} else {\n    $this->logger = $this->createMock(LoggerInterface::class);\n}\n"})}),"\n",(0,i.jsx)(n.h4,{id:"memory-profiling",children:"Memory Profiling"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:'public function tearDown(): void\n{\n    if (getenv(\'PROFILE_MEMORY\')) {\n        echo "Memory usage: " . memory_get_usage() . " bytes\\n";\n        echo "Peak memory: " . memory_get_peak_usage() . " bytes\\n";\n    }\n    \n    parent::tearDown();\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"test-maintenance",children:"Test Maintenance"}),"\n",(0,i.jsx)(n.h3,{id:"keeping-tests-current",children:"Keeping Tests Current"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"API Changes"}),": Update tests when API signatures change"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"New Features"}),": Add tests for new functionality"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Bug Fixes"}),": Add regression tests for fixed bugs"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Performance Changes"}),": Update performance expectations"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Dependencies"}),": Update mocks when dependencies change"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"test-review-checklist",children:"Test Review Checklist"}),"\n",(0,i.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","All test methods have descriptive names"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Test scenarios match requirements"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Assertions are meaningful and specific"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Mocks are properly configured"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Error cases are tested"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Performance implications considered"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Documentation updated"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Tests pass consistently"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"refactoring-guidelines",children:"Refactoring Guidelines"}),"\n",(0,i.jsx)(n.p,{children:"When refactoring tests:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Maintain Test Intent"}),": Keep the same test scenarios"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Update Implementation"}),": Change only how tests execute"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Preserve Coverage"}),": Ensure coverage doesn't decrease"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Document Changes"}),": Note why changes were made"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Verify Results"}),": Ensure tests still validate intended behavior"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"best-practices-summary",children:"Best Practices Summary"}),"\n",(0,i.jsx)(n.h3,{id:"test-design",children:"Test Design"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Follow AAA Pattern"}),": Arrange, Act, Assert"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"One Concept Per Test"}),": Each test should verify one specific behavior"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Descriptive Names"}),": Test names should clearly describe the scenario"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Fast Execution"}),": Tests should run quickly for rapid feedback"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Independent Tests"}),": Tests should not depend on each other"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"mock-usage",children:"Mock Usage"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Mock External Dependencies"}),": Don't test external systems"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Verify Interactions"}),": Use mocks to verify method calls"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Control Responses"}),": Use mocks to control return values"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Isolate System Under Test"}),": Mock everything except what you're testing"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Reset State"}),": Clear mocks between tests"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"test-organization-1",children:"Test Organization"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Logical Grouping"}),": Group related tests in the same class"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Consistent Structure"}),": Follow the same pattern across all tests"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Clear Documentation"}),": Document test purpose and scenarios"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Maintainable Code"}),": Write tests that are easy to modify"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Comprehensive Coverage"}),": Cover both happy path and edge cases"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"The multi-tenancy testing framework provides comprehensive validation of all system functionality, ensuring reliability, security, and performance at scale."})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}}}]);