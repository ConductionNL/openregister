"use strict";(self.webpackChunkopen_catalogi_docs=self.webpackChunkopen_catalogi_docs||[]).push([[2929],{2269:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>c,metadata:()=>t,toc:()=>o});const t=JSON.parse('{"id":"development/monitoring-testing","title":"Monitoring & Testing Implementation","description":"This document outlines the monitoring infrastructure and testing framework implementation for OpenRegister\'s AI-powered features.","source":"@site/docs/development/monitoring-testing.md","sourceDirName":"development","slug":"/development/monitoring-testing","permalink":"/docs/development/monitoring-testing","draft":false,"unlisted":false,"editUrl":"https://github.com/conductionnl/openregister/tree/main/website/docs/development/monitoring-testing.md","tags":[],"version":"current","sidebarPosition":55,"frontMatter":{"title":"Monitoring & Testing Implementation","sidebar_position":55},"sidebar":"tutorialSidebar","previous":{"title":"Development Milestones","permalink":"/docs/development/epic-milestones"},"next":{"title":"OpenAPI Specification Validation","permalink":"/docs/development/api-validation"}}');var s=i(74848),r=i(28453);const c={title:"Monitoring & Testing Implementation",sidebar_position:55},l="Monitoring & Testing Implementation Guide",a={},o=[{value:"Monitoring Implementation",id:"monitoring-implementation",level:2},{value:"Database Schema",id:"database-schema",level:3},{value:"MetricsService",id:"metricsservice",level:3},{value:"Integration Points",id:"integration-points",level:3},{value:"Register MetricsService",id:"register-metricsservice",level:4},{value:"Integrate into Services",id:"integrate-into-services",level:4},{value:"Metrics Dashboard",id:"metrics-dashboard",level:3},{value:"Testing Implementation",id:"testing-implementation",level:2},{value:"Test Infrastructure Setup",id:"test-infrastructure-setup",level:3},{value:"PHPUnit Configuration",id:"phpunit-configuration",level:4},{value:"Test Directory Structure",id:"test-directory-structure",level:4},{value:"Running Tests",id:"running-tests",level:3},{value:"Implementation Checklist",id:"implementation-checklist",level:2},{value:"Monitoring",id:"monitoring",level:3},{value:"Testing",id:"testing",level:3},{value:"Related Documentation",id:"related-documentation",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",input:"input",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"monitoring--testing-implementation-guide",children:"Monitoring & Testing Implementation Guide"})}),"\n",(0,s.jsx)(n.p,{children:"This document outlines the monitoring infrastructure and testing framework implementation for OpenRegister's AI-powered features."}),"\n",(0,s.jsx)(n.h2,{id:"monitoring-implementation",children:"Monitoring Implementation"}),"\n",(0,s.jsx)(n.h3,{id:"database-schema",children:"Database Schema"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Migration"}),": ",(0,s.jsx)(n.code,{children:"lib/Migration/Version002005000Date20251013000000.php"})]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Table"}),": ",(0,s.jsx)(n.code,{children:"oc_openregister_metrics"})]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Columns"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"id"}),": Primary key"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"metric_type"}),": Type of metric (file_processed, embedding_generated, search_*, etc.)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"entity_type"}),": Entity being tracked (file, object, search)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"entity_id"}),": ID of entity"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"user_id"}),": User who triggered action"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"status"}),": success/failure"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"duration_ms"}),": Operation duration"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"metadata"}),": JSON metadata"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"error_message"}),": Error details (if failed)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"created_at"}),": Timestamp"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Indexes"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"metric_type"}),"\n",(0,s.jsx)(n.li,{children:"entity_type"}),"\n",(0,s.jsx)(n.li,{children:"status"}),"\n",(0,s.jsx)(n.li,{children:"created_at"}),"\n",(0,s.jsx)(n.li,{children:"Composite indexes for common queries"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"metricsservice",children:"MetricsService"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Location"}),": ",(0,s.jsx)(n.code,{children:"lib/Service/MetricsService.php"})]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Key Methods"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// Record a metric\nrecordMetric(\n    string $metricType,\n    ?string $entityType = null,\n    ?string $entityId = null,\n    string $status = 'success',\n    ?int $durationMs = null,\n    ?array $metadata = null,\n    ?string $errorMessage = null,\n    ?string $userId = null\n): void\n\n// Get files processed per day\ngetFilesProcessedPerDay(int $days = 30): array\n\n// Get embedding generation stats\ngetEmbeddingStats(int $days = 30): array\n// Returns: total, successful, failed, success_rate, estimated_cost_usd\n\n// Get search latency statistics\ngetSearchLatencyStats(int $days = 7): array\n// Returns stats for keyword, semantic, hybrid searches\n\n// Get storage growth data\ngetStorageGrowth(int $days = 30): array\n// Returns: daily_vectors_added, current_storage_mb, avg_vectors_per_day\n\n// Get all dashboard metrics\ngetDashboardMetrics(): array\n\n// Clean old metrics (retention)\ncleanOldMetrics(int $retentionDays = 90): int\n"})}),"\n",(0,s.jsx)(n.h3,{id:"integration-points",children:"Integration Points"}),"\n",(0,s.jsx)(n.h4,{id:"register-metricsservice",children:"Register MetricsService"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"File"}),": ",(0,s.jsx)(n.code,{children:"lib/AppInfo/Application.php"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"use OCA\\OpenRegister\\Service\\MetricsService;\n\n// In register() method:\n$context->registerService(\n    MetricsService::class,\n    function ($container) {\n        return new MetricsService(\n            $container->get('OCP\\IDBConnection'),\n            $container->get('Psr\\Log\\LoggerInterface')\n        );\n    }\n);\n"})}),"\n",(0,s.jsx)(n.h4,{id:"integrate-into-services",children:"Integrate into Services"}),"\n",(0,s.jsx)(n.p,{children:"The MetricsService should be integrated into:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"SolrFileService"})," - Track file processing metrics"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"VectorEmbeddingService"})," - Track embedding generation metrics"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"ChatService"})," - Track search latency metrics"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"metrics-dashboard",children:"Metrics Dashboard"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Recommended Visualizations"}),":"]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Files Processed"}),": Line chart showing daily file processing volume"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Embedding Success Rate"}),": Gauge showing percentage"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Search Latency"}),": Bar chart comparing keyword/semantic/hybrid"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Storage Growth"}),": Area chart showing vector storage over time"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Cost Tracking"}),": Running total of estimated API costs"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Example Dashboard API Response"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "files_processed": {\n    "2025-10-01": 45,\n    "2025-10-02": 67,\n    "2025-10-03": 52\n  },\n  "embedding_stats": {\n    "total": 1234,\n    "successful": 1198,\n    "failed": 36,\n    "success_rate": 97.08,\n    "estimated_cost_usd": 0.0779,\n    "period_days": 30\n  },\n  "search_latency": {\n    "keyword": {\n      "count": 456,\n      "avg_ms": 45.2,\n      "min_ms": 12,\n      "max_ms": 234\n    },\n    "semantic": {\n      "count": 234,\n      "avg_ms": 156.7,\n      "min_ms": 67,\n      "max_ms": 456\n    },\n    "hybrid": {\n      "count": 345,\n      "avg_ms": 234.5,\n      "min_ms": 89,\n      "max_ms": 567\n    }\n  },\n  "storage_growth": {\n    "daily_vectors_added": {\n      "2025-10-01": 123,\n      "2025-10-02": 156,\n      "2025-10-03": 134\n    },\n    "current_storage_bytes": 45678912,\n    "current_storage_mb": 43.56,\n    "avg_vectors_per_day": 137.67,\n    "period_days": 30\n  }\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"testing-implementation",children:"Testing Implementation"}),"\n",(0,s.jsx)(n.h3,{id:"test-infrastructure-setup",children:"Test Infrastructure Setup"}),"\n",(0,s.jsx)(n.h4,{id:"phpunit-configuration",children:"PHPUnit Configuration"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"File"}),": ",(0,s.jsx)(n.code,{children:"phpunit.xml"})]}),"\n",(0,s.jsx)(n.p,{children:"Ensure it includes:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:'<testsuites>\n    <testsuite name="unit">\n        <directory>./tests/Unit</directory>\n    </testsuite>\n    <testsuite name="integration">\n        <directory>./tests/Integration</directory>\n    </testsuite>\n</testsuites>\n'})}),"\n",(0,s.jsx)(n.h4,{id:"test-directory-structure",children:"Test Directory Structure"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"tests/\n\u251c\u2500\u2500 Unit/\n\u2502   \u251c\u2500\u2500 Service/\n\u2502   \u2502   \u251c\u2500\u2500 SolrObjectServiceTest.php\n\u2502   \u2502   \u251c\u2500\u2500 SolrFileServiceTest.php\n\u2502   \u2502   \u251c\u2500\u2500 VectorEmbeddingServiceTest.php\n\u2502   \u2502   \u2514\u2500\u2500 MetricsServiceTest.php\n\u2502   \u2514\u2500\u2500 Controller/\n\u2502       \u251c\u2500\u2500 SolrControllerTest.php\n\u2502       \u2514\u2500\u2500 ChatControllerTest.php\n\u2514\u2500\u2500 Integration/\n    \u251c\u2500\u2500 FileProcessingTest.php\n    \u2514\u2500\u2500 HybridSearchTest.php\n"})}),"\n",(0,s.jsx)(n.h3,{id:"running-tests",children:"Running Tests"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Run all tests\nvendor/bin/phpunit\n\n# Run specific test suite\nvendor/bin/phpunit tests/Unit\n\n# Run specific test file\nvendor/bin/phpunit tests/Unit/Service/SolrObjectServiceTest.php\n\n# Run with coverage\nvendor/bin/phpunit --coverage-html coverage/\n"})}),"\n",(0,s.jsx)(n.h2,{id:"implementation-checklist",children:"Implementation Checklist"}),"\n",(0,s.jsx)(n.h3,{id:"monitoring",children:"Monitoring"}),"\n",(0,s.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",checked:!0,disabled:!0})," ","Create database migration for metrics table"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",checked:!0,disabled:!0})," ","Create MetricsService with all tracking methods"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Register MetricsService in DI container"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Integrate into SolrFileService"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Integrate into VectorEmbeddingService"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Integrate into ChatService"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Add metrics API endpoint"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Add metrics dashboard UI (optional)"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Set up background job for metrics cleanup"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"testing",children:"Testing"}),"\n",(0,s.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Create test directory structure"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Write SolrObjectServiceTest"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Write SolrFileServiceTest"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Write VectorEmbeddingServiceTest"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Write MetricsServiceTest"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Write integration tests"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Set up CI/CD pipeline (optional)"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/development/testing",children:"Testing"})," - Testing improvements and best practices"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/development/performance-optimization",children:"Performance Optimization"})," - Performance monitoring"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>c,x:()=>l});var t=i(96540);const s={},r=t.createContext(s);function c(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:c(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);