"use strict";(self.webpackChunkopen_catalogi_docs=self.webpackChunkopen_catalogi_docs||[]).push([[9246],{28453:(e,n,i)=>{i.d(n,{R:()=>c,x:()=>l});var t=i(96540);const r={},s=t.createContext(r);function c(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),t.createElement(s.Provider,{value:n},e.children)}},97355:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>c,metadata:()=>t,toc:()=>o});const t=JSON.parse('{"id":"Technical/vectorization-architecture","title":"Vectorization Architecture","description":"Unified vectorization architecture using Strategy Pattern for files and objects","source":"@site/docs/Technical/vectorization-architecture.md","sourceDirName":"Technical","slug":"/Technical/vectorization-architecture","permalink":"/docs/Technical/vectorization-architecture","draft":false,"unlisted":false,"editUrl":"https://github.com/conductionnl/openregister/tree/main/website/docs/Technical/vectorization-architecture.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"title":"Vectorization Architecture","sidebar_position":2,"description":"Unified vectorization architecture using Strategy Pattern for files and objects","keywords":["Open Register","Vectorization","Embeddings","Strategy Pattern"]},"sidebar":"tutorialSidebar","previous":{"title":"Webhooks","permalink":"/docs/Features/webhooks"},"next":{"title":"European Client Register","permalink":"/docs/UseCases/clientRegisters"}}');var r=i(74848),s=i(28453);const c={title:"Vectorization Architecture",sidebar_position:2,description:"Unified vectorization architecture using Strategy Pattern for files and objects",keywords:["Open Register","Vectorization","Embeddings","Strategy Pattern"]},l="Vectorization Architecture",a={},o=[{value:"Overview",id:"overview",level:2},{value:"Architecture",id:"architecture",level:2},{value:"Core Components",id:"core-components",level:3},{value:"1. VectorizationService",id:"1-vectorizationservice",level:3},{value:"2. VectorizationStrategyInterface",id:"2-vectorizationstrategyinterface",level:3},{value:"3. Strategies",id:"3-strategies",level:3},{value:"FileVectorizationStrategy",id:"filevectorizationstrategy",level:4},{value:"ObjectVectorizationStrategy",id:"objectvectorizationstrategy",level:4},{value:"Benefits",id:"benefits",level:2},{value:"1. Code Reduction",id:"1-code-reduction",level:3},{value:"2. Consistency",id:"2-consistency",level:3},{value:"3. Extensibility",id:"3-extensibility",level:3},{value:"4. Testability",id:"4-testability",level:3},{value:"Usage Examples",id:"usage-examples",level:2},{value:"File Vectorization",id:"file-vectorization",level:3},{value:"Object Vectorization",id:"object-vectorization",level:3},{value:"Vector Storage",id:"vector-storage",level:2},{value:"Database Schema",id:"database-schema",level:3},{value:"Field Descriptions",id:"field-descriptions",level:3},{value:"Document Chunking Strategy",id:"document-chunking-strategy",level:2},{value:"Chunking Parameters",id:"chunking-parameters",level:3},{value:"Chunking by Document Type",id:"chunking-by-document-type",level:3},{value:"1. <strong>Technical Documentation</strong> (Code, API docs)",id:"1-technical-documentation-code-api-docs",level:4},{value:"2. <strong>Legal Documents</strong> (Contracts, policies)",id:"2-legal-documents-contracts-policies",level:4},{value:"3. <strong>Articles &amp; Reports</strong>",id:"3-articles--reports",level:4},{value:"4. <strong>Spreadsheets &amp; Tables</strong>",id:"4-spreadsheets--tables",level:4},{value:"File Processing Pipeline",id:"file-processing-pipeline",level:2},{value:"Step 1: File Upload",id:"step-1-file-upload",level:3},{value:"Step 2: Text Extraction",id:"step-2-text-extraction",level:3},{value:"Step 3: Chunking",id:"step-3-chunking",level:3},{value:"Step 4: Vector Generation",id:"step-4-vector-generation",level:3},{value:"Step 5: Linking",id:"step-5-linking",level:3},{value:"Integration with Vector Search",id:"integration-with-vector-search",level:2},{value:"Hybrid Search Architecture",id:"hybrid-search-architecture",level:2},{value:"Search Flow",id:"search-flow",level:3},{value:"Performance Considerations",id:"performance-considerations",level:2},{value:"1. <strong>Token Limits</strong>",id:"1-token-limits",level:3},{value:"2. <strong>API Costs</strong>",id:"2-api-costs",level:3},{value:"3. <strong>Processing Time</strong>",id:"3-processing-time",level:3},{value:"4. <strong>Storage</strong>",id:"4-storage",level:3},{value:"Related Documentation",id:"related-documentation",level:2},{value:"ObjectVectorizationStrategy",id:"objectvectorizationstrategy-1",level:4},{value:"Usage",id:"usage",level:2},{value:"File Vectorization",id:"file-vectorization-1",level:3},{value:"Object Vectorization",id:"object-vectorization-1",level:3},{value:"Adding New Entity Types",id:"adding-new-entity-types",level:2},{value:"1. Create Strategy",id:"1-create-strategy",level:3},{value:"2. Register Strategy",id:"2-register-strategy",level:3},{value:"3. Use It",id:"3-use-it",level:3},{value:"Benefits",id:"benefits-1",level:2},{value:"Code Reduction",id:"code-reduction",level:3},{value:"Consistency",id:"consistency",level:3},{value:"Extensibility",id:"extensibility",level:3},{value:"Maintainability",id:"maintainability",level:3},{value:"Implementation Details",id:"implementation-details",level:2},{value:"Dependency Injection",id:"dependency-injection",level:3},{value:"Processing Modes",id:"processing-modes",level:3},{value:"Migration from Old Services",id:"migration-from-old-services",level:2},{value:"Testing",id:"testing",level:2},{value:"Test Core Logic Once",id:"test-core-logic-once",level:3},{value:"Test Strategies Independently",id:"test-strategies-independently",level:3},{value:"Embedding Model Management",id:"embedding-model-management",level:2},{value:"\u26a0\ufe0f CRITICAL: Changing Embedding Models",id:"\ufe0f-critical-changing-embedding-models",level:3},{value:"Model Tracking",id:"model-tracking",level:3},{value:"Required Actions When Changing Models",id:"required-actions-when-changing-models",level:3},{value:"UI Workflow",id:"ui-workflow",level:3},{value:"API Endpoints",id:"api-endpoints",level:3},{value:"Example: Switching from OpenAI to Ollama",id:"example-switching-from-openai-to-ollama",level:3},{value:"Database Migration",id:"database-migration",level:3},{value:"Why This Matters",id:"why-this-matters",level:3},{value:"Best Practices",id:"best-practices",level:3},{value:"Future Enhancements",id:"future-enhancements",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"vectorization-architecture",children:"Vectorization Architecture"})}),"\n",(0,r.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsxs)(n.p,{children:["OpenRegister uses a unified vectorization architecture based on the ",(0,r.jsx)(n.strong,{children:"Strategy Pattern"})," to eliminate code duplication and provide a consistent API for vectorizing different entity types (files, objects, etc.)."]}),"\n",(0,r.jsx)(n.h2,{id:"architecture",children:"Architecture"}),"\n",(0,r.jsx)(n.h3,{id:"core-components",children:"Core Components"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"VectorizationService (Generic Core)\n    \u251c\u2500\u2500 VectorEmbeddingService (generates embeddings)\n    \u2514\u2500\u2500 Strategies (entity-specific logic):\n        \u251c\u2500\u2500 FileVectorizationStrategy\n        \u251c\u2500\u2500 ObjectVectorizationStrategy\n        \u2514\u2500\u2500 [Future strategies...]\n"})}),"\n",(0,r.jsx)(n.h3,{id:"1-vectorizationservice",children:"1. VectorizationService"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Location:"})," ",(0,r.jsx)(n.code,{children:"lib/Service/VectorizationService.php"})]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Responsibilities:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Batch processing with error handling"}),"\n",(0,r.jsx)(n.li,{children:"Serial and parallel mode support"}),"\n",(0,r.jsx)(n.li,{children:"Progress tracking"}),"\n",(0,r.jsx)(n.li,{children:"Embedding generation coordination"}),"\n",(0,r.jsx)(n.li,{children:"Vector storage coordination"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Key Method:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"public function vectorizeBatch(string $entityType, array $options): array\n"})}),"\n",(0,r.jsx)(n.h3,{id:"2-vectorizationstrategyinterface",children:"2. VectorizationStrategyInterface"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Location:"})," ",(0,r.jsx)(n.code,{children:"lib/Service/Vectorization/VectorizationStrategyInterface.php"})]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Contract:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"interface VectorizationStrategyInterface\n{\n    // Fetch entities to process\n    public function fetchEntities(array $options): array;\n    \n    // Extract text items from entity (1 for objects, N for file chunks)\n    public function extractVectorizationItems($entity): array;\n    \n    // Prepare metadata for vector storage\n    public function prepareVectorMetadata($entity, array $item): array;\n    \n    // Get entity identifier (for logging)\n    public function getEntityIdentifier($entity);\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"3-strategies",children:"3. Strategies"}),"\n",(0,r.jsx)(n.h4,{id:"filevectorizationstrategy",children:"FileVectorizationStrategy"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Location:"})," ",(0,r.jsx)(n.code,{children:"lib/Service/Vectorization/FileVectorizationStrategy.php"})]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"File-specific logic:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Fetches files with ",(0,r.jsx)(n.code,{children:"status='completed'"})," and chunks"]}),"\n",(0,r.jsx)(n.li,{children:"Filters by MIME types"}),"\n",(0,r.jsxs)(n.li,{children:["Extracts chunks from ",(0,r.jsx)(n.code,{children:"chunks_json"})]}),"\n",(0,r.jsx)(n.li,{children:"Prepares metadata with file path, offsets, etc."}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"objectvectorizationstrategy",children:"ObjectVectorizationStrategy"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Location:"})," ",(0,r.jsx)(n.code,{children:"lib/Service/Vectorization/ObjectVectorizationStrategy.php"})]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Object-specific logic:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Fetches objects by views/schemas"}),"\n",(0,r.jsx)(n.li,{children:"Serializes object data to text"}),"\n",(0,r.jsx)(n.li,{children:"Prepares metadata with object schema, relations, etc."}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"benefits",children:"Benefits"}),"\n",(0,r.jsx)(n.h3,{id:"1-code-reduction",children:"1. Code Reduction"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Before:"})," ~820 lines across two services"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"After:"})," ~350 lines core + ~150 per strategy"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Savings:"})," ~40% less code for 2 entity types, more as we add types"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"2-consistency",children:"2. Consistency"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Same batch processing logic"}),"\n",(0,r.jsx)(n.li,{children:"Same error handling"}),"\n",(0,r.jsx)(n.li,{children:"Same progress tracking"}),"\n",(0,r.jsx)(n.li,{children:"Same API structure"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"3-extensibility",children:"3. Extensibility"}),"\n",(0,r.jsx)(n.p,{children:"Adding new entity types is straightforward:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"// 1. Create strategy\nclass ChatMessageStrategy implements VectorizationStrategyInterface {\n    public function fetchEntities($options) { /* fetch emails */ }\n    public function extractVectorizationItems($email) { /* extract subject + body */ }\n    public function prepareVectorMetadata($email, $item) { /* email metadata */ }\n    public function getEntityIdentifier($email) { return $email->getId(); }\n}\n\n// 2. Register\n$strategy = new ChatMessageStrategy($chatMapper, $logger);\n$vectorizationService->registerStrategy('chat_message', $strategy);\n\n// 3. Use\n$result = $vectorizationService->vectorizeBatch('chat_message', [\n    'conversation_id' => 123,\n    'batch_size' => 50,\n]);\n"})}),"\n",(0,r.jsx)(n.h3,{id:"4-testability",children:"4. Testability"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Test generic logic once"}),"\n",(0,r.jsx)(n.li,{children:"Test strategies independently"}),"\n",(0,r.jsx)(n.li,{children:"Mock strategies easily"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"usage-examples",children:"Usage Examples"}),"\n",(0,r.jsx)(n.h3,{id:"file-vectorization",children:"File Vectorization"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"// FileExtractionController\npublic function vectorizeBatch(): JSONResponse\n{\n    $result = $this->vectorizationService->vectorizeBatch('file', [\n        'mode' => 'parallel',\n        'max_files' => 100,\n        'batch_size' => 50,\n        'file_types' => ['application/pdf'],\n    ]);\n    return new JSONResponse(['success' => true, 'data' => $result]);\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"object-vectorization",children:"Object Vectorization"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"// ObjectsController\npublic function vectorizeBatch(): JSONResponse\n{\n    $result = $vectorizationService->vectorizeBatch('object', [\n        'mode' => 'serial',\n        'views' => [1, 2, 3],\n        'batch_size' => 25,\n    ]);\n    return new JSONResponse(['success' => true, 'data' => $result]);\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"vector-storage",children:"Vector Storage"}),"\n",(0,r.jsxs)(n.p,{children:["Vectors are stored in the ",(0,r.jsx)(n.code,{children:"oc_openregister_vectors"})," table with the following structure:"]}),"\n",(0,r.jsx)(n.h3,{id:"database-schema",children:"Database Schema"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE oc_openregister_vectors (\n    id BIGINT AUTO_INCREMENT PRIMARY KEY,\n    \n    -- Entity information\n    entity_type VARCHAR(50) NOT NULL,        -- 'object' or 'file'\n    entity_id VARCHAR(255) NOT NULL,         -- UUID of object or file\n    \n    -- Chunk information (for files)\n    chunk_index INT DEFAULT 0,               -- 0 for objects, N for file chunks\n    total_chunks INT DEFAULT 1,              -- 1 for objects, N for files\n    chunk_text MEDIUMTEXT,                   -- The actual text that was embedded\n    \n    -- Vector data\n    embedding BLOB NOT NULL,                 -- Binary vector data\n    embedding_model VARCHAR(100) NOT NULL,   -- 'text-embedding-ada-002', etc.\n    embedding_dimensions INT NOT NULL,       -- 1536 for OpenAI ada-002\n    \n    -- Metadata\n    metadata JSON,                           -- Additional searchable metadata\n    \n    -- Timestamps\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n    \n    -- Indexes for performance\n    INDEX idx_entity (entity_type, entity_id),\n    INDEX idx_chunk (entity_id, chunk_index),\n    INDEX idx_model (embedding_model),\n    INDEX idx_created (created_at)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\n"})}),"\n",(0,r.jsx)(n.h3,{id:"field-descriptions",children:"Field Descriptions"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"id"}),": Primary key"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"entity_type"}),": 'file' or 'object'"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"entity_id"}),": ID of the source entity"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"chunk_index"}),": Index of chunk within entity (for files)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"total_chunks"}),": Total number of chunks for entity"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"chunk_text"}),": Text content that was vectorized"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"embedding"}),": Vector embedding (stored as JSON or binary)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"embedding_model"}),": Model used for embedding"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"embedding_dimensions"}),": Dimension count (e.g., 768, 1536, 4096)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"metadata"}),": Additional metadata (JSON)"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"document-chunking-strategy",children:"Document Chunking Strategy"}),"\n",(0,r.jsx)(n.h3,{id:"chunking-parameters",children:"Chunking Parameters"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Parameter"}),(0,r.jsx)(n.th,{children:"Value"}),(0,r.jsx)(n.th,{children:"Reasoning"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"chunk_size"})}),(0,r.jsx)(n.td,{children:"1000 tokens (~750 words)"}),(0,r.jsx)(n.td,{children:"Balances context vs. specificity"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"chunk_overlap"})}),(0,r.jsx)(n.td,{children:"200 tokens (~150 words)"}),(0,r.jsx)(n.td,{children:"Preserves context across chunks"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"max_chunks_per_file"})}),(0,r.jsx)(n.td,{children:"1000"}),(0,r.jsx)(n.td,{children:"Safety limit to prevent memory issues"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"min_chunk_size"})}),(0,r.jsx)(n.td,{children:"100 tokens"}),(0,r.jsx)(n.td,{children:"Skip tiny chunks that lack context"})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"chunking-by-document-type",children:"Chunking by Document Type"}),"\n",(0,r.jsxs)(n.h4,{id:"1-technical-documentation-code-api-docs",children:["1. ",(0,r.jsx)(n.strong,{children:"Technical Documentation"})," (Code, API docs)"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"[\n    'chunk_size' => 800,\n    'chunk_overlap' => 200,\n    'respect_code_blocks' => true,\n    'split_on' => ['###', '##', '```', '\\n\\n']\n]\n"})}),"\n",(0,r.jsxs)(n.h4,{id:"2-legal-documents-contracts-policies",children:["2. ",(0,r.jsx)(n.strong,{children:"Legal Documents"})," (Contracts, policies)"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"[\n    'chunk_size' => 600,\n    'chunk_overlap' => 150,\n    'respect_sections' => true,\n    'split_on' => ['Article', 'Section', 'Clause', '\\n\\n']\n]\n"})}),"\n",(0,r.jsxs)(n.h4,{id:"3-articles--reports",children:["3. ",(0,r.jsx)(n.strong,{children:"Articles & Reports"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"[\n    'chunk_size' => 1200,\n    'chunk_overlap' => 200,\n    'split_on' => ['##', '\\n\\n\\n', '\\n\\n']\n]\n"})}),"\n",(0,r.jsxs)(n.h4,{id:"4-spreadsheets--tables",children:["4. ",(0,r.jsx)(n.strong,{children:"Spreadsheets & Tables"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"[\n    'chunk_size' => 500,\n    'chunk_overlap' => 50,\n    'preserve_rows' => true,\n    'include_headers' => true\n]\n"})}),"\n",(0,r.jsx)(n.h2,{id:"file-processing-pipeline",children:"File Processing Pipeline"}),"\n",(0,r.jsx)(n.h3,{id:"step-1-file-upload",children:"Step 1: File Upload"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"User uploads file \u2192 FileService validates \u2192 Store in Nextcloud files\n"})}),"\n",(0,r.jsx)(n.h3,{id:"step-2-text-extraction",children:"Step 2: Text Extraction"}),"\n",(0,r.jsx)(n.p,{children:"Files are processed to extract text content using LLPhant document loaders, supporting:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"PDF (via pdftotext or Smalot\\PdfParser)"}),"\n",(0,r.jsx)(n.li,{children:"Word (via PhpOffice\\PhpWord)"}),"\n",(0,r.jsx)(n.li,{children:"Excel (via PhpOffice\\PhpSpreadsheet)"}),"\n",(0,r.jsx)(n.li,{children:"PowerPoint (via PhpOffice\\PhpPresentation)"}),"\n",(0,r.jsx)(n.li,{children:"Images (via Tesseract OCR)"}),"\n",(0,r.jsx)(n.li,{children:"Text files (direct reading)"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"step-3-chunking",children:"Step 3: Chunking"}),"\n",(0,r.jsx)(n.p,{children:"Large documents are split into manageable chunks with overlap to preserve context:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Chunks are sized based on document type"}),"\n",(0,r.jsx)(n.li,{children:"Overlap ensures continuity between chunks"}),"\n",(0,r.jsx)(n.li,{children:"Each chunk maintains metadata about its position"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"step-4-vector-generation",children:"Step 4: Vector Generation"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Generate embeddings for each chunk using configured embedding provider"}),"\n",(0,r.jsx)(n.li,{children:"Store vectors in database with metadata"}),"\n",(0,r.jsx)(n.li,{children:"Index chunks in Solr fileCollection for hybrid search"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"step-5-linking",children:"Step 5: Linking"}),"\n",(0,r.jsx)(n.p,{children:"Store relationships:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["File \u2192 Chunks (1",":N",")"]}),"\n",(0,r.jsxs)(n.li,{children:["Object \u2192 Files (1",":N",")"]}),"\n",(0,r.jsx)(n.li,{children:"Chunks \u2192 Vectors (1:1)"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"integration-with-vector-search",children:"Integration with Vector Search"}),"\n",(0,r.jsx)(n.p,{children:"Vectorized entities can be searched using semantic similarity:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Generate query embedding"})," using VectorEmbeddingService"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Search vectors"})," using selected backend (PHP, PostgreSQL, or Solr)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Return top N matches"})," sorted by similarity"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Retrieve source entities"})," using entity_type and entity_id"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["See ",(0,r.jsx)(n.a,{href:"/docs/technical/vectorization#vector-search-backends",children:"Vector Search Backends"})," for details on search backends."]}),"\n",(0,r.jsx)(n.h2,{id:"hybrid-search-architecture",children:"Hybrid Search Architecture"}),"\n",(0,r.jsx)(n.p,{children:"OpenRegister supports hybrid search combining keyword (SOLR) and semantic (vector) search:"}),"\n",(0,r.jsx)(n.h3,{id:"search-flow",children:"Search Flow"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"User Query\n    \u2502\n    \u251c\u2500\u2192 Keyword Search (SOLR)\n    \u2502   \u2514\u2500\u2192 Full-text matching\n    \u2502       Faceting\n    \u2502       Filtering\n    \u2502\n    \u251c\u2500\u2192 Semantic Search (Vectors)\n    \u2502   \u2514\u2500\u2192 Generate query embedding\n    \u2502       Similarity search\n    \u2502       Return top K results\n    \u2502\n    \u2514\u2500\u2192 Merge & Rank Results\n        \u2514\u2500\u2192 Combine by relevance\n            Deduplicate\n            Re-rank using scores\n            Return unified results\n"})}),"\n",(0,r.jsx)(n.h2,{id:"performance-considerations",children:"Performance Considerations"}),"\n",(0,r.jsxs)(n.h3,{id:"1-token-limits",children:["1. ",(0,r.jsx)(n.strong,{children:"Token Limits"})]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"OpenAI ada-002: 8,191 tokens max"}),"\n",(0,r.jsx)(n.li,{children:"OpenAI text-3: 8,191 tokens max"}),"\n",(0,r.jsx)(n.li,{children:"Always chunk before limits"}),"\n"]}),"\n",(0,r.jsxs)(n.h3,{id:"2-api-costs",children:["2. ",(0,r.jsx)(n.strong,{children:"API Costs"})]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"OpenAI ada-002: $0.0001 per 1K tokens"}),"\n",(0,r.jsx)(n.li,{children:"For 1M tokens: ~$0.10"}),"\n",(0,r.jsx)(n.li,{children:"Cache embeddings to avoid re-generation"}),"\n"]}),"\n",(0,r.jsxs)(n.h3,{id:"3-processing-time",children:["3. ",(0,r.jsx)(n.strong,{children:"Processing Time"})]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"PDF extraction: ~1-2 seconds per page"}),"\n",(0,r.jsx)(n.li,{children:"Chunking: < 100ms per document"}),"\n",(0,r.jsx)(n.li,{children:"Embedding generation: ~200ms per chunk (OpenAI)"}),"\n",(0,r.jsx)(n.li,{children:"Parallel processing: 4-8 chunks simultaneously"}),"\n"]}),"\n",(0,r.jsxs)(n.h3,{id:"4-storage",children:["4. ",(0,r.jsx)(n.strong,{children:"Storage"})]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Vector (1536 dimensions): ~6KB per embedding"}),"\n",(0,r.jsx)(n.li,{children:"1M file chunks: ~6GB vector storage"}),"\n",(0,r.jsx)(n.li,{children:"Use compressed storage for large deployments"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/docs/technical/vectorization#vector-search-backends",children:"Vector Search Backends"})," - Vector search backend options"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/docs/development/services-architecture",children:"Services Architecture"})," - Overall service architecture"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"File-specific logic:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Fetches files with completed extractions"}),"\n",(0,r.jsx)(n.li,{children:"Filters by MIME type"}),"\n",(0,r.jsx)(n.li,{children:"Extracts pre-chunked text from 'chunks_json'"}),"\n",(0,r.jsx)(n.li,{children:"Handles multiple chunks per file (1 file = N vectors)"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Options:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"'max_files' - Maximum files to process (0 = all)"}),"\n",(0,r.jsx)(n.li,{children:"'file_types' - Array of MIME types to filter"}),"\n",(0,r.jsx)(n.li,{children:"'batch_size' - Chunks per batch"}),"\n",(0,r.jsx)(n.li,{children:"'mode' - 'serial' or 'parallel'"}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"objectvectorizationstrategy-1",children:"ObjectVectorizationStrategy"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Location:"})," 'lib/Service/Vectorization/ObjectVectorizationStrategy.php'"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Object-specific logic:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Fetches objects by views and schemas"}),"\n",(0,r.jsx)(n.li,{children:"Serializes object data to text"}),"\n",(0,r.jsx)(n.li,{children:"Handles single vector per object (1 object = 1 vector)"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Options:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"'views' - Array of view IDs to filter (null = all)"}),"\n",(0,r.jsx)(n.li,{children:"'batch_size' - Objects per batch"}),"\n",(0,r.jsx)(n.li,{children:"'mode' - 'serial' or 'parallel'"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"usage",children:"Usage"}),"\n",(0,r.jsx)(n.h3,{id:"file-vectorization-1",children:"File Vectorization"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"// In FileExtractionController\n$result = $this->vectorizationService->vectorizeBatch('file', [\n    'mode' => 'parallel',\n    'max_files' => 100,\n    'batch_size' => 50,\n    'file_types' => ['application/pdf', 'text/plain'],\n]);\n"})}),"\n",(0,r.jsx)(n.h3,{id:"object-vectorization-1",children:"Object Vectorization"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"// In ObjectsController\n$result = $this->vectorizationService->vectorizeBatch('object', [\n    'mode' => 'serial',\n    'views' => [1, 2, 3],\n    'batch_size' => 25,\n]);\n"})}),"\n",(0,r.jsx)(n.h2,{id:"adding-new-entity-types",children:"Adding New Entity Types"}),"\n",(0,r.jsx)(n.p,{children:"To add vectorization for a new entity type (e.g., emails, chat messages):"}),"\n",(0,r.jsx)(n.h3,{id:"1-create-strategy",children:"1. Create Strategy"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"namespace OCA\\OpenRegister\\Service\\Vectorization;\n\nclass EmailVectorizationStrategy implements VectorizationStrategyInterface\n{\n    public function fetchEntities(array $options): array\n    {\n        // Fetch emails to vectorize\n        return $this->emailMapper->findUnvectorized($options['limit'] ?? 100);\n    }\n    \n    public function extractVectorizationItems($email): array\n    {\n        // Extract text from email\n        return [[\n            'text' => $email->getSubject() . \"\\n\\n\" . $email->getBody(),\n            'index' => 0,\n        ]];\n    }\n    \n    public function prepareVectorMetadata($email, array $item): array\n    {\n        return [\n            'entity_type' => 'email',\n            'entity_id' => (string) $email->getId(),\n            'chunk_index' => 0,\n            'total_chunks' => 1,\n            'chunk_text' => substr($item['text'], 0, 500),\n            'additional_metadata' => [\n                'from' => $email->getFrom(),\n                'to' => $email->getTo(),\n                'subject' => $email->getSubject(),\n                'date' => $email->getDate(),\n            ],\n        ];\n    }\n    \n    public function getEntityIdentifier($email)\n    {\n        return $email->getId();\n    }\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"2-register-strategy",children:"2. Register Strategy"}),"\n",(0,r.jsx)(n.p,{children:"In 'lib/AppInfo/Application.php':"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"// Register EmailVectorizationStrategy\n$context->registerService(\n    EmailVectorizationStrategy::class,\n    function ($container) {\n        return new EmailVectorizationStrategy(\n            $container->get(EmailMapper::class),\n            $container->get('Psr\\Log\\LoggerInterface')\n        );\n    }\n);\n\n// Register with VectorizationService\n$service->registerStrategy('email', $container->get(EmailVectorizationStrategy::class));\n"})}),"\n",(0,r.jsx)(n.h3,{id:"3-use-it",children:"3. Use It"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"$result = $vectorizationService->vectorizeBatch('email', [\n    'mode' => 'serial',\n    'limit' => 50,\n]);\n"})}),"\n",(0,r.jsx)(n.h2,{id:"benefits-1",children:"Benefits"}),"\n",(0,r.jsx)(n.h3,{id:"code-reduction",children:"Code Reduction"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Before:"})," 820 lines across two separate services"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"After:"})," 350 lines core + ~150 lines per strategy"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Savings:"})," 40% less code for 2 entity types, more as we add types"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"consistency",children:"Consistency"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Same batch processing for all entities"}),"\n",(0,r.jsx)(n.li,{children:"Same error handling"}),"\n",(0,r.jsx)(n.li,{children:"Same progress tracking"}),"\n",(0,r.jsx)(n.li,{children:"Same API structure"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"extensibility",children:"Extensibility"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"New entity types require only ~150 lines"}),"\n",(0,r.jsx)(n.li,{children:"No modification to core logic"}),"\n",(0,r.jsx)(n.li,{children:"Easy to test independently"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"maintainability",children:"Maintainability"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Single source of truth for vectorization"}),"\n",(0,r.jsx)(n.li,{children:"Changes to core logic benefit all entities"}),"\n",(0,r.jsx)(n.li,{children:"Clear separation of concerns"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"implementation-details",children:"Implementation Details"}),"\n",(0,r.jsx)(n.h3,{id:"dependency-injection",children:"Dependency Injection"}),"\n",(0,r.jsx)(n.p,{children:"All services and strategies are registered in 'lib/AppInfo/Application.php':"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"// VectorEmbeddingService (low-level embedding generation)\n$context->registerService(VectorEmbeddingService::class, ...);\n\n// Strategies\n$context->registerService(FileVectorizationStrategy::class, ...);\n$context->registerService(ObjectVectorizationStrategy::class, ...);\n\n// VectorizationService (unified API)\n$context->registerService(VectorizationService::class, function ($container) {\n    $service = new VectorizationService(\n        $container->get(VectorEmbeddingService::class),\n        $container->get('Psr\\Log\\LoggerInterface')\n    );\n    \n    // Register all strategies\n    $service->registerStrategy('file', $container->get(FileVectorizationStrategy::class));\n    $service->registerStrategy('object', $container->get(ObjectVectorizationStrategy::class));\n    \n    return $service;\n});\n"})}),"\n",(0,r.jsx)(n.h3,{id:"processing-modes",children:"Processing Modes"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Serial Mode:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Process one item at a time"}),"\n",(0,r.jsx)(n.li,{children:"Lower memory usage"}),"\n",(0,r.jsx)(n.li,{children:"More predictable performance"}),"\n",(0,r.jsx)(n.li,{children:"Recommended for objects"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Parallel Mode:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Process items in batches"}),"\n",(0,r.jsx)(n.li,{children:"Higher throughput"}),"\n",(0,r.jsx)(n.li,{children:"More memory usage"}),"\n",(0,r.jsx)(n.li,{children:"Recommended for files (many chunks)"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"migration-from-old-services",children:"Migration from Old Services"}),"\n",(0,r.jsx)(n.p,{children:"The old separate services have been removed:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u274c 'FileVectorizationService.php' (355 lines) - DELETED"}),"\n",(0,r.jsx)(n.li,{children:"\u274c 'ObjectVectorizationService.php' (465 lines) - DELETED"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"All functionality is now provided by:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u2705 'VectorizationService.php' (350 lines) - Generic core"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 'FileVectorizationStrategy.php' (150 lines) - File-specific"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 'ObjectVectorizationStrategy.php' (180 lines) - Object-specific"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"The API has changed slightly:"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Old API (deprecated):"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"$fileVectorizationService->startBatchVectorization($mode, $maxFiles, $batchSize, $fileTypes);\n$objectVectorizationService->startBatchVectorization($views, $batchSize);\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"New API (current):"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"$vectorizationService->vectorizeBatch('file', [\n    'mode' => $mode,\n    'max_files' => $maxFiles,\n    'batch_size' => $batchSize,\n    'file_types' => $fileTypes,\n]);\n\n$vectorizationService->vectorizeBatch('object', [\n    'views' => $views,\n    'batch_size' => $batchSize,\n    'mode' => 'serial',\n]);\n"})}),"\n",(0,r.jsx)(n.h2,{id:"testing",children:"Testing"}),"\n",(0,r.jsx)(n.h3,{id:"test-core-logic-once",children:"Test Core Logic Once"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"class VectorizationServiceTest extends TestCase {\n    public function testBatchProcessing() {\n        // Mock strategy\n        $strategy = $this->createMock(VectorizationStrategyInterface::class);\n        \n        // Test batch processing, error handling, etc.\n        $service->registerStrategy('test', $strategy);\n        $result = $service->vectorizeBatch('test', []);\n    }\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"test-strategies-independently",children:"Test Strategies Independently"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"class FileVectorizationStrategyTest extends TestCase {\n    public function testFetchEntities() {\n        // Test file filtering, MIME type handling, etc.\n    }\n    \n    public function testExtractChunks() {\n        // Test chunk extraction from JSON\n    }\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"embedding-model-management",children:"Embedding Model Management"}),"\n",(0,r.jsx)(n.h3,{id:"\ufe0f-critical-changing-embedding-models",children:"\u26a0\ufe0f CRITICAL: Changing Embedding Models"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"When you change embedding models, ALL existing vectors become invalid"})," and must be deleted and regenerated. Vectors created with different embedding models have:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Different dimensions"}),"\n",(0,r.jsx)(n.li,{children:"Different semantic spaces"}),"\n",(0,r.jsx)(n.li,{children:"Incompatible similarity metrics"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"model-tracking",children:"Model Tracking"}),"\n",(0,r.jsx)(n.p,{children:"As of version 0.2.7+, OpenRegister tracks which embedding model created each vector:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"-- openregister_vectors table structure\nCREATE TABLE openregister_vectors (\n    id INT PRIMARY KEY,\n    entity_type VARCHAR(255),\n    entity_id VARCHAR(255),\n    embedding BLOB,\n    embedding_model VARCHAR(255),  -- e.g., 'text-embedding-ada-002', 'llama3.2'\n    embedding_dimensions INT,\n    created_at TIMESTAMP,\n    -- ... other fields\n);\n"})}),"\n",(0,r.jsx)(n.h3,{id:"required-actions-when-changing-models",children:"Required Actions When Changing Models"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Clear All Embeddings"}),': Use the "Clear All Embeddings" button in LLM Configuration']}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Re-vectorize All Data"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:'Click "Vectorize All Files" from the Actions menu'}),"\n",(0,r.jsx)(n.li,{children:'Click "Vectorize All Objects" from the Actions menu'}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"ui-workflow",children:"UI Workflow"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'Settings \u2192 Actions \u2192 LLM Configuration\n    \u2193\nChange Embedding Model (OpenAI \u2192 Ollama)\n    \u2193\nClick "Clear All Embeddings" (red button)\n    \u2193\nConfirm deletion\n    \u2193\nSave Configuration\n    \u2193\nSettings \u2192 Actions \u2192 Vectorize All Files\n    \u2193\nSettings \u2192 Actions \u2192 Vectorize All Objects\n'})}),"\n",(0,r.jsx)(n.h3,{id:"api-endpoints",children:"API Endpoints"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Check for Model Mismatches:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'GET /apps/openregister/api/vectors/check-model-mismatch\n\nResponse:\n{\n  "has_vectors": true,\n  "mismatch": true,\n  "current_model": "llama3.2",\n  "existing_models": ["text-embedding-ada-002"],\n  "total_vectors": 598,\n  "null_model_count": 0,\n  "mismatched_models": ["text-embedding-ada-002"],\n  "message": "Embedding model has changed. Please clear all vectors and re-vectorize."\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Clear All Embeddings:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'DELETE /apps/openregister/api/vectors/clear-all\n\nResponse:\n{\n  "success": true,\n  "deleted": 598,\n  "message": "Deleted 598 vectors successfully"\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"example-switching-from-openai-to-ollama",children:"Example: Switching from OpenAI to Ollama"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"// 1. Current state: 500 vectors created with text-embedding-ada-002\n$status = $vectorEmbeddingService->checkEmbeddingModelMismatch();\n// Returns: mismatch = false (all vectors use text-embedding-ada-002)\n\n// 2. Change configuration to Ollama (llama3.2)\n$settingsService->updateLLMSettings([\n    'embeddingProvider' => 'ollama',\n    'ollamaConfig' => ['model' => 'llama3.2']\n]);\n\n// 3. Check again - now there is a mismatch!\n$status = $vectorEmbeddingService->checkEmbeddingModelMismatch();\n// Returns: mismatch = true (current: llama3.2, existing: text-embedding-ada-002)\n\n// 4. Clear all embeddings\n$result = $vectorEmbeddingService->clearAllEmbeddings();\n// Returns: deleted = 500\n\n// 5. Re-vectorize everything with new model (llama3.2)\n$vectorizationService->vectorizeBatch('file', ['mode' => 'parallel']);\n$vectorizationService->vectorizeBatch('object', ['mode' => 'serial']);\n"})}),"\n",(0,r.jsx)(n.h3,{id:"database-migration",children:"Database Migration"}),"\n",(0,r.jsx)(n.p,{children:"The 'embedding_model' column was added in migration 'Version1Date20251111000000':"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"// Existing vectors (before migration) will have NULL embedding_model\n// New vectors automatically track their model\n// System warns if any NULL or mismatched models exist\n"})}),"\n",(0,r.jsx)(n.h3,{id:"why-this-matters",children:"Why This Matters"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Semantic Search Breaks:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"// Vectors created with OpenAI text-embedding-ada-002 (1536 dimensions)\n$oldVector = [0.023, -0.142, 0.891, ...]; // 1536 values\n\n// Query vector created with Ollama llama3.2 (4096 dimensions)\n$queryVector = [0.012, -0.234, 0.456, ...]; // 4096 values\n\n// \u274c Cannot compare! Dimensions don't match, similarity is meaningless\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Even Same Dimensions Fail:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:'// Both models have 1536 dimensions, but:\n$openaiVector = [0.5, 0.3, -0.2]; // "apple" in OpenAI semantic space\n$ollamaVector = [0.2, -0.5, 0.8]; // "apple" in Ollama semantic space\n\n// \u274c Cosine similarity between these is meaningless!\n// They represent the same word in completely different semantic spaces\n'})}),"\n",(0,r.jsx)(n.h3,{id:"best-practices",children:"Best Practices"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Choose your embedding model carefully"})," before vectorizing large datasets"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Track your model version"})," in application logs"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Use the built-in model tracking"})," to detect mismatches"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Always clear and re-vectorize"})," after model changes"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Test new models"})," on a small dataset first"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Document your model choice"})," for your team"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"future-enhancements",children:"Future Enhancements"}),"\n",(0,r.jsx)(n.p,{children:"Potential new entity types to vectorize:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\ud83d\udce7 ",(0,r.jsx)(n.strong,{children:"Emails"})," - Subject + body vectorization"]}),"\n",(0,r.jsxs)(n.li,{children:["\ud83d\udcac ",(0,r.jsx)(n.strong,{children:"Chat messages"})," - Conversation context vectorization"]}),"\n",(0,r.jsxs)(n.li,{children:["\ud83d\udcdd ",(0,r.jsx)(n.strong,{children:"Comments"})," - User-generated content vectorization"]}),"\n",(0,r.jsxs)(n.li,{children:["\ud83c\udff7\ufe0f ",(0,r.jsx)(n.strong,{children:"Tags"})," - Semantic tag relationships"]}),"\n",(0,r.jsxs)(n.li,{children:["\ud83d\udcca ",(0,r.jsx)(n.strong,{children:"Reports"})," - Generated report content"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Each requires only ~150 lines of strategy code!"})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}}}]);