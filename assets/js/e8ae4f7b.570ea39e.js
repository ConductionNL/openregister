"use strict";(self.webpackChunkopen_catalogi_docs=self.webpackChunkopen_catalogi_docs||[]).push([[275],{28453:(e,n,s)=>{s.d(n,{R:()=>d,x:()=>l});var i=s(96540);const o={},t=i.createContext(o);function d(e){const n=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:d(e.components),i.createElement(t.Provider,{value:n},e.children)}},96880:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>r,contentTitle:()=>l,default:()=>u,frontMatter:()=>d,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"development/git-submodules","title":"Git Submodules Development Guide","description":"This guide explains how to work with the multi-repository structure for Conduction Nextcloud apps.","source":"@site/docs/development/git-submodules.md","sourceDirName":"development","slug":"/development/git-submodules","permalink":"/docs/development/git-submodules","draft":false,"unlisted":false,"editUrl":"https://github.com/conductionnl/openregister/tree/main/website/docs/development/git-submodules.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"title":"Git Submodules Development Guide","sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"Deep Linking and SPOT Architecture","permalink":"/docs/development/deeplinking-spot"},"next":{"title":"Service Architecture","permalink":"/docs/development/services-architecture"}}');var o=s(74848),t=s(28453);const d={title:"Git Submodules Development Guide",sidebar_position:1},l="Development Guide for Multi-Repository Setup",r={},c=[{value:"Quick Start",id:"quick-start",level:2},{value:"Working with Individual Apps",id:"working-with-individual-apps",level:2},{value:"Making changes to an app:",id:"making-changes-to-an-app",level:3},{value:"Switching to a different branch in a submodule:",id:"switching-to-a-different-branch-in-a-submodule",level:3},{value:"Repository Structure",id:"repository-structure",level:2},{value:"Useful Commands",id:"useful-commands",level:2},{value:"Submodule Management",id:"submodule-management",level:3},{value:"Development Workflow",id:"development-workflow",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Submodule is in detached HEAD state:",id:"submodule-is-in-detached-head-state",level:3},{value:"Reset a submodule to match the main repository:",id:"reset-a-submodule-to-match-the-main-repository",level:3},{value:"Remove a submodule:",id:"remove-a-submodule",level:3},{value:"\u26a0\ufe0f Docker Development Environment Warnings",id:"\ufe0f-docker-development-environment-warnings",level:2},{value:"DO NOT Use <code>occ upgrade</code> in Development",id:"do-not-use-occ-upgrade-in-development",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"CI/CD Considerations",id:"cicd-considerations",level:2}];function a(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"development-guide-for-multi-repository-setup",children:"Development Guide for Multi-Repository Setup"})}),"\n",(0,o.jsx)(n.p,{children:"This guide explains how to work with the multi-repository structure for Conduction Nextcloud apps."}),"\n",(0,o.jsx)(n.h2,{id:"quick-start",children:"Quick Start"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"First time setup:"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"git clone <this-repository>\ncd apps-extra\n./setup-submodules.sh\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Update all apps to latest:"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'git submodule update --remote --recursive\ngit add .\ngit commit -m "Update all submodules to latest"\n'})}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"working-with-individual-apps",children:"Working with Individual Apps"}),"\n",(0,o.jsx)(n.h3,{id:"making-changes-to-an-app",children:"Making changes to an app:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Navigate to the app directory:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"cd openregister\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Make your changes and commit normally:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'git add .\ngit commit -m "Your changes"\ngit push origin main\n'})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Update the main repository to reference the new commit:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'cd ..\ngit add openregister\ngit commit -m "Update openregister to latest version"\ngit push\n'})}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"switching-to-a-different-branch-in-a-submodule",children:"Switching to a different branch in a submodule:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'cd openregister\ngit checkout feature-branch\ncd ..\ngit add openregister\ngit commit -m "Switch openregister to feature-branch"\n'})}),"\n",(0,o.jsx)(n.h2,{id:"repository-structure",children:"Repository Structure"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"apps-extra/                    # Main repository\n\u251c\u2500\u2500 .gitignore                 # Ignores non-Conduction apps\n\u251c\u2500\u2500 .gitmodules               # Submodule configuration (auto-generated)\n\u251c\u2500\u2500 README.md                 # Documentation\n\u251c\u2500\u2500 DEVELOPMENT.md            # This file\n\u251c\u2500\u2500 setup-submodules.sh       # Setup script\n\u251c\u2500\u2500 docudesk/                 # Submodule -> ConductionNL/DocuDesk\n\u251c\u2500\u2500 larpingapp/               # Submodule -> ConductionNL/LarpingNextApp\n\u251c\u2500\u2500 opencatalogi/             # Submodule -> ConductionNL/opencatalogi\n\u251c\u2500\u2500 openconnector/            # Submodule -> ConductionNL/OpenConnector\n\u251c\u2500\u2500 openregister/             # Submodule -> ConductionNL/openregister\n\u251c\u2500\u2500 softwarecatalog/          # Submodule -> ConductionNL/softwarecatalog\n\u251c\u2500\u2500 zaakafhandelapp/          # Submodule -> ConductionNL/ZaakAfhandelApp\n\u2514\u2500\u2500 [ignored apps]/           # Non-Conduction apps (gitignored)\n"})}),"\n",(0,o.jsx)(n.h2,{id:"useful-commands",children:"Useful Commands"}),"\n",(0,o.jsx)(n.h3,{id:"submodule-management",children:"Submodule Management"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# Clone repository with all submodules\ngit clone --recursive <repository-url>\n\n# Update all submodules to latest\ngit submodule update --remote --recursive\n\n# Initialize submodules after cloning without --recursive\ngit submodule update --init --recursive\n\n# Check status of all submodules\ngit submodule status\n\n# Run command in all submodules\ngit submodule foreach 'git status'\n"})}),"\n",(0,o.jsx)(n.h3,{id:"development-workflow",children:"Development Workflow"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# Pull latest changes from main repo and all submodules\ngit pull --recurse-submodules\n\n# Push changes including submodule updates\ngit push --recurse-submodules=on-demand\n"})}),"\n",(0,o.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,o.jsx)(n.h3,{id:"submodule-is-in-detached-head-state",children:"Submodule is in detached HEAD state:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'cd <submodule>\ngit checkout main\ngit pull origin main\ncd ..\ngit add <submodule>\ngit commit -m "Update <submodule> to latest main"\n'})}),"\n",(0,o.jsx)(n.h3,{id:"reset-a-submodule-to-match-the-main-repository",children:"Reset a submodule to match the main repository:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"git submodule update --init <submodule>\n"})}),"\n",(0,o.jsx)(n.h3,{id:"remove-a-submodule",children:"Remove a submodule:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"git submodule deinit <submodule>\ngit rm <submodule>\nrm -rf .git/modules/<submodule>\n"})}),"\n",(0,o.jsx)(n.h2,{id:"\ufe0f-docker-development-environment-warnings",children:"\u26a0\ufe0f Docker Development Environment Warnings"}),"\n",(0,o.jsxs)(n.h3,{id:"do-not-use-occ-upgrade-in-development",children:["DO NOT Use ",(0,o.jsx)(n.code,{children:"occ upgrade"})," in Development"]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Critical"}),": Running ",(0,o.jsx)(n.code,{children:"php occ upgrade"})," in the Docker development environment can break Nextcloud."]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Why"}),": Docker volumes and custom app paths (custom_apps, apps-extra) don't always sync properly during upgrade, causing app file inconsistencies."]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"What to do instead"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# If you need to update Nextcloud:\ndocker-compose down\ndocker-compose pull\ndocker-compose up -d\n\n# If something breaks:\ndocker-compose down\ndocker-compose up -d --build\n"})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Safe commands"}),":"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["\u2705 ",(0,o.jsx)(n.code,{children:"php occ app:enable <app>"})]}),"\n",(0,o.jsxs)(n.li,{children:["\u2705 ",(0,o.jsx)(n.code,{children:"php occ app:disable <app>"})]}),"\n",(0,o.jsxs)(n.li,{children:["\u2705 ",(0,o.jsx)(n.code,{children:"php occ background-job:execute"})]}),"\n",(0,o.jsxs)(n.li,{children:["\u2705 ",(0,o.jsx)(n.code,{children:"php occ maintenance:repair"})]}),"\n",(0,o.jsxs)(n.li,{children:["\u274c ",(0,o.jsx)(n.code,{children:"php occ upgrade"})," (DO NOT USE)"]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["See ",(0,o.jsx)(n.code,{children:"openregister/DEVELOPMENT_NOTES.md"})," for more details."]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Always commit submodule changes first"}),", then update the main repository"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Use descriptive commit messages"})," when updating submodule references"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Keep submodules on main branch"})," unless specifically working on a feature"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Regularly update submodules"})," to stay current with latest changes"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Test the entire system"})," after updating multiple submodules"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsxs)(n.strong,{children:["Never use ",(0,o.jsx)(n.code,{children:"occ upgrade"})]})," in Docker development environment (see warning above)"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"cicd-considerations",children:"CI/CD Considerations"}),"\n",(0,o.jsx)(n.p,{children:"When setting up CI/CD pipelines, remember to:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Use ",(0,o.jsx)(n.code,{children:"--recursive"})," flag when cloning"]}),"\n",(0,o.jsx)(n.li,{children:"Update submodules before running tests"}),"\n",(0,o.jsx)(n.li,{children:"Consider separate pipelines for individual apps vs. integration tests"}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(a,{...e})}):a(e)}}}]);