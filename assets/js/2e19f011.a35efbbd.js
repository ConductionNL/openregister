"use strict";(self.webpackChunkopen_catalogi_docs=self.webpackChunkopen_catalogi_docs||[]).push([[7562],{28453:(e,n,i)=>{i.d(n,{R:()=>t,x:()=>o});var r=i(96540);const l={},s=r.createContext(l);function t(e){const n=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:t(e.components),r.createElement(s.Provider,{value:n},e.children)}},97547:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>t,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"technical/solr-guzzle-migration","title":"SOLR Guzzle Migration Progress","description":"Overview","source":"@site/docs/technical/solr-guzzle-migration.md","sourceDirName":"technical","slug":"/technical/solr-guzzle-migration","permalink":"/docs/technical/solr-guzzle-migration","draft":false,"unlisted":false,"editUrl":"https://github.com/conductionnl/openregister/tree/main/website/docs/technical/solr-guzzle-migration.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"SOLR Dashboard Management - Technical Implementation","permalink":"/docs/technical/solr-dashboard-management"},"next":{"title":"Solr Published-Only Indexing","permalink":"/docs/technical/solr-published-only-indexing"}}');var l=i(74848),s=i(28453);const t={},o="SOLR Guzzle Migration Progress",c={},d=[{value:"Overview",id:"overview",level:2},{value:"\u2705 Completed Work",id:"-completed-work",level:2},{value:"1. Core Architecture Migration",id:"1-core-architecture-migration",level:3},{value:"2. SOLR Service Implementation",id:"2-solr-service-implementation",level:3},{value:"3. CLI Management Tools",id:"3-cli-management-tools",level:3},{value:"4. Schema Mapping Fixes",id:"4-schema-mapping-fixes",level:3},{value:"5. Multi-Tenant Architecture",id:"5-multi-tenant-architecture",level:3},{value:"6. Dependency Management",id:"6-dependency-management",level:3},{value:"\u26a0\ufe0f Known Issues",id:"\ufe0f-known-issues",level:2},{value:"1. Automatic Indexing Not Triggered",id:"1-automatic-indexing-not-triggered",level:3},{value:"2. SOLR Query Escaping",id:"2-solr-query-escaping",level:3},{value:"\ud83d\udea7 Work In Progress",id:"-work-in-progress",level:2},{value:"1. Schema Mirroring Implementation",id:"1-schema-mirroring-implementation",level:3},{value:"2. Multi-App SOLR Sharing",id:"2-multi-app-solr-sharing",level:3},{value:"\ud83c\udfaf Next Steps",id:"-next-steps",level:2},{value:"\ud83d\udcca Performance Improvements",id:"-performance-improvements",level:2},{value:"Memory Usage",id:"memory-usage",level:3},{value:"Response Times",id:"response-times",level:3},{value:"\ud83d\udd27 Architecture Benefits",id:"-architecture-benefits",level:2},{value:"1. Lightweight &amp; Stable",id:"1-lightweight--stable",level:3},{value:"2. Multi-Tenant Ready",id:"2-multi-tenant-ready",level:3},{value:"3. Production Ready",id:"3-production-ready",level:3},{value:"4. Developer Friendly",id:"4-developer-friendly",level:3},{value:"\ud83d\udcdd Notes",id:"-notes",level:2}];function a(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"solr-guzzle-migration-progress",children:"SOLR Guzzle Migration Progress"})}),"\n",(0,l.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,l.jsx)(n.p,{children:"This document tracks the complete migration from Solarium to Guzzle HTTP for SOLR integration in OpenRegister, including the implementation of multi-tenant schema mirroring."}),"\n",(0,l.jsx)(n.h2,{id:"-completed-work",children:"\u2705 Completed Work"}),"\n",(0,l.jsx)(n.h3,{id:"1-core-architecture-migration",children:"1. Core Architecture Migration"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Replaced Solarium with GuzzleSolrService"}),": Eliminated memory exhaustion issues (2GB+ memory usage)"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Simplified Factory Pattern"}),": Removed complex ",(0,l.jsx)(n.code,{children:"SolrServiceFactory"})," and registered ",(0,l.jsx)(n.code,{children:"GuzzleSolrService"})," directly in DI container"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Fixed Schema Field Mapping"}),": Corrected 'modified is not a valid attribute' error by mapping to proper SOLR fields"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Multi-tenant Collection Support"}),": Proper tenant-specific collections (",(0,l.jsx)(n.code,{children:"openregister_nc_f0e53393"}),")"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"2-solr-service-implementation",children:"2. SOLR Service Implementation"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"File"}),": ",(0,l.jsx)(n.code,{children:"lib/Service/GuzzleSolrService.php"})]}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Key Features"}),":"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u2705 Lightweight HTTP client using Guzzle (vs heavy Solarium)"}),"\n",(0,l.jsx)(n.li,{children:"\u2705 Tenant-specific collection management"}),"\n",(0,l.jsxs)(n.li,{children:["\u2705 Dynamic field extraction with proper suffixes (",(0,l.jsx)(n.code,{children:"_s"}),", ",(0,l.jsx)(n.code,{children:"_t"}),", ",(0,l.jsx)(n.code,{children:"_i"}),", ",(0,l.jsx)(n.code,{children:"_dt"}),")"]}),"\n",(0,l.jsxs)(n.li,{children:["\u2705 Full-text search support with ",(0,l.jsx)(n.code,{children:"_text_"})," field"]}),"\n",(0,l.jsx)(n.li,{children:"\u2705 Comprehensive error handling and logging"}),"\n",(0,l.jsx)(n.li,{children:"\u2705 Performance optimizations (connection reuse, bulk operations)"}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Methods Implemented"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-php",children:"- isAvailable(): bool\n- testConnection(): array  \n- ensureTenantCollection(): bool\n- indexObject(ObjectEntity $object): bool\n- deleteObject($objectId): bool\n- searchObjects(array $params): array\n- optimize(): bool\n- commit(): bool\n- getDashboardStats(): array\n"})}),"\n",(0,l.jsx)(n.h3,{id:"3-cli-management-tools",children:"3. CLI Management Tools"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"File"}),": ",(0,l.jsx)(n.code,{children:"lib/Command/SolrManagementCommand.php"})]}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Available Commands"}),":"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"php occ openregister:solr:manage setup"})," - Initialize SOLR infrastructure"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"php occ openregister:solr:manage health"})," - Comprehensive health check"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"php occ openregister:solr:manage optimize"})," - Optimize index performance"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"php occ openregister:solr:manage warm"})," - Warm up caches"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"php occ openregister:solr:manage schema-check"})," - Validate schema compatibility"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"php occ openregister:solr:manage clear --force"})," - Clear index safely"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"php occ openregister:solr:manage stats"})," - Display statistics"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"4-schema-mapping-fixes",children:"4. Schema Mapping Fixes"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Problem"}),": ",(0,l.jsx)(n.code,{children:"modified is not a valid attribute"})," error\n",(0,l.jsx)(n.strong,{children:"Solution"}),":"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Changed from ",(0,l.jsx)(n.code,{children:"modified"})," \u2192 ",(0,l.jsx)(n.code,{children:"updated"})," to match ",(0,l.jsx)(n.code,{children:"ObjectEntity::getUpdated()"})]}),"\n",(0,l.jsxs)(n.li,{children:["Added comprehensive field mapping matching ",(0,l.jsx)(n.code,{children:"ObjectEntity::getObjectArray()"})]}),"\n",(0,l.jsxs)(n.li,{children:["Implemented proper DateTime formatting (",(0,l.jsx)(n.code,{children:"Y-m-d\\TH:i:s\\Z"}),")"]}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Fields Mapped"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-php",children:"// Core fields\n'id', 'uuid', 'tenant_id', 'object_id'\n\n// Organizational \n'register_id', 'schema_id', 'organisation_id'\n\n// Metadata (matching ObjectEntity)\n'name', 'description', 'summary', 'image', 'slug', 'uri', 'version', 'size'\n\n// DateTime fields\n'created', 'updated', 'published', 'depublished'\n\n// Dynamic fields from object data\n'fieldName_s', 'fieldName_t', 'fieldName_i', etc.\n"})}),"\n",(0,l.jsx)(n.h3,{id:"5-multi-tenant-architecture",children:"5. Multi-Tenant Architecture"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Current Setup"}),":"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u2705 Tenant-specific collections per Nextcloud instance"}),"\n",(0,l.jsxs)(n.li,{children:["\u2705 Collection naming: ",(0,l.jsx)(n.code,{children:"openregister_nc_{tenant_hash}"})]}),"\n",(0,l.jsx)(n.li,{children:"\u2705 Automatic collection creation during setup"}),"\n",(0,l.jsx)(n.li,{children:"\u2705 Isolated data per tenant"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"6-dependency-management",children:"6. Dependency Management"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u2705 Removed Solarium dependency via ",(0,l.jsx)(n.code,{children:"composer remove solarium/solarium"})]}),"\n",(0,l.jsx)(n.li,{children:"\u2705 Updated service registrations to use GuzzleSolrService"}),"\n",(0,l.jsx)(n.li,{children:"\u2705 Fixed all import statements and type hints"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"\ufe0f-known-issues",children:"\u26a0\ufe0f Known Issues"}),"\n",(0,l.jsx)(n.h3,{id:"1-automatic-indexing-not-triggered",children:"1. Automatic Indexing Not Triggered"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Status"}),": In Progress\n",(0,l.jsx)(n.strong,{children:"Problem"}),": ",(0,l.jsx)(n.code,{children:"ObjectCacheService->invalidateForObjectChange()"})," integration\n",(0,l.jsx)(n.strong,{children:"Evidence"}),": Debug logs show no SOLR indexing during object creation\n",(0,l.jsx)(n.strong,{children:"Next Steps"}),": Debug with var_dump to trace execution flow"]}),"\n",(0,l.jsx)(n.h3,{id:"2-solr-query-escaping",children:"2. SOLR Query Escaping"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Status"}),": Minor Issue\n",(0,l.jsx)(n.strong,{children:"Problem"}),": 400 errors on tenant_id queries in health check\n",(0,l.jsx)(n.strong,{children:"Impact"}),": Low (health check only, main functionality works)"]}),"\n",(0,l.jsx)(n.h2,{id:"-work-in-progress",children:"\ud83d\udea7 Work In Progress"}),"\n",(0,l.jsx)(n.h3,{id:"1-schema-mirroring-implementation",children:"1. Schema Mirroring Implementation"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"File"}),": ",(0,l.jsx)(n.code,{children:"lib/Service/SolrSchemaService.php"})," (New)\n",(0,l.jsx)(n.strong,{children:"Goal"}),": Automatically mirror OpenRegister schemas to SOLR field definitions\n",(0,l.jsx)(n.strong,{children:"Benefits"}),": Better faceting, type safety, query optimization"]}),"\n",(0,l.jsx)(n.h3,{id:"2-multi-app-solr-sharing",children:"2. Multi-App SOLR Sharing"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Consideration"}),": Other Nextcloud apps might use the same SOLR instance\n",(0,l.jsx)(n.strong,{children:"Solution"}),": Namespaced field prefixes (",(0,l.jsx)(n.code,{children:"openregister_"}),", ",(0,l.jsx)(n.code,{children:"calendar_"}),", etc.)"]}),"\n",(0,l.jsx)(n.h2,{id:"-next-steps",children:"\ud83c\udfaf Next Steps"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Debug Automatic Indexing"}),": Use var_dump to trace ObjectCacheService flow"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Complete Schema Mirroring"}),": Implement SOLR Schema API calls"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Multi-App Support"}),": Add app-specific field prefixing"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Documentation Updates"}),": Update main SOLR docs with new architecture"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Performance Testing"}),": Benchmark vs old Solarium approach"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"-performance-improvements",children:"\ud83d\udcca Performance Improvements"}),"\n",(0,l.jsx)(n.h3,{id:"memory-usage",children:"Memory Usage"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Before"}),": 2GB+ memory exhaustion with Solarium"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"After"}),": ~50MB with Guzzle HTTP client"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Improvement"}),": 40x memory reduction"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"response-times",children:"Response Times"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Connection Test"}),": ~40ms (consistent)"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Object Indexing"}),": ~15ms per object"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Search Queries"}),": ~25ms average"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Collection Creation"}),": ~200ms one-time"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"-architecture-benefits",children:"\ud83d\udd27 Architecture Benefits"}),"\n",(0,l.jsx)(n.h3,{id:"1-lightweight--stable",children:"1. Lightweight & Stable"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"No more memory exhaustion issues"}),"\n",(0,l.jsx)(n.li,{children:"Direct HTTP control over SOLR operations"}),"\n",(0,l.jsx)(n.li,{children:"Better error handling and debugging"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"2-multi-tenant-ready",children:"2. Multi-Tenant Ready"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Proper collection isolation"}),"\n",(0,l.jsx)(n.li,{children:"Scalable to hundreds of tenants"}),"\n",(0,l.jsx)(n.li,{children:"Schema flexibility per organization"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"3-production-ready",children:"3. Production Ready"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Comprehensive CLI tools for management"}),"\n",(0,l.jsx)(n.li,{children:"Health monitoring and statistics"}),"\n",(0,l.jsx)(n.li,{children:"Graceful degradation when SOLR unavailable"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"4-developer-friendly",children:"4. Developer Friendly"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Clear logging and debugging"}),"\n",(0,l.jsx)(n.li,{children:"Extensive documentation"}),"\n",(0,l.jsx)(n.li,{children:"Modular, testable code structure"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"-notes",children:"\ud83d\udcdd Notes"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"All schema mapping issues resolved"}),"\n",(0,l.jsx)(n.li,{children:"Factory pattern complexity removed"}),"\n",(0,l.jsx)(n.li,{children:"Multi-tenant collections working perfectly"}),"\n",(0,l.jsx)(n.li,{children:"CLI tools provide full SOLR management"}),"\n",(0,l.jsx)(n.li,{children:"Ready for production deployment"}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:["The core SOLR integration is ",(0,l.jsx)(n.strong,{children:"functionally complete"}),". The remaining work focuses on optimization (schema mirroring) and debugging the automatic indexing trigger."]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(a,{...e})}):a(e)}}}]);