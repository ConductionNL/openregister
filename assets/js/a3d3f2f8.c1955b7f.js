"use strict";(self.webpackChunkopen_catalogi_docs=self.webpackChunkopen_catalogi_docs||[]).push([[818],{12179:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>a,metadata:()=>t,toc:()=>o});const t=JSON.parse('{"id":"technical/php","title":"php","description":"API Testing","source":"@site/docs/technical/php.md","sourceDirName":"technical","slug":"/technical/php","permalink":"/docs/technical/php","draft":false,"unlisted":false,"editUrl":"https://github.com/conductionnl/openregister/tree/main/website/docs/technical/php.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Multi-Tenancy Testing Framework","permalink":"/docs/technical/multi-tenancy-testing"},"next":{"title":"Schema-Based Faceting","permalink":"/docs/technical/schema-based-facets"}}');var i=s(74848),r=s(28453);const a={},c=void 0,l={},o=[{value:"API Testing",id:"api-testing",level:2},{value:"CRITICAL: Local Development API Testing Requirements",id:"critical-local-development-api-testing-requirements",level:3},{value:"Schema Access and Inspection",id:"schema-access-and-inspection",level:3},{value:"Recent Fixes and Improvements",id:"recent-fixes-and-improvements",level:3},{value:"\ud83d\udd27 IN PROGRESS: Inverse Relations Write-Back Issue",id:"-in-progress-inverse-relations-write-back-issue",level:4},{value:"Test Configuration",id:"test-configuration",level:3},{value:"Writing Tests",id:"writing-tests",level:2},{value:"Test Class Structure",id:"test-class-structure",level:3},{value:"Test Scenarios",id:"test-scenarios",level:3},{value:"Testing Object Cascading",id:"testing-object-cascading",level:4},{value:"Testing UUID Handling",id:"testing-uuid-handling",level:4},{value:"Testing Error Scenarios",id:"testing-error-scenarios",level:4},{value:"Mocking Dependencies",id:"mocking-dependencies",level:3},{value:"Test Categories",id:"test-categories",level:2},{value:"Unit Tests",id:"unit-tests",level:3},{value:"Integration Tests",id:"integration-tests",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"Common Test Patterns",id:"common-test-patterns",level:2},{value:"Data Providers",id:"data-providers",level:3},{value:"Exception Testing",id:"exception-testing",level:3},{value:"Debugging Tests",id:"debugging-tests",level:2},{value:"Verbose Output",id:"verbose-output",level:3},{value:"Debug Specific Test",id:"debug-specific-test",level:3},{value:"Test Coverage",id:"test-coverage",level:3},{value:"Continuous Integration",id:"continuous-integration",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Common Issues",id:"common-issues",level:3},{value:"Test Environment Setup",id:"test-environment-setup",level:3},{value:"Manual Testing Scenarios",id:"manual-testing-scenarios",level:2},{value:"Test Cascading Between Contactgegevens and Organisatie",id:"test-cascading-between-contactgegevens-and-organisatie",level:3},{value:"Validate Response Structure",id:"validate-response-structure",level:3},{value:"Future Enhancements",id:"future-enhancements",level:2},{value:"Current Testing Status",id:"current-testing-status",level:2},{value:"Recent Updates and Fixes",id:"recent-updates-and-fixes",level:3},{value:"UI Improvements (EditSchema.vue)",id:"ui-improvements-editschemavue",level:4},{value:"Backend Bug Fixes",id:"backend-bug-fixes",level:4},{value:"Schema Configuration Testing",id:"schema-configuration-testing",level:3},{value:"Current Organisatie Schema Structure",id:"current-organisatie-schema-structure",level:4},{value:"Testing Scenarios Planned",id:"testing-scenarios-planned",level:4},{value:"Current Issues",id:"current-issues",level:3},{value:"\u2705 RESOLVED: Duplicate Schema ID Error",id:"-resolved-duplicate-schema-id-error",level:4},{value:"Next Steps",id:"next-steps",level:3},{value:"Test Commands for Manual Verification",id:"test-commands-for-manual-verification",level:3},{value:"Code Quality Improvements",id:"code-quality-improvements",level:3}];function d(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h2,{id:"api-testing",children:"API Testing"}),"\n",(0,i.jsx)(n.h3,{id:"critical-local-development-api-testing-requirements",children:"CRITICAL: Local Development API Testing Requirements"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'\n#### 4. Testing Object Creation and Relationships\n\n**Create Test Objects:**\n```bash\n# Create a test organisation\ndocker exec -it -u 33 master-nextcloud-1 bash -c "curl -u \'admin:admin\' -H \'OCS-APIREQUEST: true\' -H \'Content-Type: application/json\' -X POST \'http://localhost/index.php/apps/openregister/api/objects/6/35\' -d \'{\\"naam\\": \\"Test Organisatie 1\\", \\"website\\": \\"https://test1.nl\\", \\"type\\": \\"Leverancier\\"}\'"\n\n# Create another test organisation\ndocker exec -it -u 33 master-nextcloud-1 bash -c "curl -u \'admin:admin\' -H \'OCS-APIREQUEST: true\' -H \'Content-Type: application/json\' -X POST \'http://localhost/index.php/apps/openregister/api/objects/6/35\' -d \'{\\"naam\\": \\"Test Organisatie 2\\", \\"website\\": \\"https://test2.nl\\", \\"type\\": \\"Leverancier\\"}\'"\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Test Inverse Relationships:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Test deelnemers property population\ndocker exec -it -u 33 master-nextcloud-1 bash -c \"curl -u 'admin:admin' -H 'OCS-APIREQUEST: true' 'http://localhost/index.php/apps/openregister/api/objects/6/35?extend=deelnemers'\"\n\n# Test specific object with extend\ndocker exec -it -u 33 master-nextcloud-1 bash -c \"curl -u 'admin:admin' -H 'OCS-APIREQUEST: true' 'http://localhost/index.php/apps/openregister/api/objects/6/35/UUID-HERE?extend=deelnemers'\"\n"})}),"\n",(0,i.jsx)(n.h3,{id:"schema-access-and-inspection",children:"Schema Access and Inspection"}),"\n",(0,i.jsx)(n.p,{children:"To inspect or modify schema configurations, you can access them directly via the API:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# View a specific schema (replace 35 with the schema ID)\ndocker exec -it -u 33 master-nextcloud-1 bash -c \"curl -u 'admin:admin' -H 'OCS-APIREQUEST: true' 'http://localhost/index.php/apps/openregister/api/schemas/35'\"\n\n# For external access (production/staging environments)\ncurl -u 'admin:admin' -H 'OCS-APIREQUEST: true' \\\n  'http://nextcloud.local/index.php/apps/openregister/api/schemas/35'\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Schema ID Reference:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Organisatie schema: ID 35 (UUID: 94cd5186-b6d3-4d9d-91c8-a109083a7f88)"}),"\n",(0,i.jsx)(n.li,{children:"Contactgegevens schema: ID 34"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"recent-fixes-and-improvements",children:"Recent Fixes and Improvements"}),"\n",(0,i.jsx)(n.h4,{id:"-in-progress-inverse-relations-write-back-issue",children:"\ud83d\udd27 IN PROGRESS: Inverse Relations Write-Back Issue"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Problem"}),": The ",(0,i.jsx)(n.code,{children:"deelnemers"})," property was not triggering write-back to update the ",(0,i.jsx)(n.code,{children:"deelnames"})," property on referenced organizations."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Root Cause"}),": The ",(0,i.jsx)(n.code,{children:"handleInverseRelationsWriteBack"})," method was not correctly detecting ",(0,i.jsx)(n.code,{children:"writeBack"})," properties in array configurations. The schema structure has ",(0,i.jsx)(n.code,{children:"writeBack"})," at the array level, but the code was only checking at the items level."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Schema Structure"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'"deelnemers": {\n  "type": "array",\n  "items": {\n    "type": "object",\n    "objectConfiguration": {"handling": "related-object"},\n    "$ref": "#/components/schemas/organisatie",\n    "inversedBy": "deelnames",\n    "writeBack": true,           // \u2190 This is at array level\n    "removeAfterWriteBack": true\n  }\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsxs)(n.strong,{children:["Difference between ",(0,i.jsx)(n.code,{children:"writeBack"})," and ",(0,i.jsx)(n.code,{children:"inversedBy"})]}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"inversedBy"})}),": Declarative property that defines the relationship direction (\"referenced objects have a 'deelnames' property\")"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"writeBack"})}),': Action property that triggers the actual update ("when I set deelnemers, update the referenced objects\' deelnames")']}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Solution Implemented"}),":"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Fixed property detection"}),": Added logic to check for ",(0,i.jsx)(n.code,{children:"writeBack"})," at both property level and array level"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Enhanced configuration extraction"}),": Updated logic to handle array of objects with ",(0,i.jsx)(n.code,{children:"writeBack"})," at array level"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Improved error handling"}),": Better logging and error handling for write-back operations"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Testing Status"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u2705 Schema configuration is correct"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 API calls work properly"}),"\n",(0,i.jsx)(n.li,{children:"\ud83d\udd04 Debug logging needs investigation (logs not appearing in Docker stdout)"}),"\n",(0,i.jsx)(n.li,{children:"\ud83d\udd04 Write-back functionality needs verification"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"\n# Unit Testing\n\nUnit testing is crucial for maintaining code quality and ensuring that changes don't break existing functionality. The OpenRegister project uses PHPUnit for testing.\n\n## Test Structure\n\nTests are organized in the 'tests/' directory with the following structure:\n\n"})}),"\n",(0,i.jsx)(n.p,{children:"tests/\n\u251c\u2500\u2500 bootstrap.php          # Test bootstrap file\n\u251c\u2500\u2500 Unit/                  # Unit tests\n\u2502   \u251c\u2500\u2500 Service/          # Service layer tests\n\u2502   \u2502   \u251c\u2500\u2500 ObjectHandlers/\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 SaveObjectTest.php\n\u2502   \u2502   \u2514\u2500\u2500 ObjectServiceTest.php\n\u2502   \u2514\u2500\u2500 Db/               # Database layer tests\n\u2514\u2500\u2500 Integration/          # Integration tests (future)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"\n## Running Tests\n\n### Prerequisites\n\n1. Ensure you have a running Nextcloud development environment\n2. Install dependencies: 'composer install'\n3. The tests require access to the Nextcloud framework\n\n### Running Tests via Docker\n\nFor the most reliable test execution, run tests inside the Nextcloud container:\n\n```bash\n# Execute tests in the container\ndocker exec -it -u 33 master-nextcloud-1 bash -c 'cd /var/www/html/apps-extra/openregister && ./vendor/bin/phpunit tests/Unit/Service/ObjectHandlers/SaveObjectTest.php --bootstrap tests/bootstrap.php'\n\n# Run all unit tests\ndocker exec -it -u 33 master-nextcloud-1 bash -c 'cd /var/www/html/apps-extra/openregister && ./vendor/bin/phpunit tests/Unit/ --bootstrap tests/bootstrap.php'\n\n# Run with verbose output\ndocker exec -it -u 33 master-nextcloud-1 bash -c 'cd /var/www/html/apps-extra/openregister && ./vendor/bin/phpunit tests/Unit/ --bootstrap tests/bootstrap.php --verbose'\n"})}),"\n",(0,i.jsx)(n.h3,{id:"test-configuration",children:"Test Configuration"}),"\n",(0,i.jsx)(n.p,{children:"The project uses 'phpunit.xml' for configuration:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-xml",children:"<?xml version='1.0' encoding='UTF-8'?>\n<phpunit xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance'\n         xsi:noNamespaceSchemaLocation='https://schema.phpunit.de/9.5/phpunit.xsd'\n         bootstrap='tests/bootstrap.php'\n         cacheResultFile='.phpunit.result.cache'\n         executionOrder='depends,defects'\n         forceCoversAnnotation='false'\n         beStrictAboutCoversAnnotation='true'\n         beStrictAboutOutputDuringTests='true'\n         beStrictAboutTodoAnnotatedTests='true'\n         failOnRisky='true'\n         failOnWarning='true'\n         verbose='true'>\n    <testsuites>\n        <testsuite name='unit'>\n            <directory>tests/Unit</directory>\n        </testsuite>\n    </testsuites>\n    <coverage>\n        <include>\n            <directory suffix='.php'>lib</directory>\n        </include>\n    </coverage>\n</phpunit>\n"})}),"\n",(0,i.jsx)(n.h2,{id:"writing-tests",children:"Writing Tests"}),"\n",(0,i.jsx)(n.h3,{id:"test-class-structure",children:"Test Class Structure"}),"\n",(0,i.jsx)(n.p,{children:"All test classes should follow this structure:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"<?php\n/**\n * Test class for [ClassName]\n *\n * @category Test\n * @package  OCA\\OpenRegister\\Tests\\Unit\\Service\n *\n * @author    Conduction Development Team <dev@conduction.nl>\n * @copyright 2024 Conduction B.V.\n * @license   EUPL-1.2 https://joinup.ec.europa.eu/collection/eupl/eupl-text-eupl-12\n *\n * @version GIT: <git-id>\n *\n * @link https://OpenRegister.app\n */\n\ndeclare(strict_types=1);\n\nnamespace OCA\\OpenRegister\\Tests\\Unit\\Service;\n\nuse PHPUnit\\Framework\\TestCase;\nuse OCA\\OpenRegister\\Service\\YourService;\n\n/**\n * Test class for YourService\n */\nclass YourServiceTest extends TestCase\n{\n    /**\n     * @var YourService The service under test\n     */\n    private YourService $service;\n\n    /**\n     * Set up test environment before each test\n     *\n     * @return void\n     */\n    protected function setUp(): void\n    {\n        parent::setUp();\n        $this->service = new YourService();\n    }\n\n    /**\n     * Clean up after each test\n     *\n     * @return void\n     */\n    protected function tearDown(): void\n    {\n        parent::tearDown();\n        unset($this->service);\n    }\n\n    /**\n     * Test method description\n     *\n     * @return void\n     */\n    public function testMethodName(): void\n    {\n        // Arrange\n        $input = 'test input';\n        $expected = 'expected output';\n\n        // Act\n        $result = $this->service->methodName($input);\n\n        // Assert\n        $this->assertEquals($expected, $result);\n    }\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"test-scenarios",children:"Test Scenarios"}),"\n",(0,i.jsx)(n.h4,{id:"testing-object-cascading",children:"Testing Object Cascading"}),"\n",(0,i.jsx)(n.p,{children:"Example test for object cascading behavior:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"public function testCascadeObjectsWithInversedBy(): void\n{\n    // Arrange\n    $mainObject = new ObjectEntity();\n    $schema = $this->createMockSchema();\n    $data = [\n        'name' => 'Test Organization',\n        'contactgegevens' => [\n            [\n                'voornaam' => 'John',\n                'achternaam' => 'Doe',\n                'email' => 'john@example.com'\n            ]\n        ]\n    ];\n\n    // Act\n    $result = $this->saveObject->cascadeObjects($mainObject, $schema, $data);\n\n    // Assert\n    $this->assertArrayHasKey('contactgegevens', $result);\n    $this->assertEmpty($result['contactgegevens']); // Should be empty due to inversedBy\n}\n"})}),"\n",(0,i.jsx)(n.h4,{id:"testing-uuid-handling",children:"Testing UUID Handling"}),"\n",(0,i.jsx)(n.p,{children:"Example test for UUID handling:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"public function testSaveObjectWithSpecificUuid(): void\n{\n    // Arrange\n    $uuid = '12345678-1234-5678-9012-123456789012';\n    $data = ['name' => 'Test Object'];\n\n    // Act\n    $result = $this->saveObject->saveObject(\n        registerId: 1,\n        schemaId: 1,\n        objectData: $data,\n        uuid: $uuid\n    );\n\n    // Assert\n    $this->assertInstanceOf(ObjectEntity::class, $result);\n    $this->assertEquals($uuid, $result->getUuid());\n}\n"})}),"\n",(0,i.jsx)(n.h4,{id:"testing-error-scenarios",children:"Testing Error Scenarios"}),"\n",(0,i.jsx)(n.p,{children:"Example test for error handling:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"public function testSaveObjectWithInvalidData(): void\n{\n    // Arrange\n    $invalidData = []; // Missing required fields\n\n    // Assert\n    $this->expectException(\\Exception::class);\n    $this->expectExceptionMessage('Validation failed');\n\n    // Act\n    $this->saveObject->saveObject(\n        registerId: 1,\n        schemaId: 1,\n        objectData: $invalidData\n    );\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"mocking-dependencies",children:"Mocking Dependencies"}),"\n",(0,i.jsx)(n.p,{children:"Use PHPUnit's mocking capabilities for dependencies:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"protected function setUp(): void\n{\n    parent::setUp();\n    \n    // Mock dependencies\n    $this->objectMapper = $this->createMock(ObjectMapper::class);\n    $this->schemaMapper = $this->createMock(SchemaMapper::class);\n    $this->validator = $this->createMock(ValidatorService::class);\n    \n    // Create service with mocked dependencies\n    $this->saveObject = new SaveObject(\n        $this->objectMapper,\n        $this->schemaMapper,\n        $this->validator\n    );\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"test-categories",children:"Test Categories"}),"\n",(0,i.jsx)(n.h3,{id:"unit-tests",children:"Unit Tests"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Test individual methods in isolation"}),"\n",(0,i.jsx)(n.li,{children:"Mock all dependencies"}),"\n",(0,i.jsx)(n.li,{children:"Fast execution"}),"\n",(0,i.jsx)(n.li,{children:"Located in 'tests/Unit/'"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"integration-tests",children:"Integration Tests"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Test interaction between components"}),"\n",(0,i.jsx)(n.li,{children:"Use real database connections"}),"\n",(0,i.jsx)(n.li,{children:"Slower execution"}),"\n",(0,i.jsx)(n.li,{children:"Located in 'tests/Integration/' (future)"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Follow AAA Pattern"}),": Arrange, Act, Assert"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"One Assertion Per Test"}),": Each test should verify one specific behavior"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Descriptive Test Names"}),": Use clear, descriptive method names"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Mock External Dependencies"}),": Don't rely on external services"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Test Edge Cases"}),": Include tests for boundary conditions and error scenarios"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Use Data Providers"}),": For testing multiple input scenarios"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Clean Up"}),": Always clean up resources in tearDown()"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"common-test-patterns",children:"Common Test Patterns"}),"\n",(0,i.jsx)(n.h3,{id:"data-providers",children:"Data Providers"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"/**\n * @dataProvider validationDataProvider\n */\npublic function testValidation(array $data, bool $expected): void\n{\n    $result = $this->validator->validate($data);\n    $this->assertEquals($expected, $result);\n}\n\npublic function validationDataProvider(): array\n{\n    return [\n        'valid data' => [['name' => 'Test'], true],\n        'invalid data' => [[], false],\n        'missing required field' => [['description' => 'Test'], false],\n    ];\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"exception-testing",children:"Exception Testing"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"public function testExceptionHandling(): void\n{\n    $this->expectException(\\InvalidArgumentException::class);\n    $this->expectExceptionMessage('Invalid input provided');\n    \n    $this->service->methodThatThrows('invalid input');\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"debugging-tests",children:"Debugging Tests"}),"\n",(0,i.jsx)(n.h3,{id:"verbose-output",children:"Verbose Output"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"./vendor/bin/phpunit --verbose\n"})}),"\n",(0,i.jsx)(n.h3,{id:"debug-specific-test",children:"Debug Specific Test"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"./vendor/bin/phpunit --filter testMethodName --verbose\n"})}),"\n",(0,i.jsx)(n.h3,{id:"test-coverage",children:"Test Coverage"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"./vendor/bin/phpunit --coverage-text\n"})}),"\n",(0,i.jsx)(n.h2,{id:"continuous-integration",children:"Continuous Integration"}),"\n",(0,i.jsx)(n.p,{children:"Tests should be run automatically in CI/CD pipelines:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"On pull requests"}),"\n",(0,i.jsx)(n.li,{children:"Before deployments"}),"\n",(0,i.jsx)(n.li,{children:"On scheduled basis"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,i.jsx)(n.h3,{id:"common-issues",children:"Common Issues"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Missing Dependencies"}),": Ensure all required packages are installed"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Database Connection"}),": Verify database is accessible"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Nextcloud Bootstrap"}),": Ensure proper Nextcloud environment setup"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Memory Limits"}),": Increase PHP memory limit if needed"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"test-environment-setup",children:"Test Environment Setup"}),"\n",(0,i.jsx)(n.p,{children:"The 'tests/bootstrap.php' file handles:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Nextcloud framework initialization"}),"\n",(0,i.jsx)(n.li,{children:"Autoloader setup"}),"\n",(0,i.jsx)(n.li,{children:"Test environment configuration"}),"\n",(0,i.jsx)(n.li,{children:"Database connection setup"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"manual-testing-scenarios",children:"Manual Testing Scenarios"}),"\n",(0,i.jsx)(n.p,{children:"For comprehensive testing, also perform manual API tests:"}),"\n",(0,i.jsx)(n.h3,{id:"test-cascading-between-contactgegevens-and-organisatie",children:"Test Cascading Between Contactgegevens and Organisatie"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# Test creating Organisatie with nested Contactgegevens\ncurl -u \'admin:admin\' -H \'OCS-APIREQUEST: true\' -H \'Content-Type: application/json\' \\\n  -X POST \'http://localhost/index.php/apps/openregister/api/objects/6/35\' \\\n  -d \'{\n    "naam": "Test Organisatie BV",\n    "website": "https://test-organisatie.nl",\n    "type": "Leverancier",\n    "contactgegevens": [\n      {\n        "voornaam": "Jan",\n        "achternaam": "Jansen",\n        "email": "jan.jansen@test-organisatie.nl",\n        "telefoon": "06-12345678",\n        "functie": "Manager"\n      }\n    ]\n  }\'\n'})}),"\n",(0,i.jsx)(n.h3,{id:"validate-response-structure",children:"Validate Response Structure"}),"\n",(0,i.jsx)(n.p,{children:"Check that the response includes:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Proper UUID generation"}),"\n",(0,i.jsx)(n.li,{children:"Correct cascading behavior"}),"\n",(0,i.jsx)(n.li,{children:"Proper inversedBy handling"}),"\n",(0,i.jsx)(n.li,{children:"Validation compliance"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"future-enhancements",children:"Future Enhancements"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Integration Tests"}),": Full database integration tests"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Performance Tests"}),": Load and stress testing"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"API Tests"}),": Automated API endpoint testing"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Mock Services"}),": More sophisticated mocking framework"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Test Data Factories"}),": Automated test data generation"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"current-testing-status",children:"Current Testing Status"}),"\n",(0,i.jsx)(n.h3,{id:"recent-updates-and-fixes",children:"Recent Updates and Fixes"}),"\n",(0,i.jsx)(n.h4,{id:"ui-improvements-editschemavue",children:"UI Improvements (EditSchema.vue)"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Fixed array item object configuration"}),": Added support for configuring object properties when array items are of type 'object'"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Updated object handling options"}),": Added 'nested-object' and 'related-object' options for both regular objects and array items"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Enhanced inversedBy support"}),": Added proper support for inversedBy relationships in array items"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Improved schema reference handling"}),": Better handling of schema references in array configurations"]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"backend-bug-fixes",children:"Backend Bug Fixes"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Fixed RenderObject.php"}),": Resolved 'str_contains(): Argument #1 ($haystack) must be of type string, array given' error by properly handling both string and object formats for '$ref' fields"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Fixed ValidateObject.php"}),": Similar fix for schema reference validation to handle object format '$ref' fields"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"schema-configuration-testing",children:"Schema Configuration Testing"}),"\n",(0,i.jsx)(n.h4,{id:"current-organisatie-schema-structure",children:"Current Organisatie Schema Structure"}),"\n",(0,i.jsx)(n.p,{children:"The Organisatie schema has been updated with the following key relationships:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"deelnemers"})," (array of objects):"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Type: array with object items"}),"\n",(0,i.jsx)(n.li,{children:"Object handling: 'related-object'"}),"\n",(0,i.jsx)(n.li,{children:"Schema reference: '#/components/schemas/organisatie'"}),"\n",(0,i.jsx)(n.li,{children:"InversedBy: 'deelnames'"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"deelnames"})," (array of objects):"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Type: array with object items"}),"\n",(0,i.jsx)(n.li,{children:"Object handling: 'related-object'"}),"\n",(0,i.jsx)(n.li,{children:"Schema reference: '#/components/schemas/organisatie'"}),"\n",(0,i.jsx)(n.li,{children:"No inversedBy (receives the relationship)"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"testing-scenarios-planned",children:"Testing Scenarios Planned"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Create Individual Organisations"}),": Create test organisations to use as deelnemers"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Create Samenwerking Organisation"}),": Create a 'Samenwerking' type organisation with existing organisation UUIDs in deelnemers array"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Verify Cascading Logic"}),": Check that:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"deelnemers array gets emptied after cascading"}),"\n",(0,i.jsx)(n.li,{children:"Referenced organisations get the parent UUID added to their deelnames array"}),"\n",(0,i.jsx)(n.li,{children:"Proper UUID handling and relationship establishment"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"current-issues",children:"Current Issues"}),"\n",(0,i.jsx)(n.h4,{id:"-resolved-duplicate-schema-id-error",children:"\u2705 RESOLVED: Duplicate Schema ID Error"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Error"}),": 'Duplicate schema id: ",(0,i.jsx)(n.a,{href:"http://localhost/apps/openregister/api/v1/schemas/94cd5186-b6d3-4d9d-91c8-a109083a7f88#",children:"http://localhost/apps/openregister/api/v1/schemas/94cd5186-b6d3-4d9d-91c8-a109083a7f88#"}),"'"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Root Cause"}),": Circular references in the Organisatie schema where ",(0,i.jsx)(n.code,{children:"deelnames"})," and ",(0,i.jsx)(n.code,{children:"deelnemers"})," properties both referenced ",(0,i.jsx)(n.code,{children:"#/components/schemas/organisatie"}),", causing the Opis JSON Schema validator to encounter the same schema ID multiple times."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Solution Implemented"}),": Added OpenRegister-specific schema transformation in ",(0,i.jsx)(n.code,{children:"ValidateObject.php"})," that:"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Transforms schemas before validation"}),": Processes schema objects before they reach the Opis JSON Schema validator"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Handles related vs nested objects"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Related objects (",(0,i.jsx)(n.code,{children:"handling: 'related-object'"}),") \u2192 Converted to UUID string validation"]}),"\n",(0,i.jsxs)(n.li,{children:["Nested objects (",(0,i.jsx)(n.code,{children:"handling: 'nested-object'"}),") \u2192 Keeps object structure but prevents circular refs"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Prevents circular references"}),": Removes ",(0,i.jsx)(n.code,{children:"$ref"})," properties that would cause infinite validation loops"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Maintains OpenRegister logic"}),": Ensures related objects expect UUID strings while nested objects expect full objects"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Impact"}),": Organisation creation now works correctly, enabling testing of cascading relationships between ",(0,i.jsx)(n.code,{children:"deelnemers"})," and ",(0,i.jsx)(n.code,{children:"deelnames"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"next-steps",children:"Next Steps"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Resolve Schema Validation Issues"}),": Fix the duplicate schema ID error"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Complete Cascading Tests"}),": Once schema is fixed, test the deelnemers/deelnames relationship"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Verify InversedBy Logic"}),": Ensure proper handling of inversedBy relationships"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Document Test Results"}),": Record successful test scenarios and edge cases"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Update Documentation"}),": Document the new cascading behavior and UI improvements"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"test-commands-for-manual-verification",children:"Test Commands for Manual Verification"}),"\n",(0,i.jsx)(n.p,{children:"Once schema issues are resolved, use these commands:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# Create test organisations\ncurl -u \'admin:admin\' -H \'OCS-APIREQUEST: true\' -H \'Content-Type: application/json\' \\\n  -X POST \'http://localhost/index.php/apps/openregister/api/objects/6/35\' \\\n  -d \'{"naam": "Test Organisatie 1", "website": "https://test1.nl", "type": "Leverancier"}\'\n\n# Create samenwerking with deelnemers\ncurl -u \'admin:admin\' -H \'OCS-APIREQUEST: true\' -H \'Content-Type: application/json\' \\\n  -X POST \'http://localhost/index.php/apps/openregister/api/objects/6/35\' \\\n  -d \'{\n    "naam": "Test Samenwerking",\n    "website": "https://samenwerking.nl", \n    "type": "Samenwerking",\n    "deelnemers": [\n      "uuid-of-org-1",\n      "uuid-of-org-2"\n    ]\n  }\'\n\n# Verify cascading results\ncurl -u \'admin:admin\' -H \'OCS-APIREQUEST: true\' \\\n  \'http://localhost/index.php/apps/openregister/api/objects/6/35/uuid-of-org-1\'\n'})}),"\n",(0,i.jsx)(n.h3,{id:"code-quality-improvements",children:"Code Quality Improvements"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"All new code follows PSR-12 standards"}),"\n",(0,i.jsx)(n.li,{children:"Proper error handling with try-catch blocks"}),"\n",(0,i.jsx)(n.li,{children:"Comprehensive inline documentation"}),"\n",(0,i.jsx)(n.li,{children:"Type hints and return types specified"}),"\n",(0,i.jsx)(n.li,{children:"PHPStan and Psalm compatible annotations"}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>c});var t=s(96540);const i={},r=t.createContext(i);function a(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);