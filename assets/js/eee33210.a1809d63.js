"use strict";(self.webpackChunkopen_catalogi_docs=self.webpackChunkopen_catalogi_docs||[]).push([[7065],{28453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>c});var r=t(96540);const i={},s=r.createContext(i);function a(e){const n=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),r.createElement(s.Provider,{value:n},e.children)}},86116:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>c,default:()=>h,frontMatter:()=>a,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"features/chat-rag-deepdive","title":"Chat RAG (Retrieval Augmented Generation) - Deep Dive","description":"Inhoudsopgave","source":"@site/docs/features/chat-rag-deepdive.md","sourceDirName":"features","slug":"/features/chat-rag-deepdive","permalink":"/docs/features/chat-rag-deepdive","draft":false,"unlisted":false,"editUrl":"https://github.com/conductionnl/openregister/tree/main/website/docs/features/chat-rag-deepdive.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Agents","permalink":"/docs/features/agents"},"next":{"title":"Function Calling (Tools)","permalink":"/docs/features/function-calling"}}');var i=t(74848),s=t(28453);const a={},c="Chat RAG (Retrieval Augmented Generation) - Deep Dive",o={},l=[{value:"Inhoudsopgave",id:"inhoudsopgave",level:2},{value:"Overzicht",id:"overzicht",level:2},{value:"Wat is RAG?",id:"wat-is-rag",level:3},{value:"De Volledige Flow",id:"de-volledige-flow",level:2},{value:"Vector Embeddings: De Basis",id:"vector-embeddings-de-basis",level:2},{value:"Wat is een Embedding?",id:"wat-is-een-embedding",level:3},{value:"Hoe Worden Embeddings Opgeslagen?",id:"hoe-worden-embeddings-opgeslagen",level:3},{value:"Semantic Search",id:"semantic-search",level:2},{value:"Hoe Werkt Semantic Search?",id:"hoe-werkt-semantic-search",level:3},{value:"1. Query Embedding Genereren",id:"1-query-embedding-genereren",level:4},{value:"2. Alle Vectors Ophalen uit Database",id:"2-alle-vectors-ophalen-uit-database",level:4},{value:"3. Cosine Similarity Berekenen",id:"3-cosine-similarity-berekenen",level:4},{value:"4. Sorteren en Top N Teruggeven",id:"4-sorteren-en-top-n-teruggeven",level:4},{value:"RAG in Actie",id:"rag-in-actie",level:2},{value:"ChatService::processMessage()",id:"chatserviceprocessmessage",level:3},{value:"Retrieve Context: De Kern van RAG",id:"retrieve-context-de-kern-van-rag",level:3},{value:"Generate Response: LLM met Context",id:"generate-response-llm-met-context",level:3},{value:"Objecten vs Files",id:"objecten-vs-files",level:2},{value:"Hoe Worden Ze Onderscheiden?",id:"hoe-worden-ze-onderscheiden",level:3},{value:"Frontend Weergave",id:"frontend-weergave",level:2},{value:"ChatIndex.vue: Hoe Sources Worden Getoond",id:"chatindexvue-hoe-sources-worden-getoond",level:3},{value:"Voorbeeld Query",id:"voorbeeld-query",level:2},{value:"Scenario: &#39;Wat is de kleur van Mokkum?&#39;",id:"scenario-wat-is-de-kleur-van-mokkum",level:3},{value:"Performance &amp; Schaalbaarheid",id:"performance--schaalbaarheid",level:2},{value:"Huidige Implementatie",id:"huidige-implementatie",level:3},{value:"Toekomstige Optimalisaties",id:"toekomstige-optimalisaties",level:3},{value:"Debugging &amp; Monitoring",id:"debugging--monitoring",level:2},{value:"Log Statements",id:"log-statements",level:3},{value:"API Testing",id:"api-testing",level:3},{value:"Conclusie",id:"conclusie",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"chat-rag-retrieval-augmented-generation---deep-dive",children:"Chat RAG (Retrieval Augmented Generation) - Deep Dive"})}),"\n",(0,i.jsx)(n.h2,{id:"inhoudsopgave",children:"Inhoudsopgave"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#overzicht",children:"Overzicht"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#de-volledige-flow",children:"De Volledige Flow"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#vector-embeddings-de-basis",children:"Vector Embeddings: De Basis"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#semantic-search",children:"Semantic Search: Hoe Vindt Chat Relevante Informatie?"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#rag-in-actie",children:"RAG in Actie: Van Vraag tot Antwoord"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#objecten-vs-files",children:"Objecten vs Files: Het Verschil"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#frontend-weergave",children:"Frontend Weergave"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#voorbeeld-query",children:"Voorbeeld: 'De kleur van Mokkum is...'"})}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"overzicht",children:"Overzicht"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"OpenRegister's Chat functionaliteit gebruikt RAG (Retrieval Augmented Generation)"})," om contextuele, nauwkeurige antwoorden te geven op basis van jouw eigen data - zowel ",(0,i.jsx)(n.strong,{children:"objecten"})," als ",(0,i.jsx)(n.strong,{children:"documenten"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"wat-is-rag",children:"Wat is RAG?"}),"\n",(0,i.jsx)(n.p,{children:"RAG combineert twee krachtige technieken:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Retrieval"}),": Zoek relevante informatie in jouw data via semantic search"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Generation"}),": Gebruik een LLM om een natuurlijk antwoord te genereren met die context"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Dit voorkomt 'hallucination' (verzonnen antwoorden) en houdt de AI gegrond in jouw echte data."}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"de-volledige-flow",children:"De Volledige Flow"}),"\n",(0,i.jsx)(n.mermaid,{value:"sequenceDiagram\n    participant User\n    participant Frontend as ChatIndex.vue\n    participant Backend as ChatService\n    participant VectorService as VectorEmbeddingService\n    participant LLM as Fireworks AI\n    participant DB as MySQL oc_openregister_vectors\n\n    User->>Frontend: Vraag: 'Wat is de kleur van Mokkum?'\n    Frontend->>Backend: POST /api/conversations/{id}/messages\n    \n    Note over Backend: STAP 1: Retrieve Context\n    Backend->>VectorService: retrieveContext(query, agent)\n    VectorService->>LLM: generateEmbedding(query)\n    LLM--\x3e>VectorService: [0.234, -0.123, 0.567, ...] (768 dims)\n    \n    VectorService->>DB: SELECT * FROM oc_openregister_vectors<br/>WHERE entity_type IN ('object', 'file')\n    DB--\x3e>VectorService: All stored vectors + metadata\n    \n    Note over VectorService: STAP 2: Calculate Similarity\n    VectorService->>VectorService: cosineSimilarity(queryVector, allVectors)\n    Note over VectorService: Loop through all vectors:<br/>- Deserialize embedding<br/>- Calculate dot product<br/>- Sort by similarity DESC\n    \n    VectorService--\x3e>Backend: Top 5 results with:<br/>- entity_id<br/>- entity_type (object/file)<br/>- similarity score<br/>- chunk_text\n    \n    Note over Backend: STAP 3: Build Context\n    Backend->>Backend: Format sources:<br/>Source: Object #123<br/>{chunk_text}<br/><br/>Source: Document ABC<br/>{chunk_text}\n    \n    Note over Backend: STAP 4: Generate Response\n    Backend->>LLM: chat.completions.create()<br/>system: 'You are a helpful assistant'<br/>context: {retrieved_sources}<br/>user: {original_question}\n    LLM--\x3e>Backend: 'De kleur van Mokkum is blauw, zoals...'\n    \n    Backend->>DB: INSERT INTO oc_openregister_messages<br/>(content, sources)\n    Backend--\x3e>Frontend: {message, sources, title}\n    \n    Frontend->>User: Display message + source chips"}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"vector-embeddings-de-basis",children:"Vector Embeddings: De Basis"}),"\n",(0,i.jsx)(n.h3,{id:"wat-is-een-embedding",children:"Wat is een Embedding?"}),"\n",(0,i.jsxs)(n.p,{children:["Een ",(0,i.jsx)(n.strong,{children:"embedding"})," is een ",(0,i.jsx)(n.strong,{children:"numerieke representatie"})," van tekst in een hoog-dimensionale ruimte:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// Input tekst\n$text = 'De kleur van Mokkum is blauw';\n\n// LLM embedding model (Fireworks: thenlper/gte-base)\n$embedding = [\n    0.234,\n    -0.123,\n    0.567,\n    0.891,\n    // ... 768 dimensies totaal\n];\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Waarom embeddings?"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Teksten met ",(0,i.jsx)(n.strong,{children:"vergelijkbare betekenis"})," hebben ",(0,i.jsx)(n.strong,{children:"vergelijkbare vectors"})]}),"\n",(0,i.jsxs)(n.li,{children:["We kunnen ",(0,i.jsx)(n.strong,{children:"wiskundig berekenen"})," hoe 'dichtbij' twee teksten zijn"]}),"\n",(0,i.jsx)(n.li,{children:"Taal-onafhankelijk: 'color' en 'kleur' zijn dichtbij elkaar"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"hoe-worden-embeddings-opgeslagen",children:"Hoe Worden Embeddings Opgeslagen?"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Database tabel:"})," ",(0,i.jsx)(n.code,{children:"oc_openregister_vectors"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE `oc_openregister_vectors` (\n  `id` bigint PRIMARY KEY AUTO_INCREMENT,\n  `entity_type` varchar(50),  -- 'object' of 'file'\n  `entity_id` varchar(255),   -- UUID van object/file\n  `chunk_index` int,          -- Voor files: welk stuk (0 voor objects)\n  `total_chunks` int,         -- Voor files: totaal aantal stukken\n  `chunk_text` longtext,      -- De originele tekst (voor debugging/display)\n  `embedding` longblob,       -- Serialized PHP array met vector\n  `embedding_model` varchar(100),  -- 'thenlper/gte-base'\n  `embedding_dimensions` int, -- 768\n  `metadata` longtext,        -- Extra JSON metadata\n  `created_at` datetime,\n  KEY `entity_idx` (`entity_type`,`entity_id`)\n);\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Voorbeeld rij:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"id: 123\nentity_type: 'object'\nentity_id: 'a1b2c3d4-...'\nchunk_index: 0\nchunk_text: 'Object met naam Mokkum en kleur blauw'\nembedding: (serialized array van 768 floats)\nembedding_model: 'thenlper/gte-base'\nembedding_dimensions: 768\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"semantic-search",children:"Semantic Search"}),"\n",(0,i.jsx)(n.h3,{id:"hoe-werkt-semantic-search",children:"Hoe Werkt Semantic Search?"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Code:"})," ",(0,i.jsx)(n.code,{children:"VectorEmbeddingService::semanticSearch()"})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Stap voor stap:"})}),"\n",(0,i.jsx)(n.h4,{id:"1-query-embedding-genereren",children:"1. Query Embedding Genereren"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// User vraagt: 'Wat is de kleur van Mokkum?'\n$queryEmbeddingData = $this->generateEmbedding($query, $provider);\n$queryEmbedding = $queryEmbeddingData['embedding'];\n// Result: [0.123, -0.456, 0.789, ...] (768 dims)\n"})}),"\n",(0,i.jsx)(n.h4,{id:"2-alle-vectors-ophalen-uit-database",children:"2. Alle Vectors Ophalen uit Database"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$vectors = $this->fetchVectors($filters);\n// Returns: All object + file vectors from oc_openregister_vectors\n"})}),"\n",(0,i.jsx)(n.h4,{id:"3-cosine-similarity-berekenen",children:"3. Cosine Similarity Berekenen"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Cosine Similarity"})," meet de hoek tussen twee vectors:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"1.0"})," = identiek (0\xb0 hoek)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"0.0"})," = geen relatie (90\xb0 hoek)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"-1.0"})," = tegengesteld (180\xb0 hoek)"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"private function cosineSimilarity(array $vector1, array $vector2): float\n{\n    $dotProduct = 0.0;\n    $magnitude1 = 0.0;\n    $magnitude2 = 0.0;\n\n    // Loop through all 768 dimensions\n    for ($i = 0; $i < 768; $i++) {\n        $dotProduct += $vector1[$i] * $vector2[$i];\n        $magnitude1 += $vector1[$i] ** 2;\n        $magnitude2 += $vector2[$i] ** 2;\n    }\n\n    $magnitude1 = sqrt($magnitude1);\n    $magnitude2 = sqrt($magnitude2);\n\n    return $dotProduct / ($magnitude1 * $magnitude2);\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Voor elk vector in de database:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"foreach ($vectors as $vector) {\n    $storedEmbedding = unserialize($vector['embedding']);\n    $similarity = $this->cosineSimilarity($queryEmbedding, $storedEmbedding);\n    \n    $results[] = [\n        'vector_id' => $vector['id'],\n        'entity_type' => $vector['entity_type'],  // 'object' of 'file'\n        'entity_id' => $vector['entity_id'],\n        'similarity' => $similarity,  // 0.0 - 1.0\n        'chunk_text' => $vector['chunk_text'],\n        // ...\n    ];\n}\n"})}),"\n",(0,i.jsx)(n.h4,{id:"4-sorteren-en-top-n-teruggeven",children:"4. Sorteren en Top N Teruggeven"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// Sort descending by similarity\nusort($results, fn($a, $b) => $b['similarity'] <=> $a['similarity']);\n\n// Return top 10 (or whatever limit)\nreturn array_slice($results, 0, $limit);\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Resultaat:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"[\n    [\n        'entity_type' => 'object',\n        'entity_id' => 'a1b2c3d4-...',\n        'similarity' => 0.923,  // Very relevant!\n        'chunk_text' => 'Object met naam Mokkum en kleur blauw',\n    ],\n    [\n        'entity_type' => 'file',\n        'entity_id' => '12',\n        'similarity' => 0.812,\n        'chunk_text' => 'Rapport over Mokkum: De historische stad...',\n    ],\n    // ... more results\n]\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"rag-in-actie",children:"RAG in Actie"}),"\n",(0,i.jsx)(n.h3,{id:"chatserviceprocessmessage",children:"ChatService::processMessage()"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"De volledige conversatie flow:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"public function processMessage(int $conversationId, string $userMessage, string $userId): array\n{\n    // 1. Store user message\n    $userMsgEntity = $this->storeMessage($conversationId, 'user', $userMessage);\n\n    // 2. Get agent configuration (optional)\n    $agent = $this->agentMapper->find($conversation->getAgentId());\n    \n    // Agent bepaalt:\n    // - searchMode: 'semantic', 'hybrid', 'keyword'\n    // - numSources: hoeveel bronnen (default 5)\n    // - searchFiles: true/false\n    // - searchObjects: true/false\n    // - views: filter op specifieke views\n\n    // 3. RETRIEVE CONTEXT using RAG\n    $context = $this->retrieveContext($userMessage, $agent);\n    // Returns:\n    // {\n    //   'text': 'Source: Mokkum\\n{chunk_text}\\n\\nSource: ...',\n    //   'sources': [\n    //     {'id': '...', 'type': 'object', 'name': 'Mokkum', 'similarity': 0.923},\n    //     {'id': '12', 'type': 'file', 'name': 'rapport.pdf', 'similarity': 0.812},\n    //   ]\n    // }\n\n    // 4. Build conversation history\n    $messageHistory = $this->buildMessageHistory($conversationId);\n\n    // 5. GENERATE RESPONSE from LLM\n    $aiResponse = $this->generateResponse(\n        $userMessage,\n        $context,\n        $messageHistory,\n        $agent\n    );\n\n    // 6. Store AI response WITH sources\n    $aiMsgEntity = $this->storeMessage(\n        $conversationId,\n        'assistant',\n        $aiResponse,\n        $context['sources']  // \u2190 Sources worden opgeslagen bij het bericht!\n    );\n\n    return [\n        'message' => $aiMsgEntity->jsonSerialize(),\n        'sources' => $context['sources'],\n        'title' => $conversation->getTitle(),\n    ];\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"retrieve-context-de-kern-van-rag",children:"Retrieve Context: De Kern van RAG"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"private function retrieveContext(string $query, ?Agent $agent): array\n{\n    // Get agent settings\n    $searchMode = $agent?->getRagSearchMode() ?? 'hybrid';\n    $numSources = $agent?->getRagNumSources() ?? 5;\n    $includeFiles = $agent?->getSearchFiles() ?? true;\n    $includeObjects = $agent?->getSearchObjects() ?? true;\n\n    // Perform semantic search\n    $results = $this->vectorService->semanticSearch(\n        $query,\n        $numSources * 2,  // Get more to filter\n        ['entity_type' => ['object', 'file']]\n    );\n\n    $sources = [];\n    $contextText = '';\n\n    foreach ($results as $result) {\n        $isFile = ($result['entity_type'] === 'file');\n        $isObject = ($result['entity_type'] === 'object');\n\n        // Apply type filters\n        if (($isFile && !$includeFiles) || ($isObject && !$includeObjects)) {\n            continue;\n        }\n\n        // Stop if enough sources\n        if (count($sources) >= $numSources) {\n            break;\n        }\n\n        // Build source info\n        $source = [\n            'id' => $result['entity_id'],\n            'type' => $result['entity_type'],\n            'name' => $this->extractSourceName($result),\n            'similarity' => $result['similarity'],\n            'text' => $result['chunk_text'],\n        ];\n\n        $sources[] = $source;\n\n        // Add to context text\n        $contextText .= \"Source: {$source['name']}\\n\";\n        $contextText .= \"{$source['text']}\\n\\n\";\n    }\n\n    return [\n        'text' => $contextText,\n        'sources' => $sources,\n    ];\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"generate-response-llm-met-context",children:"Generate Response: LLM met Context"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"private function generateResponse(\n    string $userMessage,\n    array $context,\n    array $messageHistory,\n    ?Agent $agent\n): string {\n    // Build system prompt\n    $systemPrompt = 'You are a helpful assistant.';\n    if ($agent && $agent->getSystemPrompt()) {\n        $systemPrompt = $agent->getSystemPrompt();\n    }\n\n    // Add context to system message\n    if (!empty($context['text'])) {\n        $systemPrompt .= \"\\n\\nRelevant context:\\n\" . $context['text'];\n    }\n\n    // Build messages array for LLM\n    $messages = [\n        ['role' => 'system', 'content' => $systemPrompt],\n        ...$messageHistory,  // Previous conversation\n        ['role' => 'user', 'content' => $userMessage],\n    ];\n\n    // Call LLM\n    $chat = new OpenAIChat($llphantConfig);\n    $response = $chat->generateChatResponse($messages);\n\n    return $response->content;\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"LLM ziet dus:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"SYSTEM: You are a helpful assistant.\n\nRelevant context:\nSource: Mokkum\nObject met naam Mokkum en kleur blauw en locatie Friesland\n\nSource: rapport.pdf\nRapport over Mokkum: De historische stad met haar blauwe aardewerk...\n\nUSER: Wat is de kleur van Mokkum?\n\nASSISTANT: De kleur van Mokkum is blauw. Dit blijkt zowel uit de object informatie als uit historische documenten over het Mokkumer aardewerk.\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"objecten-vs-files",children:"Objecten vs Files"}),"\n",(0,i.jsx)(n.h3,{id:"hoe-worden-ze-onderscheiden",children:"Hoe Worden Ze Onderscheiden?"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"1. In de Database:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"-- Object vector\nentity_type: 'object'\nentity_id: 'a1b2c3d4-5678-...'  -- UUID\nchunk_index: 0                   -- Altijd 0 voor objects\ntotal_chunks: 1                  -- Altijd 1 voor objects\nchunk_text: 'Object met naam X...'\n\n-- File vector (met chunks)\nentity_type: 'file'\nentity_id: '12'                  -- Nextcloud file ID\nchunk_index: 0                   -- Chunk 0 van 5\ntotal_chunks: 5                  -- Dit document heeft 5 chunks\nchunk_text: 'Dit is het eerste deel...'\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"2. Bij Vectorization:"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Objects"})," (",(0,i.jsx)(n.code,{children:"ObjectVectorizationStrategy"}),"):"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"public function extractVectorizationItems(mixed $entity): array\n{\n    // Objects worden als GEHEEL gevectoriseerd\n    return [[\n        'text' => $this->serializeObject($entity),  // Full JSON representation\n        'index' => 0,\n        'metadata' => [\n            'schema_id' => $entity->getSchema(),\n            'register_id' => $entity->getRegister(),\n            'object_title' => $entity->getTitle() ?? 'Untitled',\n        ],\n    ]];\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Files"})," (",(0,i.jsx)(n.code,{children:"FileVectorizationStrategy"}),"):"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"public function extractVectorizationItems(mixed $entity): array\n{\n    // Files worden GESPLITST in chunks\n    $chunks = $this->textService->extractText($fileId);\n    // Result: [\n    //   ['text' => 'Page 1 content...', 'index' => 0],\n    //   ['text' => 'Page 2 content...', 'index' => 1],\n    //   ['text' => 'Page 3 content...', 'index' => 2],\n    // ]\n    \n    return array_map(fn($chunk, $index) => [\n        'text' => $chunk,\n        'index' => $index,\n        'metadata' => [\n            'file_name' => $entity->getName(),\n            'mime_type' => $entity->getMimeType(),\n            'total_chunks' => count($chunks),\n        ],\n    ], $chunks, array_keys($chunks));\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"3. In Search Results:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// ChatService::retrieveContext()\nforeach ($results as $result) {\n    $isFile = ($result['entity_type'] === 'file');\n    $isObject = ($result['entity_type'] === 'object');\n\n    // Agent kan filteren:\n    if (($isFile && !$includeFiles) || ($isObject && !$includeObjects)) {\n        continue;  // Skip deze source\n    }\n\n    // Source name extraction differs:\n    $sourceName = $isObject \n        ? ($result['metadata']['object_title'] ?? 'Object #' . $result['entity_id'])\n        : ($result['metadata']['file_name'] ?? 'Document #' . $result['entity_id']);\n}\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"frontend-weergave",children:"Frontend Weergave"}),"\n",(0,i.jsx)(n.h3,{id:"chatindexvue-hoe-sources-worden-getoond",children:"ChatIndex.vue: Hoe Sources Worden Getoond"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Template:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-vue",children:'\x3c!-- Voor elk AI bericht --\x3e\n<div class="message assistant">\n    <div class="message-content">\n        \x3c!-- AI response text --\x3e\n        <div class="message-text" v-html="formatMessage(message.content)" />\n\n        \x3c!-- Sources sectie (alleen voor AI messages) --\x3e\n        <div v-if="message.sources && message.sources.length > 0" class="message-sources">\n            <div class="sources-header">\n                <FileDocumentOutline :size="16" />\n                <span>Sources:</span>\n            </div>\n            \n            <div class="sources-list">\n                <div\n                    v-for="(source, sIndex) in message.sources"\n                    :key="sIndex"\n                    class="source-item"\n                    @click="viewSource(source)">\n                    \n                    \x3c!-- Icon gebaseerd op type --\x3e\n                    <div class="source-icon">\n                        <FileDocument v-if="source.type === \'file\'" :size="16" />\n                        <CubeOutline v-else :size="16" />\n                        \x3c!--                    \u2191 = Object icon --\x3e\n                    </div>\n                    \n                    \x3c!-- Source info --\x3e\n                    <div class="source-info">\n                        <div class="source-name">{{ source.name }}</div>\n                        <div class="source-similarity">\n                            {{ Math.round(source.similarity * 100) }}% relevantie\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Visueel:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 \ud83e\udd16 AI Assistant              13:45          \u2502\n\u2502                                             \u2502\n\u2502 De kleur van Mokkum is blauw. Dit blijkt   \u2502\n\u2502 uit zowel de object informatie als...      \u2502\n\u2502                                             \u2502\n\u2502 \ud83d\udcc4 Sources:                                 \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502 \u2502 \ud83e\uddca Mokkum              92% relevantie   \u2502 \u2502  \u2190 Object\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502 \u2502 \ud83d\udcc4 rapport.pdf         81% relevantie   \u2502 \u2502  \u2190 File\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Click Handler:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"methods: {\n    viewSource(source) {\n        if (source.type === 'object') {\n            // Navigate to object detail page\n            this.$router.push({\n                name: 'ObjectDetails',\n                params: { id: source.id }\n            });\n        } else if (source.type === 'file') {\n            // Open file viewer/downloader\n            window.open(\n                generateUrl('/apps/files/?fileid=' + source.id),\n                '_blank'\n            );\n        }\n    }\n}\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"voorbeeld-query",children:"Voorbeeld Query"}),"\n",(0,i.jsx)(n.h3,{id:"scenario-wat-is-de-kleur-van-mokkum",children:"Scenario: 'Wat is de kleur van Mokkum?'"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Stel je hebt dit object:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n    "uuid": "a1b2c3d4-5678-...",\n    "schema": 4,\n    "register": 1,\n    "title": "Mokkum",\n    "summary": "Historische stad",\n    "data": {\n        "naam": "Mokkum",\n        "kleur": "blauw",\n        "locatie": "Friesland",\n        "bekend_van": "aardewerk"\n    }\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Stap 1: Object Vectorization"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// ObjectVectorizationStrategy::serializeObject()\n$text = \"Object met naam Mokkum en kleur blauw en locatie Friesland en bekend_van aardewerk\";\n\n// Send to Fireworks AI\n$embedding = $llm->generateEmbedding($text);\n// Result: [0.234, -0.123, 0.567, ..., 0.891] (768 dims)\n\n// Store in database\nINSERT INTO oc_openregister_vectors (\n    entity_type, entity_id, chunk_text, embedding, ...\n) VALUES (\n    'object', 'a1b2c3d4-...', $text, serialize($embedding), ...\n);\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Stap 2: User Chat Query"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'User: "Wat is de kleur van Mokkum?"\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Stap 3: Query Embedding"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:'$queryEmbedding = $llm->generateEmbedding("Wat is de kleur van Mokkum?");\n// Result: [0.245, -0.115, 0.573, ..., 0.887] (768 dims)\n//          \u2191 Very similar to object embedding!\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Stap 4: Cosine Similarity Calculation"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$similarity = cosineSimilarity(\n    [0.245, -0.115, 0.573, ..., 0.887],  // Query\n    [0.234, -0.123, 0.567, ..., 0.891]   // Object\n);\n// Result: 0.923 (92.3% similarity - zeer relevant!)\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Vergelijk met NIET-relevante vector:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:'// Ander object: "Duurzaamheidsrapport 2023"\n$otherEmbedding = [0.012, 0.834, -0.512, ..., 0.123];\n\n$similarity = cosineSimilarity($queryEmbedding, $otherEmbedding);\n// Result: 0.213 (21.3% - niet relevant)\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Stap 5: Semantic Search Results"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// VectorEmbeddingService::semanticSearch() returns:\n[\n    [\n        'entity_type' => 'object',\n        'entity_id' => 'a1b2c3d4-...',\n        'similarity' => 0.923,  // \u2190 TOP RESULT!\n        'chunk_text' => 'Object met naam Mokkum en kleur blauw...',\n        'metadata' => ['object_title' => 'Mokkum', 'schema_id' => 4],\n    ],\n    [\n        'entity_type' => 'file',\n        'entity_id' => '12',\n        'similarity' => 0.812,\n        'chunk_text' => 'Rapport over Mokkum: De historische stad...',\n    ],\n    // ... lower similarity results\n]\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Stap 6: Build Context"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:'$contextText = "\nSource: Mokkum\nObject met naam Mokkum en kleur blauw en locatie Friesland en bekend_van aardewerk\n\nSource: rapport.pdf\nRapport over Mokkum: De historische stad met haar karakteristieke blauwe aardewerk...\n";\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Stap 7: LLM Prompt"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"SYSTEM: You are a helpful assistant.\n\nRelevant context:\nSource: Mokkum\nObject met naam Mokkum en kleur blauw en locatie Friesland en bekend_van aardewerk\n\nSource: rapport.pdf\nRapport over Mokkum: De historische stad met haar karakteristieke blauwe aardewerk...\n\nUSER: Wat is de kleur van Mokkum?\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Stap 8: LLM Response"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"ASSISTANT: De kleur van Mokkum is blauw. Mokkum, een historische stad in \nFriesland, staat vooral bekend om het karakteristieke blauwe aardewerk dat \ndaar wordt geproduceerd.\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Stap 9: Store Message + Sources"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:'INSERT INTO oc_openregister_messages (\n    conversation_id,\n    role,\n    content,\n    sources  -- JSON met alle source details!\n) VALUES (\n    1,\n    \'assistant\',\n    \'De kleur van Mokkum is blauw...\',\n    \'[{"id":"a1b2c3d4-...","type":"object","name":"Mokkum","similarity":0.923}]\'\n);\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Stap 10: Frontend Display"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 \ud83d\udc64 You                       13:44          \u2502\n\u2502 Wat is de kleur van Mokkum?                \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 \ud83e\udd16 AI Assistant              13:45          \u2502\n\u2502                                             \u2502\n\u2502 De kleur van Mokkum is blauw. Mokkum, een  \u2502\n\u2502 historische stad in Friesland, staat       \u2502\n\u2502 vooral bekend om het karakteristieke       \u2502\n\u2502 blauwe aardewerk dat daar wordt            \u2502\n\u2502 geproduceerd.                              \u2502\n\u2502                                             \u2502\n\u2502 \ud83d\udcc4 Sources:                                 \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502 \u2502 \ud83e\uddca Mokkum              92% relevantie   \u2502 \u2502  \u2190 Click \u2192 Object details\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502 \u2502 \ud83d\udcc4 rapport.pdf         81% relevantie   \u2502 \u2502  \u2190 Click \u2192 Open PDF\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"performance--schaalbaarheid",children:"Performance & Schaalbaarheid"}),"\n",(0,i.jsx)(n.h3,{id:"huidige-implementatie",children:"Huidige Implementatie"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Bottleneck:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// VectorEmbeddingService::semanticSearch()\n$vectors = $this->fetchVectors($filters);  // Haalt ALLE vectors op!\n\nforeach ($vectors as $vector) {\n    $similarity = $this->cosineSimilarity($queryEmbedding, $storedEmbedding);\n    // \u2191 N comparisons (waar N = totaal aantal vectors)\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Performance met jouw dataset:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"961 total vectors (404 objects + 557 files)"}),"\n",(0,i.jsx)(n.li,{children:"Search time: ~50-200ms (afhankelijk van server load)"}),"\n",(0,i.jsx)(n.li,{children:"Memory usage: ~2-5MB per search"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Schaling:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"10,000 vectors: ~500ms"}),"\n",(0,i.jsx)(n.li,{children:"100,000 vectors: ~5s (te langzaam!)"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"toekomstige-optimalisaties",children:"Toekomstige Optimalisaties"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Optie 1: Vector Database (Pinecone, Weaviate, Qdrant)"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Approximate Nearest Neighbor (ANN) search"}),"\n",(0,i.jsx)(n.li,{children:"Sub-millisecond queries op 1M+ vectors"}),"\n",(0,i.jsx)(n.li,{children:"Extra infra nodig"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Optie 2: FAISS (Facebook AI Similarity Search)"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"In-memory index"}),"\n",(0,i.jsx)(n.li,{children:"100x sneller dan brute-force"}),"\n",(0,i.jsx)(n.li,{children:"Kan in PHP via extension"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Optie 3: PostgreSQL pgvector"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Native vector support in Postgres"}),"\n",(0,i.jsx)(n.li,{children:"Geen extra infra"}),"\n",(0,i.jsx)(n.li,{children:"IVFFLAT/HNSW indices voor snelle search"}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"debugging--monitoring",children:"Debugging & Monitoring"}),"\n",(0,i.jsx)(n.h3,{id:"log-statements",children:"Log Statements"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Enable debug logging:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// config.php\n'loglevel' => 0,  // 0 = debug, 1 = info, 2 = warn, etc.\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Kijk in logs:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"docker logs -f master-nextcloud-1 | grep '\\[VectorEmbeddingService\\]'\ndocker logs -f master-nextcloud-1 | grep '\\[ChatService\\]'\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Typische log flow:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'[info] [ChatService] Retrieving context for query: "Wat is de kleur..."\n[info] [VectorEmbeddingService] Performing semantic search, limit=10\n[debug] [VectorEmbeddingService] Step 1: Generating query embedding\n[debug] [VectorEmbeddingService] Step 2: Fetching vectors from database\n[debug] [VectorEmbeddingService] Step 3: Calculating similarities, count=961\n[info] [VectorEmbeddingService] Semantic search completed, results=10, top_similarity=0.923, time=87ms\n[info] [ChatService] Context retrieved, numSources=2, contextLength=342\n'})}),"\n",(0,i.jsx)(n.h3,{id:"api-testing",children:"API Testing"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Test vectorization stats:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"curl -u admin:admin http://localhost/index.php/apps/openregister/api/vectors/stats\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Test semantic search directly:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'curl -u admin:admin -X POST \\\n  http://localhost/index.php/apps/openregister/api/vectors/search \\\n  -H \'Content-Type: application/json\' \\\n  -d \'{"query":"Wat is de kleur van Mokkum?","limit":5}\'\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Test chat conversation:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"curl -u admin:admin -X POST \\\n  http://localhost/index.php/apps/openregister/api/conversations/1/messages \\\n  -H 'Content-Type: application/json' \\\n  -d '{\"message\":\"Wat is de kleur van Mokkum?\"}'\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"conclusie",children:"Conclusie"}),"\n",(0,i.jsxs)(n.p,{children:["De ",(0,i.jsx)(n.strong,{children:"OpenRegister Chat met RAG"})," combineert:"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Vector Embeddings"})," (wiskundige representaties van tekst)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Semantic Search"})," (vind relevante info via cosine similarity)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"LLM Generation"})," (genereer natuurlijke antwoorden met context)"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Result:"})," Een AI assistent die ",(0,i.jsx)(n.strong,{children:"gegrond"})," is in ",(0,i.jsx)(n.strong,{children:"jouw eigen data"}),", zowel ",(0,i.jsx)(n.strong,{children:"gestructureerde objecten"})," als ",(0,i.jsx)(n.strong,{children:"ongestructureerde documenten"}),", met ",(0,i.jsx)(n.strong,{children:"transparante bronvermelding"})," en ",(0,i.jsx)(n.strong,{children:"volledige traceability"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["\ud83c\udfaf ",(0,i.jsx)(n.strong,{children:"Alle antwoorden zijn verifieerbaar via de source chips!"})]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}}}]);