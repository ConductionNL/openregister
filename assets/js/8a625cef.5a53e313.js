"use strict";(self.webpackChunkopen_catalogi_docs=self.webpackChunkopen_catalogi_docs||[]).push([[6211],{28453:(e,n,i)=>{i.d(n,{R:()=>r,x:()=>c});var s=i(96540);const t={},a=s.createContext(t);function r(e){const n=s.useContext(a);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),s.createElement(a.Provider,{value:n},e.children)}},67063:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"technical/unified-faceting-system","title":"Unified Faceting System","description":"Overview","source":"@site/docs/technical/unified-faceting-system.md","sourceDirName":"technical","slug":"/technical/unified-faceting-system","permalink":"/docs/technical/unified-faceting-system","draft":false,"unlisted":false,"editUrl":"https://github.com/conductionnl/openregister/tree/main/website/docs/technical/unified-faceting-system.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"SOLR Setup and Configuration Guide","permalink":"/docs/technical/solr-setup-configuration"},"next":{"title":"Conversations - User Guide","permalink":"/docs/user/ai-conversations"}}');var t=i(74848),a=i(28453);const r={},c="Unified Faceting System",l={},d=[{value:"Overview",id:"overview",level:2},{value:"Key Benefits",id:"key-benefits",level:2},{value:"Two-Stage Architecture",id:"two-stage-architecture",level:2},{value:"Stage 1: Facet Discovery (<code>_facets=true</code>)",id:"stage-1-facet-discovery-_facetstrue",level:3},{value:"Stage 2: Facet Data (<code>_facets[field][type]=...</code>)",id:"stage-2-facet-data-_facetsfieldtype",level:3},{value:"Optional: Combined Mode (<code>_facets=include</code>)",id:"optional-combined-mode-_facetsinclude",level:3},{value:"Implementation Strategy",id:"implementation-strategy",level:2},{value:"SOLR-Native Translation",id:"solr-native-translation",level:3},{value:"Data Source Priority",id:"data-source-priority",level:3},{value:"Field Discovery Method",id:"field-discovery-method",level:3},{value:"Facet Types Supported",id:"facet-types-supported",level:3},{value:"Frontend Integration",id:"frontend-integration",level:2},{value:"SearchSideBar Implementation",id:"searchsidebar-implementation",level:3},{value:"User Experience Flow",id:"user-experience-flow",level:3},{value:"Performance Considerations",id:"performance-considerations",level:2},{value:"Discovery Stage (<code>_facets=true</code>)",id:"discovery-stage-_facetstrue",level:3},{value:"Data Stage (<code>_facets[field]=...</code>)",id:"data-stage-_facetsfield",level:3},{value:"Combined Mode (<code>_facets=include</code>)",id:"combined-mode-_facetsinclude",level:3},{value:"SOLR Advantages",id:"solr-advantages",level:3},{value:"Migration Path",id:"migration-path",level:2},{value:"From Current Systems",id:"from-current-systems",level:3},{value:"API Compatibility",id:"api-compatibility",level:3},{value:"Configuration",id:"configuration",level:2},{value:"Schema Properties",id:"schema-properties",level:3},{value:"System Settings",id:"system-settings",level:3},{value:"Error Handling",id:"error-handling",level:2},{value:"Graceful Degradation",id:"graceful-degradation",level:3},{value:"User Feedback",id:"user-feedback",level:3},{value:"Future Enhancements",id:"future-enhancements",level:2},{value:"Planned Features",id:"planned-features",level:3},{value:"Performance Optimizations",id:"performance-optimizations",level:3}];function o(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"unified-faceting-system",children:"Unified Faceting System"})}),"\n",(0,t.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,t.jsxs)(n.p,{children:["OpenRegister implements a unified two-stage faceting system that leverages SOLR's native faceting capabilities while providing a simplified interface. The system uses schema properties marked with ",(0,t.jsx)(n.code,{children:"facetable: true"})," which are automatically converted to SOLR fields with ",(0,t.jsx)(n.code,{children:"docValues: true"})," for efficient faceting."]}),"\n",(0,t.jsx)(n.h2,{id:"key-benefits",children:"Key Benefits"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"SOLR Native Performance"}),": Uses SOLR's built-in JSON faceting for maximum efficiency"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Schema-Driven"}),": Based on explicit ",(0,t.jsx)(n.code,{children:"facetable: true"})," properties in schemas"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Two-Stage UX"}),": Clear separation between discovery and data loading"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Translation Layer"}),": Converts SOLR responses to OpenRegister's unified format"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Backward Compatible"}),": Works with existing faceting interfaces"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"two-stage-architecture",children:"Two-Stage Architecture"}),"\n",(0,t.jsxs)(n.h3,{id:"stage-1-facet-discovery-_facetstrue",children:["Stage 1: Facet Discovery (",(0,t.jsx)(n.code,{children:"_facets=true"}),")"]}),"\n",(0,t.jsx)(n.p,{children:"Discovers available facetable fields and their characteristics without computing actual counts."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"GET /api/objects/{register}/{schema}?_facets=true&_limit=0\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Response Structure:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "results": [],\n  "total": 0,\n  "facets": {\n    "available": {\n      "@self": {\n        "register": {\n          "type": "categorical",\n          "facet_types": ["terms"],\n          "description": "Register that contains the object"\n        },\n        "created": {\n          "type": "date",\n          "facet_types": ["date_histogram", "range"],\n          "description": "Creation timestamp"\n        }\n      },\n      "object_fields": {\n        "status": {\n          "type": "string",\n          "facet_types": ["terms"],\n          "title": "Status",\n          "source": "schema"\n        },\n        "priority": {\n          "type": "integer", \n          "facet_types": ["range", "terms"],\n          "title": "Priority Level",\n          "source": "schema"\n        }\n      }\n    }\n  }\n}\n'})}),"\n",(0,t.jsxs)(n.h3,{id:"stage-2-facet-data-_facetsfieldtype",children:["Stage 2: Facet Data (",(0,t.jsx)(n.code,{children:"_facets[field][type]=..."}),")"]}),"\n",(0,t.jsx)(n.p,{children:"Retrieves actual facet counts and buckets for specified fields."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"GET /api/objects/{register}/{schema}?_facets[@self][register][type]=terms&_facets[status][type]=terms\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Response Structure:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "results": [...],\n  "total": 150,\n  "facets": {\n    "data": {\n      "@self": {\n        "register": {\n          "type": "terms",\n          "buckets": [\n            {"key": "1", "label": "Publications", "count": 120},\n            {"key": "2", "label": "Events", "count": 30}\n          ]\n        }\n      },\n      "status": {\n        "type": "terms",\n        "buckets": [\n          {"key": "active", "count": 100},\n          {"key": "draft", "count": 35},\n          {"key": "archived", "count": 15}\n        ]\n      }\n    }\n  }\n}\n'})}),"\n",(0,t.jsxs)(n.h3,{id:"optional-combined-mode-_facetsinclude",children:["Optional: Combined Mode (",(0,t.jsx)(n.code,{children:"_facets=include"}),")"]}),"\n",(0,t.jsx)(n.p,{children:"For performance-optimized scenarios, get both discovery and data in one call."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"GET /api/objects/{register}/{schema}?_facets=include\n"})}),"\n",(0,t.jsx)(n.h2,{id:"implementation-strategy",children:"Implementation Strategy"}),"\n",(0,t.jsx)(n.h3,{id:"solr-native-translation",children:"SOLR-Native Translation"}),"\n",(0,t.jsx)(n.p,{children:"The system works by:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Schema Analysis"}),": Reads ",(0,t.jsx)(n.code,{children:"facetable: true"})," properties from schemas"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"SOLR Field Mapping"}),": Uses existing SOLR fields with ",(0,t.jsx)(n.code,{children:"docValues: true"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"JSON Faceting"}),": Leverages SOLR's native ",(0,t.jsx)(n.code,{children:"json.facet"})," parameter"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Response Translation"}),": Converts SOLR format to OpenRegister format"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"data-source-priority",children:"Data Source Priority"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"SOLR"})," (primary) - Native JSON faceting with high performance"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Database"})," (fallback) - SQL-based aggregation for compatibility"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"field-discovery-method",children:"Field Discovery Method"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Schema-based only"})," - Uses fields marked with ",(0,t.jsx)(n.code,{children:"facetable: true"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"No object analysis"})," - Relies on schema definitions for consistency"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"facet-types-supported",children:"Facet Types Supported"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Terms"}),": Categorical data (status, category, etc.)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Date Histogram"}),": Time-based data with intervals"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Range"}),": Numeric data with custom buckets"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"frontend-integration",children:"Frontend Integration"}),"\n",(0,t.jsx)(n.h3,{id:"searchsidebar-implementation",children:"SearchSideBar Implementation"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"// Stage 1: Discover available facets\nconst discovery = await objectStore.getFacetableFields()\n\n// Stage 2: Enable specific facets\nawait objectStore.enableFacets(['@self.register', 'status', 'priority'])\n\n// Optional: Get everything at once\nawait objectStore.getFacetsIncluded()\n"})}),"\n",(0,t.jsx)(n.h3,{id:"user-experience-flow",children:"User Experience Flow"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"User selects register/schema"}),"\n",(0,t.jsx)(n.li,{children:"System discovers available facets (Stage 1)"}),"\n",(0,t.jsx)(n.li,{children:"User enables desired facets via checkboxes"}),"\n",(0,t.jsx)(n.li,{children:"System loads facet data (Stage 2)"}),"\n",(0,t.jsx)(n.li,{children:"User applies facet filters to search results"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"performance-considerations",children:"Performance Considerations"}),"\n",(0,t.jsxs)(n.h3,{id:"discovery-stage-_facetstrue",children:["Discovery Stage (",(0,t.jsx)(n.code,{children:"_facets=true"}),")"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"SOLR"}),": Schema property analysis (~2ms)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Database"}),": Schema property analysis (~2ms)"]}),"\n"]}),"\n",(0,t.jsxs)(n.h3,{id:"data-stage-_facetsfield",children:["Data Stage (",(0,t.jsx)(n.code,{children:"_facets[field]=..."}),")"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"SOLR"}),": Native JSON faceting (~5-10ms per facet)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Database"}),": SQL GROUP BY queries (~15-25ms per facet)"]}),"\n"]}),"\n",(0,t.jsxs)(n.h3,{id:"combined-mode-_facetsinclude",children:["Combined Mode (",(0,t.jsx)(n.code,{children:"_facets=include"}),")"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"SOLR"}),": Single request with JSON faceting (~15ms)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Database"}),": Parallel queries (~35ms)"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"solr-advantages",children:"SOLR Advantages"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Native docValues"}),": Fields created with faceting optimizations"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"JSON Faceting"}),": Modern, efficient aggregation API"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"No Sampling"}),": Uses actual indexed data, not samples"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Concurrent Processing"}),": Multiple facets processed in parallel"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"migration-path",children:"Migration Path"}),"\n",(0,t.jsx)(n.h3,{id:"from-current-systems",children:"From Current Systems"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Schema-based"}),": Continue using ",(0,t.jsx)(n.code,{children:"facetable: true"})," (preferred)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Automatic"}),": Fallback for schemas without facetable properties"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Legacy"}),": Maintain backward compatibility"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"api-compatibility",children:"API Compatibility"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Existing ",(0,t.jsx)(n.code,{children:"_facetable=true"})," parameter maps to new ",(0,t.jsx)(n.code,{children:"_facets=true"})]}),"\n",(0,t.jsx)(n.li,{children:"Existing facet configuration syntax remains supported"}),"\n",(0,t.jsx)(n.li,{children:"New simplified syntax available for common use cases"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,t.jsx)(n.h3,{id:"schema-properties",children:"Schema Properties"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "properties": {\n    "status": {\n      "type": "string",\n      "title": "Status",\n      "facetable": true,\n      "facet_config": {\n        "type": "terms",\n        "sort": "count"\n      }\n    }\n  }\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"system-settings",children:"System Settings"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"// In app config\n'faceting' => [\n    'default_source' => 'solr', // 'solr' or 'database'\n    'discovery_sample_size' => 100,\n    'max_facet_values' => 50,\n    'enable_combined_mode' => true\n]\n"})}),"\n",(0,t.jsx)(n.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,t.jsx)(n.h3,{id:"graceful-degradation",children:"Graceful Degradation"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"SOLR unavailable \u2192 Fall back to database"}),"\n",(0,t.jsx)(n.li,{children:"Schema missing facetable properties \u2192 Use automatic discovery"}),"\n",(0,t.jsx)(n.li,{children:"Discovery fails \u2192 Show basic metadata facets only"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"user-feedback",children:"User Feedback"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Loading states for each stage"}),"\n",(0,t.jsx)(n.li,{children:"Clear error messages"}),"\n",(0,t.jsx)(n.li,{children:"Fallback options when features unavailable"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"future-enhancements",children:"Future Enhancements"}),"\n",(0,t.jsx)(n.h3,{id:"planned-features",children:"Planned Features"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Facet value search/filtering"}),"\n",(0,t.jsx)(n.li,{children:"Saved facet configurations"}),"\n",(0,t.jsx)(n.li,{children:"Custom facet types"}),"\n",(0,t.jsx)(n.li,{children:"Hierarchical facets"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"performance-optimizations",children:"Performance Optimizations"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Facet result caching"}),"\n",(0,t.jsx)(n.li,{children:"Incremental facet loading"}),"\n",(0,t.jsx)(n.li,{children:"Background facet pre-computation"}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}}}]);