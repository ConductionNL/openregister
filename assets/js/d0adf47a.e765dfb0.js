(self.webpackChunkopen_catalogi_docs=self.webpackChunkopen_catalogi_docs||[]).push([[5218],{7411:()=>{},28453:(e,n,i)=>{"use strict";i.d(n,{R:()=>r,x:()=>a});var t=i(96540);const s={},l=t.createContext(s);function r(e){const n=t.useContext(l);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),t.createElement(l.Provider,{value:n},e.children)}},28825:()=>{},45673:(e,n,i)=>{"use strict";i.d(n,{A:()=>x});var t=i(96540),s=i(20053),l=i(44404),r=(i(34345),i(28794)),a=i(54022),c=i(72077);function o(e){const n=(0,c.kh)("docusaurus-plugin-redoc");return e?n?.[e]:Object.values(n??{})?.[0]}var d=i(74848);const h=e=>{let{id:n,example:i,pointer:c,...h}=e;const x=o(n),{store:p}=(0,a.r)(x);return(0,t.useEffect)((()=>{p.menu.dispose()}),[p]),(0,d.jsx)(l.ThemeProvider,{theme:p.options.theme,children:(0,d.jsx)("div",{className:(0,s.A)(["redocusaurus","redocusaurus-schema",i?null:"hide-example"]),children:(0,d.jsx)(r.SchemaDefinition,{parser:p.spec.parser,options:p.options,schemaRef:c,...h})})})};h.defaultProps={example:!1};const x=h},65537:(e,n,i)=>{"use strict";i.d(n,{A:()=>S});var t=i(96540),s=i(18215),l=i(65627),r=i(56347),a=i(50372),c=i(30604),o=i(11861),d=i(78749);function h(e){return t.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,t.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function x(e){const{values:n,children:i}=e;return(0,t.useMemo)((()=>{const e=n??function(e){return h(e).map((e=>{let{props:{value:n,label:i,attributes:t,default:s}}=e;return{value:n,label:i,attributes:t,default:s}}))}(i);return function(e){const n=(0,o.XI)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,i])}function p(e){let{value:n,tabValues:i}=e;return i.some((e=>e.value===n))}function u(e){let{queryString:n=!1,groupId:i}=e;const s=(0,r.W6)(),l=function(e){let{queryString:n=!1,groupId:i}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!i)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return i??null}({queryString:n,groupId:i});return[(0,c.aZ)(l),(0,t.useCallback)((e=>{if(!l)return;const n=new URLSearchParams(s.location.search);n.set(l,e),s.replace({...s.location,search:n.toString()})}),[l,s])]}function j(e){const{defaultValue:n,queryString:i=!1,groupId:s}=e,l=x(e),[r,c]=(0,t.useState)((()=>function(e){let{defaultValue:n,tabValues:i}=e;if(0===i.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!p({value:n,tabValues:i}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${n}" but none of its children has the corresponding value. Available values are: ${i.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return n}const t=i.find((e=>e.default))??i[0];if(!t)throw new Error("Unexpected error: 0 tabValues");return t.value}({defaultValue:n,tabValues:l}))),[o,h]=u({queryString:i,groupId:s}),[j,g]=function(e){let{groupId:n}=e;const i=function(e){return e?`docusaurus.tab.${e}`:null}(n),[s,l]=(0,d.Dv)(i);return[s,(0,t.useCallback)((e=>{i&&l.set(e)}),[i,l])]}({groupId:s}),f=(()=>{const e=o??j;return p({value:e,tabValues:l})?e:null})();(0,a.A)((()=>{f&&c(f)}),[f]);return{selectedValue:r,selectValue:(0,t.useCallback)((e=>{if(!p({value:e,tabValues:l}))throw new Error(`Can't select invalid tab value=${e}`);c(e),h(e),g(e)}),[h,g,l]),tabValues:l}}var g=i(9136);const f={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var m=i(74848);function v(e){let{className:n,block:i,selectedValue:t,selectValue:r,tabValues:a}=e;const c=[],{blockElementScrollPositionUntilNextRender:o}=(0,l.a_)(),d=e=>{const n=e.currentTarget,i=c.indexOf(n),s=a[i].value;s!==t&&(o(n),r(s))},h=e=>{let n=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const i=c.indexOf(e.currentTarget)+1;n=c[i]??c[0];break}case"ArrowLeft":{const i=c.indexOf(e.currentTarget)-1;n=c[i]??c[c.length-1];break}}n?.focus()};return(0,m.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,s.A)("tabs",{"tabs--block":i},n),children:a.map((e=>{let{value:n,label:i,attributes:l}=e;return(0,m.jsx)("li",{role:"tab",tabIndex:t===n?0:-1,"aria-selected":t===n,ref:e=>{c.push(e)},onKeyDown:h,onClick:d,...l,className:(0,s.A)("tabs__item",f.tabItem,l?.className,{"tabs__item--active":t===n}),children:i??n},n)}))})}function b(e){let{lazy:n,children:i,selectedValue:l}=e;const r=(Array.isArray(i)?i:[i]).filter(Boolean);if(n){const e=r.find((e=>e.props.value===l));return e?(0,t.cloneElement)(e,{className:(0,s.A)("margin-top--md",e.props.className)}):null}return(0,m.jsx)("div",{className:"margin-top--md",children:r.map(((e,n)=>(0,t.cloneElement)(e,{key:n,hidden:e.props.value!==l})))})}function y(e){const n=j(e);return(0,m.jsxs)("div",{className:(0,s.A)("tabs-container",f.tabList),children:[(0,m.jsx)(v,{...n,...e}),(0,m.jsx)(b,{...n,...e})]})}function S(e){const n=(0,g.A)();return(0,m.jsx)(y,{...e,children:h(e.children)},String(n))}},67992:()=>{},79329:(e,n,i)=>{"use strict";i.d(n,{A:()=>r});i(96540);var t=i(18215);const s={tabItem:"tabItem_Ymn6"};var l=i(74848);function r(e){let{children:n,hidden:i,className:r}=e;return(0,l.jsx)("div",{role:"tabpanel",className:(0,t.A)(s.tabItem,r),hidden:i,children:n})}},92441:()=>{},93290:()=>{},99604:(e,n,i)=>{"use strict";i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>c,default:()=>x,frontMatter:()=>a,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"Features/files","title":"Files","description":"What are Files in Open Register?","source":"@site/docs/Features/files.md","sourceDirName":"Features","slug":"/Features/files","permalink":"/docs/Features/files","draft":false,"unlisted":false,"editUrl":"https://github.com/conductionnl/openregister/tree/main/website/docs/Features/files.md","tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"title":"Files","sidebar_position":6},"sidebar":"tutorialSidebar","previous":{"title":"Core Features","permalink":"/docs/Features/events"},"next":{"title":"Acces Control","permalink":"/docs/Features/access-control"}}');var s=i(74848),l=i(28453),r=i(45673);i(65537),i(79329);const a={title:"Files",sidebar_position:6},c="Files",o={},d=[{value:"What are Files in Open Register?",id:"what-are-files-in-open-register",level:2},{value:"Attaching Files to Objects",id:"attaching-files-to-objects",level:2},{value:"File Metadata and Tagging",id:"file-metadata-and-tagging",level:2},{value:"Tagging System",id:"tagging-system",level:3},{value:"Version Control",id:"version-control",level:2},{value:"Security and Access Control",id:"security-and-access-control",level:2},{value:"File Operations",id:"file-operations",level:2},{value:"File Preview and Rendering",id:"file-preview-and-rendering",level:2},{value:"Integration with Object Lifecycle",id:"integration-with-object-lifecycle",level:2},{value:"Technical Implementation",id:"technical-implementation",level:2},{value:"File Structure",id:"file-structure",level:2},{value:"How Files are Stored",id:"how-files-are-stored",level:2},{value:"1. Nextcloud Storage",id:"1-nextcloud-storage",level:3},{value:"2. External Storage",id:"2-external-storage",level:3},{value:"3. Database Storage",id:"3-database-storage",level:3},{value:"File Features",id:"file-features",level:2},{value:"1. Versioning",id:"1-versioning",level:3},{value:"2. Access Control",id:"2-access-control",level:3},{value:"3. Metadata",id:"3-metadata",level:3},{value:"4. Preview Generation",id:"4-preview-generation",level:3},{value:"5. Content Extraction",id:"5-content-extraction",level:3},{value:"Technical Implementation",id:"technical-implementation-1",level:3},{value:"Files Management Page",id:"files-management-page",level:2},{value:"Working with Files",id:"working-with-files",level:2},{value:"Uploading Files",id:"uploading-files",level:3},{value:"Retrieving Files",id:"retrieving-files",level:3},{value:"Listing Files for an Object",id:"listing-files-for-an-object",level:3},{value:"Updating Files",id:"updating-files",level:3},{value:"1. Update File Content",id:"1-update-file-content",level:4},{value:"2. Update Metadata Only",id:"2-update-metadata-only",level:4},{value:"Deleting Files",id:"deleting-files",level:3},{value:"File Relationships",id:"file-relationships",level:2},{value:"Files and Objects",id:"files-and-objects",level:3},{value:"Files and Schemas",id:"files-and-schemas",level:3},{value:"Files and Registers",id:"files-and-registers",level:3},{value:"Use Cases",id:"use-cases",level:2},{value:"1. Document Management",id:"1-document-management",level:3},{value:"2. Media Management",id:"2-media-management",level:3},{value:"3. Evidence Collection",id:"3-evidence-collection",level:3},{value:"4. Technical Documentation",id:"4-technical-documentation",level:3},{value:"Advanced File Features",id:"advanced-file-features",level:2},{value:"1. Auto-Share Configuration",id:"1-auto-share-configuration",level:3},{value:"Configuration via UI",id:"configuration-via-ui",level:4},{value:"Configuration via API",id:"configuration-via-api",level:4},{value:"Important: Property-Level vs Schema-Level autoPublish",id:"important-property-level-vs-schema-level-autopublish",level:4},{value:"Example Response",id:"example-response",level:4},{value:"2. Authenticated File Access",id:"2-authenticated-file-access",level:3},{value:"Authenticated URLs",id:"authenticated-urls",level:4},{value:"Example Response (Non-Shared File)",id:"example-response-non-shared-file",level:4},{value:"3. Logo/Image Metadata from File Properties",id:"3-logoimage-metadata-from-file-properties",level:3},{value:"Configuration",id:"configuration",level:4},{value:"Result",id:"result",level:4},{value:"4. File Deletion via API",id:"4-file-deletion-via-api",level:3},{value:"Single File Deletion",id:"single-file-deletion",level:4},{value:"File Array Deletion",id:"file-array-deletion",level:4},{value:"Use Cases",id:"use-cases-1",level:4},{value:"Best Practices",id:"best-practices",level:2},{value:"Conclusion",id:"conclusion",level:2},{value:"Technical Architecture",id:"technical-architecture",level:2},{value:"File Upload and Processing Flow",id:"file-upload-and-processing-flow",level:3},{value:"File Property Processing Pipeline",id:"file-property-processing-pipeline",level:3},{value:"Text Extraction Process",id:"text-extraction-process",level:3},{value:"File Storage Architecture",id:"file-storage-architecture",level:3},{value:"File Type Compatibility Matrix",id:"file-type-compatibility-matrix",level:3},{value:"File Text Extraction Settings",id:"file-text-extraction-settings",level:3},{value:"File Chunking for Solr",id:"file-chunking-for-solr",level:3},{value:"Performance Characteristics",id:"performance-characteristics",level:3},{value:"Code Examples",id:"code-examples",level:3},{value:"Processing File Upload",id:"processing-file-upload",level:4},{value:"Text Extraction",id:"text-extraction",level:4},{value:"Searching File Content",id:"searching-file-content",level:4},{value:"Testing",id:"testing",level:3}];function h(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"files",children:"Files"})}),"\n",(0,s.jsx)(n.h2,{id:"what-are-files-in-open-register",children:"What are Files in Open Register?"}),"\n",(0,s.jsxs)(n.p,{children:["In Open Register, ",(0,s.jsx)(n.strong,{children:"Files"})," are binary data attachments that can be associated with objects. They extend the system beyond structured data to include documents, images, videos, and other file types that are essential for many applications."]}),"\n",(0,s.jsx)(n.p,{children:"Files in Open Register are:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Securely stored and managed"}),"\n",(0,s.jsx)(n.li,{children:"Associated with specific objects"}),"\n",(0,s.jsx)(n.li,{children:"Versioned alongside their parent objects"}),"\n",(0,s.jsx)(n.li,{children:"Accessible through a consistent API"}),"\n",(0,s.jsx)(n.li,{children:"Integrated with Nextcloud's file management capabilities"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"attaching-files-to-objects",children:"Attaching Files to Objects"}),"\n",(0,s.jsx)(n.p,{children:"Files can be attached to objects in several ways:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Schema-defined file properties: When a schema includes properties of type 'file', these are automatically handled during object creation or updates"}),"\n",(0,s.jsx)(n.li,{children:"Direct API attachment: Files can be added to an object after creation using the file attachment API endpoints"}),"\n",(0,s.jsx)(n.li,{children:"Base64 encoded content: Files can be included in object data as base64-encoded strings"}),"\n",(0,s.jsx)(n.li,{children:"URL references: External files can be referenced by URL and will be downloaded and stored locally"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"file-metadata-and-tagging",children:"File Metadata and Tagging"}),"\n",(0,s.jsx)(n.p,{children:"Each file attachment includes rich metadata:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Basic properties (name, size, type, extension)"}),"\n",(0,s.jsx)(n.li,{children:"Creation and modification timestamps"}),"\n",(0,s.jsx)(n.li,{children:"Access and download URLs"}),"\n",(0,s.jsx)(n.li,{children:"Checksum for integrity verification"}),"\n",(0,s.jsx)(n.li,{children:"Custom tags for categorization"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"tagging-system",children:"Tagging System"}),"\n",(0,s.jsx)(n.p,{children:"Files can be tagged with both simple labels and key-value pairs:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Tags with a colon (':') are treated as key-value pairs and can be used for advanced filtering and organization"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"version-control",children:"Version Control"}),"\n",(0,s.jsx)(n.p,{children:"The system maintains file versions by:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Tracking file modifications with timestamps"}),"\n",(0,s.jsx)(n.li,{children:"Preserving checksums to detect changes"}),"\n",(0,s.jsx)(n.li,{children:"Integrating with the object audit trail system"}),"\n",(0,s.jsx)(n.li,{children:"Supporting file restoration from previous versions"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"security-and-access-control",children:"Security and Access Control"}),"\n",(0,s.jsx)(n.p,{children:"File attachments inherit the security model of their parent objects:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Files are stored in NextCloud with appropriate permissions"}),"\n",(0,s.jsx)(n.li,{children:"Share links can be generated for controlled external access"}),"\n",(0,s.jsx)(n.li,{children:"Access is managed through the OpenRegister user and group system"}),"\n",(0,s.jsx)(n.li,{children:"Files are associated with the OpenRegister application user for consistent permissions"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"file-operations",children:"File Operations"}),"\n",(0,s.jsx)(n.p,{children:"The system supports the following operations on file attachments:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Retrieving Files"}),"\n",(0,s.jsx)(n.li,{children:"Updating Files"}),"\n",(0,s.jsx)(n.li,{children:"Deleting Files"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"file-preview-and-rendering",children:"File Preview and Rendering"}),"\n",(0,s.jsx)(n.p,{children:"The system leverages NextCloud's preview capabilities for supported file types:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Images are displayed as thumbnails"}),"\n",(0,s.jsx)(n.li,{children:"PDFs can be previewed in-browser"}),"\n",(0,s.jsx)(n.li,{children:"Office documents can be viewed with compatible apps"}),"\n",(0,s.jsx)(n.li,{children:"Preview URLs are generated for easy embedding"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"integration-with-object-lifecycle",children:"Integration with Object Lifecycle"}),"\n",(0,s.jsx)(n.p,{children:"File attachments are fully integrated with the object lifecycle:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"When objects are created, their file folders are automatically provisioned"}),"\n",(0,s.jsx)(n.li,{children:"When objects are updated, file references are maintained"}),"\n",(0,s.jsx)(n.li,{children:"When objects are deleted, associated files can be optionally preserved or removed"}),"\n",(0,s.jsx)(n.li,{children:"File operations are recorded in the object's audit trail"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"technical-implementation",children:"Technical Implementation"}),"\n",(0,s.jsx)(n.p,{children:"The file attachment system is implemented through two main service classes:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"FileService: Handles low-level file operations, folder management, and NextCloud integration"}),"\n",(0,s.jsx)(n.li,{children:"ObjectService: Provides high-level methods for attaching, retrieving, and managing files in the context of objects"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"These services work together to provide a seamless file management experience within the OpenRegister application."}),"\n",(0,s.jsx)(n.h2,{id:"file-structure",children:"File Structure"}),"\n",(0,s.jsx)(r.A,{id:"open-register",example:!0,pointer:"#/components/schemas/File"}),"\n",(0,s.jsx)(n.h2,{id:"how-files-are-stored",children:"How Files are Stored"}),"\n",(0,s.jsx)(n.p,{children:"Open Register provides flexible storage options for files:"}),"\n",(0,s.jsx)(n.h3,{id:"1-nextcloud-storage",children:"1. Nextcloud Storage"}),"\n",(0,s.jsx)(n.p,{children:"By default, files are stored in Nextcloud's file system, leveraging its robust file management capabilities, including:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Access control"}),"\n",(0,s.jsx)(n.li,{children:"Versioning"}),"\n",(0,s.jsx)(n.li,{children:"Encryption"}),"\n",(0,s.jsx)(n.li,{children:"Collaborative editing"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"2-external-storage",children:"2. External Storage"}),"\n",(0,s.jsx)(n.p,{children:"For larger deployments or specialized needs, files can be stored in:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Object storage systems (S3, MinIO)"}),"\n",(0,s.jsx)(n.li,{children:"Content delivery networks"}),"\n",(0,s.jsx)(n.li,{children:"Specialized document management systems"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"3-database-storage",children:"3. Database Storage"}),"\n",(0,s.jsx)(n.p,{children:"Small files can be stored directly in the database for simplicity and performance."}),"\n",(0,s.jsx)(n.h2,{id:"file-features",children:"File Features"}),"\n",(0,s.jsx)(n.h3,{id:"1-versioning",children:"1. Versioning"}),"\n",(0,s.jsx)(n.p,{children:"Files maintain version history, allowing you to:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Track changes over time"}),"\n",(0,s.jsx)(n.li,{children:"Revert to previous versions"}),"\n",(0,s.jsx)(n.li,{children:"Compare different versions"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"2-access-control",children:"2. Access Control"}),"\n",(0,s.jsx)(n.p,{children:"Files inherit access control from their parent objects, ensuring consistent security:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Users who can access an object can access its files"}),"\n",(0,s.jsx)(n.li,{children:"Additional file-specific permissions can be applied"}),"\n",(0,s.jsx)(n.li,{children:"Permissions can be audited"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"3-metadata",children:"3. Metadata"}),"\n",(0,s.jsx)(n.p,{children:"Files support rich metadata to provide context and improve searchability:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Standard metadata (creation date, size, type)"}),"\n",(0,s.jsx)(n.li,{children:"Custom metadata specific to your application"}),"\n",(0,s.jsx)(n.li,{children:"Extracted metadata (e.g., EXIF data from images)"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"4-preview-generation",children:"4. Preview Generation"}),"\n",(0,s.jsx)(n.p,{children:"Open Register can generate previews for common file types:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Thumbnails for images"}),"\n",(0,s.jsx)(n.li,{children:"PDF previews"}),"\n",(0,s.jsx)(n.li,{children:"Document previews"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"5-content-extraction",children:"5. Content Extraction"}),"\n",(0,s.jsx)(n.p,{children:"For supported file types, content can be extracted for indexing and search:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Text extraction from documents"}),"\n",(0,s.jsx)(n.li,{children:"OCR for scanned documents and images"}),"\n",(0,s.jsx)(n.li,{children:"Metadata extraction"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Asynchronous Processing"}),": Text extraction happens in the background after file upload, ensuring:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Fast uploads"}),": Your file uploads complete instantly without waiting"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Non-blocking"}),": Users don't experience delays during file operations"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Reliable"}),": Background jobs automatically handle retries for failed extractions"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Resource-efficient"}),": Processing happens when resources are available"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Text Extraction Options"}),":"]}),"\n",(0,s.jsx)(n.p,{children:"OpenRegister supports two text extraction engines:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"LLPhant (Default)"})," - PHP-based extraction:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u2713 Native support: TXT, MD, HTML, JSON, XML, CSV"}),"\n",(0,s.jsx)(n.li,{children:"\u25cb Library support: PDF, DOCX, DOC, XLSX, XLS (requires PhpOffice, PdfParser)"}),"\n",(0,s.jsx)(n.li,{children:"\u26a0\ufe0f Limited: PPTX, ODT, RTF"}),"\n",(0,s.jsx)(n.li,{children:"\u2717 No support: Image files (JPG, PNG, GIF, WebP)"}),"\n",(0,s.jsx)(n.li,{children:"Best for: Privacy-conscious environments, regular documents"}),"\n",(0,s.jsx)(n.li,{children:"Cost: Free (included)"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Dolphin AI"})," - Advanced AI-powered extraction:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u2713 All document formats with superior quality"}),"\n",(0,s.jsx)(n.li,{children:"\u2713 OCR for scanned documents and images (JPG, PNG, GIF, WebP)"}),"\n",(0,s.jsx)(n.li,{children:"\u2713 Advanced table extraction"}),"\n",(0,s.jsx)(n.li,{children:"\u2713 Formula recognition"}),"\n",(0,s.jsx)(n.li,{children:"\u2713 Multi-language OCR"}),"\n",(0,s.jsx)(n.li,{children:"Best for: Complex documents, scanned materials, images with text"}),"\n",(0,s.jsx)(n.li,{children:"Cost: API subscription required"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Extraction Scope Options"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"None"}),": Text extraction disabled"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"All files"}),": Extract from all uploaded files"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Files in folders"}),": Extract only from files in specific folders"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Files attached to objects"}),": Extract only from files linked to objects (recommended)"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Typical Processing Times"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Text files: < 1 second"}),"\n",(0,s.jsx)(n.li,{children:"PDFs (LLPhant): 2-10 seconds"}),"\n",(0,s.jsx)(n.li,{children:"PDFs (Dolphin): 3-15 seconds"}),"\n",(0,s.jsx)(n.li,{children:"Large documents or OCR: 10-60 seconds"}),"\n",(0,s.jsx)(n.li,{children:"Images with OCR (Dolphin): 5-20 seconds"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"You can configure text extraction in Settings \u2192 File Configuration. Check extraction status in the file's metadata after upload."}),"\n",(0,s.jsx)(n.h3,{id:"technical-implementation-1",children:"Technical Implementation"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Background Job Processing"}),":"]}),"\n",(0,s.jsx)(n.p,{children:"Text extraction uses Nextcloud's background job system for reliable, async processing:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"File Upload"})," - User uploads a file"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Job Queuing"})," - 'FileChangeListener' automatically queues 'FileTextExtractionJob'"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Job Execution"})," - Background job system processes the file when resources are available"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Text Extraction"})," - Selected extractor (LLPhant or Dolphin) processes the file"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Chunking"})," - Text is automatically split into chunks with overlap (1000 chars per chunk, 200 char overlap)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Storage"})," - Extracted text and chunks stored in 'FileText' entity for reuse"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Completion"})," - Status updated to 'completed' or 'failed'"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Note"}),": Text extraction is now ",(0,s.jsx)(n.strong,{children:"fully independent of SOLR"}),". Chunks are generated during extraction and stored in the database, making them reusable for SOLR indexing, vector embeddings, AI processing, or any other service that needs chunked text."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"File Type Compatibility Matrix"}),":"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"LLPhant Support:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\u2713 ",(0,s.jsx)(n.strong,{children:"Native"})," (TXT, MD, HTML, JSON, XML, CSV) - Perfect quality, very fast"]}),"\n",(0,s.jsxs)(n.li,{children:["\u25cb ",(0,s.jsx)(n.strong,{children:"Library"})," (PDF, DOCX, DOC, XLSX, XLS) - Good quality, medium speed"]}),"\n",(0,s.jsxs)(n.li,{children:["\u26a0\ufe0f ",(0,s.jsx)(n.strong,{children:"Limited"})," (PPTX, ODT, RTF) - Basic text only, use Dolphin for better results"]}),"\n",(0,s.jsxs)(n.li,{children:["\u2717 ",(0,s.jsx)(n.strong,{children:"No Support"})," (JPG, PNG, GIF, WebP) - Requires Dolphin with OCR"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Dolphin AI Support:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u2713 All formats with superior quality"}),"\n",(0,s.jsx)(n.li,{children:"\u2713 OCR for scanned documents and images"}),"\n",(0,s.jsx)(n.li,{children:"\u2713 Table extraction with structure preserved"}),"\n",(0,s.jsx)(n.li,{children:"\u2713 Formula recognition (LaTeX format)"}),"\n",(0,s.jsx)(n.li,{children:"\u2713 Multi-language support"}),"\n",(0,s.jsx)(n.li,{children:"\u2713 Layout understanding (multi-column, etc.)"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"OCR-Specific Use Cases (Dolphin only)"}),":"]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Document Digitization"})," - Scanning paper archives into searchable text"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Receipt Processing"})," - Photo receipts from mobile devices"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Screenshot Analysis"})," - Extract text from application screenshots"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Infographic Text"})," - Extract text from images with embedded text"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Historical Documents"})," - Digitize old scanned materials"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Quality Requirements for OCR"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Minimum: 150 DPI resolution"}),"\n",(0,s.jsx)(n.li,{children:"Recommended: 300+ DPI"}),"\n",(0,s.jsx)(n.li,{children:"Clear, high-contrast images"}),"\n",(0,s.jsx)(n.li,{children:"Minimal blur or distortion"}),"\n",(0,s.jsx)(n.li,{children:"Properly oriented (not rotated)"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Extraction Configuration Options"}),":"]}),"\n",(0,s.jsx)(n.p,{children:"Configure in Settings \u2192 File Configuration:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Text Extractor Selection"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"LLPhant (default) - Local, free, privacy-friendly"}),"\n",(0,s.jsx)(n.li,{children:"Dolphin - Advanced AI, requires API key"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Extraction Scope"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"None - Disabled"}),"\n",(0,s.jsx)(n.li,{children:"All files - Every uploaded file"}),"\n",(0,s.jsx)(n.li,{children:"Files in folders - Specific folders only"}),"\n",(0,s.jsx)(n.li,{children:"Files attached to objects - Only object attachments (recommended)"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Extraction Mode"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Background (default) - Async via background jobs"}),"\n",(0,s.jsx)(n.li,{children:"Immediate - Synchronous during upload (slower)"}),"\n",(0,s.jsx)(n.li,{children:"Manual - Triggered by admin action only"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Enabled File Types"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Select which file extensions to process"}),"\n",(0,s.jsx)(n.li,{children:"Different for LLPhant vs Dolphin"}),"\n",(0,s.jsx)(n.li,{children:"Enable OCR formats (images) only if using Dolphin"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Integration Tests"}),":"]}),"\n",(0,s.jsx)(n.p,{children:"The file text extraction system includes comprehensive integration tests:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Run file extraction tests\nvendor/bin/phpunit tests/Integration/FileTextExtractionIntegrationTest.php\n\n# Test cases covered:\n# - File upload queues background job\n# - Background job execution completes\n# - Text extraction end-to-end with content verification\n# - Multiple file format support (TXT, MD, JSON)\n# - Extraction metadata recording (status, method, timestamps)\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Monitoring Extraction"}),":"]}),"\n",(0,s.jsx)(n.p,{children:"Check extraction status via logs:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Watch extraction progress\ndocker logs -f nextcloud-container | grep FileTextExtractionJob\n\n# Check for errors\ndocker logs nextcloud-container | grep 'extraction failed'\n\n# View extraction statistics\n# Settings \u2192 File Configuration \u2192 Statistics section\n"})}),"\n",(0,s.jsx)(n.h2,{id:"files-management-page",children:"Files Management Page"}),"\n",(0,s.jsx)(n.p,{children:"The Files page provides a centralized view of all files tracked in the text extraction system."}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Accessing the Files Page"}),":"]}),"\n",(0,s.jsxs)(n.p,{children:["Navigate to ",(0,s.jsx)(n.strong,{children:"Files"})," in the main menu to view all files with their extraction status."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Features"}),":"]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"File List Table"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"File name and path"}),"\n",(0,s.jsx)(n.li,{children:"File type and size"}),"\n",(0,s.jsx)(n.li,{children:"Extraction status (Pending, Processing, Completed, Failed)"}),"\n",(0,s.jsx)(n.li,{children:"Number of text chunks created"}),"\n",(0,s.jsx)(n.li,{children:"Last extraction timestamp"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Status Indicators"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\ud83d\udfe0 ",(0,s.jsx)(n.strong,{children:"Pending"}),": File discovered but not yet extracted"]}),"\n",(0,s.jsxs)(n.li,{children:["\ud83d\udd35 ",(0,s.jsx)(n.strong,{children:"Processing"}),": Extraction in progress"]}),"\n",(0,s.jsxs)(n.li,{children:["\ud83d\udfe2 ",(0,s.jsx)(n.strong,{children:"Completed"}),": Successfully extracted"]}),"\n",(0,s.jsxs)(n.li,{children:["\ud83d\udd34 ",(0,s.jsx)(n.strong,{children:"Failed"}),": Extraction error occurred"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"File Actions"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Retry"}),": Re-extract failed files"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"View Error"}),": See detailed error message for failed extractions"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Pagination"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Browse through large file lists (50 files per page)"}),"\n",(0,s.jsx)(n.li,{children:"Navigate between pages"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Refresh"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Update the list to see latest extraction status"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Use Cases"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Monitor extraction progress across all files"}),"\n",(0,s.jsx)(n.li,{children:"Identify and retry failed extractions"}),"\n",(0,s.jsx)(n.li,{children:"View error details for troubleshooting"}),"\n",(0,s.jsx)(n.li,{children:"Verify which files have been processed"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Core File Extraction API"}),":"]}),"\n",(0,s.jsx)(n.p,{children:"OpenRegister provides dedicated API endpoints for file text extraction (moved from settings to core functionality):"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"GET /api/files"})," - List all tracked files with extraction status"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"GET /api/files/{id}"})," - Get single file extraction information"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"POST /api/files/{id}/extract"})," - Extract text from specific file"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"POST /api/files/extract"})," - Extract all pending files (batch processing)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"POST /api/files/retry-failed"})," - Retry all failed extractions"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"GET /api/files/stats"})," - Get extraction statistics"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Smart Re-Extraction"}),":"]}),"\n",(0,s.jsx)(n.p,{children:"The system automatically detects when files need re-extraction by comparing:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"File modification time ('mtime' from Nextcloud's 'oc_filecache')"}),"\n",(0,s.jsx)(n.li,{children:"Last extraction time ('extractedAt' from 'oc_openregister_file_texts')"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"If 'mtime > extractedAt', the file is re-extracted to ensure content is up-to-date."}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"File Tracking Table"}),":"]}),"\n",(0,s.jsx)(n.p,{children:"Extracted text and metadata are stored in 'oc_openregister_file_texts' with:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"'file_id' - Links to Nextcloud's 'oc_filecache' table"}),"\n",(0,s.jsx)(n.li,{children:"'extraction_status' - pending, processing, completed, failed"}),"\n",(0,s.jsx)(n.li,{children:"'extractedAt' - Timestamp of last extraction"}),"\n",(0,s.jsx)(n.li,{children:"'text_content' - Full extracted text"}),"\n",(0,s.jsx)(n.li,{children:"'text_length' - Character count"}),"\n",(0,s.jsx)(n.li,{children:"'chunked' - Whether text has been chunked"}),"\n",(0,s.jsx)(n.li,{children:"'chunk_count' - Number of chunks created"}),"\n",(0,s.jsx)(n.li,{children:"'chunks_json' - JSON array of text chunks with offsets (new in v0.2.7)"}),"\n",(0,s.jsx)(n.li,{children:"'extraction_method' - LLPhant or Dolphin"}),"\n",(0,s.jsx)(n.li,{children:"Plus SOLR indexing and vectorization tracking"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Chunking Details"}),": Each chunk in 'chunks_json' contains the chunk text, start offset, and end offset. This allows for precise text retrieval and consistent chunking across all services."]}),"\n",(0,s.jsx)(n.h2,{id:"working-with-files",children:"Working with Files"}),"\n",(0,s.jsx)(n.h3,{id:"uploading-files",children:"Uploading Files"}),"\n",(0,s.jsx)(n.p,{children:"Files can be uploaded and attached to objects:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'POST /api/objects/{id}/files\nContent-Type: multipart/form-data\n\nfile: [binary data]\nmetadata: {"author": "Legal Department", "securityLevel": "confidential"}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"retrieving-files",children:"Retrieving Files"}),"\n",(0,s.jsx)(n.p,{children:"You can download a file:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"GET /api/files/{id}\n"})}),"\n",(0,s.jsx)(n.p,{children:"Or get file metadata:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"GET /api/files/{id}/metadata\n"})}),"\n",(0,s.jsx)(n.h3,{id:"listing-files-for-an-object",children:"Listing Files for an Object"}),"\n",(0,s.jsx)(n.p,{children:"You can retrieve all files associated with an object:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"GET /api/objects/files/{objectId}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"updating-files",children:"Updating Files"}),"\n",(0,s.jsx)(n.p,{children:"Files can be updated in two ways:"}),"\n",(0,s.jsx)(n.h4,{id:"1-update-file-content",children:"1. Update File Content"}),"\n",(0,s.jsx)(n.p,{children:"Upload a new version of the file:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"PUT /api/objects/{register}/{schema}/{objectId}/files/{fileId}\nContent-Type: application/json\n\n{\n  'content': '[base64 encoded content or raw content]',\n  'tags': ['tag1', 'tag2']\n}\n"})}),"\n",(0,s.jsx)(n.h4,{id:"2-update-metadata-only",children:"2. Update Metadata Only"}),"\n",(0,s.jsx)(n.p,{children:"Update only the file metadata (tags) without changing content:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"PUT /api/objects/{register}/{schema}/{objectId}/files/{fileId}\nContent-Type: application/json\n\n{\n  'tags': ['updated-tag1', 'updated-tag2']\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"Note: The 'content' parameter is optional. If omitted, only the metadata will be updated without modifying the file content itself."}),"\n",(0,s.jsx)(n.h3,{id:"deleting-files",children:"Deleting Files"}),"\n",(0,s.jsx)(n.p,{children:"Files can be deleted when no longer needed:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"DELETE /api/files/{id}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"file-relationships",children:"File Relationships"}),"\n",(0,s.jsx)(n.p,{children:"Files have important relationships with other core concepts:"}),"\n",(0,s.jsx)(n.h3,{id:"files-and-objects",children:"Files and Objects"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Files are attached to objects"}),"\n",(0,s.jsx)(n.li,{children:"An object can have multiple files"}),"\n",(0,s.jsx)(n.li,{children:"Files inherit permissions from their parent object"}),"\n",(0,s.jsx)(n.li,{children:"Files are versioned alongside their parent object"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"files-and-schemas",children:"Files and Schemas"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Schemas can define expectations for file attachments"}),"\n",(0,s.jsx)(n.li,{children:"File validation can be specified in schemas (allowed types, max size)"}),"\n",(0,s.jsx)(n.li,{children:"Schemas can define required file attachments"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"files-and-registers",children:"Files and Registers"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Registers can be configured with different file storage options"}),"\n",(0,s.jsx)(n.li,{children:"File storage policies can be defined at the register level"}),"\n",(0,s.jsx)(n.li,{children:"Registers can have quotas for file storage"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"use-cases",children:"Use Cases"}),"\n",(0,s.jsx)(n.h3,{id:"1-document-management",children:"1. Document Management"}),"\n",(0,s.jsx)(n.p,{children:"Attach important documents to business objects:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Contracts to customer records"}),"\n",(0,s.jsx)(n.li,{children:"Invoices to order records"}),"\n",(0,s.jsx)(n.li,{children:"Specifications to product records"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"2-media-management",children:"2. Media Management"}),"\n",(0,s.jsx)(n.p,{children:"Store and manage media assets:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Product images"}),"\n",(0,s.jsx)(n.li,{children:"Marketing materials"}),"\n",(0,s.jsx)(n.li,{children:"Training videos"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"3-evidence-collection",children:"3. Evidence Collection"}),"\n",(0,s.jsx)(n.p,{children:"Maintain evidence for regulatory or legal purposes:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Compliance documentation"}),"\n",(0,s.jsx)(n.li,{children:"Audit evidence"}),"\n",(0,s.jsx)(n.li,{children:"Legal case files"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"4-technical-documentation",children:"4. Technical Documentation"}),"\n",(0,s.jsx)(n.p,{children:"Manage technical documents:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"User manuals"}),"\n",(0,s.jsx)(n.li,{children:"Technical specifications"}),"\n",(0,s.jsx)(n.li,{children:"Installation guides"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"advanced-file-features",children:"Advanced File Features"}),"\n",(0,s.jsx)(n.h3,{id:"1-auto-share-configuration",children:"1. Auto-Share Configuration"}),"\n",(0,s.jsx)(n.p,{children:"File properties can be configured to automatically share uploaded files publicly. This is useful for assets that need to be accessible without authentication, such as product images or public documents."}),"\n",(0,s.jsx)(n.h4,{id:"configuration-via-ui",children:"Configuration via UI"}),"\n",(0,s.jsx)(n.p,{children:"When editing a schema in the OpenRegister UI:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Select a property with type 'file' or 'array' with items type 'file'"}),"\n",(0,s.jsx)(n.li,{children:"In the property actions menu, expand the 'File Configuration' section"}),"\n",(0,s.jsx)(n.li,{children:"Check the 'Auto-Share Files' checkbox"}),"\n",(0,s.jsx)(n.li,{children:"Save the schema"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Files uploaded to this property will now be automatically publicly shared."}),"\n",(0,s.jsx)(n.h4,{id:"configuration-via-api",children:"Configuration via API"}),"\n",(0,s.jsx)(n.p,{children:"In your schema definition, add the 'autoPublish' option to file properties:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:"{\n  'properties': {\n    'productImage': {\n      'type': 'file',\n      'autoPublish': true,\n      'allowedTypes': ['image/jpeg', 'image/png'],\n      'maxSize': 5242880\n    }\n  }\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"When 'autoPublish' is set to 'true', files uploaded to this property will automatically:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Create a public share link"}),"\n",(0,s.jsx)(n.li,{children:"Set the 'published' timestamp"}),"\n",(0,s.jsx)(n.li,{children:"Generate a public 'accessUrl' and 'downloadUrl'"}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"important-property-level-vs-schema-level-autopublish",children:"Important: Property-Level vs Schema-Level autoPublish"}),"\n",(0,s.jsxs)(n.p,{children:["\u26a0\ufe0f ",(0,s.jsx)(n.strong,{children:"Don't confuse these two different 'autoPublish' settings:"})]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"1. Property-Level autoPublish"})," (this section):"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:"{\n  'properties': {\n    'productImage': {\n      'type': 'file',\n      'autoPublish': true  // \u2190 Controls if FILES are published\n    }\n  }\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"Controls whether files uploaded to this specific property are automatically shared publicly."}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"2. Schema-Level autoPublish"})," (different setting):"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:"{\n  'configuration': {\n    'autoPublish': true  // \u2190 Controls if OBJECTS are published\n  }\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"Controls whether the object entity itself is published (has nothing to do with file sharing)."}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"These are completely separate settings"})," with different purposes. Setting one does NOT affect the other."]}),"\n",(0,s.jsx)(n.h4,{id:"example-response",children:"Example Response"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:"{\n  'id': '12345',\n  'title': 'Product A',\n  'productImage': {\n    'id': 789,\n    'title': 'product-a.jpg',\n    'accessUrl': 'https://your-domain.com/index.php/s/AbCdEfG123',\n    'downloadUrl': 'https://your-domain.com/index.php/s/AbCdEfG123/download',\n    'published': '2024-01-15T10:30:00+00:00',\n    'size': 245678,\n    'type': 'image/jpeg'\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"2-authenticated-file-access",children:"2. Authenticated File Access"}),"\n",(0,s.jsx)(n.p,{children:"Files that are not publicly shared still have 'accessUrl' and 'downloadUrl' properties, but these URLs require authentication. This allows frontend applications to:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Display file previews for logged-in users"}),"\n",(0,s.jsx)(n.li,{children:"Provide download links that work within authenticated sessions"}),"\n",(0,s.jsx)(n.li,{children:"Maintain security while offering convenient access"}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"authenticated-urls",children:"Authenticated URLs"}),"\n",(0,s.jsx)(n.p,{children:"Non-shared files return URLs with the following format:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Access URL"}),": ",(0,s.jsx)(n.code,{children:"/index.php/core/preview?fileId={fileId}&x=1920&y=1080&a=1"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Download URL"}),": ",(0,s.jsx)(n.code,{children:"/index.php/apps/openregister/api/files/{fileId}/download"})]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"These URLs require the user to be authenticated to Nextcloud."}),"\n",(0,s.jsx)(n.h4,{id:"example-response-non-shared-file",children:"Example Response (Non-Shared File)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:"{\n  'attachment': {\n    'id': 456,\n    'title': 'confidential-report.pdf',\n    'accessUrl': 'https://your-domain.com/index.php/core/preview?fileId=456&x=1920&y=1080&a=1',\n    'downloadUrl': 'https://your-domain.com/index.php/apps/openregister/api/files/456/download',\n    'published': null,\n    'size': 1234567,\n    'type': 'application/pdf'\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"3-logoimage-metadata-from-file-properties",children:"3. Logo/Image Metadata from File Properties"}),"\n",(0,s.jsx)(n.p,{children:"When a schema is configured to extract metadata fields like 'image' or 'logo' from file properties, the system automatically extracts the public share URL (or authenticated URL if not shared) and stores it in the object metadata."}),"\n",(0,s.jsx)(n.h4,{id:"configuration",children:"Configuration"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:"{\n  'properties': {\n    'logo': {\n      'type': 'file',\n      'allowedTypes': ['image/png', 'image/jpeg'],\n      'autoPublish': true\n    }\n  },\n  'configuration': {\n    'objectImageField': 'logo'\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h4,{id:"result",children:"Result"}),"\n",(0,s.jsx)(n.p,{children:"The object's '@self.image' field will contain the share URL:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:"{\n  'id': '12345',\n  'title': 'Company A',\n  'logo': {\n    'id': 789,\n    'accessUrl': 'https://your-domain.com/index.php/s/XyZ789',\n    'type': 'image/png'\n  },\n  '@self': {\n    'name': 'Company A',\n    'image': 'https://your-domain.com/index.php/s/XyZ789'\n  }\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"This makes it easy to display company logos, product images, or other visual metadata in listings and search results."}),"\n",(0,s.jsx)(n.h3,{id:"4-file-deletion-via-api",children:"4. File Deletion via API"}),"\n",(0,s.jsx)(n.p,{children:"Files can be deleted by setting the file property to 'null' (for single file properties) or an empty array (for array file properties)."}),"\n",(0,s.jsx)(n.h4,{id:"single-file-deletion",children:"Single File Deletion"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-http",children:"PUT /api/objects/{register}/{schema}/{id}\nContent-Type: application/json\n\n{\n  'title': 'Updated Title',\n  'attachment': null\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"This will:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Delete the file from Nextcloud storage"}),"\n",(0,s.jsx)(n.li,{children:"Remove the file record from the database"}),"\n",(0,s.jsx)(n.li,{children:"Set the 'attachment' property to 'null' in the object data"}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"file-array-deletion",children:"File Array Deletion"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-http",children:"PUT /api/objects/{register}/{schema}/{id}\nContent-Type: application/json\n\n{\n  'title': 'Updated Gallery',\n  'images': []\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"This will:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Delete all files in the array from Nextcloud storage"}),"\n",(0,s.jsx)(n.li,{children:"Remove all file records from the database"}),"\n",(0,s.jsx)(n.li,{children:"Set the 'images' property to an empty array in the object data"}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"use-cases-1",children:"Use Cases"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Privacy Compliance"}),": Remove sensitive files upon user request"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Storage Management"}),": Clean up unused files"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Data Lifecycle"}),": Remove temporary or expired files"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Error Correction"}),": Remove incorrectly uploaded files"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Define File Types"}),": Establish clear guidelines for what file types are allowed"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Set Size Limits"}),": Define appropriate size limits for different file types"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Use Metadata"}),": Add relevant metadata to improve searchability and context"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Consider Storage"}),": Choose appropriate storage backends based on file types and access patterns"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Implement Retention Policies"}),": Define how long files should be kept"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Plan for Backup"}),": Ensure files are included in backup strategies"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Consider Performance"}),": Optimize file storage for your access patterns"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Use Auto-Publish Wisely"}),": Only enable property-level 'autoPublish' for files that should be publicly accessible. Remember: property 'autoPublish' (file sharing) is different from schema 'autoPublish' (object publishing)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Document File Deletion"}),": Maintain audit trails when files are deleted for compliance"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Handle Authentication"}),": Use authenticated URLs for sensitive files"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,s.jsx)(n.p,{children:"Files in Open Register bridge the gap between structured data and unstructured content, providing a comprehensive solution for managing all types of information in your application. With advanced features like auto-sharing, authenticated access, metadata extraction, and flexible deletion options, Open Register creates a unified system where all your data\u2014structured and unstructured\u2014works together seamlessly."}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"technical-architecture",children:"Technical Architecture"}),"\n",(0,s.jsx)(n.p,{children:"This section provides detailed visualization of the file handling system's architecture and data flow."}),"\n",(0,s.jsx)(n.h3,{id:"file-upload-and-processing-flow",children:"File Upload and Processing Flow"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-mermaid",children:"sequenceDiagram\n    participant Client\n    participant API\n    participant ObjectService\n    participant SaveObject\n    participant FileService\n    participant Nextcloud\n    participant DB\n    participant BgJob\n    participant Extractor\n    participant Solr\n    \n    Client->>API: POST /objects with file data\n    API->>ObjectService: saveObject(data)\n    \n    ObjectService->>SaveObject: handle(data, uploadedFiles)\n    \n    Note over SaveObject: 1. Detect file properties\n    SaveObject->>SaveObject: detectFileProperties(schema)\n    \n    Note over SaveObject: 2. Process file data\n    SaveObject->>SaveObject: processFileProperty(fileData)\n    \n    alt Base64 data\n        SaveObject->>SaveObject: decodeBase64()\n    else URL\n        SaveObject->>SaveObject: fetchFromURL()\n    else File object\n        SaveObject->>SaveObject: validateFileObject()\n    end\n    \n    Note over SaveObject: 3. Create file\n    SaveObject->>FileService: createFile(objectEntity, data)\n    \n    FileService->>FileService: determineFolder()\n    FileService->>Nextcloud: createFolder(path)\n    Nextcloud--\x3e>FileService: Folder created\n    \n    FileService->>Nextcloud: writeFile(path, content)\n    Nextcloud--\x3e>FileService: File ID\n    \n    FileService->>FileService: applyAutoTags()\n    FileService->>FileService: createShareLink()\n    \n    FileService--\x3e>SaveObject: File metadata\n    \n    Note over SaveObject: 4. Update object data\n    SaveObject->>SaveObject: replaceFileDataWithIds()\n    \n    SaveObject->>DB: INSERT/UPDATE object\n    DB--\x3e>SaveObject: Object saved\n    \n    SaveObject--\x3e>ObjectService: ObjectEntity\n    ObjectService--\x3e>API: Response\n    API--\x3e>Client: Object with file IDs\n    \n    Note over BgJob: Background Processing\n    Nextcloud->>BgJob: FileChangeListener\n    BgJob->>Extractor: extractText(fileId)\n    \n    alt LLPhant\n        Extractor->>Extractor: extractWithLLPhant()\n    else Dolphin AI\n        Extractor->>Extractor: extractWithDolphin()\n    end\n    \n    Extractor--\x3e>BgJob: Extracted text\n    BgJob->>DB: Store extracted text\n    BgJob->>Solr: Index file chunks\n    Solr--\x3e>BgJob: Indexed\n"})}),"\n",(0,s.jsx)(n.h3,{id:"file-property-processing-pipeline",children:"File Property Processing Pipeline"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-mermaid",children:"graph TD\n    A[Object with File Property] --\x3e B{Property Type}\n    B --\x3e|type=file| C[Single File]\n    B --\x3e|type=array items.type=file| D[Multiple Files]\n    \n    C --\x3e E{Data Type?}\n    D --\x3e E\n    \n    E --\x3e|Base64 String| F[Decode Base64]\n    E --\x3e|URL String| G[Fetch from URL]\n    E --\x3e|File Object| H[Validate File Object]\n    E --\x3e|File ID| I[Load Existing File]\n    \n    F --\x3e J[Validate MIME Type]\n    G --\x3e J\n    H --\x3e J\n    I --\x3e J\n    \n    J --\x3e K{Size Check?}\n    K --\x3e|Too Large| L[Reject Upload]\n    K --\x3e|OK| M[Create File Entity]\n    \n    M --\x3e N[Determine Folder Path]\n    N --\x3e O[/register/schema/object_uuid/]\n    \n    O --\x3e P[Write to Nextcloud]\n    P --\x3e Q[Generate Filename]\n    Q --\x3e R[Apply Auto Tags]\n    \n    R --\x3e S{Auto Publish?}\n    S --\x3e|Yes| T[Create Share Link]\n    S --\x3e|No| U[Skip Sharing]\n    \n    T --\x3e V[Store File Metadata]\n    U --\x3e V\n    \n    V --\x3e W[Return File ID]\n    W --\x3e X[Update Object Data]\n    \n    L --\x3e Y[Return Error]\n    \n    style J fill:#e1f5ff\n    style P fill:#ffe1e1\n    style T fill:#fff4e1\n"})}),"\n",(0,s.jsx)(n.h3,{id:"text-extraction-process",children:"Text Extraction Process"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-mermaid",children:"sequenceDiagram\n    participant NC as Nextcloud\n    participant Listener as FileChangeListener\n    participant Job as FileTextExtractionJob\n    participant Service as FileTextExtractionService\n    participant LLPhant as LLPhant Extractor\n    participant Dolphin as Dolphin AI API\n    participant DB as Database\n    participant Solr as Solr Index\n    \n    Note over NC: File uploaded/modified\n    NC->>Listener: post_create / post_update event\n    \n    Listener->>Listener: Check extraction scope\n    alt Scope matches\n        Listener->>Job: Queue FileTextExtractionJob\n        Job--\x3e>Listener: Job queued\n    else Scope doesn't match\n        Listener->>Listener: Skip extraction\n    end\n    \n    Note over Job: Background job execution\n    Job->>Service: extractText(fileId)\n    \n    Service->>Service: Check extraction mode\n    alt Mode=background\n        Service->>Service: Process immediately\n    else Mode=immediate\n        Service->>Service: Process in request\n    else Mode=manual\n        Service->>Service: Skip until manual trigger\n    end\n    \n    Service->>DB: Get file info\n    DB--\x3e>Service: File metadata\n    \n    Service->>Service: Validate file type\n    \n    alt LLPhant Selected\n        Service->>LLPhant: extract(filePath)\n        \n        alt Native format (TXT, MD, HTML)\n            LLPhant->>LLPhant: Read directly\n        else PDF/DOCX\n            LLPhant->>LLPhant: Use library parser\n        else Image (JPG, PNG)\n            LLPhant->>LLPhant: Not supported\n        end\n        \n        LLPhant--\x3e>Service: Extracted text\n    else Dolphin AI Selected\n        Service->>Dolphin: POST /extract\n        \n        Dolphin->>Dolphin: AI processing\n        alt Document\n            Dolphin->>Dolphin: Text + layout extraction\n        else Image\n            Dolphin->>Dolphin: OCR processing\n        end\n        \n        Dolphin--\x3e>Service: Extracted text + metadata\n    end\n    \n    Service->>Service: Chunk document\n    Service->>DB: Store FileText entity with chunks\n    DB--\x3e>Service: Stored\n    \n    Note over Service: Chunks stored in DB for reuse\n    Note over Service: SOLR indexing is separate\n    \n    Service->>DB: Update status=completed\n    DB--\x3e>Service: Success\n    \n    Service--\x3e>Job: Extraction complete\n"})}),"\n",(0,s.jsx)(n.h3,{id:"file-storage-architecture",children:"File Storage Architecture"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-mermaid",children:"graph TB\n    A[File Upload] --\x3e B[FileService]\n    B --\x3e C{Storage Backend?}\n    \n    C --\x3e|Nextcloud| D[Nextcloud Files API]\n    C --\x3e|S3| E[S3 Compatible Storage]\n    C --\x3e|Database| F[Direct DB Storage]\n    \n    D --\x3e G[Folder Structure]\n    G --\x3e H[/openregister/]\n    H --\x3e I[/register_id/]\n    I --\x3e J[/schema_id/]\n    J --\x3e K[/object_uuid/]\n    K --\x3e L[file_timestamp.ext]\n    \n    E --\x3e M[Bucket Structure]\n    M --\x3e N[openregister/register/schema/object/file]\n    \n    F --\x3e O[file_data BLOB]\n    \n    L --\x3e P[File Metadata]\n    N --\x3e P\n    O --\x3e P\n    \n    P --\x3e Q[(File Registry)]\n    Q --\x3e R[file_id]\n    Q --\x3e S[file_path]\n    Q --\x3e T[share_link]\n    Q --\x3e U[checksum]\n    Q --\x3e V[tags]\n    \n    style B fill:#e1f5ff\n    style Q fill:#ffe1e1\n"})}),"\n",(0,s.jsx)(n.h3,{id:"file-type-compatibility-matrix",children:"File Type Compatibility Matrix"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-mermaid",children:"graph TD\n    A[File Type] --\x3e B{Extraction Engine}\n    \n    B --\x3e|LLPhant| C[LLPhant Support]\n    B --\x3e|Dolphin AI| D[Dolphin Support]\n    \n    C --\x3e E[Native: TXT, MD, HTML, JSON, XML, CSV]\n    C --\x3e F[Library: PDF, DOCX, DOC, XLSX, XLS]\n    C --\x3e G[Limited: PPTX, ODT, RTF]\n    C --\x3e H[Not Supported: Images JPG, PNG, GIF, WebP]\n    \n    D --\x3e I[Full Support: All Documents]\n    D --\x3e J[OCR: Images JPG, PNG, GIF, WebP]\n    D --\x3e K[Advanced: Tables, Formulas]\n    D --\x3e L[Multi-language OCR]\n    \n    E --\x3e M[\u2705 Instant]\n    F --\x3e N[\u2705 2-10s]\n    G --\x3e O[\u26a0\ufe0f May Fail]\n    H --\x3e P[\u274c No Support]\n    \n    I --\x3e Q[\u2705 3-15s]\n    J --\x3e R[\u2705 5-20s OCR]\n    K --\x3e S[\u2705 Superior Quality]\n    L --\x3e T[\u2705 100+ Languages]\n    \n    style C fill:#fff4e1\n    style D fill:#e1ffe1\n"})}),"\n",(0,s.jsx)(n.h3,{id:"file-text-extraction-settings",children:"File Text Extraction Settings"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-mermaid",children:"graph LR\n    A[Settings] --\x3e B{Extraction Engine}\n    B --\x3e|llphant| C[LLPhant Extractor]\n    B --\x3e|dolphin| D[Dolphin AI API]\n    \n    A --\x3e E{Extraction Scope}\n    E --\x3e|none| F[Disabled]\n    E --\x3e|all| G[All Files]\n    E --\x3e|folders| H[Specific Folders]\n    E --\x3e|objects| I[Object Files Only]\n    \n    A --\x3e J{Extraction Mode}\n    J --\x3e|background| K[Async Processing]\n    J --\x3e|immediate| L[Sync Processing]\n    J --\x3e|manual| M[Manual Trigger]\n    \n    C --\x3e N{File Type}\n    D --\x3e N\n    \n    N --\x3e|Supported| O[Extract Text]\n    N --\x3e|Unsupported| P[Skip Extraction]\n    \n    O --\x3e Q[Store in FileText]\n    Q --\x3e R[Index in Solr]\n    \n    style B fill:#e1f5ff\n    style E fill:#fff4e1\n    style J fill:#ffe1e1\n"})}),"\n",(0,s.jsx)(n.h3,{id:"file-chunking-for-solr",children:"File Chunking for Solr"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Note"}),": As of v0.2.7, chunking happens during text extraction, not during SOLR indexing. Chunks are stored in the database and reused."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-mermaid",children:"graph TD\n    A[Text Extraction] --\x3e B[Chunk Document]\n    B --\x3e C{Chunking Strategy}\n    \n    C --\x3e|Recursive Character| D[Smart splitting by paragraphs/sentences]\n    C --\x3e|Fixed Size| E[1000 chars per chunk + 200 overlap]\n    \n    D --\x3e F[Create Chunks]\n    E --\x3e F\n    \n    F --\x3e G[Store in Database]\n    G --\x3e H[chunks_json column]\n    \n    H --\x3e I[Chunk 1: 0-1000]\n    H --\x3e J[Chunk 2: 900-1900]\n    H --\x3e K[Chunk 3: 1800-2800]\n    H --\x3e L[...]\n    \n    subgraph SOLR_Indexing[SOLR Indexing - Reads Pre-Chunked Data]\n        M[Read chunks_json from DB]\n        M --\x3e N[Parse JSON chunks]\n        N --\x3e O[Solr Documents]\n    end\n    \n    I --\x3e M\n    J --\x3e M\n    K --\x3e M\n    L --\x3e M\n    \n    O --\x3e P[Index Fields]\n    P --\x3e Q[file_id]\n    P --\x3e R[chunk_index]\n    P --\x3e S[chunk_text]\n    P --\x3e T[chunk_start_offset]\n    P --\x3e U[chunk_end_offset]\n    \n    Q --\x3e V[(Solr Index)]\n    R --\x3e V\n    S --\x3e V\n    T --\x3e V\n    U --\x3e V\n    \n    style G fill:#e1f5ff\n    style H fill:#ffe1e1\n    style V fill:#e1ffe1\n"})}),"\n",(0,s.jsx)(n.h3,{id:"performance-characteristics",children:"Performance Characteristics"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"File Upload Performance:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Small files (<1MB):      ~100-200ms\nMedium files (1-10MB):   ~500ms-2s\nLarge files (>10MB):     ~2-10s\nVery large (>100MB):     ~10-60s\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Text Extraction Performance:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"LLPhant:\n- TXT/MD/HTML:    <1s    (instant)\n- PDF (10 pages): 2-5s   (library parsing)\n- DOCX:           3-8s   (library parsing)\n- Images:         N/A    (not supported)\n\nDolphin AI:\n- TXT/MD/HTML:    1-2s   (API latency)\n- PDF (10 pages): 5-10s  (AI processing)\n- DOCX:           4-8s   (AI processing)\n- Images (OCR):   5-15s  (OCR + AI)\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Chunking and Indexing:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Text chunking:     <100ms  for 100KB text (now part of extraction)\nSolr indexing:     ~50-200ms per document (reads pre-chunked data)\nBatch indexing:    ~500ms for 100 chunks (faster with pre-chunked data)\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Note"}),": Since v0.2.7, chunking is performed once during text extraction and stored in the database. This makes SOLR indexing faster and allows chunks to be reused for vector embeddings, AI processing, or any other service that needs chunked text."]}),"\n",(0,s.jsx)(n.h3,{id:"code-examples",children:"Code Examples"}),"\n",(0,s.jsx)(n.h4,{id:"processing-file-upload",children:"Processing File Upload"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"use OCA\\OpenRegister\\Service\\FileService;\n\n// Create file from base64\n$fileMetadata = $fileService->createFile(\n    objectEntity: $object,\n    fileData: [\n        'content' => 'data:image/jpeg;base64,/9j/4AAQ...',\n        'tags' => ['profile', 'avatar']\n    ]\n);\n\n// Create file from URL\n$fileMetadata = $fileService->createFile(\n    objectEntity: $object,\n    fileData: [\n        'url' => 'https://example.com/document.pdf',\n        'tags' => ['imported', 'external']\n    ]\n);\n\n// Access file metadata\n$fileId = $fileMetadata['id'];\n$shareLinkUrl = $fileMetadata['accessUrl'];\n$downloadUrl = $fileMetadata['downloadUrl'];\n"})}),"\n",(0,s.jsx)(n.h4,{id:"text-extraction",children:"Text Extraction"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"use OCA\\OpenRegister\\Service\\FileTextExtractionService;\n\n// Extract text from file\n$extractionService->extractText($fileId);\n\n// Get extraction status\n$fileText = $fileTextMapper->findByFileId($fileId);\n$status = $fileText->getExtractionStatus(); // 'pending', 'processing', 'completed', 'failed'\n$text = $fileText->getTextContent();\n\n// Manually trigger extraction\n$extractionService->queueExtraction($fileId);\n"})}),"\n",(0,s.jsx)(n.h4,{id:"searching-file-content",children:"Searching File Content"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// Search across file content in Solr\n$results = $solrService->searchFiles([\n    '_search' => 'contract terms',\n    'mime_type' => 'application/pdf',\n    '_limit' => 20\n]);\n\n// Access chunk results\nforeach ($results['hits'] as $hit) {\n    $fileId = $hit['file_id'];\n    $chunkIndex = $hit['chunk_index'];\n    $text = $hit['chunk_text'];\n    $highlighted = $hit['highlighted_text'];\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"testing",children:"Testing"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Run file handling tests\nvendor/bin/phpunit tests/Service/FileServiceTest.php\n\n# Test text extraction\nvendor/bin/phpunit tests/Service/FileTextExtractionServiceTest.php\n\n# Test specific scenarios\nvendor/bin/phpunit --filter testBase64FileUpload\nvendor/bin/phpunit --filter testTextExtraction\nvendor/bin/phpunit --filter testFileChunking\n\n# Integration tests\nvendor/bin/phpunit tests/Integration/FileIntegrationTest.php\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Test Coverage:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"File upload (base64, URL, file object)"}),"\n",(0,s.jsx)(n.li,{children:"File property processing"}),"\n",(0,s.jsx)(n.li,{children:"Text extraction (LLPhant, Dolphin)"}),"\n",(0,s.jsx)(n.li,{children:"Chunking and Solr indexing"}),"\n",(0,s.jsx)(n.li,{children:"File deletion"}),"\n",(0,s.jsx)(n.li,{children:"Share link generation"}),"\n",(0,s.jsx)(n.li,{children:"Auto-tagging"}),"\n"]})]})}function x(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}}}]);