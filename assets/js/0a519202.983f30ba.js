"use strict";(self.webpackChunkopen_catalogi_docs=self.webpackChunkopen_catalogi_docs||[]).push([[3703],{28453:(e,n,i)=>{i.d(n,{R:()=>a,x:()=>o});var s=i(96540);const t={},r=s.createContext(t);function a(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),s.createElement(r.Provider,{value:n},e.children)}},92952:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>p,frontMatter:()=>a,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"development/api-validation","title":"OpenAPI Specification Validation","description":"This document explains how to validate OpenAPI specifications generated by the OpenRegister application using automated tools.","source":"@site/docs/development/api-validation.md","sourceDirName":"development","slug":"/development/api-validation","permalink":"/docs/development/api-validation","draft":false,"unlisted":false,"editUrl":"https://github.com/conductionnl/openregister/tree/main/website/docs/development/api-validation.md","tags":[],"version":"current","sidebarPosition":65,"frontMatter":{"title":"OpenAPI Specification Validation","sidebar_position":65},"sidebar":"tutorialSidebar","previous":{"title":"Testing Improvements","permalink":"/docs/development/testing"},"next":{"title":"Search and Faceting Optimization","permalink":"/docs/development/search-optimization"}}');var t=i(74848),r=i(28453);const a={title:"OpenAPI Specification Validation",sidebar_position:65},o="OpenAPI Specification (OAS) Validation",l={},c=[{value:"Overview",id:"overview",level:2},{value:"Validation Tool: Spectral",id:"validation-tool-spectral",level:2},{value:"Installation",id:"installation",level:3},{value:"Basic Usage",id:"basic-usage",level:3},{value:"1. Download OAS Specification",id:"1-download-oas-specification",level:4},{value:"2. Validate with Spectral",id:"2-validate-with-spectral",level:4},{value:"Understanding Spectral Output",id:"understanding-spectral-output",level:3},{value:"Automated Testing Integration",id:"automated-testing-integration",level:3},{value:"For Continuous Integration",id:"for-continuous-integration",level:4},{value:"Common OAS Issues and Fixes",id:"common-oas-issues-and-fixes",level:3},{value:"1. Missing Server Information",id:"1-missing-server-information",level:4},{value:"2. Missing Operation Tags",id:"2-missing-operation-tags",level:4},{value:"3. Missing Descriptions",id:"3-missing-descriptions",level:4},{value:"4. Invalid Schema References",id:"4-invalid-schema-references",level:4},{value:"Custom Spectral Rules",id:"custom-spectral-rules",level:3},{value:"Best Practices",id:"best-practices",level:3},{value:"Troubleshooting",id:"troubleshooting",level:3},{value:"Node.js Version Issues",id:"nodejs-version-issues",level:4},{value:"Large OAS Files",id:"large-oas-files",level:4},{value:"Docker Integration",id:"docker-integration",level:4},{value:"Summary",id:"summary",level:2},{value:"Related Documentation",id:"related-documentation",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"openapi-specification-oas-validation",children:"OpenAPI Specification (OAS) Validation"})}),"\n",(0,t.jsx)(n.p,{children:"This document explains how to validate OpenAPI specifications generated by the OpenRegister application using automated tools."}),"\n",(0,t.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,t.jsx)(n.p,{children:"The OpenRegister application generates OpenAPI 3.1.0 specifications for each register, which need to be validated to ensure they conform to OpenAPI standards and follow best practices."}),"\n",(0,t.jsx)(n.h2,{id:"validation-tool-spectral",children:"Validation Tool: Spectral"}),"\n",(0,t.jsxs)(n.p,{children:["We use ",(0,t.jsx)(n.strong,{children:"Spectral"})," by Stoplight, a comprehensive OpenAPI linter that checks for:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"OpenAPI specification compliance"}),"\n",(0,t.jsx)(n.li,{children:"Best practices and conventions"}),"\n",(0,t.jsx)(n.li,{children:"Security considerations"}),"\n",(0,t.jsx)(n.li,{children:"Documentation quality"}),"\n",(0,t.jsx)(n.li,{children:"Schema consistency"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"installation",children:"Installation"}),"\n",(0,t.jsx)(n.p,{children:"Install Spectral CLI globally:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"npm install -g @stoplight/spectral-cli\n"})}),"\n",(0,t.jsx)(n.h3,{id:"basic-usage",children:"Basic Usage"}),"\n",(0,t.jsx)(n.h4,{id:"1-download-oas-specification",children:"1. Download OAS Specification"}),"\n",(0,t.jsx)(n.p,{children:"First, retrieve the OAS specification from your register:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Download OAS for a specific register (replace 15 with your register ID)\ndocker exec -u 33 master-nextcloud-1 bash -c \"curl -s -u 'admin:admin' -H 'Content-Type: application/json' -X GET 'http://localhost/index.php/apps/openregister/api/registers/15/oas'\" > oas-register-15.json\n"})}),"\n",(0,t.jsx)(n.h4,{id:"2-validate-with-spectral",children:"2. Validate with Spectral"}),"\n",(0,t.jsx)(n.p,{children:"Run Spectral validation on the downloaded specification:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Basic validation\nspectral lint oas-register-15.json\n\n# Detailed validation with specific ruleset\nspectral lint oas-register-15.json --ruleset spectral:oas\n\n# JSON output for programmatic processing\nspectral lint oas-register-15.json --format json\n\n# Fail on warnings (useful for CI/CD)\nspectral lint oas-register-15.json --fail-severity warn\n"})}),"\n",(0,t.jsx)(n.h3,{id:"understanding-spectral-output",children:"Understanding Spectral Output"}),"\n",(0,t.jsx)(n.p,{children:"Spectral categorizes issues by severity:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Error"}),": Specification violations that break OpenAPI compliance"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Warning"}),": Best practice violations or potential issues"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Info"}),": Suggestions for improvement"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Hint"}),": Minor style/consistency suggestions"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Example output:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"\u2716 3 problems (1 error, 1 warning, 1 info, 0 hints)\n  1:1  error    oas3-api-servers  OpenAPI 'servers' must be present and non-empty array.\n 12:5  warning  operation-tags    Operation should have non-empty 'tags' array.\n 25:3  info     operation-description  Operation 'description' should be present and non-empty string.\n"})}),"\n",(0,t.jsx)(n.h3,{id:"automated-testing-integration",children:"Automated Testing Integration"}),"\n",(0,t.jsx)(n.h4,{id:"for-continuous-integration",children:"For Continuous Integration"}),"\n",(0,t.jsx)(n.p,{children:"Create a test script that validates all register OAS specifications:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\n# validate-oas.sh\n\necho \'Validating OpenAPI Specifications...\'\n\n# Get list of all registers\nREGISTERS=$(docker exec -u 33 master-nextcloud-1 bash -c "curl -s -u \'admin:admin\' -H \'Content-Type: application/json\' -X GET \'http://localhost/index.php/apps/openregister/api/registers\'" | jq -r \'.results[].id\')\n\nFAILED=0\n\nfor REGISTER_ID in $REGISTERS; do\n    echo "Validating Register $REGISTER_ID..."\n    \n    # Download OAS\n    docker exec -u 33 master-nextcloud-1 bash -c "curl -s -u \'admin:admin\' -H \'Content-Type: application/json\' -X GET \'http://localhost/index.php/apps/openregister/api/registers/$REGISTER_ID/oas\'" > "oas-register-$REGISTER_ID.json"\n    \n    # Validate with Spectral\n    if ! spectral lint "oas-register-$REGISTER_ID.json" --fail-severity error; then\n        echo "\u274c Register $REGISTER_ID OAS validation failed"\n        FAILED=1\n    else\n        echo "\u2705 Register $REGISTER_ID OAS validation passed"\n    fi\n    \n    # Clean up\n    rm "oas-register-$REGISTER_ID.json"\ndone\n\nif [ $FAILED -eq 1 ]; then\n    echo "\ud83d\udca5 OAS validation failed for one or more registers"\n    exit 1\nelse\n    echo "\ud83c\udf89 All OAS specifications are valid!"\nfi\n'})}),"\n",(0,t.jsx)(n.h3,{id:"common-oas-issues-and-fixes",children:"Common OAS Issues and Fixes"}),"\n",(0,t.jsx)(n.h4,{id:"1-missing-server-information",children:"1. Missing Server Information"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Error"}),": ",(0,t.jsx)(n.code,{children:"OpenAPI 'servers' must be present and non-empty array"})]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Fix"}),": Ensure BaseOas.json includes proper server configuration:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "servers": [\n    {\n      "url": "http://localhost/apps/openregister/api",\n      "description": "OpenRegister API Server"\n    }\n  ]\n}\n'})}),"\n",(0,t.jsx)(n.h4,{id:"2-missing-operation-tags",children:"2. Missing Operation Tags"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Warning"}),": ",(0,t.jsx)(n.code,{children:"Operation should have non-empty 'tags' array"})]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Fix"}),": Ensure all operations have tags for proper grouping:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"$operation['tags'] = [$schema->getTitle()];\n"})}),"\n",(0,t.jsx)(n.h4,{id:"3-missing-descriptions",children:"3. Missing Descriptions"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Info"}),": ",(0,t.jsx)(n.code,{children:"Operation 'description' should be present and non-empty string"})]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Fix"}),": Add comprehensive descriptions to all operations:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"$operation['description'] = 'Retrieve a list of all ' . $schema->getTitle() . ' objects';\n"})}),"\n",(0,t.jsx)(n.h4,{id:"4-invalid-schema-references",children:"4. Invalid Schema References"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Error"}),": ",(0,t.jsx)(n.code,{children:"Property '$ref' does not exist"})]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Fix"}),": Ensure all $ref values point to valid schema definitions:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"// Good\n'$ref' => '#/components/schemas/Element'\n\n// Bad  \n'$ref' => '#/components/schemas/NonExistentSchema'\n"})}),"\n",(0,t.jsx)(n.h3,{id:"custom-spectral-rules",children:"Custom Spectral Rules"}),"\n",(0,t.jsx)(n.p,{children:"Create custom validation rules for OpenRegister-specific requirements:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"# .spectral.yml\nextends: 'spectral:oas'\n\nrules:\n  # Ensure all operations have pagination for collections\n  openregister-pagination:\n    given: '$.paths.*[get,post]'\n    then:\n      - field: 'parameters'\n        function: schema\n        functionOptions:\n          schema:\n            type: array\n            contains:\n              properties:\n                name:\n                  enum: ['_limit', '_page', '_offset']\n\n  # Ensure error responses use Error schema\n  openregister-error-schema:\n    given: '$.paths.*.*.responses[4*,5*]'\n    then:\n      - field: 'content.application/json.schema.$ref'\n        function: pattern\n        functionOptions:\n          match: '#/components/schemas/Error'\n"})}),"\n",(0,t.jsx)(n.h3,{id:"best-practices",children:"Best Practices"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Run validation regularly"}),": Include OAS validation in your CI/CD pipeline"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Fix errors first"}),": Address errors before warnings"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Document decisions"}),": Use custom rules to enforce project-specific requirements"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Version control"}),": Store validated OAS files for regression testing"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Monitor changes"}),": Alert on new validation issues when code changes"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,t.jsx)(n.h4,{id:"nodejs-version-issues",children:"Node.js Version Issues"}),"\n",(0,t.jsx)(n.p,{children:"If you encounter Node.js version warnings:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Use Node Version Manager to install compatible version\nnvm install 18\nnvm use 18\nnpm install -g @stoplight/spectral-cli\n"})}),"\n",(0,t.jsx)(n.h4,{id:"large-oas-files",children:"Large OAS Files"}),"\n",(0,t.jsx)(n.p,{children:"For large specifications, increase memory limit:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"node --max-old-space-size=4096 $(which spectral) lint large-oas.json\n"})}),"\n",(0,t.jsx)(n.h4,{id:"docker-integration",children:"Docker Integration"}),"\n",(0,t.jsx)(n.p,{children:"Run Spectral in Docker for consistent environments:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"docker run --rm -v $(pwd):/work stoplight/spectral lint /work/oas-register-15.json\n"})}),"\n",(0,t.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,t.jsx)(n.p,{children:"Using Spectral for OAS validation ensures:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u2705 OpenAPI specification compliance"}),"\n",(0,t.jsx)(n.li,{children:"\u2705 Consistent API documentation quality"}),"\n",(0,t.jsx)(n.li,{children:"\u2705 Early detection of specification issues"}),"\n",(0,t.jsx)(n.li,{children:"\u2705 Automated quality checks in CI/CD"}),"\n",(0,t.jsx)(n.li,{children:"\u2705 Better developer experience with generated SDKs"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Regular validation helps maintain high-quality API documentation that accurately reflects your OpenRegister implementation."}),"\n",(0,t.jsx)(n.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/docs/api/objects",children:"API Reference"})," - API documentation"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/docs/Features/schemas",children:"Schemas"})," - Schema documentation"]}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}}}]);