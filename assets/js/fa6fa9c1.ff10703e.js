"use strict";(self.webpackChunkopen_catalogi_docs=self.webpackChunkopen_catalogi_docs||[]).push([[4130],{28453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>i});var s=t(96540);const o={},r=s.createContext(o);function a(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),s.createElement(r.Provider,{value:n},e.children)}},39566:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>u,frontMatter:()=>a,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"Integrations/custom-webhooks","title":"Custom Webhooks","description":"This guide explains how to build custom webhook consumers for OpenRegister events. Use this if you want to integrate OpenRegister with your own applications or services.","source":"@site/docs/Integrations/custom-webhooks.md","sourceDirName":"Integrations","slug":"/Integrations/custom-webhooks","permalink":"/docs/Integrations/custom-webhooks","draft":false,"unlisted":false,"editUrl":"https://github.com/conductionnl/openregister/tree/main/website/docs/Integrations/custom-webhooks.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Integrations Overview","permalink":"/docs/Integrations/"},"next":{"title":"Dolphin LLM Model Integration","permalink":"/docs/Integrations/dolphin"}}');var o=t(74848),r=t(28453);const a={},i="Custom Webhooks",l={},d=[{value:"Overview",id:"overview",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Webhook Request Structure",id:"webhook-request-structure",level:2},{value:"HTTP Method",id:"http-method",level:3},{value:"Headers",id:"headers",level:3},{value:"Payload Structure",id:"payload-structure",level:3},{value:"Implementation Examples",id:"implementation-examples",level:2},{value:"Python (Flask)",id:"python-flask",level:3},{value:"Node.js (Express)",id:"nodejs-express",level:3},{value:"PHP",id:"php",level:3},{value:"Go",id:"go",level:3},{value:"Registering Your Webhook",id:"registering-your-webhook",level:2},{value:"Security Best Practices",id:"security-best-practices",level:2},{value:"1. Use HTTPS",id:"1-use-https",level:3},{value:"2. Implement Authentication",id:"2-implement-authentication",level:3},{value:"3. Validate Payload",id:"3-validate-payload",level:3},{value:"4. IP Whitelisting",id:"4-ip-whitelisting",level:3},{value:"5. Rate Limiting",id:"5-rate-limiting",level:3},{value:"Error Handling",id:"error-handling",level:2},{value:"Implement Retry Logic",id:"implement-retry-logic",level:3},{value:"Example Error Handling",id:"example-error-handling",level:3},{value:"Testing Your Webhook",id:"testing-your-webhook",level:2},{value:"Manual Testing with curl",id:"manual-testing-with-curl",level:3},{value:"Unit Testing",id:"unit-testing",level:3},{value:"Logging and Monitoring",id:"logging-and-monitoring",level:2},{value:"Structured Logging",id:"structured-logging",level:3},{value:"Monitoring",id:"monitoring",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Webhook Not Received",id:"webhook-not-received",level:3},{value:"Payload Parsing Errors",id:"payload-parsing-errors",level:3},{value:"Authentication Failures",id:"authentication-failures",level:3},{value:"Further Reading",id:"further-reading",level:2},{value:"Support",id:"support",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"custom-webhooks",children:"Custom Webhooks"})}),"\n",(0,o.jsx)(n.p,{children:"This guide explains how to build custom webhook consumers for OpenRegister events. Use this if you want to integrate OpenRegister with your own applications or services."}),"\n",(0,o.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,o.jsxs)(n.p,{children:["OpenRegister uses Nextcloud's ",(0,o.jsx)(n.code,{children:"webhook_listeners"})," app to dispatch HTTP requests when events occur. You can create custom webhook endpoints in any programming language to receive and process these events."]}),"\n",(0,o.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Understanding of HTTP webhooks"}),"\n",(0,o.jsx)(n.li,{children:"Programming language of your choice"}),"\n",(0,o.jsx)(n.li,{children:"Web server or serverless function endpoint"}),"\n",(0,o.jsxs)(n.li,{children:["Nextcloud instance with OpenRegister and ",(0,o.jsx)(n.code,{children:"webhook_listeners"})," app"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"webhook-request-structure",children:"Webhook Request Structure"}),"\n",(0,o.jsx)(n.h3,{id:"http-method",children:"HTTP Method"}),"\n",(0,o.jsx)(n.p,{children:"Webhooks are sent as HTTP POST requests by default, but you can configure GET, PUT, or other methods when registering the webhook."}),"\n",(0,o.jsx)(n.h3,{id:"headers",children:"Headers"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-http",children:"POST /your-webhook-endpoint HTTP/1.1\nHost: your-domain.com\nContent-Type: application/json\nUser-Agent: Nextcloud-Webhook\n"})}),"\n",(0,o.jsx)(n.h3,{id:"payload-structure",children:"Payload Structure"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\n  "event": "OCA\\\\OpenRegister\\\\Event\\\\ObjectCreatedEvent",\n  "data": {\n    "object": {\n      "id": 123,\n      "uuid": "550e8400-e29b-41d4-a716-446655440000",\n      "register": "my-register",\n      "schema": "my-schema",\n      "data": {\n        "title": "Example Object",\n        "description": "Object description",\n        "custom_field": "value"\n      },\n      "organisation": "org-uuid",\n      "created": "2024-01-15T10:30:00+00:00",\n      "updated": "2024-01-15T10:30:00+00:00"\n    }\n  }\n}\n'})}),"\n",(0,o.jsx)(n.p,{children:"For update events:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\n  "event": "OCA\\\\OpenRegister\\\\Event\\\\ObjectUpdatedEvent",\n  "data": {\n    "newObject": { /* updated object */ },\n    "oldObject": { /* previous state */ }\n  }\n}\n'})}),"\n",(0,o.jsx)(n.h2,{id:"implementation-examples",children:"Implementation Examples"}),"\n",(0,o.jsx)(n.h3,{id:"python-flask",children:"Python (Flask)"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:"from flask import Flask, request, jsonify\nimport logging\n\napp = Flask(__name__)\nlogging.basicConfig(level=logging.INFO)\n\n@app.route('/openregister-webhook', methods=['POST'])\ndef handle_webhook():\n    '''Handle OpenRegister webhook events.'''\n    try:\n        # Parse incoming webhook payload.\n        payload = request.json\n        event_type = payload.get('event', '')\n        data = payload.get('data', {})\n        \n        # Log event.\n        logging.info(f\"Received event: {event_type}\")\n        \n        # Process based on event type.\n        if 'ObjectCreatedEvent' in event_type:\n            result = process_object_created(data)\n        elif 'ObjectUpdatedEvent' in event_type:\n            result = process_object_updated(data)\n        elif 'ObjectDeletedEvent' in event_type:\n            result = process_object_deleted(data)\n        else:\n            result = {'status': 'ignored', 'event': event_type}\n        \n        return jsonify(result), 200\n        \n    except Exception as e:\n        logging.error(f\"Error processing webhook: {str(e)}\")\n        return jsonify({'error': str(e)}), 500\n\ndef process_object_created(data):\n    '''Process object creation event.'''\n    object_data = data.get('object', {})\n    \n    # Your custom logic here.\n    print(f\"New object: {object_data.get('uuid')}\")\n    print(f\"Register: {object_data.get('register')}\")\n    print(f\"Data: {object_data.get('data')}\")\n    \n    # Example: Save to database, send notification, etc.\n    \n    return {'status': 'success', 'processed': object_data.get('uuid')}\n\ndef process_object_updated(data):\n    '''Process object update event.'''\n    new_object = data.get('newObject', {})\n    old_object = data.get('oldObject', {})\n    \n    # Detect changes.\n    changes = detect_changes(old_object, new_object)\n    \n    print(f\"Object {new_object.get('uuid')} updated\")\n    print(f\"Changes: {changes}\")\n    \n    return {'status': 'success', 'changes': len(changes)}\n\ndef process_object_deleted(data):\n    '''Process object deletion event.'''\n    object_data = data.get('object', {})\n    \n    print(f\"Object deleted: {object_data.get('uuid')}\")\n    \n    # Cleanup logic here.\n    \n    return {'status': 'success', 'deleted': object_data.get('uuid')}\n\ndef detect_changes(old_obj, new_obj):\n    '''Detect changes between old and new object states.'''\n    changes = []\n    \n    old_data = old_obj.get('data', {})\n    new_data = new_obj.get('data', {})\n    \n    # Compare data fields.\n    for key in new_data:\n        if key not in old_data or old_data[key] != new_data[key]:\n            changes.append({\n                'field': key,\n                'old_value': old_data.get(key),\n                'new_value': new_data[key]\n            })\n    \n    return changes\n\nif __name__ == '__main__':\n    app.run(host='0.0.0.0', port=5000)\n"})}),"\n",(0,o.jsx)(n.h3,{id:"nodejs-express",children:"Node.js (Express)"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-javascript",children:"const express = require('express');\nconst app = express();\n\napp.use(express.json());\n\napp.post('/openregister-webhook', async (req, res) => {\n  try {\n    const { event, data } = req.body;\n    \n    console.log(`Received event: ${event}`);\n    \n    let result;\n    \n    if (event.includes('ObjectCreatedEvent')) {\n      result = await processObjectCreated(data);\n    } else if (event.includes('ObjectUpdatedEvent')) {\n      result = await processObjectUpdated(data);\n    } else if (event.includes('ObjectDeletedEvent')) {\n      result = await processObjectDeleted(data);\n    } else {\n      result = { status: 'ignored', event };\n    }\n    \n    res.json(result);\n  } catch (error) {\n    console.error('Error processing webhook:', error);\n    res.status(500).json({ error: error.message });\n  }\n});\n\nasync function processObjectCreated(data) {\n  const object = data.object || {};\n  \n  console.log(`New object: ${object.uuid}`);\n  console.log(`Register: ${object.register}`);\n  console.log(`Data:`, object.data);\n  \n  // Your custom logic here.\n  // - Save to database.\n  // - Send notification.\n  // - Trigger workflow.\n  \n  return { status: 'success', processed: object.uuid };\n}\n\nasync function processObjectUpdated(data) {\n  const newObject = data.newObject || {};\n  const oldObject = data.oldObject || {};\n  \n  const changes = detectChanges(oldObject, newObject);\n  \n  console.log(`Object ${newObject.uuid} updated`);\n  console.log(`Changes:`, changes);\n  \n  return { status: 'success', changes: changes.length };\n}\n\nasync function processObjectDeleted(data) {\n  const object = data.object || {};\n  \n  console.log(`Object deleted: ${object.uuid}`);\n  \n  // Cleanup logic here.\n  \n  return { status: 'success', deleted: object.uuid };\n}\n\nfunction detectChanges(oldObj, newObj) {\n  const changes = [];\n  const oldData = oldObj.data || {};\n  const newData = newObj.data || {};\n  \n  for (const key in newData) {\n    if (!(key in oldData) || oldData[key] !== newData[key]) {\n      changes.push({\n        field: key,\n        oldValue: oldData[key],\n        newValue: newData[key]\n      });\n    }\n  }\n  \n  return changes;\n}\n\nconst PORT = process.env.PORT || 3000;\napp.listen(PORT, () => {\n  console.log(`Webhook server listening on port ${PORT}`);\n});\n"})}),"\n",(0,o.jsx)(n.h3,{id:"php",children:"PHP"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-php",children:"<?php\n/**\n * OpenRegister Custom Webhook Handler\n */\n\n// Get the raw POST body.\n$payload = json_decode(file_get_contents('php://input'), true);\n\n// Log incoming webhook.\nerror_log('Received OpenRegister webhook: ' . json_encode($payload));\n\ntry {\n    $event = $payload['event'] ?? 'unknown';\n    $data = $payload['data'] ?? [];\n    \n    // Process based on event type.\n    if (strpos($event, 'ObjectCreatedEvent') !== false) {\n        $result = processObjectCreated($data);\n    } elseif (strpos($event, 'ObjectUpdatedEvent') !== false) {\n        $result = processObjectUpdated($data);\n    } elseif (strpos($event, 'ObjectDeletedEvent') !== false) {\n        $result = processObjectDeleted($data);\n    } else {\n        $result = ['status' => 'ignored', 'event' => $event];\n    }\n    \n    // Return JSON response.\n    header('Content-Type: application/json');\n    echo json_encode($result);\n    http_response_code(200);\n    \n} catch (Exception $e) {\n    error_log('Error processing webhook: ' . $e->getMessage());\n    header('Content-Type: application/json');\n    echo json_encode(['error' => $e->getMessage()]);\n    http_response_code(500);\n}\n\nfunction processObjectCreated(array $data): array\n{\n    $object = $data['object'] ?? [];\n    \n    error_log('New object: ' . ($object['uuid'] ?? 'unknown'));\n    error_log('Register: ' . ($object['register'] ?? 'unknown'));\n    \n    // Your custom logic here.\n    // - Save to database.\n    // - Send notification.\n    // - Trigger workflow.\n    \n    return [\n        'status' => 'success',\n        'processed' => $object['uuid'] ?? null\n    ];\n}\n\nfunction processObjectUpdated(array $data): array\n{\n    $newObject = $data['newObject'] ?? [];\n    $oldObject = $data['oldObject'] ?? [];\n    \n    $changes = detectChanges($oldObject, $newObject);\n    \n    error_log('Object updated: ' . ($newObject['uuid'] ?? 'unknown'));\n    error_log('Changes: ' . count($changes));\n    \n    return [\n        'status' => 'success',\n        'changes' => count($changes)\n    ];\n}\n\nfunction processObjectDeleted(array $data): array\n{\n    $object = $data['object'] ?? [];\n    \n    error_log('Object deleted: ' . ($object['uuid'] ?? 'unknown'));\n    \n    // Cleanup logic here.\n    \n    return [\n        'status' => 'success',\n        'deleted' => $object['uuid'] ?? null\n    ];\n}\n\nfunction detectChanges(array $oldObj, array $newObj): array\n{\n    $changes = [];\n    $oldData = $oldObj['data'] ?? [];\n    $newData = $newObj['data'] ?? [];\n    \n    foreach ($newData as $key => $value) {\n        if (!isset($oldData[$key]) || $oldData[$key] !== $value) {\n            $changes[] = [\n                'field' => $key,\n                'old_value' => $oldData[$key] ?? null,\n                'new_value' => $value\n            ];\n        }\n    }\n    \n    return $changes;\n}\n"})}),"\n",(0,o.jsx)(n.h3,{id:"go",children:"Go"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:'package main\n\nimport (\n    "encoding/json"\n    "fmt"\n    "log"\n    "net/http"\n)\n\ntype WebhookPayload struct {\n    Event string                 `json:"event"`\n    Data  map[string]interface{} `json:"data"`\n}\n\ntype WebhookResponse struct {\n    Status  string `json:"status"`\n    Message string `json:"message"`\n}\n\nfunc handleWebhook(w http.ResponseWriter, r *http.Request) {\n    // Parse incoming webhook payload.\n    var payload WebhookPayload\n    err := json.NewDecoder(r.Body).Decode(&payload)\n    if err != nil {\n        log.Printf("Error decoding payload: %v", err)\n        http.Error(w, err.Error(), http.StatusBadRequest)\n        return\n    }\n    \n    log.Printf("Received event: %s", payload.Event)\n    \n    var response WebhookResponse\n    \n    // Process based on event type.\n    switch {\n    case contains(payload.Event, "ObjectCreatedEvent"):\n        response = processObjectCreated(payload.Data)\n    case contains(payload.Event, "ObjectUpdatedEvent"):\n        response = processObjectUpdated(payload.Data)\n    case contains(payload.Event, "ObjectDeletedEvent"):\n        response = processObjectDeleted(payload.Data)\n    default:\n        response = WebhookResponse{\n            Status:  "ignored",\n            Message: "Event type not handled",\n        }\n    }\n    \n    // Return JSON response.\n    w.Header().Set("Content-Type", "application/json")\n    json.NewEncoder(w).Encode(response)\n}\n\nfunc processObjectCreated(data map[string]interface{}) WebhookResponse {\n    object := data["object"].(map[string]interface{})\n    \n    uuid := object["uuid"].(string)\n    register := object["register"].(string)\n    \n    log.Printf("New object: %s in register: %s", uuid, register)\n    \n    // Your custom logic here.\n    \n    return WebhookResponse{\n        Status:  "success",\n        Message: fmt.Sprintf("Processed object %s", uuid),\n    }\n}\n\nfunc processObjectUpdated(data map[string]interface{}) WebhookResponse {\n    newObject := data["newObject"].(map[string]interface{})\n    uuid := newObject["uuid"].(string)\n    \n    log.Printf("Object updated: %s", uuid)\n    \n    return WebhookResponse{\n        Status:  "success",\n        Message: fmt.Sprintf("Processed update for %s", uuid),\n    }\n}\n\nfunc processObjectDeleted(data map[string]interface{}) WebhookResponse {\n    object := data["object"].(map[string]interface{})\n    uuid := object["uuid"].(string)\n    \n    log.Printf("Object deleted: %s", uuid)\n    \n    return WebhookResponse{\n        Status:  "success",\n        Message: fmt.Sprintf("Processed deletion of %s", uuid),\n    }\n}\n\nfunc contains(str, substr string) bool {\n    return len(str) >= len(substr) && (str == substr || len(str) > len(substr) && \n        (str[0:len(substr)] == substr || str[len(str)-len(substr):] == substr))\n}\n\nfunc main() {\n    http.HandleFunc("/openregister-webhook", handleWebhook)\n    \n    port := ":8080"\n    log.Printf("Webhook server listening on port %s", port)\n    log.Fatal(http.ListenAndServe(port, nil))\n}\n'})}),"\n",(0,o.jsx)(n.h2,{id:"registering-your-webhook",children:"Registering Your Webhook"}),"\n",(0,o.jsx)(n.p,{children:"Once your endpoint is ready, register it with Nextcloud:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'curl -X POST http://<nextcloud-host>/ocs/v2.php/apps/webhook_listeners/api/v1/webhooks \\\n  -H "OCS-APIRequest: true" \\\n  -u "admin:admin" \\\n  -H "Content-Type: application/json" \\\n  -d \'{\n    "httpMethod": "POST",\n    "uri": "https://your-domain.com/openregister-webhook",\n    "event": "OCA\\\\OpenRegister\\\\Event\\\\ObjectCreatedEvent",\n    "eventFilter": []\n  }\'\n'})}),"\n",(0,o.jsx)(n.h2,{id:"security-best-practices",children:"Security Best Practices"}),"\n",(0,o.jsx)(n.h3,{id:"1-use-https",children:"1. Use HTTPS"}),"\n",(0,o.jsx)(n.p,{children:"Always use HTTPS endpoints to protect data in transit:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'# Good.\n"uri": "https://your-domain.com/webhook"\n\n# Bad.\n"uri": "http://your-domain.com/webhook"\n'})}),"\n",(0,o.jsx)(n.h3,{id:"2-implement-authentication",children:"2. Implement Authentication"}),"\n",(0,o.jsx)(n.p,{children:"Add authentication to your webhook endpoint:"}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Shared Secret (HMAC)"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:"import hmac\nimport hashlib\n\nSECRET_KEY = 'your-secret-key'\n\n@app.route('/webhook', methods=['POST'])\ndef webhook():\n    # Verify signature.\n    signature = request.headers.get('X-Webhook-Signature')\n    payload = request.get_data()\n    \n    expected_signature = hmac.new(\n        SECRET_KEY.encode(),\n        payload,\n        hashlib.sha256\n    ).hexdigest()\n    \n    if not hmac.compare_digest(signature, expected_signature):\n        return jsonify({'error': 'Invalid signature'}), 403\n    \n    # Process webhook.\n    ...\n"})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"API Key"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-javascript",children:"app.post('/webhook', (req, res) => {\n  const apiKey = req.headers['x-api-key'];\n  \n  if (apiKey !== process.env.WEBHOOK_API_KEY) {\n    return res.status(403).json({ error: 'Invalid API key' });\n  }\n  \n  // Process webhook.\n  ...\n});\n"})}),"\n",(0,o.jsx)(n.h3,{id:"3-validate-payload",children:"3. Validate Payload"}),"\n",(0,o.jsx)(n.p,{children:"Always validate incoming payloads:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:"def validate_payload(payload):\n    '''Validate webhook payload structure.'''\n    if not isinstance(payload, dict):\n        raise ValueError('Payload must be a dictionary')\n    \n    if 'event' not in payload:\n        raise ValueError('Missing event field')\n    \n    if 'data' not in payload:\n        raise ValueError('Missing data field')\n    \n    return True\n"})}),"\n",(0,o.jsx)(n.h3,{id:"4-ip-whitelisting",children:"4. IP Whitelisting"}),"\n",(0,o.jsx)(n.p,{children:"Restrict access to your webhook endpoint to your Nextcloud server IP:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-nginx",children:"# Nginx example.\nlocation /openregister-webhook {\n    allow 192.168.1.10;  # Your Nextcloud server IP.\n    deny all;\n    proxy_pass http://localhost:5000;\n}\n"})}),"\n",(0,o.jsx)(n.h3,{id:"5-rate-limiting",children:"5. Rate Limiting"}),"\n",(0,o.jsx)(n.p,{children:"Implement rate limiting to prevent abuse:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:"from flask_limiter import Limiter\nfrom flask_limiter.util import get_remote_address\n\nlimiter = Limiter(\n    app,\n    key_func=get_remote_address,\n    default_limits=[\"100 per minute\"]\n)\n\n@app.route('/webhook', methods=['POST'])\n@limiter.limit(\"50 per minute\")\ndef webhook():\n    ...\n"})}),"\n",(0,o.jsx)(n.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,o.jsx)(n.h3,{id:"implement-retry-logic",children:"Implement Retry Logic"}),"\n",(0,o.jsxs)(n.p,{children:["Nextcloud ",(0,o.jsx)(n.code,{children:"webhook_listeners"})," implements automatic retries with exponential backoff. Ensure your endpoint:"]}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Returns appropriate HTTP status codes:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"200-299"}),": Success (no retry)"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"400-499"}),": Client error (no retry)"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"500-599"}),": Server error (will retry)"]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Is idempotent (can handle duplicate requests)"}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"example-error-handling",children:"Example Error Handling"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:"@app.route('/webhook', methods=['POST'])\ndef webhook():\n    try:\n        payload = request.json\n        \n        # Validate payload.\n        validate_payload(payload)\n        \n        # Process webhook.\n        result = process_webhook(payload)\n        \n        return jsonify(result), 200\n        \n    except ValueError as e:\n        # Client error - don't retry.\n        logging.error(f\"Validation error: {str(e)}\")\n        return jsonify({'error': str(e)}), 400\n        \n    except Exception as e:\n        # Server error - will retry.\n        logging.error(f\"Processing error: {str(e)}\")\n        return jsonify({'error': 'Internal server error'}), 500\n"})}),"\n",(0,o.jsx)(n.h2,{id:"testing-your-webhook",children:"Testing Your Webhook"}),"\n",(0,o.jsx)(n.h3,{id:"manual-testing-with-curl",children:"Manual Testing with curl"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'curl -X POST https://your-domain.com/openregister-webhook \\\n  -H "Content-Type: application/json" \\\n  -d \'{\n    "event": "OCA\\\\OpenRegister\\\\Event\\\\ObjectCreatedEvent",\n    "data": {\n      "object": {\n        "id": 1,\n        "uuid": "test-uuid",\n        "register": "test-register",\n        "schema": "test-schema",\n        "data": {"title": "Test Object"},\n        "created": "2024-01-15T10:30:00+00:00",\n        "updated": "2024-01-15T10:30:00+00:00"\n      }\n    }\n  }\'\n'})}),"\n",(0,o.jsx)(n.h3,{id:"unit-testing",children:"Unit Testing"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:"import unittest\nfrom your_webhook_handler import app\n\nclass TestWebhook(unittest.TestCase):\n    def setUp(self):\n        self.client = app.test_client()\n    \n    def test_object_created(self):\n        payload = {\n            'event': 'OCA\\\\OpenRegister\\\\Event\\\\ObjectCreatedEvent',\n            'data': {\n                'object': {\n                    'uuid': 'test-uuid',\n                    'register': 'test',\n                    'schema': 'test',\n                    'data': {'title': 'Test'}\n                }\n            }\n        }\n        \n        response = self.client.post('/webhook', json=payload)\n        self.assertEqual(response.status_code, 200)\n        self.assertIn('success', response.json['status'])\n"})}),"\n",(0,o.jsx)(n.h2,{id:"logging-and-monitoring",children:"Logging and Monitoring"}),"\n",(0,o.jsx)(n.h3,{id:"structured-logging",children:"Structured Logging"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:"import logging\nimport json\n\nlogging.basicConfig(\n    level=logging.INFO,\n    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s'\n)\n\ndef log_webhook_event(event_type, uuid, status):\n    logging.info(json.dumps({\n        'type': 'webhook_event',\n        'event': event_type,\n        'uuid': uuid,\n        'status': status,\n        'timestamp': datetime.now().isoformat()\n    }))\n"})}),"\n",(0,o.jsx)(n.h3,{id:"monitoring",children:"Monitoring"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Track webhook delivery success rate"}),"\n",(0,o.jsx)(n.li,{children:"Monitor processing time"}),"\n",(0,o.jsx)(n.li,{children:"Alert on failed webhooks"}),"\n",(0,o.jsx)(n.li,{children:"Log all errors with context"}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,o.jsx)(n.h3,{id:"webhook-not-received",children:"Webhook Not Received"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:"Verify endpoint is accessible"}),"\n",(0,o.jsx)(n.li,{children:"Check firewall rules"}),"\n",(0,o.jsx)(n.li,{children:"Test with curl"}),"\n",(0,o.jsx)(n.li,{children:"Review Nextcloud logs"}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"payload-parsing-errors",children:"Payload Parsing Errors"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:"Verify Content-Type header"}),"\n",(0,o.jsx)(n.li,{children:"Check JSON syntax"}),"\n",(0,o.jsx)(n.li,{children:"Validate payload structure"}),"\n",(0,o.jsx)(n.li,{children:"Test with sample data"}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"authentication-failures",children:"Authentication Failures"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:"Verify credentials/tokens"}),"\n",(0,o.jsx)(n.li,{children:"Check authentication headers"}),"\n",(0,o.jsx)(n.li,{children:"Test authentication separately"}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"further-reading",children:"Further Reading"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"/docs/Features/webhooks",children:"Webhooks Feature Documentation"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"/docs/api/events-reference",children:"Events API Reference"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"/docs/Integrations/n8n",children:"n8n Integration Guide"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"/docs/Integrations/windmill",children:"Windmill Integration Guide"})}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"support",children:"Support"}),"\n",(0,o.jsx)(n.p,{children:"For issues and questions:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"OpenRegister GitHub Issues"}),"\n",(0,o.jsx)(n.li,{children:"Nextcloud Documentation"}),"\n",(0,o.jsx)(n.li,{children:"Community Forums"}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}}}]);