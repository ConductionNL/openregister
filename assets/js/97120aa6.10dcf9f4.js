"use strict";(self.webpackChunkopen_catalogi_docs=self.webpackChunkopen_catalogi_docs||[]).push([[5638],{15481:(e,i,n)=>{n.r(i),n.d(i,{assets:()=>a,contentTitle:()=>c,default:()=>h,frontMatter:()=>l,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"technical/schemas","title":"Schema Technical Documentation","description":"This document covers technical details about schema configuration, metadata handling, and register relationships.","source":"@site/docs/technical/schemas.md","sourceDirName":"technical","slug":"/technical/schemas","permalink":"/docs/technical/schemas","draft":false,"unlisted":false,"editUrl":"https://github.com/conductionnl/openregister/tree/main/website/docs/technical/schemas.md","tags":[],"version":"current","sidebarPosition":15,"frontMatter":{"title":"Schema Technical Documentation","sidebar_position":15},"sidebar":"tutorialSidebar","previous":{"title":"Named Entity Recognition Technical Documentation","permalink":"/docs/technical/named-entity-recognition"},"next":{"title":"Hyper-Performant Faceting System","permalink":"/docs/technical/faceting-performance"}}');var r=n(74848),t=n(28453);const l={title:"Schema Technical Documentation",sidebar_position:15},c="Schema Technical Documentation",a={},d=[{value:"Schema Metadata Configuration",id:"schema-metadata-configuration",level:2},{value:"Configuration Options",id:"configuration-options",level:3},{value:"Available Metadata Fields",id:"available-metadata-fields",level:3},{value:"Object Image Field Configuration",id:"object-image-field-configuration",level:3},{value:"\u26a0\ufe0f IMPORTANT WARNING",id:"\ufe0f-important-warning",level:4},{value:"Why This Matters",id:"why-this-matters",level:4},{value:"Understanding autoPublish Settings",id:"understanding-autopublish-settings",level:4},{value:"1. Property-Level autoPublish (File Properties)",id:"1-property-level-autopublish-file-properties",level:5},{value:"2. Schema-Level autoPublish (Object Publishing)",id:"2-schema-level-autopublish-object-publishing",level:5},{value:"Auto-Publishing Behavior for objectImageField",id:"auto-publishing-behavior-for-objectimagefield",level:4},{value:"Quick Reference Table",id:"quick-reference-table",level:3},{value:"Best Practices",id:"best-practices",level:3},{value:"\u2705 Recommended Approach",id:"-recommended-approach",level:4},{value:"\u274c What to Avoid",id:"-what-to-avoid",level:4},{value:"Array File Properties",id:"array-file-properties",level:3},{value:"URL Structure",id:"url-structure",level:3},{value:"Implementation Details",id:"implementation-details",level:3},{value:"Technical Flow",id:"technical-flow",level:4},{value:"Code Location",id:"code-location",level:4},{value:"Troubleshooting",id:"troubleshooting",level:3},{value:"Image Not Appearing",id:"image-not-appearing",level:4},{value:"Performance Concerns",id:"performance-concerns",level:4},{value:"Security Concerns",id:"security-concerns",level:4},{value:"Schema and Register Relationship",id:"schema-and-register-relationship",level:2},{value:"Key Principles",id:"key-principles",level:3},{value:"1. Schemas Are Independent Entities",id:"1-schemas-are-independent-entities",level:4},{value:"2. Schemas Do NOT Cascade Delete",id:"2-schemas-do-not-cascade-delete",level:4},{value:"3. Register-Schema Association",id:"3-register-schema-association",level:4},{value:"Use Cases",id:"use-cases",level:3},{value:"Single Schema, Multiple Registers",id:"single-schema-multiple-registers",level:4},{value:"Schema Evolution",id:"schema-evolution",level:4},{value:"Deletion Behavior",id:"deletion-behavior",level:3},{value:"Register Deletion",id:"register-deletion",level:4},{value:"Schema Deletion",id:"schema-deletion",level:4},{value:"Best Practices",id:"best-practices-1",level:3},{value:"1. Schema Naming",id:"1-schema-naming",level:4},{value:"2. Schema Versioning",id:"2-schema-versioning",level:4},{value:"3. Cleanup Strategy",id:"3-cleanup-strategy",level:4},{value:"4. Schema Discovery",id:"4-schema-discovery",level:4},{value:"Database Structure",id:"database-structure",level:3},{value:"Migration Considerations",id:"migration-considerations",level:3},{value:"Testing Implications",id:"testing-implications",level:3},{value:"Summary",id:"summary",level:3},{value:"Related Documentation",id:"related-documentation",level:2}];function o(e){const i={a:"a",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.header,{children:(0,r.jsx)(i.h1,{id:"schema-technical-documentation",children:"Schema Technical Documentation"})}),"\n",(0,r.jsx)(i.p,{children:"This document covers technical details about schema configuration, metadata handling, and register relationships."}),"\n",(0,r.jsx)(i.h2,{id:"schema-metadata-configuration",children:"Schema Metadata Configuration"}),"\n",(0,r.jsx)(i.p,{children:"OpenRegister schemas support automatic metadata extraction from object properties. This allows you to configure which fields should populate the object's metadata (like name, description, image, etc.)."}),"\n",(0,r.jsx)(i.h3,{id:"configuration-options",children:"Configuration Options"}),"\n",(0,r.jsxs)(i.p,{children:["Metadata fields are configured in the schema's ",(0,r.jsx)(i.code,{children:"configuration"})," object:"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-json",children:'{\n  "configuration": {\n    "objectNameField": "title",\n    "objectDescriptionField": "description",\n    "objectSummaryField": "summary",\n    "objectImageField": "logo",\n    "objectSlugField": "name"\n  }\n}\n'})}),"\n",(0,r.jsx)(i.h3,{id:"available-metadata-fields",children:"Available Metadata Fields"}),"\n",(0,r.jsxs)(i.table,{children:[(0,r.jsx)(i.thead,{children:(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.th,{children:"Field"}),(0,r.jsx)(i.th,{children:"Description"}),(0,r.jsx)(i.th,{children:"Purpose"})]})}),(0,r.jsxs)(i.tbody,{children:[(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"objectNameField"})}),(0,r.jsx)(i.td,{children:"The property to use for object name"}),(0,r.jsx)(i.td,{children:"Used for display in lists, search results"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"objectDescriptionField"})}),(0,r.jsx)(i.td,{children:"The property to use for detailed description"}),(0,r.jsx)(i.td,{children:"Used in detail views, previews"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"objectSummaryField"})}),(0,r.jsx)(i.td,{children:"The property to use for short summary"}),(0,r.jsx)(i.td,{children:"Used in cards, listings"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"objectImageField"})}),(0,r.jsx)(i.td,{children:"The property to use for object image"}),(0,r.jsx)(i.td,{children:"Used for thumbnails, previews, social sharing"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"objectSlugField"})}),(0,r.jsx)(i.td,{children:"The property to use for URL-friendly slug"}),(0,r.jsx)(i.td,{children:"Used in URLs, permalinks"})]})]})]}),"\n",(0,r.jsx)(i.h3,{id:"object-image-field-configuration",children:"Object Image Field Configuration"}),"\n",(0,r.jsx)(i.h4,{id:"\ufe0f-important-warning",children:"\u26a0\ufe0f IMPORTANT WARNING"}),"\n",(0,r.jsx)(i.p,{children:(0,r.jsxs)(i.strong,{children:["When configuring ",(0,r.jsx)(i.code,{children:"objectImageField"})," to point to a file property, the file MUST be publicly accessible."]})}),"\n",(0,r.jsx)(i.h4,{id:"why-this-matters",children:"Why This Matters"}),"\n",(0,r.jsxs)(i.p,{children:["The object's image metadata (",(0,r.jsx)(i.code,{children:"@self.image"}),") is used in:"]}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"API responses"})," for public consumption"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Social media sharing"})," (Open Graph, Twitter Cards)"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Frontend displays"})," where the image needs to be accessible"]}),"\n",(0,r.jsx)(i.li,{children:(0,r.jsx)(i.strong,{children:"Search engine indexing"})}),"\n",(0,r.jsx)(i.li,{children:(0,r.jsx)(i.strong,{children:"Third-party integrations"})}),"\n"]}),"\n",(0,r.jsx)(i.p,{children:"If the file is not publicly shared, these features will not work correctly."}),"\n",(0,r.jsx)(i.h4,{id:"understanding-autopublish-settings",children:"Understanding autoPublish Settings"}),"\n",(0,r.jsxs)(i.p,{children:["\u26a0\ufe0f ",(0,r.jsx)(i.strong,{children:"IMPORTANT"}),": There are TWO different 'autoPublish' settings with different purposes. Do not confuse them!"]}),"\n",(0,r.jsx)(i.h5,{id:"1-property-level-autopublish-file-properties",children:"1. Property-Level autoPublish (File Properties)"}),"\n",(0,r.jsx)(i.p,{children:"Controls whether files uploaded to a specific property get published:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-json",children:'{\n  "properties": {\n    "productImage": {\n      "type": "file",\n      "autoPublish": true  // \u2190 Files uploaded here are published\n    },\n    "internalDoc": {\n      "type": "file",\n      "autoPublish": false  // \u2190 Files uploaded here stay private\n    }\n  }\n}\n'})}),"\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"Purpose"}),": Gives you control over which file properties should have their files publicly accessible."]}),"\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"Location"}),": Inside individual file property definitions"]}),"\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"Applies to"}),": Only files uploaded to that specific property"]}),"\n",(0,r.jsx)(i.h5,{id:"2-schema-level-autopublish-object-publishing",children:"2. Schema-Level autoPublish (Object Publishing)"}),"\n",(0,r.jsx)(i.p,{children:"Controls whether the entire object gets published:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-json",children:'{\n  "configuration": {\n    "autoPublish": true  // \u2190 The OBJECT itself is published\n  }\n}\n'})}),"\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"Purpose"}),": Controls object visibility (has nothing to do with file sharing)"]}),"\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"Location"}),": In the schema's 'configuration' object"]}),"\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"Applies to"}),": The object entity itself, not its files"]}),"\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"Note"}),": This is completely separate from file publishing!"]}),"\n",(0,r.jsx)(i.h4,{id:"auto-publishing-behavior-for-objectimagefield",children:"Auto-Publishing Behavior for objectImageField"}),"\n",(0,r.jsxs)(i.p,{children:["When a file property is configured as 'objectImageField', ",(0,r.jsx)(i.strong,{children:"the file is ALWAYS published"}),", regardless of the property's 'autoPublish' setting."]}),"\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"Why?"})," Object metadata must be publicly accessible for:"]}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"Social media previews"}),"\n",(0,r.jsx)(i.li,{children:"API consumers"}),"\n",(0,r.jsx)(i.li,{children:"Search engines"}),"\n",(0,r.jsx)(i.li,{children:"Third-party integrations"}),"\n"]}),"\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.strong,{children:"What happens:"})}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-json",children:'{\n  "properties": {\n    "logo": {\n      "type": "file",\n      "autoPublish": false  // \u2190 User preference: keep private\n    }\n  },\n  "configuration": {\n    "objectImageField": "logo"  // \u2190 FORCES publication!\n  }\n}\n'})}),"\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"Result"}),": The logo file will be published anyway, and you'll see this warning in logs:"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{children:"File configured as objectImageField is not published. Auto-publishing file.\n"})}),"\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"Recommendation"}),": Always set 'autoPublish: true' on file properties used as 'objectImageField' to make the behavior explicit and avoid confusion."]}),"\n",(0,r.jsx)(i.h3,{id:"quick-reference-table",children:"Quick Reference Table"}),"\n",(0,r.jsxs)(i.table,{children:[(0,r.jsx)(i.thead,{children:(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.th,{children:"Setting Location"}),(0,r.jsx)(i.th,{children:"Property Name"}),(0,r.jsx)(i.th,{children:"What It Controls"}),(0,r.jsx)(i.th,{children:"Example"})]})}),(0,r.jsxs)(i.tbody,{children:[(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:"Property definition"}),(0,r.jsx)(i.td,{children:"'autoPublish'"}),(0,r.jsx)(i.td,{children:"Whether files in THIS property get published"}),(0,r.jsx)(i.td,{children:"'logo: {type: \"file\", autoPublish: true}'"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:"Schema configuration"}),(0,r.jsx)(i.td,{children:"'autoPublish'"}),(0,r.jsx)(i.td,{children:"Whether the OBJECT gets published"}),(0,r.jsx)(i.td,{children:"'configuration: {autoPublish: true}'"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:"Schema configuration"}),(0,r.jsx)(i.td,{children:"'objectImageField'"}),(0,r.jsx)(i.td,{children:"Forces file publication for metadata"}),(0,r.jsx)(i.td,{children:"'configuration: {objectImageField: \"logo\"}'"})]})]})]}),"\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.strong,{children:"Key Takeaways:"})}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"\u2705 Property 'autoPublish' = controls file sharing per property"}),"\n",(0,r.jsx)(i.li,{children:"\u2705 Schema 'autoPublish' = controls object publication (unrelated to files)"}),"\n",(0,r.jsx)(i.li,{children:"\u26a0\ufe0f 'objectImageField' = overrides property 'autoPublish' and forces publication"}),"\n",(0,r.jsx)(i.li,{children:"\ud83d\udca1 Best practice: Set 'autoPublish: true' on properties used as 'objectImageField'"}),"\n"]}),"\n",(0,r.jsx)(i.h3,{id:"best-practices",children:"Best Practices"}),"\n",(0,r.jsx)(i.h4,{id:"-recommended-approach",children:"\u2705 Recommended Approach"}),"\n",(0,r.jsxs)(i.p,{children:[(0,r.jsxs)(i.strong,{children:["Use ",(0,r.jsx)(i.code,{children:"autoPublish"})," property configuration"]})," to ensure files are published on upload:"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-json",children:'{\n  "slug": "products",\n  "title": "Products Schema",\n  "properties": {\n    "name": {\n      "type": "string"\n    },\n    "logo": {\n      "type": "file",\n      "allowedTypes": ["image/png", "image/jpeg"],\n      "autoPublish": true  // \u2705 File will be published on upload\n    }\n  },\n  "configuration": {\n    "objectImageField": "logo"  // \u2705 File is already published\n  }\n}\n'})}),"\n",(0,r.jsx)(i.h4,{id:"-what-to-avoid",children:"\u274c What to Avoid"}),"\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.strong,{children:"Don't use private file properties as objectImageField:"})}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-json",children:'{\n  "properties": {\n    "internalDocument": {\n      "type": "file",\n      "autoPublish": false  // \u274c Property says: keep private\n    }\n  },\n  "configuration": {\n    "objectImageField": "internalDocument"  // \u274c But metadata needs public access!\n  }\n}\n'})}),"\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"What happens:"})," The file WILL be published anyway (with a warning logged), defeating your 'autoPublish: false' setting."]}),"\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.strong,{children:"Why this is bad:"})}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"Confusing behavior (says private, becomes public)"}),"\n",(0,r.jsx)(i.li,{children:"Unexpected file publication"}),"\n",(0,r.jsx)(i.li,{children:"Security risk if you think files are private"}),"\n"]}),"\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"The fix:"})," Don't point 'objectImageField' to properties with sensitive files. Use separate properties:"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-json",children:'{\n  "properties": {\n    "publicLogo": {\n      "type": "file",\n      "autoPublish": true  // \u2705 Explicitly public\n    },\n    "internalDocuments": {\n      "type": "file",\n      "autoPublish": false  // \u2705 Stays private (not used as image)\n    }\n  },\n  "configuration": {\n    "objectImageField": "publicLogo"  // \u2705 Points to public property\n  }\n}\n'})}),"\n",(0,r.jsx)(i.h3,{id:"array-file-properties",children:"Array File Properties"}),"\n",(0,r.jsxs)(i.p,{children:["When ",(0,r.jsx)(i.code,{children:"objectImageField"})," points to an ",(0,r.jsx)(i.strong,{children:"array of files"}),", the ",(0,r.jsx)(i.strong,{children:"first file"})," in the array is used as the object's image:"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-json",children:'{\n  "properties": {\n    "photos": {\n      "type": "array",\n      "items": {\n        "type": "file",\n        "allowedTypes": ["image/png", "image/jpeg"],\n        "autoPublish": true  // \u2705 All photos will be published\n      }\n    }\n  },\n  "configuration": {\n    "objectImageField": "photos"  // \u2705 First photo used as image\n  }\n}\n'})}),"\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.strong,{children:"Important Notes:"})}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:["Only the ",(0,r.jsx)(i.strong,{children:"first file"})," is used for the object image"]}),"\n",(0,r.jsxs)(i.li,{children:["All files in the array are ",(0,r.jsx)(i.strong,{children:"still stored and accessible"})]}),"\n",(0,r.jsx)(i.li,{children:"Consider the first file as the 'primary' or 'featured' image"}),"\n",(0,r.jsx)(i.li,{children:"Order matters - the first uploaded file becomes the image"}),"\n"]}),"\n",(0,r.jsx)(i.h3,{id:"url-structure",children:"URL Structure"}),"\n",(0,r.jsxs)(i.p,{children:["The object image uses the file's ",(0,r.jsx)(i.strong,{children:"downloadUrl"}),", not accessUrl. This ensures:"]}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"Direct download capability"}),"\n",(0,r.jsx)(i.li,{children:"Compatibility with image proxies"}),"\n",(0,r.jsx)(i.li,{children:"Better caching behavior"}),"\n",(0,r.jsx)(i.li,{children:"Social media previews work correctly"}),"\n"]}),"\n",(0,r.jsx)(i.p,{children:"Example URL format:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{children:"https://your-domain.com/index.php/s/abc123xyz/download\n"})}),"\n",(0,r.jsx)(i.h3,{id:"implementation-details",children:"Implementation Details"}),"\n",(0,r.jsx)(i.h4,{id:"technical-flow",children:"Technical Flow"}),"\n",(0,r.jsxs)(i.ol,{children:["\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"Object Created"})," with file attached"]}),"\n"]}),"\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"File Stored"})," in Nextcloud Files"]}),"\n"]}),"\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"Metadata Hydration"}),":"]}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:["Check if ",(0,r.jsx)(i.code,{children:"objectImageField"})," is configured"]}),"\n",(0,r.jsx)(i.li,{children:"Locate the file (ID or file object)"}),"\n",(0,r.jsx)(i.li,{children:"Check if file is published"}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Auto-publish"})," if not published (with warning logged)"]}),"\n",(0,r.jsxs)(i.li,{children:["Extract ",(0,r.jsx)(i.code,{children:"downloadUrl"})]}),"\n",(0,r.jsxs)(i.li,{children:["Set ",(0,r.jsx)(i.code,{children:"@self.image"})," to downloadUrl"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"API Response"})," includes:"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-json",children:'{\n  "id": "uuid-123",\n  "name": "Product Name",\n  "logo": {\n    "id": 456,\n    "downloadUrl": "https://domain.com/s/abc/download",\n    "accessUrl": "https://domain.com/preview?id=456"\n  },\n  "@self": {\n    "image": "https://domain.com/s/abc/download"\n  }\n}\n'})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(i.h4,{id:"code-location",children:"Code Location"}),"\n",(0,r.jsx)(i.p,{children:"The auto-publishing logic is implemented in:"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"/lib/Service/ObjectHandlers/SaveObject.php"})," - ",(0,r.jsx)(i.code,{children:"hydrateObjectMetadata()"})," method"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"/lib/Service/ObjectService.php"})," - ",(0,r.jsx)(i.code,{children:"hydrateObjectMetadataFromData()"})," method"]}),"\n"]}),"\n",(0,r.jsx)(i.h3,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,r.jsx)(i.h4,{id:"image-not-appearing",children:"Image Not Appearing"}),"\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"Problem"}),": ",(0,r.jsx)(i.code,{children:"@self.image"})," is ",(0,r.jsx)(i.code,{children:"null"})," in API responses"]}),"\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"Solutions"}),":"]}),"\n",(0,r.jsxs)(i.ol,{children:["\n",(0,r.jsxs)(i.li,{children:["Check that ",(0,r.jsx)(i.code,{children:"objectImageField"})," matches the property name exactly"]}),"\n",(0,r.jsxs)(i.li,{children:["Verify the file property has ",(0,r.jsx)(i.code,{children:"autoPublish: true"})]}),"\n",(0,r.jsx)(i.li,{children:"Check logs for auto-publishing warnings"}),"\n",(0,r.jsx)(i.li,{children:"Ensure the property actually contains a file"}),"\n"]}),"\n",(0,r.jsx)(i.h4,{id:"performance-concerns",children:"Performance Concerns"}),"\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"Problem"}),": Slow object saves when using ",(0,r.jsx)(i.code,{children:"objectImageField"})," with files"]}),"\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"Solution"}),": The file is loaded and checked during metadata hydration. This is cached. If performance is critical:"]}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:["Use ",(0,r.jsx)(i.code,{children:"autoPublish: true"})," to avoid auto-publishing checks"]}),"\n",(0,r.jsx)(i.li,{children:"Consider using string URLs instead of file properties for external images"}),"\n",(0,r.jsx)(i.li,{children:"Use background jobs for bulk imports"}),"\n"]}),"\n",(0,r.jsx)(i.h4,{id:"security-concerns",children:"Security Concerns"}),"\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"Problem"}),": Don't want to auto-publish sensitive files"]}),"\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"Solution"}),": ",(0,r.jsx)(i.strong,{children:"DO NOT"})," configure sensitive file properties as ",(0,r.jsx)(i.code,{children:"objectImageField"}),". Use separate fields:"]}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:["Public logo \u2192 ",(0,r.jsx)(i.code,{children:"logo"})," property with ",(0,r.jsx)(i.code,{children:"autoPublish: true"})," \u2192 configured as ",(0,r.jsx)(i.code,{children:"objectImageField"})]}),"\n",(0,r.jsxs)(i.li,{children:["Private documents \u2192 ",(0,r.jsx)(i.code,{children:"documents"})," property without ",(0,r.jsx)(i.code,{children:"autoPublish"})," \u2192 NOT configured as ",(0,r.jsx)(i.code,{children:"objectImageField"})]}),"\n"]}),"\n",(0,r.jsx)(i.h2,{id:"schema-and-register-relationship",children:"Schema and Register Relationship"}),"\n",(0,r.jsxs)(i.p,{children:["In OpenRegister, ",(0,r.jsx)(i.strong,{children:"schemas"})," and ",(0,r.jsx)(i.strong,{children:"registers"})," have an independent, many-to-many relationship. This architectural decision enables maximum flexibility and reusability."]}),"\n",(0,r.jsx)(i.h3,{id:"key-principles",children:"Key Principles"}),"\n",(0,r.jsx)(i.h4,{id:"1-schemas-are-independent-entities",children:"1. Schemas Are Independent Entities"}),"\n",(0,r.jsx)(i.p,{children:"Schemas exist independently of registers and can be:"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"Created without being assigned to any register"}),"\n",(0,r.jsx)(i.li,{children:"Shared across multiple registers"}),"\n",(0,r.jsx)(i.li,{children:"Modified without affecting unrelated registers"}),"\n",(0,r.jsx)(i.li,{children:"Deleted independently (with proper cascade handling for objects)"}),"\n"]}),"\n",(0,r.jsx)(i.h4,{id:"2-schemas-do-not-cascade-delete",children:"2. Schemas Do NOT Cascade Delete"}),"\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"Important:"})," When a register is deleted, its associated schemas are ",(0,r.jsx)(i.strong,{children:"NOT"})," automatically deleted."]}),"\n",(0,r.jsxs)(i.p,{children:["This is ",(0,r.jsx)(i.strong,{children:"by design"})," because:"]}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Reusability"}),": Schemas can be used by multiple registers"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Data Integrity"}),": Deleting a register should not break other registers using the same schema"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Explicit Management"}),": Schema lifecycle is managed independently for safety"]}),"\n"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-php",children:"// Example: Deleting a register\nDELETE /api/registers/{id}\n\n// Result:\n// \u2705 Register is deleted\n// \u2705 Objects in that register are deleted\n// \u274c Schemas are NOT deleted (they may be used elsewhere)\n"})}),"\n",(0,r.jsx)(i.h4,{id:"3-register-schema-association",children:"3. Register-Schema Association"}),"\n",(0,r.jsx)(i.p,{children:"Schemas are associated with registers through:"}),"\n",(0,r.jsxs)(i.ol,{children:["\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"Schema Creation"}),":"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-json",children:'POST /api/schemas\n{\n  "register": 123,  // Optional: Primary register\n  "slug": "person",\n  "title": "Person Schema"\n}\n'})}),"\n"]}),"\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"Object Creation"}),":"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-json",children:'POST /api/objects/{register}/{schema}\n{\n  "name": "John Doe"\n}\n'})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(i.p,{children:"The schema used in an object determines its structure, regardless of which register it's stored in."}),"\n",(0,r.jsx)(i.h3,{id:"use-cases",children:"Use Cases"}),"\n",(0,r.jsx)(i.h4,{id:"single-schema-multiple-registers",children:"Single Schema, Multiple Registers"}),"\n",(0,r.jsx)(i.p,{children:'A "Person" schema can be reused across different registers:'}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{children:'Schema: "person"\n\u251c\u2500\u2500 Register: "employees"      (HR department)\n\u251c\u2500\u2500 Register: "customers"      (Sales department)\n\u2514\u2500\u2500 Register: "contractors"    (Operations department)\n'})}),"\n",(0,r.jsx)(i.p,{children:"Each register contains different person objects, but they all follow the same schema structure."}),"\n",(0,r.jsx)(i.h4,{id:"schema-evolution",children:"Schema Evolution"}),"\n",(0,r.jsx)(i.p,{children:"Schemas can evolve independently:"}),"\n",(0,r.jsxs)(i.ol,{children:["\n",(0,r.jsx)(i.li,{children:"Update schema definition"}),"\n",(0,r.jsx)(i.li,{children:"Affects all registers using that schema"}),"\n",(0,r.jsx)(i.li,{children:"Provides consistent data structure across the application"}),"\n"]}),"\n",(0,r.jsx)(i.h3,{id:"deletion-behavior",children:"Deletion Behavior"}),"\n",(0,r.jsx)(i.h4,{id:"register-deletion",children:"Register Deletion"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{children:"DELETE /api/registers/{id}\n"})}),"\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.strong,{children:"Deletes:"})}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"\u2705 The register record"}),"\n",(0,r.jsx)(i.li,{children:"\u2705 All objects in that register"}),"\n",(0,r.jsx)(i.li,{children:"\u2705 Register-specific metadata"}),"\n"]}),"\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.strong,{children:"Does NOT Delete:"})}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"\u274c Schemas (independent lifecycle)"}),"\n",(0,r.jsx)(i.li,{children:"\u274c Objects in other registers"}),"\n"]}),"\n",(0,r.jsx)(i.h4,{id:"schema-deletion",children:"Schema Deletion"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{children:"DELETE /api/schemas/{id}\n"})}),"\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.strong,{children:"Deletes:"})}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"\u2705 The schema definition"}),"\n",(0,r.jsx)(i.li,{children:"\u2705 All objects using that schema (across ALL registers)"}),"\n",(0,r.jsx)(i.li,{children:"\u2705 Schema metadata"}),"\n"]}),"\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"Use with caution"})," - this affects all registers using the schema!"]}),"\n",(0,r.jsx)(i.h3,{id:"best-practices-1",children:"Best Practices"}),"\n",(0,r.jsx)(i.h4,{id:"1-schema-naming",children:"1. Schema Naming"}),"\n",(0,r.jsx)(i.p,{children:"Use descriptive, generic names that reflect the data structure, not the specific use case:"}),"\n",(0,r.jsxs)(i.p,{children:["\u2705 Good: ",(0,r.jsx)(i.code,{children:"person"}),", ",(0,r.jsx)(i.code,{children:"document"}),", ",(0,r.jsx)(i.code,{children:"transaction"}),(0,r.jsx)(i.br,{}),"\n","\u274c Bad: ",(0,r.jsx)(i.code,{children:"hr-employee"}),", ",(0,r.jsx)(i.code,{children:"sales-customer"})]}),"\n",(0,r.jsx)(i.h4,{id:"2-schema-versioning",children:"2. Schema Versioning"}),"\n",(0,r.jsx)(i.p,{children:"For breaking changes, create a new schema instead of modifying:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{children:"person-v1  \u2192  person-v2\n"})}),"\n",(0,r.jsx)(i.p,{children:"This allows gradual migration without breaking existing data."}),"\n",(0,r.jsx)(i.h4,{id:"3-cleanup-strategy",children:"3. Cleanup Strategy"}),"\n",(0,r.jsx)(i.p,{children:"When deleting registers in tests or cleanup scripts:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-php",children:"// 1. Delete objects\nDELETE /api/objects/{register}/{schema}/{uuid}\n\n// 2. Delete register\nDELETE /api/registers/{id}\n\n// 3. Optionally delete schemas (if not used elsewhere)\nDELETE /api/schemas/{id}\n"})}),"\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"Always check"})," if a schema is used by other registers before deleting it!"]}),"\n",(0,r.jsx)(i.h4,{id:"4-schema-discovery",children:"4. Schema Discovery"}),"\n",(0,r.jsx)(i.p,{children:"Find which registers use a specific schema:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{children:"GET /api/objects?schema={schemaId}\n"})}),"\n",(0,r.jsx)(i.p,{children:"Group results by register to see usage patterns."}),"\n",(0,r.jsx)(i.h3,{id:"database-structure",children:"Database Structure"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{children:"oc_openregister_schemas\n\u251c\u2500\u2500 id (primary key)\n\u251c\u2500\u2500 slug (unique)\n\u251c\u2500\u2500 register (nullable foreign key - primary register reference)\n\u2514\u2500\u2500 ...\n\noc_openregister_objects  \n\u251c\u2500\u2500 id (primary key)\n\u251c\u2500\u2500 register (foreign key \u2192 CASCADES on delete)\n\u251c\u2500\u2500 schema (foreign key \u2192 CASCADES on delete)\n\u2514\u2500\u2500 ...\n"})}),"\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"Note:"})," The ",(0,r.jsx)(i.code,{children:"register"})," field in ",(0,r.jsx)(i.code,{children:"schemas"})," table is ",(0,r.jsx)(i.strong,{children:"nullable"})," and serves as a ",(0,r.jsx)(i.strong,{children:"hint"})," for the primary register, but does not enforce exclusivity."]}),"\n",(0,r.jsx)(i.h3,{id:"migration-considerations",children:"Migration Considerations"}),"\n",(0,r.jsx)(i.p,{children:"When migrating data between registers:"}),"\n",(0,r.jsxs)(i.ol,{children:["\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"Same Schema"}),": Direct move possible"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{children:'PATCH /api/objects/{register}/{schema}/{uuid}\n{ "register": newRegisterId }\n'})}),"\n"]}),"\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"Different Schema"}),": Data transformation required"]}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"Export from old schema"}),"\n",(0,r.jsx)(i.li,{children:"Transform data structure"}),"\n",(0,r.jsx)(i.li,{children:"Import to new schema"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(i.h3,{id:"testing-implications",children:"Testing Implications"}),"\n",(0,r.jsx)(i.p,{children:"Integration tests must explicitly clean up both registers AND schemas:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-php",children:"protected function tearDown(): void\n{\n    // 1. Delete objects\n    foreach ($this->createdObjects as $obj) {\n        $this->client->delete(\"/api/objects/{$obj['register']}/{$obj['schema']}/{$obj['uuid']}\");\n    }\n    \n    // 2. Delete register\n    $this->client->delete(\"/api/registers/{$this->registerId}\");\n    \n    // 3. Delete schemas (if test-specific)\n    foreach ($this->createdSchemas as $schemaId) {\n        $this->client->delete(\"/api/schemas/{$schemaId}\");\n    }\n}\n"})}),"\n",(0,r.jsx)(i.h3,{id:"summary",children:"Summary"}),"\n",(0,r.jsxs)(i.table,{children:[(0,r.jsx)(i.thead,{children:(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.th,{children:"Action"}),(0,r.jsx)(i.th,{children:"Affects Schemas?"}),(0,r.jsx)(i.th,{children:"Affects Objects?"})]})}),(0,r.jsxs)(i.tbody,{children:[(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:"Delete Register"}),(0,r.jsx)(i.td,{children:"\u274c No"}),(0,r.jsx)(i.td,{children:"\u2705 Yes (in that register)"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:"Delete Schema"}),(0,r.jsx)(i.td,{children:"\u2705 Yes (definition)"}),(0,r.jsx)(i.td,{children:"\u2705 Yes (ALL using it)"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:"Update Schema"}),(0,r.jsx)(i.td,{children:"\u2705 Yes (definition)"}),(0,r.jsx)(i.td,{children:"\ud83d\udd04 Structure changed"})]})]})]}),"\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"Remember:"})," Schemas are shared resources - treat them with care!"]}),"\n",(0,r.jsx)(i.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.a,{href:"/docs/Features/schemas",children:"Schemas"})," - User-facing schema documentation"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.a,{href:"/docs/api/schemas",children:"Schema API"})," - API reference for schemas"]}),"\n"]})]})}function h(e={}){const{wrapper:i}={...(0,t.R)(),...e.components};return i?(0,r.jsx)(i,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}},28453:(e,i,n)=>{n.d(i,{R:()=>l,x:()=>c});var s=n(96540);const r={},t=s.createContext(r);function l(e){const i=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function c(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),s.createElement(t.Provider,{value:i},e.children)}}}]);