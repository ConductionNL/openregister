"use strict";(self.webpackChunkopen_catalogi_docs=self.webpackChunkopen_catalogi_docs||[]).push([[4651],{28453:(e,n,s)=>{s.d(n,{R:()=>c,x:()=>l});var i=s(96540);const t={},r=i.createContext(t);function c(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:c(e.components),i.createElement(r.Provider,{value:n},e.children)}},39127:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>h,frontMatter:()=>c,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"technical/text-extraction","title":"Text Extraction Technical Documentation","description":"Complete technical documentation for text extraction, chunking, and file processing","source":"@site/docs/technical/text-extraction.md","sourceDirName":"technical","slug":"/technical/text-extraction","permalink":"/docs/technical/text-extraction","draft":false,"unlisted":false,"editUrl":"https://github.com/conductionnl/openregister/tree/main/website/docs/technical/text-extraction.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"title":"Text Extraction Technical Documentation","sidebar_position":1,"description":"Complete technical documentation for text extraction, chunking, and file processing","keywords":["Text Extraction","Chunking","File Processing","Handler Architecture"]},"sidebar":"tutorialSidebar","previous":{"title":"Introduction","permalink":"/docs/intro"},"next":{"title":"Vectorization Technical Documentation","permalink":"/docs/technical/vectorization"}}');var t=s(74848),r=s(28453);const c={title:"Text Extraction Technical Documentation",sidebar_position:1,description:"Complete technical documentation for text extraction, chunking, and file processing",keywords:["Text Extraction","Chunking","File Processing","Handler Architecture"]},l="Text Extraction Technical Documentation",d={},o=[{value:"Overview",id:"overview",level:2},{value:"Architecture",id:"architecture",level:2},{value:"Handler-Based Design",id:"handler-based-design",level:3},{value:"Service Flow",id:"service-flow",level:3},{value:"Database Schema",id:"database-schema",level:2},{value:"Chunk Entity",id:"chunk-entity",level:3},{value:"Entity Class",id:"entity-class",level:3},{value:"Handlers",id:"handlers",level:2},{value:"FileHandler",id:"filehandler",level:3},{value:"ObjectHandler",id:"objecthandler",level:3},{value:"Chunking Strategies",id:"chunking-strategies",level:2},{value:"Recursive Character Splitting (Recommended)",id:"recursive-character-splitting-recommended",level:3},{value:"Fixed Size Splitting",id:"fixed-size-splitting",level:3},{value:"Supported File Formats",id:"supported-file-formats",level:2},{value:"Text Documents",id:"text-documents",level:3},{value:"PDF Documents",id:"pdf-documents",level:3},{value:"Microsoft Office",id:"microsoft-office",level:3},{value:"Images (OCR)",id:"images-ocr",level:3},{value:"Data Formats",id:"data-formats",level:3},{value:"Service Implementation",id:"service-implementation",level:2},{value:"TextExtractionService",id:"textextractionservice",level:3},{value:"Change Detection",id:"change-detection",level:2},{value:"Performance",id:"performance",level:2},{value:"Processing Times",id:"processing-times",level:3},{value:"Bulk Processing",id:"bulk-processing",level:3},{value:"API Endpoints",id:"api-endpoints",level:2},{value:"Text Extraction",id:"text-extraction",level:3},{value:"Chunking",id:"chunking",level:3},{value:"Error Handling",id:"error-handling",level:2},{value:"Common Errors",id:"common-errors",level:3},{value:"Recovery",id:"recovery",level:3},{value:"Processing Pipeline",id:"processing-pipeline",level:2},{value:"Step-by-Step Flow",id:"step-by-step-flow",level:3},{value:"Event Listener",id:"event-listener",level:3},{value:"File Size Limits",id:"file-size-limits",level:2},{value:"Default Limits",id:"default-limits",level:3},{value:"Modifying Limits",id:"modifying-limits",level:3},{value:"Dependencies",id:"dependencies",level:2},{value:"PHP Libraries (Installed via Composer)",id:"php-libraries-installed-via-composer",level:3},{value:"System Commands",id:"system-commands",level:3},{value:"Checking Dependencies",id:"checking-dependencies",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Debugging File Processing",id:"debugging-file-processing",level:3},{value:"Performance Issues",id:"performance-issues",level:3},{value:"File Access Issues",id:"file-access-issues",level:3},{value:"Quality Issues",id:"quality-issues",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"For Administrators",id:"for-administrators",level:3},{value:"For Users",id:"for-users",level:3},{value:"FAQ",id:"faq",level:2},{value:"Migration",id:"migration",level:2},{value:"From FileText to Chunks",id:"from-filetext-to-chunks",level:3},{value:"Related Documentation",id:"related-documentation",level:2},{value:"Feature Documentation",id:"feature-documentation",level:3},{value:"Technical Documentation",id:"technical-documentation",level:3}];function a(e){const n={a:"a",blockquote:"blockquote",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"text-extraction-technical-documentation",children:"Text Extraction Technical Documentation"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\ud83d\udcda Feature Documentation"}),": See ",(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.a,{href:"/docs/Features/text-extraction-vectorization-ner",children:"Text Extraction, Vectorization & Named Entity Recognition"})})," for user-facing documentation and overview."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,t.jsx)(n.p,{children:"OpenRegister's Text Extraction Service converts content from various sources (files, objects, emails, calendar items) into searchable text chunks. The service uses a handler-based architecture to support multiple source types and extraction methods."}),"\n",(0,t.jsx)(n.h2,{id:"architecture",children:"Architecture"}),"\n",(0,t.jsx)(n.h3,{id:"handler-based-design",children:"Handler-Based Design"}),"\n",(0,t.jsx)(n.mermaid,{value:"classDiagram\n    class TextExtractionHandlerInterface {\n        <<interface>>\n        +supports(string) bool\n        +extract(int, array) string\n        +getOwner(int, array) string|null\n        +getOrganisation(int, array) string|null\n    }\n    \n    class FileHandler {\n        +extract() string\n        -extractFromPdf() string\n        -extractFromDocx() string\n        -extractFromImage() string\n    }\n    \n    class ObjectHandler {\n        +extract() string\n        -convertObjectToText() string\n        -extractTextFromArray() string\n    }\n    \n    TextExtractionHandlerInterface <|.. FileHandler\n    TextExtractionHandlerInterface <|.. ObjectHandler"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Location"}),": ",(0,t.jsx)(n.code,{children:"lib/Service/TextExtraction/"})]}),"\n",(0,t.jsx)(n.h3,{id:"service-flow",children:"Service Flow"}),"\n",(0,t.jsx)(n.mermaid,{value:"sequenceDiagram\n    participant Source as Content Source\n    participant Handler as Text Extraction Handler\n    participant Service as TextExtractionService\n    participant Chunker as Chunking Logic\n    participant Storage as Chunk Storage\n    \n    Source->>Handler: Content available\n    Handler->>Handler: Extract text\n    Handler->>Handler: Calculate checksum\n    Handler--\x3e>Service: Return payload\n    Service->>Chunker: Split into chunks\n    Chunker->>Chunker: Apply strategy\n    Chunker->>Storage: Store chunks\n    Storage--\x3e>Service: Chunks persisted"}),"\n",(0,t.jsx)(n.h2,{id:"database-schema",children:"Database Schema"}),"\n",(0,t.jsx)(n.h3,{id:"chunk-entity",children:"Chunk Entity"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Table"}),": ",(0,t.jsx)(n.code,{children:"oc_openregister_chunks"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE oc_openregister_chunks (\n    id BIGINT AUTO_INCREMENT PRIMARY KEY,\n    uuid VARCHAR(255) NOT NULL UNIQUE,\n    source_type VARCHAR(50) NOT NULL,\n    source_id BIGINT NOT NULL,\n    text_content TEXT NOT NULL,\n    start_offset INT NOT NULL,\n    end_offset INT NOT NULL,\n    chunk_index INT NOT NULL,\n    checksum VARCHAR(64),\n    language VARCHAR(10),\n    language_level VARCHAR(20),\n    language_confidence DECIMAL(3,2),\n    detection_method VARCHAR(50),\n    indexed_in_solr BOOLEAN NOT NULL DEFAULT FALSE,\n    vectorized BOOLEAN NOT NULL DEFAULT FALSE,\n    owner VARCHAR(255),\n    organisation VARCHAR(255),\n    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n    \n    INDEX idx_source (source_type, source_id),\n    INDEX idx_checksum (checksum),\n    INDEX idx_language (language),\n    INDEX idx_owner (owner),\n    INDEX idx_organisation (organisation)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Key Fields"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"source_type"}),": 'file', 'object', 'email', 'calendar'"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"source_id"}),": ID of the source entity"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"checksum"}),": SHA256 hash of source text for change detection"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"text_content"}),": The actual chunk text"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"start_offset"})," / ",(0,t.jsx)(n.code,{children:"end_offset"}),": Character positions in original text"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"chunk_index"}),": Sequential chunk number (0-based)"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"entity-class",children:"Entity Class"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Location"}),": ",(0,t.jsx)(n.code,{children:"lib/Db/Chunk.php"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"class Chunk extends Entity implements JsonSerializable\n{\n    protected ?string $uuid = null;\n    protected ?string $sourceType = null;\n    protected ?int $sourceId = null;\n    protected ?string $textContent = null;\n    protected int $startOffset = 0;\n    protected int $endOffset = 0;\n    protected int $chunkIndex = 0;\n    protected ?string $checksum = null;\n    protected ?string $language = null;\n    protected ?string $languageLevel = null;\n    protected ?float $languageConfidence = null;\n    protected ?string $detectionMethod = null;\n    protected bool $indexedInSolr = false;\n    protected bool $vectorized = false;\n    protected ?string $owner = null;\n    protected ?string $organisation = null;\n    protected ?DateTime $createdAt = null;\n    protected ?DateTime $updatedAt = null;\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"handlers",children:"Handlers"}),"\n",(0,t.jsx)(n.h3,{id:"filehandler",children:"FileHandler"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Location"}),": ",(0,t.jsx)(n.code,{children:"lib/Service/TextExtraction/FileHandler.php"})]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Supported Formats"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Documents"}),": PDF, DOCX, DOC, ODT, RTF"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Spreadsheets"}),": XLSX, XLS, CSV"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Presentations"}),": PPTX"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Text Files"}),": TXT, MD, HTML, JSON, XML"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Images"}),": JPG, PNG, GIF, WebP, TIFF (via OCR)"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Extraction Methods"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"LLPhant"}),": Local PHP-based extraction"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Dolphin"}),": AI-powered extraction with OCR"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Native"}),": Direct text reading for plain text files"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Implementation"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"public function extract(int $sourceId, array $sourceMeta): string\n{\n    $nodes = $this->rootFolder->getById($sourceId);\n    $file = $nodes[0];\n    \n    // Extract based on MIME type\n    $mimeType = $sourceMeta['mimetype'] ?? 'unknown';\n    \n    // TODO: Implement actual extraction logic\n    return $file->getContent();\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"objecthandler",children:"ObjectHandler"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Location"}),": ",(0,t.jsx)(n.code,{children:"lib/Service/TextExtraction/ObjectHandler.php"})]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Process"}),":"]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Load object from database"}),"\n",(0,t.jsx)(n.li,{children:"Extract schema and register information"}),"\n",(0,t.jsx)(n.li,{children:"Flatten nested object structures"}),"\n",(0,t.jsx)(n.li,{children:"Concatenate property values with context"}),"\n",(0,t.jsx)(n.li,{children:"Add metadata (UUID, version, organization)"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Implementation"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:'public function extract(int $sourceId, array $sourceMeta): string\n{\n    $object = $this->objectMapper->find($sourceId);\n    return $this->convertObjectToText($object);\n}\n\nprivate function convertObjectToText(ObjectEntity $object): string\n{\n    $textParts = [];\n    $textParts[] = "Object ID: " . $object->getUuid();\n    \n    // Add schema info\n    if ($object->getSchema() !== null) {\n        $schema = $this->schemaMapper->find($object->getSchema());\n        $textParts[] = "Type: " . ($schema->getTitle() ?? $schema->getName());\n    }\n    \n    // Extract object data\n    $objectData = $object->getObject();\n    if (is_array($objectData)) {\n        $textParts[] = "Content: " . $this->extractTextFromArray($objectData);\n    }\n    \n    return implode("\\n", $textParts);\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"chunking-strategies",children:"Chunking Strategies"}),"\n",(0,t.jsx)(n.h3,{id:"recursive-character-splitting-recommended",children:"Recursive Character Splitting (Recommended)"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Priority Order"}),":"]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Paragraph breaks (",(0,t.jsx)(n.code,{children:"\\n\\n"}),")"]}),"\n",(0,t.jsxs)(n.li,{children:["Sentence endings (",(0,t.jsx)(n.code,{children:". ! ?"}),")"]}),"\n",(0,t.jsxs)(n.li,{children:["Line breaks (",(0,t.jsx)(n.code,{children:"\\n"}),")"]}),"\n",(0,t.jsx)(n.li,{children:"Commas and semicolons"}),"\n",(0,t.jsx)(n.li,{children:"Word boundaries (spaces)"}),"\n",(0,t.jsx)(n.li,{children:"Character split (fallback)"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Best for"}),": Natural language documents, articles, reports"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Configuration"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"$chunks = $textExtractionService->textToChunks($text, [\n    'chunk_size' => 1000,\n    'chunk_overlap' => 200,\n    'strategy' => 'RECURSIVE_CHARACTER'\n]);\n"})}),"\n",(0,t.jsx)(n.h3,{id:"fixed-size-splitting",children:"Fixed Size Splitting"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Settings"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Chunk size: 1000 characters (default)"}),"\n",(0,t.jsx)(n.li,{children:"Overlap: 200 characters (default)"}),"\n",(0,t.jsx)(n.li,{children:"Minimum chunk: 100 characters"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Best for"}),": Structured data, code, logs"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Configuration"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"$chunks = $textExtractionService->textToChunks($text, [\n    'chunk_size' => 1000,\n    'chunk_overlap' => 200,\n    'strategy' => 'FIXED_SIZE'\n]);\n"})}),"\n",(0,t.jsx)(n.h2,{id:"supported-file-formats",children:"Supported File Formats"}),"\n",(0,t.jsx)(n.h3,{id:"text-documents",children:"Text Documents"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Format"}),(0,t.jsx)(n.th,{children:"Max Size"}),(0,t.jsx)(n.th,{children:"Processing Time"}),(0,t.jsx)(n.th,{children:"Notes"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:".txt"})}),(0,t.jsx)(n.td,{children:"100MB"}),(0,t.jsx)(n.td,{children:"< 1s"}),(0,t.jsx)(n.td,{children:"UTF-8, ISO-8859-1, Windows-1252"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:".md"})}),(0,t.jsx)(n.td,{children:"50MB"}),(0,t.jsx)(n.td,{children:"< 1s"}),(0,t.jsx)(n.td,{children:"Preserves structure"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:".html"})}),(0,t.jsx)(n.td,{children:"20MB"}),(0,t.jsx)(n.td,{children:"1-3s"}),(0,t.jsx)(n.td,{children:"Strips scripts/styles"})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"pdf-documents",children:"PDF Documents"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Type"}),(0,t.jsx)(n.th,{children:"Max Size"}),(0,t.jsx)(n.th,{children:"Processing Time"}),(0,t.jsx)(n.th,{children:"Libraries"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Text PDF"}),(0,t.jsx)(n.td,{children:"100MB"}),(0,t.jsx)(n.td,{children:"2-10s"}),(0,t.jsx)(n.td,{children:"Smalot PdfParser, pdftotext"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Scanned PDF (OCR)"}),(0,t.jsx)(n.td,{children:"50MB"}),(0,t.jsx)(n.td,{children:"10-60s"}),(0,t.jsx)(n.td,{children:"Tesseract OCR"})]})]})]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Requirements for OCR"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Install Tesseract\nsudo apt-get install tesseract-ocr\n\n# With languages\napt-get install tesseract-ocr-nld tesseract-ocr-deu\n"})}),"\n",(0,t.jsx)(n.h3,{id:"microsoft-office",children:"Microsoft Office"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Format"}),(0,t.jsx)(n.th,{children:"Max Size"}),(0,t.jsx)(n.th,{children:"Processing Time"}),(0,t.jsx)(n.th,{children:"Libraries"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:".docx"})}),(0,t.jsx)(n.td,{children:"50MB"}),(0,t.jsx)(n.td,{children:"2-5s"}),(0,t.jsx)(n.td,{children:"PhpOffice/PhpWord"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:".xlsx"})}),(0,t.jsx)(n.td,{children:"30MB"}),(0,t.jsx)(n.td,{children:"3-10s"}),(0,t.jsx)(n.td,{children:"PhpOffice/PhpSpreadsheet"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:".pptx"})}),(0,t.jsx)(n.td,{children:"50MB"}),(0,t.jsx)(n.td,{children:"2-5s"}),(0,t.jsx)(n.td,{children:"ZipArchive + XML"})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"images-ocr",children:"Images (OCR)"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Format"}),(0,t.jsx)(n.th,{children:"Max Size"}),(0,t.jsx)(n.th,{children:"Processing Time"}),(0,t.jsx)(n.th,{children:"Requirements"})]})}),(0,t.jsx)(n.tbody,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"JPG, PNG, GIF, BMP, TIFF"}),(0,t.jsx)(n.td,{children:"20MB"}),(0,t.jsx)(n.td,{children:"5-15s/page"}),(0,t.jsx)(n.td,{children:"Tesseract OCR"})]})})]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Best Practices"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Use high-resolution scans (300 DPI ideal)"}),"\n",(0,t.jsx)(n.li,{children:"Ensure text is legible and not skewed"}),"\n",(0,t.jsx)(n.li,{children:"Black text on white background works best"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"data-formats",children:"Data Formats"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Format"}),(0,t.jsx)(n.th,{children:"Max Size"}),(0,t.jsx)(n.th,{children:"Processing Time"}),(0,t.jsx)(n.th,{children:"Notes"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:".json"})}),(0,t.jsx)(n.td,{children:"20MB"}),(0,t.jsx)(n.td,{children:"1-2s"}),(0,t.jsx)(n.td,{children:"Recursive extraction"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:".xml"})}),(0,t.jsx)(n.td,{children:"20MB"}),(0,t.jsx)(n.td,{children:"1-3s"}),(0,t.jsx)(n.td,{children:"Tag names and content"})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"service-implementation",children:"Service Implementation"}),"\n",(0,t.jsx)(n.h3,{id:"textextractionservice",children:"TextExtractionService"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Location"}),": ",(0,t.jsx)(n.code,{children:"lib/Service/TextExtractionService.php"})]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Key Methods"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"/**\n * Extract text from a source using appropriate handler.\n */\npublic function extractSourceText(\n    string $sourceType,\n    int $sourceId,\n    array $sourceMeta\n): array {\n    $handler = $this->getHandler($sourceType);\n    $text = $handler->extract($sourceId, $sourceMeta);\n    $checksum = hash('sha256', $text);\n    \n    return [\n        'source_type' => $sourceType,\n        'source_id' => $sourceId,\n        'text' => $text,\n        'checksum' => $checksum,\n        'owner' => $handler->getOwner($sourceId, $sourceMeta),\n        'organisation' => $handler->getOrganisation($sourceId, $sourceMeta),\n    ];\n}\n\n/**\n * Split text into chunks.\n */\npublic function textToChunks(array $payload, array $options = []): array {\n    $chunkSize = $options['chunk_size'] ?? self::DEFAULT_CHUNK_SIZE;\n    $chunkOverlap = $options['chunk_overlap'] ?? self::DEFAULT_CHUNK_OVERLAP;\n    $strategy = $options['strategy'] ?? self::RECURSIVE_CHARACTER;\n    \n    // Apply chunking strategy\n    $chunks = match($strategy) {\n        self::FIXED_SIZE => $this->chunkFixedSize($payload['text'], $chunkSize, $chunkOverlap),\n        self::RECURSIVE_CHARACTER => $this->chunkRecursive($payload['text'], $chunkSize, $chunkOverlap),\n        default => $this->chunkRecursive($payload['text'], $chunkSize, $chunkOverlap)\n    };\n    \n    // Map to chunk entities with checksum\n    return array_map(function($index, $chunkText) use ($payload, $chunkSize) {\n        return [\n            'text_content' => $chunkText,\n            'chunk_index' => $index,\n            'start_offset' => $index * $chunkSize,\n            'end_offset' => ($index * $chunkSize) + strlen($chunkText),\n            'checksum' => $payload['checksum'] ?? null,\n        ];\n    }, array_keys($chunks), $chunks);\n}\n\n/**\n * Persist chunks to database.\n */\npublic function persistChunksForSource(\n    string $sourceType,\n    int $sourceId,\n    array $chunks,\n    ?string $owner,\n    ?string $organisation,\n    int $sourceTimestamp,\n    array $payload\n): void {\n    // Delete existing chunks for this source\n    $this->chunkMapper->deleteBySource($sourceType, $sourceId);\n    \n    // Create new chunks\n    foreach ($chunks as $chunkData) {\n        $chunk = new Chunk();\n        $chunk->setUuid(Uuid::v4()->toString());\n        $chunk->setSourceType($sourceType);\n        $chunk->setSourceId($sourceId);\n        $chunk->setTextContent($chunkData['text_content']);\n        $chunk->setStartOffset($chunkData['start_offset']);\n        $chunk->setEndOffset($chunkData['end_offset']);\n        $chunk->setChunkIndex($chunkData['chunk_index']);\n        $chunk->setChecksum($chunkData['checksum'] ?? null);\n        $chunk->setOwner($owner);\n        $chunk->setOrganisation($organisation);\n        \n        $this->chunkMapper->insert($chunk);\n    }\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"change-detection",children:"Change Detection"}),"\n",(0,t.jsx)(n.p,{children:"The system uses SHA256 checksums to detect content changes:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"// Calculate checksum from extracted text\n$checksum = hash('sha256', $extractedText);\n\n// Check if source is up-to-date\npublic function isSourceUpToDate(\n    int $sourceId,\n    string $sourceType,\n    int $sourceTimestamp,\n    bool $forceReExtract\n): bool {\n    if ($forceReExtract === true) {\n        return false;\n    }\n    \n    // Get existing chunks\n    $existingChunks = $this->chunkMapper->findBySource($sourceType, $sourceId);\n    \n    if (empty($existingChunks)) {\n        return false;\n    }\n    \n    // Check if checksum matches\n    $existingChecksum = $existingChunks[0]->getChecksum();\n    $currentChecksum = $this->calculateSourceChecksum($sourceId, $sourceType);\n    \n    return $existingChecksum === $currentChecksum;\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Benefits"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Avoids unnecessary re-extraction"}),"\n",(0,t.jsx)(n.li,{children:"Efficient change detection"}),"\n",(0,t.jsx)(n.li,{children:"Automatic updates on content modification"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"performance",children:"Performance"}),"\n",(0,t.jsx)(n.h3,{id:"processing-times",children:"Processing Times"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"File Type"}),(0,t.jsx)(n.th,{children:"Size"}),(0,t.jsx)(n.th,{children:"Extraction Time"}),(0,t.jsx)(n.th,{children:"Chunking Time"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Text (.txt)"}),(0,t.jsx)(n.td,{children:"< 1MB"}),(0,t.jsx)(n.td,{children:"< 1s"}),(0,t.jsx)(n.td,{children:"50ms"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"PDF (text)"}),(0,t.jsx)(n.td,{children:"< 5MB"}),(0,t.jsx)(n.td,{children:"1-3s"}),(0,t.jsx)(n.td,{children:"100ms"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"PDF (OCR)"}),(0,t.jsx)(n.td,{children:"< 5MB"}),(0,t.jsx)(n.td,{children:"10-60s"}),(0,t.jsx)(n.td,{children:"100ms"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"DOCX"}),(0,t.jsx)(n.td,{children:"< 5MB"}),(0,t.jsx)(n.td,{children:"1-2s"}),(0,t.jsx)(n.td,{children:"100ms"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"XLSX"}),(0,t.jsx)(n.td,{children:"< 5MB"}),(0,t.jsx)(n.td,{children:"2-5s"}),(0,t.jsx)(n.td,{children:"150ms"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Images (OCR)"}),(0,t.jsx)(n.td,{children:"< 5MB"}),(0,t.jsx)(n.td,{children:"5-15s"}),(0,t.jsx)(n.td,{children:"50ms"})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"bulk-processing",children:"Bulk Processing"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Batch Size"}),": 100 items per batch (configurable)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Parallel Processing"}),": Supported via background jobs"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Progress Tracking"}),": Real-time status updates"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"api-endpoints",children:"API Endpoints"}),"\n",(0,t.jsx)(n.h3,{id:"text-extraction",children:"Text Extraction"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-http",children:"POST /api/files/{fileId}/extract\nPOST /api/objects/{objectId}/extract\nGET  /api/chunks?source_type=file&source_id={id}\nGET  /api/chunks/{chunkId}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"chunking",children:"Chunking"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-http",children:'POST /api/chunks/chunk\nContent-Type: application/json\n\n{\n  "source_type": "file",\n  "source_id": 12345,\n  "options": {\n    "chunk_size": 1000,\n    "chunk_overlap": 200,\n    "strategy": "RECURSIVE_CHARACTER"\n  }\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,t.jsx)(n.h3,{id:"common-errors",children:"Common Errors"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Error"}),(0,t.jsx)(n.th,{children:"Cause"}),(0,t.jsx)(n.th,{children:"Solution"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"File too large"}),(0,t.jsx)(n.td,{children:"Exceeds format limit"}),(0,t.jsx)(n.td,{children:"Reduce size or increase limit"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Format not supported"}),(0,t.jsx)(n.td,{children:"Unrecognized format"}),(0,t.jsx)(n.td,{children:"Enable format or convert file"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Extraction failed"}),(0,t.jsx)(n.td,{children:"Corrupted file"}),(0,t.jsx)(n.td,{children:"Verify file integrity"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"OCR failed"}),(0,t.jsx)(n.td,{children:"Tesseract not installed"}),(0,t.jsx)(n.td,{children:"Install Tesseract OCR"})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"recovery",children:"Recovery"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Failed extractions can be retried via API"}),"\n",(0,t.jsx)(n.li,{children:"Error messages stored for debugging"}),"\n",(0,t.jsx)(n.li,{children:"Automatic retry on content update"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"processing-pipeline",children:"Processing Pipeline"}),"\n",(0,t.jsx)(n.h3,{id:"step-by-step-flow",children:"Step-by-Step Flow"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 1. File Upload                                          \u2502\n\u2502    - User uploads file to Nextcloud                     \u2502\n\u2502    - File stored in data directory                      \u2502\n\u2502    - Upload completes immediately (non-blocking)        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                     \u2502\n                     \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 2. Background Job Queued                                \u2502\n\u2502    - FileChangeListener detects new/updated file        \u2502\n\u2502    - Queues FileTextExtractionJob asynchronously        \u2502\n\u2502    - User request completes without delay               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                     \u2502\n                     \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 3. Background Processing (non-blocking)                 \u2502\n\u2502    - Job runs in background (typically within seconds)  \u2502\n\u2502    - Check MIME type and validate format                \u2502\n\u2502    - Use format-specific extractor                      \u2502\n\u2502    - Handle encoding issues                             \u2502\n\u2502    - Clean/normalize text                               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                     \u2502\n                     \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 4. Document Chunking                                    \u2502\n\u2502    - Apply selected strategy                            \u2502\n\u2502    - Create overlapping chunks                          \u2502\n\u2502    - Preserve metadata                                  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                     \u2502\n                     \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 5. Storage                                              \u2502\n\u2502    - Store chunks in database                           \u2502\n\u2502    - Calculate and store checksum                       \u2502\n\u2502    - Link chunks to source                             \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,t.jsx)(n.h3,{id:"event-listener",children:"Event Listener"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Location"}),": ",(0,t.jsx)(n.code,{children:"lib/Listener/FileChangeListener.php"})]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Purpose"}),": Automatically process files on upload/update."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Events"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"NodeCreatedEvent"})," - File uploaded"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"NodeWrittenEvent"})," - File updated"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Behavior"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Checks if extraction is needed (checksum comparison)"}),"\n",(0,t.jsx)(n.li,{children:"Triggers text extraction automatically via background job"}),"\n",(0,t.jsx)(n.li,{children:"Updates extraction status"}),"\n",(0,t.jsx)(n.li,{children:"Full error handling and logging"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Registration"}),": Registered in ",(0,t.jsx)(n.code,{children:"Application.php"})," with service container integration."]}),"\n",(0,t.jsx)(n.h2,{id:"file-size-limits",children:"File Size Limits"}),"\n",(0,t.jsx)(n.h3,{id:"default-limits",children:"Default Limits"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Format"}),(0,t.jsx)(n.th,{children:"Default Max Size"}),(0,t.jsx)(n.th,{children:"Configurable"}),(0,t.jsx)(n.th,{children:"Reason"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Text/Markdown"}),(0,t.jsx)(n.td,{children:"100MB"}),(0,t.jsx)(n.td,{children:"Yes"}),(0,t.jsx)(n.td,{children:"Memory-efficient"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"HTML"}),(0,t.jsx)(n.td,{children:"20MB"}),(0,t.jsx)(n.td,{children:"Yes"}),(0,t.jsx)(n.td,{children:"DOM parsing overhead"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"PDF (text)"}),(0,t.jsx)(n.td,{children:"100MB"}),(0,t.jsx)(n.td,{children:"Yes"}),(0,t.jsx)(n.td,{children:"Direct extraction"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"PDF (OCR)"}),(0,t.jsx)(n.td,{children:"50MB"}),(0,t.jsx)(n.td,{children:"Yes"}),(0,t.jsx)(n.td,{children:"Processing intensive"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Office Docs"}),(0,t.jsx)(n.td,{children:"30-50MB"}),(0,t.jsx)(n.td,{children:"Yes"}),(0,t.jsx)(n.td,{children:"Library limitations"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Images"}),(0,t.jsx)(n.td,{children:"20MB"}),(0,t.jsx)(n.td,{children:"Yes"}),(0,t.jsx)(n.td,{children:"OCR memory usage"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"JSON/XML"}),(0,t.jsx)(n.td,{children:"20MB"}),(0,t.jsx)(n.td,{children:"Yes"}),(0,t.jsx)(n.td,{children:"Parsing complexity"})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"modifying-limits",children:"Modifying Limits"}),"\n",(0,t.jsxs)(n.p,{children:["Edit ",(0,t.jsx)(n.code,{children:"lib/Service/SolrFileService.php"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"// File size limits (in bytes)\nprivate const MAX_FILE_SIZE_TEXT = 104857600;  // 100MB\nprivate const MAX_FILE_SIZE_PDF = 104857600;   // 100MB\nprivate const MAX_FILE_SIZE_OFFICE = 52428800; // 50MB\nprivate const MAX_FILE_SIZE_IMAGE = 20971520;  // 20MB\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Warning"}),": Increasing limits may cause:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Memory exhaustion"}),"\n",(0,t.jsx)(n.li,{children:"Slow processing"}),"\n",(0,t.jsx)(n.li,{children:"Timeouts on large files"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"dependencies",children:"Dependencies"}),"\n",(0,t.jsx)(n.h3,{id:"php-libraries-installed-via-composer",children:"PHP Libraries (Installed via Composer)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "smalot/pdfparser": "^2.0",           // PDF text extraction\n  "phpoffice/phpword": "^1.0",          // Word document processing\n  "phpoffice/phpspreadsheet": "^1.0"    // Excel processing\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"system-commands",children:"System Commands"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Command"}),(0,t.jsx)(n.th,{children:"Purpose"}),(0,t.jsx)(n.th,{children:"Installation"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"pdftotext"})}),(0,t.jsx)(n.td,{children:"PDF extraction fallback"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"apt-get install poppler-utils"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"tesseract"})}),(0,t.jsx)(n.td,{children:"OCR for images/scanned PDFs"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"apt-get install tesseract-ocr"})})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"checking-dependencies",children:"Checking Dependencies"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Check if pdftotext is available\nwhich pdftotext\n\n# Check Tesseract version\ntesseract --version\n\n# Test OCR\ntesseract test-image.png output\n"})}),"\n",(0,t.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,t.jsx)(n.h3,{id:"debugging-file-processing",children:"Debugging File Processing"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Enable Debug Logging"}),":"]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Go to Settings \u2192 File Management"}),"\n",(0,t.jsx)(n.li,{children:'Enable "Detailed Logging"'}),"\n",(0,t.jsxs)(n.li,{children:["Check logs at: ",(0,t.jsx)(n.code,{children:"data/nextcloud.log"})," or via Docker: ",(0,t.jsx)(n.code,{children:"docker logs nextcloud-container"})]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Look for"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"[TextExtractionService] Processing file: document.pdf\n[TextExtractionService] Extraction method: pdfParser\n[TextExtractionService] Extracted text length: 45678\n[TextExtractionService] Created 12 chunks\n"})}),"\n",(0,t.jsx)(n.h3,{id:"performance-issues",children:"Performance Issues"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"If processing is slow"}),":"]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Check file size and format"}),"\n",(0,t.jsxs)(n.li,{children:["Monitor memory usage: ",(0,t.jsx)(n.code,{children:"docker stats"})]}),"\n",(0,t.jsx)(n.li,{children:"Reduce chunk size to decrease processing time"}),"\n",(0,t.jsx)(n.li,{children:"Use faster extraction methods when possible"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"file-access-issues",children:"File Access Issues"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"If you see 'file not found' or 'failed to open stream' errors"}),":"]}),"\n",(0,t.jsx)(n.p,{children:"The system uses asynchronous background jobs to process files:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Non-blocking uploads"}),": File uploads complete immediately without waiting for text extraction"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Background processing"}),": Text extraction runs in background jobs (typically within seconds)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Path filtering"}),": Only OpenRegister files are processed"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Automatic retries"}),": Failed extractions are automatically retried by the background job system"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"To check background job status"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# View pending background jobs\ndocker exec -u 33 <nextcloud-container> php occ background-job:list\n\n# Check logs for extraction job status\ndocker logs <nextcloud-container> | grep FileTextExtractionJob\n"})}),"\n",(0,t.jsx)(n.h3,{id:"quality-issues",children:"Quality Issues"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"If text extraction is poor"}),":"]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Verify source file quality"}),"\n",(0,t.jsx)(n.li,{children:"For scanned documents, ensure 300+ DPI"}),"\n",(0,t.jsx)(n.li,{children:"Use native PDF over scanned when possible"}),"\n",(0,t.jsx)(n.li,{children:"Test with different OCR languages"}),"\n",(0,t.jsx)(n.li,{children:"Check for corrupted files"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,t.jsx)(n.h3,{id:"for-administrators",children:"For Administrators"}),"\n",(0,t.jsxs)(n.p,{children:["\u2705 ",(0,t.jsx)(n.strong,{children:"Do"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Enable only needed file formats"}),"\n",(0,t.jsx)(n.li,{children:"Set reasonable size limits"}),"\n",(0,t.jsx)(n.li,{children:"Monitor storage growth"}),"\n",(0,t.jsx)(n.li,{children:"Schedule bulk processing off-hours"}),"\n",(0,t.jsx)(n.li,{children:"Keep dependencies updated"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["\u274c ",(0,t.jsx)(n.strong,{children:"Don't"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Process unnecessary file types"}),"\n",(0,t.jsx)(n.li,{children:"Set extremely high size limits"}),"\n",(0,t.jsx)(n.li,{children:"Skip dependency checks"}),"\n",(0,t.jsx)(n.li,{children:"Run bulk processing during peak hours"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"for-users",children:"For Users"}),"\n",(0,t.jsxs)(n.p,{children:["\u2705 ",(0,t.jsx)(n.strong,{children:"Do"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Use text-based PDFs when possible"}),"\n",(0,t.jsx)(n.li,{children:"Provide high-quality scans (300 DPI)"}),"\n",(0,t.jsx)(n.li,{children:"Use consistent file naming"}),"\n",(0,t.jsx)(n.li,{children:"Organize files in logical folders"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["\u274c ",(0,t.jsx)(n.strong,{children:"Don't"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Upload password-protected files (won't extract)"}),"\n",(0,t.jsx)(n.li,{children:"Use low-resolution scans"}),"\n",(0,t.jsx)(n.li,{children:"Mix unrelated content in single file"}),"\n",(0,t.jsx)(n.li,{children:"Rely on OCR for perfect accuracy"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"faq",children:"FAQ"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Q: Can I process password-protected files?"}),(0,t.jsx)(n.br,{}),"\n","A: No, password-protected files cannot be extracted. Remove password first."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Q: How accurate is OCR?"}),(0,t.jsx)(n.br,{}),"\n","A: 90-98% accuracy for good quality scans (300 DPI, clear text). Lower for poor scans."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Q: Can I process files retroactively?"}),(0,t.jsx)(n.br,{}),"\n","A: Yes! Use bulk extraction via API or admin interface."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Q: Do I need to re-process files after changing chunk strategy?"}),(0,t.jsx)(n.br,{}),"\n","A: Yes, existing chunks won't update automatically. Re-extract to apply new strategy."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Q: What happens to old chunks when I re-process?"}),(0,t.jsx)(n.br,{}),"\n","A: Old chunks are replaced with new ones. Checksums ensure only changed content is re-processed."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Q: Can I see extracted text before chunking?"}),(0,t.jsx)(n.br,{}),"\n","A: Check logs with debug mode enabled. Text is logged before chunking."]}),"\n",(0,t.jsx)(n.h2,{id:"migration",children:"Migration"}),"\n",(0,t.jsx)(n.h3,{id:"from-filetext-to-chunks",children:"From FileText to Chunks"}),"\n",(0,t.jsxs)(n.p,{children:["The old ",(0,t.jsx)(n.code,{children:"FileText"})," entity stored chunks in ",(0,t.jsx)(n.code,{children:"chunks_json"}),". Migration to dedicated ",(0,t.jsx)(n.code,{children:"Chunk"})," table:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"// Migration: Version1Date20251118000000\n// Drops deprecated openregister_file_texts and openregister_object_texts tables\n\n// Migration: Version1Date20251117000000\n// Adds checksum column to openregister_chunks table\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Migration Strategy"}),":"]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Create ",(0,t.jsx)(n.code,{children:"openregister_chunks"})," table"]}),"\n",(0,t.jsxs)(n.li,{children:["Migrate existing chunks from ",(0,t.jsx)(n.code,{children:"chunks_json"})," to table"]}),"\n",(0,t.jsxs)(n.li,{children:["Update services to use ",(0,t.jsx)(n.code,{children:"ChunkMapper"})]}),"\n",(0,t.jsx)(n.li,{children:"Drop old tables (after verification)"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,t.jsx)(n.h3,{id:"feature-documentation",children:"Feature Documentation"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.a,{href:"/docs/Features/text-extraction-vectorization-ner",children:"Text Extraction, Vectorization & Named Entity Recognition"})})," - Unified feature documentation"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.a,{href:"/docs/features/text-extraction-sources",children:"Text Extraction Sources"})})," - Source-specific details (files vs objects)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.a,{href:"/docs/features/text-extraction-enhanced",children:"Enhanced Text Extraction"})})," - GDPR and language features"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"technical-documentation",children:"Technical Documentation"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.a,{href:"/docs/technical/vectorization",children:"Vectorization Technical Documentation"})})," - Vector embedding implementation"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.a,{href:"/docs/technical/named-entity-recognition",children:"Named Entity Recognition Technical Documentation"})})," - NER implementation"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}}}]);