"use strict";(self.webpackChunkopen_catalogi_docs=self.webpackChunkopen_catalogi_docs||[]).push([[1744],{28453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>c});var i=t(96540);const s={},r=i.createContext(s);function o(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),i.createElement(r.Provider,{value:n},e.children)}},52702:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"technical/named-entity-recognition","title":"Named Entity Recognition Technical Documentation","description":"Complete technical documentation for named entity recognition and GDPR compliance","source":"@site/docs/technical/named-entity-recognition.md","sourceDirName":"technical","slug":"/technical/named-entity-recognition","permalink":"/docs/technical/named-entity-recognition","draft":false,"unlisted":false,"editUrl":"https://github.com/conductionnl/openregister/tree/main/website/docs/technical/named-entity-recognition.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"title":"Named Entity Recognition Technical Documentation","sidebar_position":3,"description":"Complete technical documentation for named entity recognition and GDPR compliance","keywords":["Named Entity Recognition","NER","Entity Extraction","GDPR","PII Detection"]},"sidebar":"tutorialSidebar","previous":{"title":"Vectorization Technical Documentation","permalink":"/docs/technical/vectorization"},"next":{"title":"Schema Technical Documentation","permalink":"/docs/technical/schemas"}}');var s=t(74848),r=t(28453);const o={title:"Named Entity Recognition Technical Documentation",sidebar_position:3,description:"Complete technical documentation for named entity recognition and GDPR compliance",keywords:["Named Entity Recognition","NER","Entity Extraction","GDPR","PII Detection"]},c="Named Entity Recognition Technical Documentation",d={},a=[{value:"Overview",id:"overview",level:2},{value:"Architecture",id:"architecture",level:2},{value:"Service Flow",id:"service-flow",level:3},{value:"Service Implementation",id:"service-implementation",level:2},{value:"NamedEntityRecognitionService",id:"namedentityrecognitionservice",level:3},{value:"Database Schema",id:"database-schema",level:2},{value:"Entity Table (GDPR Register)",id:"entity-table-gdpr-register",level:3},{value:"Entity Relation Table",id:"entity-relation-table",level:3},{value:"Entity Types",id:"entity-types",level:2},{value:"Supported Entity Types",id:"supported-entity-types",level:3},{value:"Entity Categories",id:"entity-categories",level:3},{value:"Detection Methods",id:"detection-methods",level:2},{value:"1. Regex Patterns (Local)",id:"1-regex-patterns-local",level:3},{value:"2. Presidio (External Service)",id:"2-presidio-external-service",level:3},{value:"3. LLM-Based (AI)",id:"3-llm-based-ai",level:3},{value:"4. Hybrid Approach (Recommended)",id:"4-hybrid-approach-recommended",level:3},{value:"Entity Storage",id:"entity-storage",level:2},{value:"Finding or Creating Entities",id:"finding-or-creating-entities",level:3},{value:"Performance",id:"performance",level:2},{value:"Processing Times",id:"processing-times",level:3},{value:"Recommendations",id:"recommendations",level:3},{value:"API Endpoints",id:"api-endpoints",level:2},{value:"Entity Extraction",id:"entity-extraction",level:3},{value:"GDPR Reports",id:"gdpr-reports",level:3},{value:"Entity Relationships",id:"entity-relationships",level:2},{value:"EntityLink Table",id:"entitylink-table",level:3},{value:"Relationship Types",id:"relationship-types",level:3},{value:"belongs_to: Contact Information Ownership",id:"belongs_to-contact-information-ownership",level:4},{value:"associated_with: Generic Association",id:"associated_with-generic-association",level:4},{value:"primary_contact / alternate_contact: Contact Priority",id:"primary_contact--alternate_contact-contact-priority",level:4},{value:"Detection Methods",id:"detection-methods-1",level:3},{value:"1. Proximity Detection",id:"1-proximity-detection",level:4},{value:"2. Pattern Matching",id:"2-pattern-matching",level:4},{value:"3. LLM Analysis",id:"3-llm-analysis",level:4},{value:"Configuration",id:"configuration",level:2},{value:"NER Settings",id:"ner-settings",level:3},{value:"Related Documentation",id:"related-documentation",level:2},{value:"Feature Documentation",id:"feature-documentation",level:3},{value:"Technical Documentation",id:"technical-documentation",level:3}];function l(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"named-entity-recognition-technical-documentation",children:"Named Entity Recognition Technical Documentation"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"\ud83d\udcda Feature Documentation"}),": See ",(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.a,{href:"/docs/Features/text-extraction-vectorization-ner",children:"Text Extraction, Vectorization & Named Entity Recognition"})})," for user-facing documentation and overview."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsx)(n.p,{children:"OpenRegister's NamedEntityRecognitionService extracts entities (persons, organizations, emails, etc.) from text chunks for GDPR compliance and data classification. The service supports multiple detection methods and stores entities in a GDPR register."}),"\n",(0,s.jsx)(n.h2,{id:"architecture",children:"Architecture"}),"\n",(0,s.jsx)(n.h3,{id:"service-flow",children:"Service Flow"}),"\n",(0,s.jsx)(n.mermaid,{value:"sequenceDiagram\n    participant Chunk\n    participant NER as NamedEntityRecognitionService\n    participant Detector as Entity Detector\n    participant EntityDB as Entity Storage\n    participant RelationDB as Relation Storage\n    \n    Chunk->>NER: Extract entities\n    NER->>Detector: Detect entities (regex/presidio/llm)\n    Detector->>Detector: Find entities in text\n    Detector->>Detector: Calculate confidence\n    Detector--\x3e>NER: Return detected entities\n    \n    loop For each entity\n        NER->>EntityDB: Find or create entity\n        EntityDB--\x3e>NER: Entity ID\n        NER->>RelationDB: Create entity relation\n        RelationDB--\x3e>NER: Relation created\n    end\n    \n    NER--\x3e>Chunk: Entities extracted"}),"\n",(0,s.jsx)(n.h2,{id:"service-implementation",children:"Service Implementation"}),"\n",(0,s.jsx)(n.h3,{id:"namedentityrecognitionservice",children:"NamedEntityRecognitionService"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Location"}),": ",(0,s.jsx)(n.code,{children:"lib/Service/NamedEntityRecognitionService.php"})]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Key Methods"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"/**\n * Extract entities from a text chunk.\n */\npublic function extractFromChunk(Chunk $chunk, array $options = []): array\n{\n    $method = $options['method'] ?? 'hybrid';\n    $entityTypes = $options['entity_types'] ?? null;\n    $confidenceThreshold = (float) ($options['confidence_threshold'] ?? 0.5);\n    \n    $text = $chunk->getTextContent();\n    \n    // Detect entities using selected method\n    $detectedEntities = $this->detectEntities($text, $method, $entityTypes, $confidenceThreshold);\n    \n    // Store entities and create relations\n    $entitiesFound = 0;\n    $relationsCreated = 0;\n    \n    foreach ($detectedEntities as $detected) {\n        // Find or create entity\n        $entity = $this->findOrCreateEntity(\n            $detected['type'],\n            $detected['value'],\n            $detected['category'] ?? $this->getCategoryForType($detected['type'])\n        );\n        \n        // Create entity relation\n        $relation = new EntityRelation();\n        $relation->setEntityId($entity->getId());\n        $relation->setChunkId($chunk->getId());\n        $relation->setPositionStart($detected['position_start']);\n        $relation->setPositionEnd($detected['position_end']);\n        $relation->setConfidence($detected['confidence']);\n        $relation->setDetectionMethod($method);\n        $relation->setContext($this->extractContext($text, $detected['position_start'], $detected['position_end']));\n        \n        // Set source references\n        if ($chunk->getSourceType() === 'file') {\n            $relation->setFileId($chunk->getSourceId());\n        } else if ($chunk->getSourceType() === 'object') {\n            $relation->setObjectId($chunk->getSourceId());\n        }\n        \n        $this->entityRelationMapper->insert($relation);\n        $entitiesFound++;\n        $relationsCreated++;\n    }\n    \n    return [\n        'entities_found' => $entitiesFound,\n        'relations_created' => $relationsCreated,\n    ];\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"database-schema",children:"Database Schema"}),"\n",(0,s.jsx)(n.h3,{id:"entity-table-gdpr-register",children:"Entity Table (GDPR Register)"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Table"}),": ",(0,s.jsx)(n.code,{children:"oc_openregister_entities"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE oc_openregister_entities (\n    id BIGINT AUTO_INCREMENT PRIMARY KEY,\n    uuid VARCHAR(255) NOT NULL UNIQUE,\n    type VARCHAR(50) NOT NULL,\n    value TEXT NOT NULL,\n    category VARCHAR(50) NOT NULL,\n    belongs_to_entity_id BIGINT,\n    metadata JSON,\n    owner VARCHAR(255),\n    organisation VARCHAR(255),\n    detected_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n    \n    INDEX idx_type (type),\n    INDEX idx_category (category),\n    INDEX idx_detected (detected_at),\n    INDEX idx_value_hash (value(255)),\n    INDEX idx_owner (owner),\n    INDEX idx_organisation (organisation),\n    INDEX idx_belongs_to (belongs_to_entity_id),\n    \n    FOREIGN KEY (belongs_to_entity_id) REFERENCES oc_openregister_entities(id) ON DELETE SET NULL\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Key Fields"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"type"}),": Entity type (PERSON, EMAIL, PHONE, ORGANIZATION, etc.)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"value"}),": The entity value (e.g., '",(0,s.jsx)(n.a,{href:"mailto:john.doe@example.com",children:"john.doe@example.com"}),"')"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"category"}),": Classification (personal_data, sensitive_pii, business_data)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"belongs_to_entity_id"}),": Parent entity (e.g., phone belongs to person)"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"entity-relation-table",children:"Entity Relation Table"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Table"}),": ",(0,s.jsx)(n.code,{children:"oc_openregister_entity_relations"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE oc_openregister_entity_relations (\n    id BIGINT AUTO_INCREMENT PRIMARY KEY,\n    entity_id BIGINT NOT NULL,\n    chunk_id BIGINT NOT NULL,\n    role VARCHAR(50),\n    file_id BIGINT,\n    object_id BIGINT,\n    email_id BIGINT,\n    position_start INT NOT NULL,\n    position_end INT NOT NULL,\n    confidence DECIMAL(3,2) NOT NULL,\n    detection_method VARCHAR(50) NOT NULL,\n    context TEXT,\n    anonymized BOOLEAN NOT NULL DEFAULT FALSE,\n    anonymized_value VARCHAR(255),\n    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    \n    INDEX idx_entity (entity_id),\n    INDEX idx_chunk (chunk_id),\n    INDEX idx_file (file_id),\n    INDEX idx_object (object_id),\n    INDEX idx_confidence (confidence),\n    INDEX idx_anonymized (anonymized),\n    \n    FOREIGN KEY (entity_id) REFERENCES oc_openregister_entities(id) ON DELETE CASCADE,\n    FOREIGN KEY (chunk_id) REFERENCES oc_openregister_chunks(id) ON DELETE CASCADE\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Key Fields"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"entity_id"}),": Reference to Entity"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"chunk_id"}),": Reference to Chunk"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"position_start"})," / ",(0,s.jsx)(n.code,{children:"position_end"}),": Character positions in chunk"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"confidence"}),": Detection confidence (0.00-1.00)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"detection_method"}),": How it was found (regex, presidio, llm, hybrid)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"context"}),": Surrounding text for verification"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"entity-types",children:"Entity Types"}),"\n",(0,s.jsx)(n.h3,{id:"supported-entity-types",children:"Supported Entity Types"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Entity Type"}),(0,s.jsx)(n.th,{children:"Description"}),(0,s.jsx)(n.th,{children:"Examples"}),(0,s.jsx)(n.th,{children:"GDPR Category"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"PERSON"})}),(0,s.jsx)(n.td,{children:"Individual names"}),(0,s.jsx)(n.td,{children:"John Doe, Jane Smith"}),(0,s.jsx)(n.td,{children:"Personal Data"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"EMAIL"})}),(0,s.jsx)(n.td,{children:"Email addresses"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"mailto:john@example.com",children:"john@example.com"})}),(0,s.jsx)(n.td,{children:"Personal Data"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"PHONE"})}),(0,s.jsx)(n.td,{children:"Phone numbers"}),(0,s.jsx)(n.td,{children:"+31 6 12345678"}),(0,s.jsx)(n.td,{children:"Personal Data"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"ADDRESS"})}),(0,s.jsx)(n.td,{children:"Physical addresses"}),(0,s.jsx)(n.td,{children:"123 Main St, Amsterdam"}),(0,s.jsx)(n.td,{children:"Personal Data"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"ORGANIZATION"})}),(0,s.jsx)(n.td,{children:"Company/org names"}),(0,s.jsx)(n.td,{children:"Acme Corporation"}),(0,s.jsx)(n.td,{children:"Business Data"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"LOCATION"})}),(0,s.jsx)(n.td,{children:"Geographic locations"}),(0,s.jsx)(n.td,{children:"Amsterdam, Netherlands"}),(0,s.jsx)(n.td,{children:"Contextual Data"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"DATE"})}),(0,s.jsx)(n.td,{children:"Dates and times"}),(0,s.jsx)(n.td,{children:"2025-01-15, January 15th"}),(0,s.jsx)(n.td,{children:"Temporal Data"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"IBAN"})}),(0,s.jsx)(n.td,{children:"Bank account numbers"}),(0,s.jsx)(n.td,{children:"NL91 ABNA 0417 1643 00"}),(0,s.jsx)(n.td,{children:"Sensitive PII"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"SSN"})}),(0,s.jsx)(n.td,{children:"Social security numbers"}),(0,s.jsx)(n.td,{children:"123-45-6789"}),(0,s.jsx)(n.td,{children:"Sensitive PII"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"IP_ADDRESS"})}),(0,s.jsx)(n.td,{children:"IP addresses"}),(0,s.jsx)(n.td,{children:"192.168.1.1"}),(0,s.jsx)(n.td,{children:"Contextual Data"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"entity-categories",children:"Entity Categories"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Category"}),(0,s.jsx)(n.th,{children:"Description"}),(0,s.jsx)(n.th,{children:"Examples"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"personal_data"})}),(0,s.jsx)(n.td,{children:"Personal identifiable information"}),(0,s.jsx)(n.td,{children:"PERSON, EMAIL, PHONE, ADDRESS"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"sensitive_pii"})}),(0,s.jsx)(n.td,{children:"Highly sensitive PII"}),(0,s.jsx)(n.td,{children:"IBAN, SSN"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"business_data"})}),(0,s.jsx)(n.td,{children:"Business-related entities"}),(0,s.jsx)(n.td,{children:"ORGANIZATION"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"contextual_data"})}),(0,s.jsx)(n.td,{children:"Contextual information"}),(0,s.jsx)(n.td,{children:"LOCATION, IP_ADDRESS"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"temporal_data"})}),(0,s.jsx)(n.td,{children:"Time-related information"}),(0,s.jsx)(n.td,{children:"DATE"})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"detection-methods",children:"Detection Methods"}),"\n",(0,s.jsx)(n.h3,{id:"1-regex-patterns-local",children:"1. Regex Patterns (Local)"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Status"}),": \u2705 Implemented"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Advantages"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"No external dependencies"}),"\n",(0,s.jsx)(n.li,{children:"Fast processing (~10-50ms per chunk)"}),"\n",(0,s.jsx)(n.li,{children:"Privacy-friendly (no data leaves server)"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Limitations"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Lower accuracy for complex cases"}),"\n",(0,s.jsx)(n.li,{children:"Limited context awareness"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Supported Entities"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Email addresses"}),"\n",(0,s.jsx)(n.li,{children:"Phone numbers"}),"\n",(0,s.jsx)(n.li,{children:"IBANs"}),"\n",(0,s.jsx)(n.li,{children:"Basic patterns"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Implementation"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"private function detectWithRegex(string $text, ?array $entityTypes, float $confidenceThreshold): array\n{\n    $entities = [];\n    \n    // Email detection\n    if ($entityTypes === null || in_array(self::ENTITY_TYPE_EMAIL, $entityTypes, true)) {\n        if (preg_match_all('/\\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Z|a-z]{2,}\\b/', $text, $matches, PREG_OFFSET_CAPTURE)) {\n            foreach ($matches[0] as $match) {\n                $entities[] = [\n                    'type' => self::ENTITY_TYPE_EMAIL,\n                    'value' => $match[0],\n                    'category' => self::CATEGORY_PERSONAL_DATA,\n                    'position_start' => $match[1],\n                    'position_end' => $match[1] + strlen($match[0]),\n                    'confidence' => 0.9,\n                ];\n            }\n        }\n    }\n    \n    // Phone detection\n    if ($entityTypes === null || in_array(self::ENTITY_TYPE_PHONE, $entityTypes, true)) {\n        $phonePattern = '/\\+?[1-9]\\d{1,14}|\\+?31\\s?[0-9]{9}|\\d{3}[-.\\s]?\\d{3}[-.\\s]?\\d{4}/';\n        if (preg_match_all($phonePattern, $text, $matches, PREG_OFFSET_CAPTURE)) {\n            foreach ($matches[0] as $match) {\n                $entities[] = [\n                    'type' => self::ENTITY_TYPE_PHONE,\n                    'value' => $match[0],\n                    'category' => self::CATEGORY_PERSONAL_DATA,\n                    'position_start' => $match[1],\n                    'position_end' => $match[1] + strlen($match[0]),\n                    'confidence' => 0.7,\n                ];\n            }\n        }\n    }\n    \n    // Filter by confidence threshold\n    return array_filter($entities, fn($e) => $e['confidence'] >= $confidenceThreshold);\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"2-presidio-external-service",children:"2. Presidio (External Service)"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Status"}),": \ud83d\udcdd Planned (TODO)"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Advantages"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"High accuracy"}),"\n",(0,s.jsx)(n.li,{children:"Specialized for PII detection"}),"\n",(0,s.jsx)(n.li,{children:"Maintained by experts"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Limitations"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Requires external service"}),"\n",(0,s.jsx)(n.li,{children:"Data sent to external API"}),"\n",(0,s.jsx)(n.li,{children:"Network latency"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Implementation"})," (Planned):"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"private function detectWithPresidio(string $text, ?array $entityTypes, float $confidenceThreshold): array\n{\n    // TODO: Implement Presidio integration\n    // For now, fall back to regex\n    $this->logger->debug('[NamedEntityRecognitionService] Presidio not yet implemented, using regex fallback');\n    return $this->detectWithRegex($text, $entityTypes, $confidenceThreshold);\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"3-llm-based-ai",children:"3. LLM-Based (AI)"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Status"}),": \ud83d\udcdd Planned (TODO)"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Advantages"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Context-aware detection"}),"\n",(0,s.jsx)(n.li,{children:"Handles ambiguity"}),"\n",(0,s.jsx)(n.li,{children:"Can detect complex entities"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Limitations"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Slower processing (~500-2000ms per chunk)"}),"\n",(0,s.jsx)(n.li,{children:"Higher cost"}),"\n",(0,s.jsx)(n.li,{children:"Requires API access"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Implementation"})," (Planned):"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"private function detectWithLLM(string $text, ?array $entityTypes, float $confidenceThreshold): array\n{\n    // TODO: Implement LLM-based entity extraction\n    // For now, fall back to regex\n    $this->logger->debug('[NamedEntityRecognitionService] LLM extraction not yet implemented, using regex fallback');\n    return $this->detectWithRegex($text, $entityTypes, $confidenceThreshold);\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"4-hybrid-approach-recommended",children:"4. Hybrid Approach (Recommended)"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Status"}),": \u2705 Implemented"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Process"}),":"]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Start with regex for fast detection"}),"\n",(0,s.jsx)(n.li,{children:"Validate high-confidence entities"}),"\n",(0,s.jsx)(n.li,{children:"Use Presidio/LLM for ambiguous cases (planned)"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Implementation"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"private function detectWithHybrid(string $text, ?array $entityTypes, float $confidenceThreshold): array\n{\n    // Start with regex for fast detection\n    $regexEntities = $this->detectWithRegex($text, $entityTypes, $confidenceThreshold);\n    \n    // TODO: Add Presidio validation for higher confidence\n    // TODO: Add LLM validation for ambiguous cases\n    \n    return $regexEntities;\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"entity-storage",children:"Entity Storage"}),"\n",(0,s.jsx)(n.h3,{id:"finding-or-creating-entities",children:"Finding or Creating Entities"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"private function findOrCreateEntity(string $type, string $value, string $category): GdprEntity\n{\n    // Try to find existing entity by value and type\n    try {\n        $qb = $this->entityMapper->getQueryBuilder();\n        $qb->select('*')\n            ->from('openregister_entities')\n            ->where($qb->expr()->eq('type', $qb->createNamedParameter($type)))\n            ->andWhere($qb->expr()->eq('value', $qb->createNamedParameter($value)))\n            ->setMaxResults(1);\n        \n        $existing = $this->entityMapper->findEntity($qb);\n        \n        // Update timestamp\n        $existing->setUpdatedAt(new DateTime());\n        $this->entityMapper->update($existing);\n        \n        return $existing;\n    } catch (DoesNotExistException $e) {\n        // Entity doesn't exist, create new one\n        $entity = new GdprEntity();\n        $entity->setUuid(Uuid::v4()->toString());\n        $entity->setType($type);\n        $entity->setValue($value);\n        $entity->setCategory($category);\n        $entity->setDetectedAt(new DateTime());\n        $entity->setUpdatedAt(new DateTime());\n        \n        return $this->entityMapper->insert($entity);\n    }\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"performance",children:"Performance"}),"\n",(0,s.jsx)(n.h3,{id:"processing-times",children:"Processing Times"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Method"}),(0,s.jsx)(n.th,{children:"Time per Chunk"}),(0,s.jsx)(n.th,{children:"Notes"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Regex"})}),(0,s.jsx)(n.td,{children:"10-50ms"}),(0,s.jsx)(n.td,{children:"Fast, local"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Presidio"})}),(0,s.jsx)(n.td,{children:"100-300ms"}),(0,s.jsx)(n.td,{children:"External API call"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"LLM"})}),(0,s.jsx)(n.td,{children:"500-2000ms"}),(0,s.jsx)(n.td,{children:"AI processing"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Hybrid"})}),(0,s.jsx)(n.td,{children:"10-2000ms"}),(0,s.jsx)(n.td,{children:"Depends on validation needs"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"recommendations",children:"Recommendations"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Batch Processing"}),": Process enhancements in background jobs"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Selective Enhancement"}),": Only enable features you need"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Hybrid NER"}),": Use fast regex first, validate with LLM only when needed"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Confidence Threshold"}),": Adjust based on use case (default: 0.5)"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"api-endpoints",children:"API Endpoints"}),"\n",(0,s.jsx)(n.h3,{id:"entity-extraction",children:"Entity Extraction"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-http",children:'POST /api/chunks/{chunkId}/extract-entities\nContent-Type: application/json\n\n{\n  "method": "hybrid",\n  "confidence_threshold": 0.7,\n  "entity_types": ["PERSON", "EMAIL", "PHONE"]\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Response"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "entities_found": 5,\n  "relations_created": 5,\n  "entities": [\n    {\n      "type": "PERSON",\n      "value": "John Doe",\n      "confidence": 0.95\n    },\n    {\n      "type": "EMAIL",\n      "value": "john@example.com",\n      "confidence": 0.9\n    }\n  ]\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"gdpr-reports",children:"GDPR Reports"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-http",children:"GET /api/entities\nGET /api/entities/{entityId}\nGET /api/entities/{entityId}/occurrences\nGET /api/gdpr/report\n"})}),"\n",(0,s.jsx)(n.h2,{id:"entity-relationships",children:"Entity Relationships"}),"\n",(0,s.jsx)(n.h3,{id:"entitylink-table",children:"EntityLink Table"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Table"}),": ",(0,s.jsx)(n.code,{children:"oc_openregister_entity_links"})]}),"\n",(0,s.jsx)(n.p,{children:"Links entities to each other to create a knowledge graph of relationships."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE oc_openregister_entity_links (\n    id BIGINT AUTO_INCREMENT PRIMARY KEY,\n    source_entity_id BIGINT NOT NULL,\n    target_entity_id BIGINT NOT NULL,\n    relationship_type VARCHAR(100) NOT NULL,\n    confidence DECIMAL(3,2) NOT NULL,\n    detection_method VARCHAR(50) NOT NULL,\n    metadata JSON,\n    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n    \n    INDEX idx_source (source_entity_id),\n    INDEX idx_target (target_entity_id),\n    INDEX idx_relationship (relationship_type),\n    INDEX idx_confidence (confidence),\n    INDEX idx_both (source_entity_id, target_entity_id),\n    \n    FOREIGN KEY (source_entity_id) REFERENCES oc_openregister_entities(id) ON DELETE CASCADE,\n    FOREIGN KEY (target_entity_id) REFERENCES oc_openregister_entities(id) ON DELETE CASCADE,\n    \n    UNIQUE KEY unique_link (source_entity_id, target_entity_id, relationship_type)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\n"})}),"\n",(0,s.jsx)(n.h3,{id:"relationship-types",children:"Relationship Types"}),"\n",(0,s.jsx)(n.h4,{id:"belongs_to-contact-information-ownership",children:"belongs_to: Contact Information Ownership"}),"\n",(0,s.jsx)(n.p,{children:"The primary relationship type - links contact information to persons or organizations:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Phone Numbers:\n- Phone(+31612345678) \u2192 belongs_to \u2192 Person(John Doe)\n- Phone(+31201234567) \u2192 belongs_to \u2192 Organization(Acme Corp)\n\nEmail Addresses:\n- Email(john.doe@example.com) \u2192 belongs_to \u2192 Person(John Doe)\n- Email(info@acme.com) \u2192 belongs_to \u2192 Organization(Acme Corp)\n\nPhysical Addresses:\n- Address(123 Main St, Amsterdam) \u2192 belongs_to \u2192 Person(John Doe)\n- Address(456 Business Park) \u2192 belongs_to \u2192 Organization(Acme Corp)\n"})}),"\n",(0,s.jsx)(n.h4,{id:"associated_with-generic-association",children:"associated_with: Generic Association"}),"\n",(0,s.jsx)(n.p,{children:"For flexible use cases or uncertain relationships:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Examples:\n- Phone(+31612345678) \u2192 associated_with \u2192 Person(Jane Doe) (uncertain ownership)\n- Email(shared@team.com) \u2192 associated_with \u2192 Organization(Acme Corp) (shared mailbox)\n"})}),"\n",(0,s.jsx)(n.h4,{id:"primary_contact--alternate_contact-contact-priority",children:"primary_contact / alternate_contact: Contact Priority"}),"\n",(0,s.jsx)(n.p,{children:"Marks which contact method is primary:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Examples:\nPerson(John Doe):\n- Email(john.doe@work.com) \u2192 primary_contact \u2192 Person(John Doe)\n- Email(john.personal@gmail.com) \u2192 alternate_contact \u2192 Person(John Doe)\n- Phone(+31612345678) \u2192 primary_contact \u2192 Person(John Doe)\n"})}),"\n",(0,s.jsx)(n.h3,{id:"detection-methods-1",children:"Detection Methods"}),"\n",(0,s.jsx)(n.h4,{id:"1-proximity-detection",children:"1. Proximity Detection"}),"\n",(0,s.jsx)(n.p,{children:"Entities found near each other in text are likely related:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'Text: "Contact John Doe at +31612345678 or john.doe@example.com"\n\nDetection:\n- Person(John Doe) found at position 8-16\n- Phone(+31612345678) found at position 20-33\n- Email(john.doe@example.com) found at position 37-59\n\nLinks Created:\n- Phone \u2192 belongs_to \u2192 Person (confidence: 0.85, method: proximity)\n- Email \u2192 belongs_to \u2192 Person (confidence: 0.85, method: proximity)\n'})}),"\n",(0,s.jsx)(n.h4,{id:"2-pattern-matching",children:"2. Pattern Matching"}),"\n",(0,s.jsx)(n.p,{children:"Known patterns indicate relationships:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'Patterns:\n- "X works for Y" \u2192 works_for\n- "X at Y" \u2192 works_for\n- "Y\'s X" \u2192 belongs_to\n- "X (Y)" \u2192 belongs_to\n\nExample:\nText: "John Doe works for Acme Corp"\n\nLink Created:\n- Person(John Doe) \u2192 works_for \u2192 Organization(Acme Corp)\n  (confidence: 0.95, method: pattern)\n'})}),"\n",(0,s.jsx)(n.h4,{id:"3-llm-analysis",children:"3. LLM Analysis"}),"\n",(0,s.jsx)(n.p,{children:"AI understands context and relationships:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'Text: "Please contact our sales manager regarding this proposal"\n\nContext:\n- Email signature: "John Doe, Sales Manager, Acme Corp"\n- Email metadata: from john.doe@acme.com\n\nLLM Analysis:\n- Person(John Doe) works for Organization(Acme Corp)\n- Email(john.doe@acme.com) belongs to Person(John Doe)\n- Role: Sales Manager (stored in Person metadata)\n\nLinks Created:\n- Person \u2192 works_for \u2192 Organization (confidence: 0.92, method: llm)\n- Email \u2192 belongs_to \u2192 Person (confidence: 0.98, method: llm)\n'})}),"\n",(0,s.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,s.jsx)(n.h3,{id:"ner-settings",children:"NER Settings"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Settings \u2192 OpenRegister \u2192 Text Analysis"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Enable Entity Extraction"}),": Yes/No"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Extraction Method"}),": Regex, Presidio, LLM, Hybrid"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Entity Types"}),": Select types to detect"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Confidence Threshold"}),": Minimum confidence (0.0-1.0)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Context Window"}),": Characters around entity (default: 50)"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,s.jsx)(n.h3,{id:"feature-documentation",children:"Feature Documentation"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.a,{href:"/docs/Features/text-extraction-vectorization-ner",children:"Text Extraction, Vectorization & Named Entity Recognition"})})," - Unified feature documentation"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.a,{href:"/docs/features/text-extraction-enhanced",children:"Enhanced Text Extraction"})})," - GDPR entity tracking features"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"technical-documentation",children:"Technical Documentation"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.a,{href:"/docs/technical/text-extraction",children:"Text Extraction Technical Documentation"})})," - Text extraction implementation"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.a,{href:"/docs/technical/vectorization",children:"Vectorization Technical Documentation"})})," - Vector embedding implementation"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}}}]);