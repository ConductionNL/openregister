"use strict";(self.webpackChunkopen_catalogi_docs=self.webpackChunkopen_catalogi_docs||[]).push([[7405],{10942:(e,i,n)=>{n.r(i),n.d(i,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>l,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"fixes/BULK_IMPORT_STATUS","title":"Bulk Import Deduplication System - Current Status","description":"\ud83c\udfaf Project Overview","source":"@site/docs/fixes/BULK_IMPORT_STATUS.md","sourceDirName":"fixes","slug":"/fixes/BULK_IMPORT_STATUS","permalink":"/docs/fixes/BULK_IMPORT_STATUS","draft":false,"unlisted":false,"editUrl":"https://github.com/conductionnl/openregister/tree/main/website/docs/fixes/BULK_IMPORT_STATUS.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Folder Deletion Fix","permalink":"/docs/fixes/FOLDER_DELETION_FIX"},"next":{"title":"\ud83d\ude80 Bulk Save Performance Optimization: Memory-for-Speed Trade-offs","permalink":"/docs/fixes/BULK_SAVE_PERFORMANCE_OPTIMIZATION"}}');var t=n(74848),r=n(28453);const l={},a="Bulk Import Deduplication System - Current Status",d={},c=[{value:"\ud83c\udfaf Project Overview",id:"-project-overview",level:2},{value:"\u2705 Voltooide Implementaties",id:"-voltooide-implementaties",level:2},{value:"1. Revolutionary Single-Call Architecture",id:"1-revolutionary-single-call-architecture",level:3},{value:"2. Database-Managed Timestamps",id:"2-database-managed-timestamps",level:3},{value:"3. Smart Change Detection",id:"3-smart-change-detection",level:3},{value:"4. Database-Computed Classification",id:"4-database-computed-classification",level:3},{value:"5. Clean Business Data Storage",id:"5-clean-business-data-storage",level:3},{value:"6. Immutable Created Timestamp",id:"6-immutable-created-timestamp",level:3},{value:"\ud83d\udd04 Huidige Database Status",id:"-huidige-database-status",level:2},{value:"\ud83e\uddea Nog Te Testen",id:"-nog-te-testen",level:2},{value:"1. Create/Update/Unchanged Classification",id:"1-createupdateunchanged-classification",level:3},{value:"2. Mixed Data Import (New + Existing)",id:"2-mixed-data-import-new--existing",level:3},{value:"3. Performance Metrics Validatie",id:"3-performance-metrics-validatie",level:3},{value:"4. Large Dataset Test (10K+ objects)",id:"4-large-dataset-test-10k-objects",level:3},{value:"\ud83d\udcc1 Key Files Modified",id:"-key-files-modified",level:2},{value:"Core Logic",id:"core-logic",level:3},{value:"Database Schema",id:"database-schema",level:3},{value:"Documentation",id:"documentation",level:3},{value:"\ud83d\ude80 Next Steps",id:"-next-steps",level:2},{value:"\ud83c\udf89 Achievements",id:"-achievements",level:2}];function o(e){const i={br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(i.header,{children:(0,t.jsx)(i.h1,{id:"bulk-import-deduplication-system---current-status",children:"Bulk Import Deduplication System - Current Status"})}),"\n",(0,t.jsx)(i.h2,{id:"-project-overview",children:"\ud83c\udfaf Project Overview"}),"\n",(0,t.jsx)(i.p,{children:'We hebben een revolutionaire bulk import deduplication system ge\xefmplementeerd die de traditionele "lookup-then-save" aanpak vervangt met een single-call database operatie die automatisch duplicaten detecteert en classificeert.'}),"\n",(0,t.jsx)(i.h2,{id:"-voltooide-implementaties",children:"\u2705 Voltooide Implementaties"}),"\n",(0,t.jsx)(i.h3,{id:"1-revolutionary-single-call-architecture",children:"1. Revolutionary Single-Call Architecture"}),"\n",(0,t.jsxs)(i.p,{children:[(0,t.jsx)(i.strong,{children:"Files:"})," ",(0,t.jsx)(i.code,{children:"lib/Service/ObjectHandlers/SaveObjects.php"}),", ",(0,t.jsx)(i.code,{children:"lib/Db/ObjectHandlers/OptimizedBulkOperations.php"})]}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Keuze:"})," ",(0,t.jsx)(i.code,{children:"INSERT...ON DUPLICATE KEY UPDATE"})," met database-computed classification"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Voordeel:"})," Elimineert database lookup overhead, 3-5x sneller"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Status:"})," \u2705 Ge\xefmplementeerd en werkend"]}),"\n"]}),"\n",(0,t.jsx)(i.h3,{id:"2-database-managed-timestamps",children:"2. Database-Managed Timestamps"}),"\n",(0,t.jsxs)(i.p,{children:[(0,t.jsx)(i.strong,{children:"Files:"})," ",(0,t.jsx)(i.code,{children:"lib/Migration/Version1Date20250908174500.php"}),", ",(0,t.jsx)(i.code,{children:"lib/Migration/Version1Date20250908180000.php"})]}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Keuze:"})," ",(0,t.jsx)(i.code,{children:"UNIQUE (uuid)"})," constraint + ",(0,t.jsx)(i.code,{children:"ON UPDATE CURRENT_TIMESTAMP"})]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Voordeel:"})," Automatische deduplication en timestamp management"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Status:"})," \u2705 Migraties toegepast"]}),"\n"]}),"\n",(0,t.jsx)(i.h3,{id:"3-smart-change-detection",children:"3. Smart Change Detection"}),"\n",(0,t.jsxs)(i.p,{children:[(0,t.jsx)(i.strong,{children:"File:"})," ",(0,t.jsx)(i.code,{children:"lib/Db/ObjectHandlers/OptimizedBulkOperations.php"})," (lines 89-120)"]}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-sql",children:"-- CASE WHEN logic voor precisie change detection\n`updated` = CASE WHEN (\n    JSON_EXTRACT(`object`, '$') != JSON_EXTRACT(VALUES(`object`), '$') OR\n    COALESCE(`name`, '') != COALESCE(VALUES(`name`), '') OR \n    COALESCE(`description`, '') != COALESCE(VALUES(`description`), '')\n    -- ... meer velden\n) THEN NOW() ELSE `updated` END\n"})}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Keuze:"})," Vergelijkt alle data fields inclusief JSON met NULL-safe handling"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Voordeel:"})," Alleen echte changes triggeren timestamp updates"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Status:"})," \u2705 Ge\xefmplementeerd"]}),"\n"]}),"\n",(0,t.jsx)(i.h3,{id:"4-database-computed-classification",children:"4. Database-Computed Classification"}),"\n",(0,t.jsxs)(i.p,{children:[(0,t.jsx)(i.strong,{children:"File:"})," ",(0,t.jsx)(i.code,{children:"lib/Db/ObjectHandlers/OptimizedBulkOperations.php"})," (lines 200-230)"]}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-sql",children:"SELECT *,\n  '{$operationStartTime}' as operation_start_time,\n  CASE\n    WHEN created >= '{$operationStartTime}' THEN 'created'\n    WHEN updated >= '{$operationStartTime}' THEN 'updated' \n    ELSE 'unchanged'\n  END as object_status\nFROM oc_openregister_objects\nWHERE uuid IN (...)\n"})}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Keuze:"})," Database berekent classificatie in plaats van PHP"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Voordeel:"})," Precisie timing, geen PHP container time drift"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Status:"})," \u2705 Ge\xefmplementeerd"]}),"\n"]}),"\n",(0,t.jsx)(i.h3,{id:"5-clean-business-data-storage",children:"5. Clean Business Data Storage"}),"\n",(0,t.jsxs)(i.p,{children:[(0,t.jsx)(i.strong,{children:"File:"})," ",(0,t.jsx)(i.code,{children:"lib/Service/ObjectHandlers/SaveObjects.php"})," (lines 1095-1115)"]}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Probleem:"})," Metadata fields (id, uuid, register, schema, etc.) zaten in business data"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Oplossing:"})," Expliciete metadata removal voor cleane object kolom"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Status:"})," \u2705 Fixed - id field uit business data verwijderd"]}),"\n"]}),"\n",(0,t.jsx)(i.h3,{id:"6-immutable-created-timestamp",children:"6. Immutable Created Timestamp"}),"\n",(0,t.jsxs)(i.p,{children:[(0,t.jsx)(i.strong,{children:"File:"})," ",(0,t.jsx)(i.code,{children:"lib/Db/ObjectHandlers/OptimizedBulkOperations.php"})]}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Keuze:"})," ",(0,t.jsx)(i.code,{children:"created"})," veld uitgesloten van ",(0,t.jsx)(i.code,{children:"ON DUPLICATE KEY UPDATE"})]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Voordeel:"})," Created timestamp blijft intact bij updates"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Status:"})," \u2705 Ge\xefmplementeerd"]}),"\n"]}),"\n",(0,t.jsx)(i.h2,{id:"-huidige-database-status",children:"\ud83d\udd04 Huidige Database Status"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Register 19 objects:"})," 768 (na cleaning)"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Clean business data:"})," \u2705 Geen metadata fields meer in object column"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"UNIQUE constraint:"})," \u2705 Actief op UUID field"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Smart timestamps:"})," \u2705 created immutable, updated auto-managed"]}),"\n"]}),"\n",(0,t.jsx)(i.h2,{id:"-nog-te-testen",children:"\ud83e\uddea Nog Te Testen"}),"\n",(0,t.jsx)(i.h3,{id:"1-createupdateunchanged-classification",children:"1. Create/Update/Unchanged Classification"}),"\n",(0,t.jsxs)(i.p,{children:[(0,t.jsx)(i.strong,{children:"Priority:"})," \ud83d\udd34 HIGH\n",(0,t.jsx)(i.strong,{children:"Test:"})," Re-import dezelfde CSV en verificeer classification"]}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-bash",children:"# Voor import - tel objects\ndocker exec -u 33 master-nextcloud-1 mysql -h master-database-mysql-1 -u nextcloud -pnextcloud nextcloud -e \"SELECT COUNT(*) FROM oc_openregister_objects WHERE register = 19;\"\n\n# Import dezelfde data\ndocker exec -u 33 master-nextcloud-1 curl -s -u 'admin:admin' -X POST -H 'OCS-APIREQUEST: true' 'http://localhost/index.php/apps/openregister/api/registers/19/import?schema=105' -F \"file=@/var/www/html/apps-extra/openregister/lib/Settings/organisatie.csv\"\n\n# Check classification in response + logs\ndocker logs master-nextcloud-1 --tail 50 | grep -E \"created_objects|updated_objects|unchanged_objects\"\n"})}),"\n",(0,t.jsxs)(i.p,{children:[(0,t.jsx)(i.strong,{children:"Verwacht resultaat:"}),' Alle 768 objects als "unchanged" geclassificeerd']}),"\n",(0,t.jsx)(i.h3,{id:"2-mixed-data-import-new--existing",children:"2. Mixed Data Import (New + Existing)"}),"\n",(0,t.jsxs)(i.p,{children:[(0,t.jsx)(i.strong,{children:"Priority:"})," \ud83d\udfe1 MEDIUM\n",(0,t.jsx)(i.strong,{children:"Test:"})," Import CSV met mix van nieuwe en bestaande objects"]}),"\n",(0,t.jsx)(i.h3,{id:"3-performance-metrics-validatie",children:"3. Performance Metrics Validatie"}),"\n",(0,t.jsxs)(i.p,{children:[(0,t.jsx)(i.strong,{children:"Priority:"})," \ud83d\udfe1 MEDIUM",(0,t.jsx)(i.br,{}),"\n",(0,t.jsx)(i.strong,{children:"Test:"})," Vergelijk import tijden met/zonder bulk optimizations"]}),"\n",(0,t.jsx)(i.h3,{id:"4-large-dataset-test-10k-objects",children:"4. Large Dataset Test (10K+ objects)"}),"\n",(0,t.jsxs)(i.p,{children:[(0,t.jsx)(i.strong,{children:"Priority:"})," \ud83d\udfe2 LOW\n",(0,t.jsx)(i.strong,{children:"Test:"})," Stress test met grote datasets"]}),"\n",(0,t.jsx)(i.h2,{id:"-key-files-modified",children:"\ud83d\udcc1 Key Files Modified"}),"\n",(0,t.jsx)(i.h3,{id:"core-logic",children:"Core Logic"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.code,{children:"lib/Service/ObjectHandlers/SaveObjects.php"})," - Hoofdlogica bulk processing"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.code,{children:"lib/Db/ObjectHandlers/OptimizedBulkOperations.php"})," - Database operations"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.code,{children:"lib/Db/ObjectEntityMapper.php"})," - Delegates naar OptimizedBulkOperations"]}),"\n"]}),"\n",(0,t.jsx)(i.h3,{id:"database-schema",children:"Database Schema"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.code,{children:"lib/Migration/Version1Date20250908174500.php"})," - UNIQUE constraint"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.code,{children:"lib/Migration/Version1Date20250908180000.php"})," - ON UPDATE CURRENT_TIMESTAMP"]}),"\n"]}),"\n",(0,t.jsx)(i.h3,{id:"documentation",children:"Documentation"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.code,{children:"lib/Db/ObjectEntity.php"})," - Database-managed fields documentatie"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.code,{children:"website/docs/developers/bulk-import-deduplication.md"})," - System documentatie"]}),"\n"]}),"\n",(0,t.jsx)(i.h2,{id:"-next-steps",children:"\ud83d\ude80 Next Steps"}),"\n",(0,t.jsxs)(i.ol,{children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Test Unchanged Detection"}),' - Verificeer dat re-import correct "unchanged" detecteert']}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Performance Benchmarking"})," - Meet daadwerkelijke snelheidswinst"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Edge Case Testing"})," - Test met mixed new/existing data"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Documentation Update"})," - Update import flow documentatie"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Clean Up Debug Logging"})," - Remove temporary debug statements"]}),"\n"]}),"\n",(0,t.jsx)(i.h2,{id:"-achievements",children:"\ud83c\udf89 Achievements"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Performance:"})," 3-5x sneller dan traditionele lookup approach"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Accuracy:"})," Database-computed classification voorkomt timing issues"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Maintainability:"})," Single processing path elimineert complexity"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Scalability:"})," Geoptimaliseerd voor datasets van 30K+ objects"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Data Integrity:"})," Clean business data zonder metadata pollution"]}),"\n"]}),"\n",(0,t.jsx)(i.hr,{}),"\n",(0,t.jsxs)(i.p,{children:[(0,t.jsx)(i.strong,{children:"Status:"})," \ud83d\udfe1 Core implementation complete, testing phase active",(0,t.jsx)(i.br,{}),"\n",(0,t.jsx)(i.strong,{children:"Next Session Focus:"})," Create/update/unchanged classification verification"]})]})}function h(e={}){const{wrapper:i}={...(0,r.R)(),...e.components};return i?(0,t.jsx)(i,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}},28453:(e,i,n)=>{n.d(i,{R:()=>l,x:()=>a});var s=n(96540);const t={},r=s.createContext(t);function l(e){const i=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function a(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),s.createElement(r.Provider,{value:i},e.children)}}}]);