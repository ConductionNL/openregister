"use strict";(self.webpackChunkopen_catalogi_docs=self.webpackChunkopen_catalogi_docs||[]).push([[799],{9533:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>a,frontMatter:()=>t,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"technical/vector-search-backends","title":"Vector Search Backends","description":"Guide to vector search backend options and configuration","source":"@site/docs/technical/vector-search-backends.md","sourceDirName":"technical","slug":"/technical/vector-search-backends","permalink":"/docs/technical/vector-search-backends","draft":false,"unlisted":false,"editUrl":"https://github.com/conductionnl/openregister/tree/main/website/docs/technical/vector-search-backends.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"title":"Vector Search Backends","sidebar_position":1,"description":"Guide to vector search backend options and configuration","keywords":["Open Register","Vector Search","PostgreSQL","pgvector","Solr","Dense Vector"]},"sidebar":"tutorialSidebar","previous":{"title":"Introduction","permalink":"/docs/intro"},"next":{"title":"Text Extraction Implementation","permalink":"/docs/technical/text-extraction-implementation"}}');var s=r(74848),l=r(28453);const t={title:"Vector Search Backends",sidebar_position:1,description:"Guide to vector search backend options and configuration",keywords:["Open Register","Vector Search","PostgreSQL","pgvector","Solr","Dense Vector"]},c="Vector Search Backends",d={},o=[{value:"Overview",id:"overview",level:2},{value:"Backend Comparison",id:"backend-comparison",level:2},{value:"Performance Comparison",id:"performance-comparison",level:2},{value:"PHP Cosine Similarity (Default)",id:"php-cosine-similarity-default",level:2},{value:"PostgreSQL + pgvector",id:"postgresql--pgvector",level:2},{value:"Solr 9+ Dense Vector Search",id:"solr-9-dense-vector-search",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Settings Location",id:"settings-location",level:3},{value:"Configuration Properties",id:"configuration-properties",level:3},{value:"UI Configuration",id:"ui-configuration",level:3},{value:"Backend Detection",id:"backend-detection",level:3},{value:"Recommended Setup",id:"recommended-setup",level:2},{value:"Migration",id:"migration",level:2},{value:"From PHP to PostgreSQL",id:"from-php-to-postgresql",level:3},{value:"From PHP to Solr",id:"from-php-to-solr",level:3},{value:"Switching Backends",id:"switching-backends",level:3},{value:"Solr Integration Details",id:"solr-integration-details",level:2},{value:"Vector Storage in Existing Collections",id:"vector-storage-in-existing-collections",level:3},{value:"Solr Document Structure",id:"solr-document-structure",level:3},{value:"KNN Query Syntax",id:"knn-query-syntax",level:3},{value:"Configuration",id:"configuration-1",level:3},{value:"Performance Monitoring",id:"performance-monitoring",level:2},{value:"Current Performance",id:"current-performance",level:3},{value:"Performance Targets",id:"performance-targets",level:3},{value:"Performance Comparison",id:"performance-comparison-1",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Backend Not Available",id:"backend-not-available",level:3},{value:"Slow Performance",id:"slow-performance",level:3},{value:"API Endpoints",id:"api-endpoints",level:2},{value:"Get Database Info",id:"get-database-info",level:3},{value:"Get Solr Info",id:"get-solr-info",level:3},{value:"Related Documentation",id:"related-documentation",level:2}];function h(e){const n={a:"a",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"vector-search-backends",children:"Vector Search Backends"})}),"\n",(0,s.jsx)(n.p,{children:"OpenRegister supports multiple vector search backends, allowing you to choose the optimal method based on your infrastructure and performance requirements."}),"\n",(0,s.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsxs)(n.p,{children:["OpenRegister supports ",(0,s.jsx)(n.strong,{children:"three vector search backends"}),":"]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"PHP Cosine Similarity"})," (Default fallback)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"PostgreSQL + pgvector"})," (Database-level)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Solr 9+ Dense Vector Search"})," (Search engine-level)"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Users can select which backend to use based on what's available in their environment."}),"\n",(0,s.jsx)(n.h2,{id:"backend-comparison",children:"Backend Comparison"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Backend"}),(0,s.jsx)(n.th,{children:"Speed"}),(0,s.jsx)(n.th,{children:"Setup Complexity"}),(0,s.jsx)(n.th,{children:"Scalability"}),(0,s.jsx)(n.th,{children:"Requirements"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"PHP"})}),(0,s.jsx)(n.td,{children:"\u2b50"}),(0,s.jsx)(n.td,{children:"\u2b50\u2b50\u2b50\u2b50\u2b50 (None)"}),(0,s.jsx)(n.td,{children:"\u2b50"}),(0,s.jsx)(n.td,{children:"None"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"PostgreSQL + pgvector"})}),(0,s.jsx)(n.td,{children:"\u2b50\u2b50\u2b50\u2b50"}),(0,s.jsx)(n.td,{children:"\u2b50\u2b50\u2b50 (Medium)"}),(0,s.jsx)(n.td,{children:"\u2b50\u2b50\u2b50\u2b50"}),(0,s.jsx)(n.td,{children:"PostgreSQL 11+, pgvector extension"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Solr 9+"})}),(0,s.jsx)(n.td,{children:"\u2b50\u2b50\u2b50\u2b50\u2b50"}),(0,s.jsx)(n.td,{children:"\u2b50\u2b50 (If Solr exists)"}),(0,s.jsx)(n.td,{children:"\u2b50\u2b50\u2b50\u2b50\u2b50"}),(0,s.jsx)(n.td,{children:"Solr 9.0+, configured collection"})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"performance-comparison",children:"Performance Comparison"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Test"}),": Search 10,000 vectors, return top 10 results"]}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Backend"}),(0,s.jsx)(n.th,{children:"Latency"}),(0,s.jsx)(n.th,{children:"Throughput"}),(0,s.jsx)(n.th,{children:"Memory"}),(0,s.jsx)(n.th,{children:"Index Time"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"PHP"})}),(0,s.jsx)(n.td,{children:"10s"}),(0,s.jsx)(n.td,{children:"1 req/s"}),(0,s.jsx)(n.td,{children:"Low"}),(0,s.jsx)(n.td,{children:"N/A"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"PostgreSQL + pgvector"})}),(0,s.jsx)(n.td,{children:"50ms"}),(0,s.jsx)(n.td,{children:"50 req/s"}),(0,s.jsx)(n.td,{children:"Medium"}),(0,s.jsx)(n.td,{children:"Fast"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Solr 9+ (HNSW)"})}),(0,s.jsx)(n.td,{children:"20ms"}),(0,s.jsx)(n.td,{children:"100+ req/s"}),(0,s.jsx)(n.td,{children:"Medium-High"}),(0,s.jsx)(n.td,{children:"Medium"})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"php-cosine-similarity-default",children:"PHP Cosine Similarity (Default)"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Status"}),": Always available fallback"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"How It Works"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Fetches vectors from database"}),"\n",(0,s.jsx)(n.li,{children:"Calculates cosine similarity in PHP"}),"\n",(0,s.jsx)(n.li,{children:"Sorts results in memory"}),"\n",(0,s.jsx)(n.li,{children:"Returns top N matches"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Performance"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Suitable for small datasets (<500 vectors)"}),"\n",(0,s.jsx)(n.li,{children:"Current temporary optimization: Limited to 500 most recent vectors"}),"\n",(0,s.jsx)(n.li,{children:"Scales linearly: O(n) complexity"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Use When"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Small dataset (<500 vectors)"}),"\n",(0,s.jsx)(n.li,{children:"No PostgreSQL or Solr available"}),"\n",(0,s.jsx)(n.li,{children:"Testing/development environment"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Configuration"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "vectorConfig": {\n    "backend": "php"\n  }\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"postgresql--pgvector",children:"PostgreSQL + pgvector"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Status"}),": Available when PostgreSQL with pgvector extension is installed"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"What is pgvector?"}),"\nPostgreSQL extension that adds:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Native vector data type: ",(0,s.jsx)(n.code,{children:"vector(768)"})]}),"\n",(0,s.jsxs)(n.li,{children:["Cosine similarity operator: ",(0,s.jsx)(n.code,{children:"<=>"})]}),"\n",(0,s.jsx)(n.li,{children:"Vector indexing: HNSW, IVFFlat"}),"\n",(0,s.jsx)(n.li,{children:"SQL-based vector search"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Performance"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"10-100x faster than PHP"}),"\n",(0,s.jsx)(n.li,{children:"Database-level KNN search"}),"\n",(0,s.jsx)(n.li,{children:"Optimal for medium-large datasets"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Requirements"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"PostgreSQL version >= 11"}),"\n",(0,s.jsx)(n.li,{children:"pgvector extension installed"}),"\n",(0,s.jsx)(n.li,{children:"Vector column migration"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Installation"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"-- Install extension\nCREATE EXTENSION IF NOT EXISTS vector;\n\n-- Create optimized vector table\nCREATE TABLE openregister_vectors (\n    id SERIAL PRIMARY KEY,\n    entity_type VARCHAR(50),\n    entity_id VARCHAR(255),\n    chunk_index INTEGER,\n    total_chunks INTEGER,\n    chunk_text TEXT,\n    embedding vector(768),  -- Native vector type!\n    embedding_model VARCHAR(100),\n    embedding_dimensions INTEGER,\n    metadata JSONB,\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n);\n\n-- Create HNSW index for fast similarity search\nCREATE INDEX ON openregister_vectors \nUSING hnsw (embedding vector_cosine_ops);\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Configuration"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "vectorConfig": {\n    "backend": "database"\n  }\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Detection"}),":\nThe system automatically detects PostgreSQL + pgvector availability:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Checks database platform name"}),"\n",(0,s.jsxs)(n.li,{children:["Queries ",(0,s.jsx)(n.code,{children:"pg_extension"})," table for ",(0,s.jsx)(n.code,{children:"vector"})," extension"]}),"\n",(0,s.jsx)(n.li,{children:"Shows availability status in UI"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"solr-9-dense-vector-search",children:"Solr 9+ Dense Vector Search"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Status"}),": Available when Solr 9.0+ is configured"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Capabilities"}),":\nSolr 9.0+ includes:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Dense Vector Field Type"}),": ",(0,s.jsx)(n.code,{children:"DenseVectorField"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"KNN Search"}),": K-Nearest Neighbors query parser"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Similarity Functions"}),": Cosine, Dot Product, Euclidean"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Indexing Algorithms"}),": HNSW (Hierarchical Navigable Small World)"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Performance"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Very fast distributed vector search"}),"\n",(0,s.jsx)(n.li,{children:"Best for large-scale deployments"}),"\n",(0,s.jsx)(n.li,{children:"100-1000x faster than PHP at scale"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Requirements"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Solr version >= 9.0"}),"\n",(0,s.jsx)(n.li,{children:"Collection with vector field configured"}),"\n",(0,s.jsx)(n.li,{children:"Additional memory for HNSW index"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Schema Configuration"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:'<fieldType name="knn_vector" class="solr.DenseVectorField" \n           vectorDimension="768" \n           similarityFunction="cosine" \n           knnAlgorithm="hnsw"/>\n\n<field name="_embedding_" type="knn_vector" indexed="true" stored="true"/>\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Query Example"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "q": "{!knn f=_embedding_ topK=10}[0.123, 0.456, ...]",\n  "fl": "id,score"\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Configuration"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "vectorConfig": {\n    "backend": "solr",\n    "solrCollection": "openregister_vectors",\n    "solrField": "_embedding_"\n  }\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Note"}),": The vector field name ",(0,s.jsx)(n.code,{children:"_embedding_"})," is hardcoded as a reserved system field and cannot be changed by users."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Detection"}),":\nThe system automatically detects Solr vector support:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Checks Solr version >= 9.0"}),"\n",(0,s.jsx)(n.li,{children:"Lists available collections"}),"\n",(0,s.jsx)(n.li,{children:"Validates vector field configuration"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,s.jsx)(n.h3,{id:"settings-location",children:"Settings Location"}),"\n",(0,s.jsxs)(n.p,{children:["Vector search backend configuration is stored in LLM settings under ",(0,s.jsx)(n.code,{children:"vectorConfig"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "llm": {\n    "vectorConfig": {\n      "backend": "solr",\n      "solrCollection": "openregister_vectors",\n      "solrField": "_embedding_"\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"configuration-properties",children:"Configuration Properties"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Property"}),(0,s.jsx)(n.th,{children:"Type"}),(0,s.jsx)(n.th,{children:"Default"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"backend"})}),(0,s.jsx)(n.td,{children:"string"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"'php'"})}),(0,s.jsx)(n.td,{children:"Vector search backend: 'php', 'database', or 'solr'"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"solrCollection"})}),(0,s.jsx)(n.td,{children:"string|null"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"null"})}),(0,s.jsx)(n.td,{children:"Solr collection name for vector storage (required for Solr backend)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"solrField"})}),(0,s.jsx)(n.td,{children:"string"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"'_embedding_'"})}),(0,s.jsx)(n.td,{children:"Solr field name for dense vectors (hardcoded, cannot be changed)"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"ui-configuration",children:"UI Configuration"}),"\n",(0,s.jsxs)(n.p,{children:["Configure in ",(0,s.jsx)(n.strong,{children:"Settings \u2192 OpenRegister \u2192 LLM Configuration"}),":"]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Click ",(0,s.jsx)(n.strong,{children:'"Configure LLM"'})," button"]}),"\n",(0,s.jsxs)(n.li,{children:["Scroll to ",(0,s.jsx)(n.strong,{children:'"Vector Search Backend"'})," section"]}),"\n",(0,s.jsxs)(n.li,{children:["Select backend from dropdown:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"PHP Cosine Similarity (\ud83d\udc0c Slow)"}),"\n",(0,s.jsx)(n.li,{children:"PostgreSQL + pgvector (\u26a1 Fast)"}),"\n",(0,s.jsx)(n.li,{children:"Solr 9+ Dense Vector (\ud83d\ude80 Very Fast)"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["If Solr selected:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Choose Solr collection from dropdown"}),"\n",(0,s.jsxs)(n.li,{children:["Vector field name is automatically set to ",(0,s.jsx)(n.code,{children:"_embedding_"})]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Click ",(0,s.jsx)(n.strong,{children:'"Save Configuration"'})]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"backend-detection",children:"Backend Detection"}),"\n",(0,s.jsx)(n.p,{children:"The system automatically detects available backends:"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Database Detection"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Checks database platform (PostgreSQL vs MariaDB/MySQL)"}),"\n",(0,s.jsx)(n.li,{children:"Queries for pgvector extension"}),"\n",(0,s.jsx)(n.li,{children:"Shows availability status"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Solr Detection"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Checks Solr version >= 9.0"}),"\n",(0,s.jsx)(n.li,{children:"Lists available collections"}),"\n",(0,s.jsx)(n.li,{children:"Validates vector field configuration"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"recommended-setup",children:"Recommended Setup"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Dataset Size"}),(0,s.jsx)(n.th,{children:"Recommended Backend"}),(0,s.jsx)(n.th,{children:"Reason"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"< 500 vectors"}),(0,s.jsx)(n.td,{children:"PHP"}),(0,s.jsx)(n.td,{children:"Simple, no setup"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"500 - 10,000"}),(0,s.jsx)(n.td,{children:"PostgreSQL + pgvector"}),(0,s.jsx)(n.td,{children:"Fast, integrated"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"10,000+"}),(0,s.jsx)(n.td,{children:"Solr 9+"}),(0,s.jsx)(n.td,{children:"Best performance, scalability"})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"migration",children:"Migration"}),"\n",(0,s.jsx)(n.h3,{id:"from-php-to-postgresql",children:"From PHP to PostgreSQL"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Install PostgreSQL with pgvector extension"}),"\n",(0,s.jsx)(n.li,{children:"Migrate vector table to PostgreSQL"}),"\n",(0,s.jsx)(n.li,{children:"Update Nextcloud database configuration"}),"\n",(0,s.jsx)(n.li,{children:'Select "PostgreSQL + pgvector" in LLM Configuration'}),"\n",(0,s.jsx)(n.li,{children:"System will auto-detect and enable"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"from-php-to-solr",children:"From PHP to Solr"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Ensure Solr 9.0+ is running"}),"\n",(0,s.jsx)(n.li,{children:"Create or select Solr collection"}),"\n",(0,s.jsxs)(n.li,{children:["Configure vector field in Solr schema (",(0,s.jsx)(n.code,{children:"_embedding_"}),")"]}),"\n",(0,s.jsx)(n.li,{children:'Select "Solr 9+ Dense Vector" in LLM Configuration'}),"\n",(0,s.jsx)(n.li,{children:"Choose collection and save"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"switching-backends",children:"Switching Backends"}),"\n",(0,s.jsx)(n.p,{children:"You can switch backends at any time:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Configuration changes take effect immediately"}),"\n",(0,s.jsx)(n.li,{children:"Existing vectors remain in database"}),"\n",(0,s.jsx)(n.li,{children:"New searches use selected backend"}),"\n",(0,s.jsx)(n.li,{children:"No data migration required (vectors stored in database regardless of backend)"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"solr-integration-details",children:"Solr Integration Details"}),"\n",(0,s.jsx)(n.h3,{id:"vector-storage-in-existing-collections",children:"Vector Storage in Existing Collections"}),"\n",(0,s.jsx)(n.p,{children:"Vectors are stored directly in existing Solr collections (fileCollection and objectCollection) rather than a separate vector collection:"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Files"}),": Vectors stored in ",(0,s.jsx)(n.code,{children:"fileCollection"})," alongside file chunks",(0,s.jsx)(n.br,{}),"\n",(0,s.jsx)(n.strong,{children:"Objects"}),": Vectors stored in ",(0,s.jsx)(n.code,{children:"objectCollection"})," alongside object data"]}),"\n",(0,s.jsx)(n.p,{children:"This enables:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Single source of truth for each entity"}),"\n",(0,s.jsx)(n.li,{children:"Full document retrieval without additional lookups"}),"\n",(0,s.jsx)(n.li,{children:"Atomic updates to existing documents"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"solr-document-structure",children:"Solr Document Structure"}),"\n",(0,s.jsx)(n.p,{children:"Vectors are stored as fields in existing Solr documents:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "id": "object_abc123_chunk_0",\n  "entity_type_s": "object",\n  "entity_id_s": "abc123",\n  "chunk_index_i": 0,\n  "chunk_text_txt": "This is the text that was embedded...",\n  "_embedding_": [0.1, 0.2, 0.3, ...],\n  "_embedding_model_": "text-embedding-ada-002",\n  "_embedding_dim_": 1536\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"knn-query-syntax",children:"KNN Query Syntax"}),"\n",(0,s.jsx)(n.p,{children:"The implementation uses Solr's KNN query parser:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"{!knn f=_embedding_ topK=10}[0.1, 0.2, 0.3, ...]\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Benefits"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Very fast (millisecond range)"}),"\n",(0,s.jsx)(n.li,{children:"Uses HNSW indexing algorithm"}),"\n",(0,s.jsx)(n.li,{children:"Returns full documents with all metadata"}),"\n",(0,s.jsx)(n.li,{children:"Supports filtering by entity type"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"configuration-1",children:"Configuration"}),"\n",(0,s.jsxs)(n.p,{children:["No separate ",(0,s.jsx)(n.code,{children:"solrCollection"})," field needed - uses existing ",(0,s.jsx)(n.code,{children:"fileCollection"})," and ",(0,s.jsx)(n.code,{children:"objectCollection"})," from Solr settings. The ",(0,s.jsx)(n.code,{children:"solrField"})," is hardcoded to ",(0,s.jsx)(n.code,{children:"_embedding_"})," (a reserved system field)."]}),"\n",(0,s.jsx)(n.h2,{id:"performance-monitoring",children:"Performance Monitoring"}),"\n",(0,s.jsx)(n.h3,{id:"current-performance",children:"Current Performance"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"PHP Backend"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"279 vectors \u2192 ~300ms similarity calculation"}),"\n",(0,s.jsx)(n.li,{children:"1,000 vectors \u2192 ~1 second"}),"\n",(0,s.jsx)(n.li,{children:"10,000 vectors \u2192 ~10 seconds"}),"\n",(0,s.jsx)(n.li,{children:"Plus embedding generation time (~1.5s)"}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Current optimization"}),": Limited to 500 most recent vectors"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"PostgreSQL + pgvector"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"1K vectors \u2192 ~20ms"}),"\n",(0,s.jsx)(n.li,{children:"10K vectors \u2192 ~50ms"}),"\n",(0,s.jsx)(n.li,{children:"100K vectors \u2192 ~200ms"}),"\n",(0,s.jsx)(n.li,{children:"Uses HNSW indexing"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Solr 9+ Dense Vector"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"1K vectors \u2192 ~20ms"}),"\n",(0,s.jsx)(n.li,{children:"10K vectors \u2192 ~15ms"}),"\n",(0,s.jsx)(n.li,{children:"100K vectors \u2192 ~30ms"}),"\n",(0,s.jsx)(n.li,{children:"Uses HNSW indexing algorithm"}),"\n",(0,s.jsx)(n.li,{children:"Distributed search across collections"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"performance-targets",children:"Performance Targets"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Metric"}),(0,s.jsx)(n.th,{children:"Current (PHP)"}),(0,s.jsx)(n.th,{children:"Target (PostgreSQL)"}),(0,s.jsx)(n.th,{children:"Best (Solr)"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Search Time (1K vectors)"})}),(0,s.jsx)(n.td,{children:"1s"}),(0,s.jsx)(n.td,{children:"20ms"}),(0,s.jsx)(n.td,{children:"10ms"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Search Time (10K vectors)"})}),(0,s.jsx)(n.td,{children:"10s"}),(0,s.jsx)(n.td,{children:"50ms"}),(0,s.jsx)(n.td,{children:"15ms"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Search Time (100K vectors)"})}),(0,s.jsx)(n.td,{children:"100s"}),(0,s.jsx)(n.td,{children:"200ms"}),(0,s.jsx)(n.td,{children:"30ms"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Indexing"})}),(0,s.jsx)(n.td,{children:"None"}),(0,s.jsx)(n.td,{children:"HNSW"}),(0,s.jsx)(n.td,{children:"ANN algorithms"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Scalability"})}),(0,s.jsx)(n.td,{children:"Poor"}),(0,s.jsx)(n.td,{children:"Good"}),(0,s.jsx)(n.td,{children:"Excellent"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"performance-comparison-1",children:"Performance Comparison"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Test"}),": Search 10,000 vectors, return top 10 results"]}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Backend"}),(0,s.jsx)(n.th,{children:"Latency"}),(0,s.jsx)(n.th,{children:"Throughput"}),(0,s.jsx)(n.th,{children:"Memory"}),(0,s.jsx)(n.th,{children:"Index Time"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"PHP"})}),(0,s.jsx)(n.td,{children:"10s"}),(0,s.jsx)(n.td,{children:"1 req/s"}),(0,s.jsx)(n.td,{children:"Low"}),(0,s.jsx)(n.td,{children:"N/A"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"PostgreSQL + pgvector"})}),(0,s.jsx)(n.td,{children:"50ms"}),(0,s.jsx)(n.td,{children:"50 req/s"}),(0,s.jsx)(n.td,{children:"Medium"}),(0,s.jsx)(n.td,{children:"Fast"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Solr 9+ (HNSW)"})}),(0,s.jsx)(n.td,{children:"20ms"}),(0,s.jsx)(n.td,{children:"100+ req/s"}),(0,s.jsx)(n.td,{children:"Medium-High"}),(0,s.jsx)(n.td,{children:"Medium"})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,s.jsx)(n.h3,{id:"backend-not-available",children:"Backend Not Available"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"PostgreSQL + pgvector"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Verify PostgreSQL is installed"}),"\n",(0,s.jsxs)(n.li,{children:["Check pgvector extension: ",(0,s.jsx)(n.code,{children:"SELECT * FROM pg_extension WHERE extname = 'vector';"})]}),"\n",(0,s.jsxs)(n.li,{children:["Install if missing: ",(0,s.jsx)(n.code,{children:"CREATE EXTENSION vector;"})]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Solr 9+"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Verify Solr version >= 9.0"}),"\n",(0,s.jsx)(n.li,{children:"Check Solr is accessible"}),"\n",(0,s.jsx)(n.li,{children:"Verify collection exists"}),"\n",(0,s.jsx)(n.li,{children:"Check vector field is configured in schema"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"slow-performance",children:"Slow Performance"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"PHP Backend"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Consider migrating to PostgreSQL or Solr"}),"\n",(0,s.jsx)(n.li,{children:"Current optimization limits to 500 most recent vectors"}),"\n",(0,s.jsx)(n.li,{children:"Performance scales linearly with vector count"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"PostgreSQL"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Ensure HNSW index is created"}),"\n",(0,s.jsx)(n.li,{children:"Check query execution plan"}),"\n",(0,s.jsx)(n.li,{children:"Monitor database performance"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Solr"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Verify HNSW indexing is enabled"}),"\n",(0,s.jsx)(n.li,{children:"Check collection health"}),"\n",(0,s.jsx)(n.li,{children:"Monitor Solr performance metrics"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"api-endpoints",children:"API Endpoints"}),"\n",(0,s.jsx)(n.h3,{id:"get-database-info",children:"Get Database Info"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"GET /api/settings/database\n"})}),"\n",(0,s.jsx)(n.p,{children:"Returns database type, version, and vector support."}),"\n",(0,s.jsx)(n.h3,{id:"get-solr-info",children:"Get Solr Info"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"GET /api/settings/solr-info\n"})}),"\n",(0,s.jsx)(n.p,{children:"Returns Solr availability, version, and collections."}),"\n",(0,s.jsx)(n.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/Technical/vectorization-architecture",children:"Vectorization Architecture"})," - How vectors are generated and stored"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/development/performance-optimization",children:"Performance Optimization"})," - General performance tuning"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/technical/solr-setup-configuration",children:"Solr Setup Configuration"})," - Solr configuration details"]}),"\n"]})]})}function a(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},28453:(e,n,r)=>{r.d(n,{R:()=>t,x:()=>c});var i=r(96540);const s={},l=i.createContext(s);function t(e){const n=i.useContext(l);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:t(e.components),i.createElement(l.Provider,{value:n},e.children)}}}]);