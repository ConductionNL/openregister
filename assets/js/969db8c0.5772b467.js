"use strict";(self.webpackChunkopen_catalogi_docs=self.webpackChunkopen_catalogi_docs||[]).push([[2670],{7215:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>d,default:()=>h,frontMatter:()=>l,metadata:()=>t,toc:()=>o});const t=JSON.parse('{"id":"development/text-extraction-refactoring","title":"Text Extraction Refactoring Summary","description":"Overview","source":"@site/docs/development/text-extraction-refactoring.md","sourceDirName":"development","slug":"/development/text-extraction-refactoring","permalink":"/docs/development/text-extraction-refactoring","draft":false,"unlisted":false,"editUrl":"https://github.com/conductionnl/openregister/tree/main/website/docs/development/text-extraction-refactoring.md","tags":[],"version":"current","sidebarPosition":85,"frontMatter":{"title":"Text Extraction Refactoring Summary","sidebar_position":85},"sidebar":"tutorialSidebar","previous":{"title":"LLPhant Refactoring Plan","permalink":"/docs/development/llphant-refactor"},"next":{"title":"File Upload API","permalink":"/docs/development/api/files"}}');var r=i(74848),s=i(28453);const l={title:"Text Extraction Refactoring Summary",sidebar_position:85},d="Text Extraction Refactoring Summary",c={},o=[{value:"Overview",id:"overview",level:2},{value:"Changes Made",id:"changes-made",level:2},{value:"1. TextExtractionService Enhancement",id:"1-textextractionservice-enhancement",level:3},{value:"Added Chunking Logic",id:"added-chunking-logic",level:4},{value:"New Chunking Methods",id:"new-chunking-methods",level:4},{value:"Removed SOLR Dependency",id:"removed-solr-dependency",level:4},{value:"2. FileText Entity Update",id:"2-filetext-entity-update",level:3},{value:"Added New Property",id:"added-new-property",level:4},{value:"3. Database Migration",id:"3-database-migration",level:3},{value:"4. GuzzleSolrService Update",id:"4-guzzlesolrservice-update",level:3},{value:"Updated <code>indexFiles()</code> Method",id:"updated-indexfiles-method",level:4},{value:"Benefits of the Refactoring",id:"benefits-of-the-refactoring",level:2},{value:"1. Separation of Concerns",id:"1-separation-of-concerns",level:3},{value:"2. Improved Performance",id:"2-improved-performance",level:3},{value:"3. Flexibility",id:"3-flexibility",level:3},{value:"4. Better Data Integrity",id:"4-better-data-integrity",level:3},{value:"Test Results",id:"test-results",level:2},{value:"Migration Notes",id:"migration-notes",level:2},{value:"For Existing Installations",id:"for-existing-installations",level:3},{value:"For New Installations",id:"for-new-installations",level:3},{value:"Related Documentation",id:"related-documentation",level:2}];function a(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"text-extraction-refactoring-summary",children:"Text Extraction Refactoring Summary"})}),"\n",(0,r.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsxs)(n.p,{children:["Text extraction has been refactored to be ",(0,r.jsx)(n.strong,{children:"completely independent of SOLR"}),". Previously, text extraction was tightly coupled with SOLR indexing, which created unnecessary dependencies and made the extraction process less flexible."]}),"\n",(0,r.jsx)(n.h2,{id:"changes-made",children:"Changes Made"}),"\n",(0,r.jsx)(n.h3,{id:"1-textextractionservice-enhancement",children:"1. TextExtractionService Enhancement"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"File:"})," ",(0,r.jsx)(n.code,{children:"lib/Service/TextExtractionService.php"})]}),"\n",(0,r.jsx)(n.h4,{id:"added-chunking-logic",children:"Added Chunking Logic"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsxs)(n.strong,{children:["Moved chunking from ",(0,r.jsx)(n.code,{children:"SolrFileService"})," to ",(0,r.jsx)(n.code,{children:"TextExtractionService"})]})}),"\n",(0,r.jsxs)(n.li,{children:["Added constants for chunk configuration:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"DEFAULT_CHUNK_SIZE"}),": 1000 characters"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"DEFAULT_CHUNK_OVERLAP"}),": 200 characters"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"MIN_CHUNK_SIZE"}),": 100 characters"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"MAX_CHUNKS_PER_FILE"}),": 1000 chunks"]}),"\n",(0,r.jsxs)(n.li,{children:["Chunking strategies: ",(0,r.jsx)(n.code,{children:"RECURSIVE_CHARACTER"}),", ",(0,r.jsx)(n.code,{children:"FIXED_SIZE"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"new-chunking-methods",children:"New Chunking Methods"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"chunkDocument()"})," - Main chunking interface"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"chunkFixedSize()"})," - Fixed-size chunking with overlap"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"chunkRecursive()"})," - Smart chunking that tries different separators (paragraphs, sentences, words)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"recursiveSplit()"})," - Recursive text splitting algorithm"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"cleanText()"})," - Text normalization before chunking"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"removed-solr-dependency",children:"Removed SOLR Dependency"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Removed ",(0,r.jsx)(n.code,{children:"GuzzleSolrService"})," from constructor"]}),"\n",(0,r.jsx)(n.li,{children:"Removed automatic SOLR indexing after extraction"}),"\n",(0,r.jsx)(n.li,{children:"Text extraction now stores chunks independently"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"2-filetext-entity-update",children:"2. FileText Entity Update"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"File:"})," ",(0,r.jsx)(n.code,{children:"lib/Db/FileText.php"})]}),"\n",(0,r.jsx)(n.h4,{id:"added-new-property",children:"Added New Property"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"chunks_json"})," (LONGTEXT) - Stores JSON-encoded array of text chunks"]}),"\n",(0,r.jsxs)(n.li,{children:["Each chunk contains:","\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "text": "chunk content",\n  "start_offset": 0,\n  "end_offset": 1000\n}\n'})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"3-database-migration",children:"3. Database Migration"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"File:"})," ",(0,r.jsx)(n.code,{children:"lib/Migration/Version1Date20251107170000.php"})]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Created migration to add ",(0,r.jsx)(n.code,{children:"chunks_json"})," column to ",(0,r.jsx)(n.code,{children:"oc_openregister_file_texts"})," table"]}),"\n",(0,r.jsx)(n.li,{children:"Migration ran successfully on 2025-11-07"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"4-guzzlesolrservice-update",children:"4. GuzzleSolrService Update"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"File:"})," ",(0,r.jsx)(n.code,{children:"lib/Service/GuzzleSolrService.php"})]}),"\n",(0,r.jsxs)(n.h4,{id:"updated-indexfiles-method",children:["Updated ",(0,r.jsx)(n.code,{children:"indexFiles()"})," Method"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Before"}),": Generated chunks on-the-fly during SOLR indexing"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"After"}),": Reads pre-generated chunks from ",(0,r.jsx)(n.code,{children:"chunks_json"})," field"]}),"\n",(0,r.jsxs)(n.li,{children:["Benefits:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"SOLR indexing is faster (no need to re-chunk)"}),"\n",(0,r.jsx)(n.li,{children:"Consistent chunking across all services"}),"\n",(0,r.jsx)(n.li,{children:"Chunks can be reused for embeddings, search, etc."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"benefits-of-the-refactoring",children:"Benefits of the Refactoring"}),"\n",(0,r.jsx)(n.h3,{id:"1-separation-of-concerns",children:"1. Separation of Concerns"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Text Extraction"}),": Handles file parsing and chunking"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"SOLR Service"}),": Only responsible for indexing pre-chunked data"]}),"\n",(0,r.jsx)(n.li,{children:"Each service has a single, well-defined responsibility"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"2-improved-performance",children:"2. Improved Performance"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Chunks are generated once during extraction"}),"\n",(0,r.jsx)(n.li,{children:"SOLR indexing no longer needs to re-chunk text"}),"\n",(0,r.jsx)(n.li,{children:"Chunks are cached in database for reuse"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"3-flexibility",children:"3. Flexibility"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Chunks can be used by multiple services:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"SOLR for full-text search"}),"\n",(0,r.jsx)(n.li,{children:"Vector databases for embeddings"}),"\n",(0,r.jsx)(n.li,{children:"AI services for text analysis"}),"\n",(0,r.jsx)(n.li,{children:"Export/download features"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.li,{children:"Easy to adjust chunking strategies without affecting SOLR"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"4-better-data-integrity",children:"4. Better Data Integrity"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Chunks are stored with the extracted text"}),"\n",(0,r.jsx)(n.li,{children:"No risk of different services generating inconsistent chunks"}),"\n",(0,r.jsx)(n.li,{children:"Chunks are versioned with the file (re-extraction updates chunks)"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"test-results",children:"Test Results"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"File Tested"}),": ",(0,r.jsx)(n.code,{children:"Nextcloud_Server_Administration_Manual.pdf"})," (8.8 MB)"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Results"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u2705 PDF extraction successful"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Text extracted: 416,657 characters"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Chunks generated: 551 chunks"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Average chunk size: ~756 characters"}),"\n",(0,r.jsxs)(n.li,{children:["\u2705 Chunks stored in ",(0,r.jsx)(n.code,{children:"chunks_json"})," field"]}),"\n",(0,r.jsx)(n.li,{children:"\u2705 SOLR indexing uses pre-generated chunks"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"migration-notes",children:"Migration Notes"}),"\n",(0,r.jsx)(n.h3,{id:"for-existing-installations",children:"For Existing Installations"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Run Migration"}),": The migration adds the ",(0,r.jsx)(n.code,{children:"chunks_json"})," column automatically"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Re-extract Files"}),": Existing files need to be re-extracted to generate chunks"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"SOLR Re-index"}),": After re-extraction, re-index files in SOLR to use new chunks"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"for-new-installations",children:"For New Installations"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"No migration needed - new installations include chunking from the start"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/docs/technical/text-extraction",children:"Text Extraction Implementation"})," - Current text extraction implementation"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/docs/development/llphant-refactor",children:"LLPhant Refactor"})," - Future refactoring plan using LLPhant"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>l,x:()=>d});var t=i(96540);const r={},s=t.createContext(r);function l(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);