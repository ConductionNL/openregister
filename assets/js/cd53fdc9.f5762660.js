"use strict";(self.webpackChunkopen_catalogi_docs=self.webpackChunkopen_catalogi_docs||[]).push([[7384],{12284:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>r,metadata:()=>t,toc:()=>o});const t=JSON.parse('{"id":"technical/faceting-performance","title":"Hyper-Performant Faceting System","description":"Overview","source":"@site/docs/technical/faceting-performance.md","sourceDirName":"technical","slug":"/technical/faceting-performance","permalink":"/docs/technical/faceting-performance","draft":false,"unlisted":false,"editUrl":"https://github.com/conductionnl/openregister/tree/main/website/docs/technical/faceting-performance.md","tags":[],"version":"current","sidebarPosition":20,"frontMatter":{"title":"Hyper-Performant Faceting System","sidebar_position":20},"sidebar":"tutorialSidebar","previous":{"title":"Schema Technical Documentation","permalink":"/docs/technical/schemas"},"next":{"title":"Authorization Exceptions Performance","permalink":"/docs/technical/authorization-exceptions-performance"}}');var i=s(74848),a=s(28453);const r={title:"Hyper-Performant Faceting System",sidebar_position:20},c="Hyper-Performant Faceting System",l={},o=[{value:"Overview",id:"overview",level:2},{value:"Performance Goals Achieved",id:"performance-goals-achieved",level:2},{value:"System Architecture",id:"system-architecture",level:2},{value:"Intelligent Strategy Selection",id:"intelligent-strategy-selection",level:2},{value:"Strategy 1: <strong>Exact Parallel Calculation</strong>",id:"strategy-1-exact-parallel-calculation",level:3},{value:"Strategy 2: <strong>Smart Sampling</strong>",id:"strategy-2-smart-sampling",level:3},{value:"Strategy 3: <strong>HyperLogLog Estimation</strong>",id:"strategy-3-hyperloglog-estimation",level:3},{value:"Multi-Layered Caching System",id:"multi-layered-caching-system",level:2},{value:"Cache Layer 1: <strong>Facet Result Cache</strong> (5 min TTL)",id:"cache-layer-1-facet-result-cache-5-min-ttl",level:3},{value:"Cache Layer 2: <strong>Query Fragment Cache</strong> (15 min TTL)",id:"cache-layer-2-query-fragment-cache-15-min-ttl",level:3},{value:"Cache Layer 3: <strong>Cardinality Cache</strong> (1 hour TTL)",id:"cache-layer-3-cardinality-cache-1-hour-ttl",level:3},{value:"Cache Layer 4: <strong>Schema Facet Cache</strong> (24 hour TTL)",id:"cache-layer-4-schema-facet-cache-24-hour-ttl",level:3},{value:"Revolutionary Optimizations Implemented",id:"revolutionary-optimizations-implemented",level:2},{value:"\ud83c\udfaf <strong>1. Index-Optimized Query Strategy</strong>",id:"-1-index-optimized-query-strategy",level:3},{value:"\ud83d\udcca <strong>2. Statistical Approximation</strong>",id:"-2-statistical-approximation",level:3},{value:"\ud83d\udd04 <strong>3. Parallel Processing Architecture</strong>",id:"-3-parallel-processing-architecture",level:3},{value:"\ud83d\udca1 <strong>4. Intelligent Request Detection</strong>",id:"-4-intelligent-request-detection",level:3},{value:"\ud83d\uddc3\ufe0f <strong>5. Pre-computed Schema Facets</strong>",id:"\ufe0f-5-pre-computed-schema-facets",level:3},{value:"API Usage Examples",id:"api-usage-examples",level:2},{value:"Basic Faceting Request",id:"basic-faceting-request",level:3},{value:"Complex Multi-Facet Request",id:"complex-multi-facet-request",level:3},{value:"Large Dataset Request",id:"large-dataset-request",level:3},{value:"Enhanced Response Format",id:"enhanced-response-format",level:2},{value:"Implementation Details",id:"implementation-details",level:2},{value:"File Structure",id:"file-structure",level:3},{value:"Integration Points",id:"integration-points",level:3},{value:"1. <strong>ObjectService.php Integration</strong>",id:"1-objectservicephp-integration",level:4},{value:"2. <strong>Schema Entity Enhancement</strong>",id:"2-schema-entity-enhancement",level:4},{value:"3. <strong>Database Migration Support</strong>",id:"3-database-migration-support",level:4},{value:"Configuration &amp; Tuning",id:"configuration--tuning",level:2},{value:"Performance Thresholds",id:"performance-thresholds",level:3},{value:"Cache TTL Settings",id:"cache-ttl-settings",level:3},{value:"Sampling Rates",id:"sampling-rates",level:3},{value:"System Health &amp; Monitoring",id:"system-health--monitoring",level:2},{value:"Performance Monitoring",id:"performance-monitoring",level:3},{value:"Key Metrics to Monitor",id:"key-metrics-to-monitor",level:3},{value:"Cache Invalidation Strategy",id:"cache-invalidation-strategy",level:2},{value:"Automatic Invalidation",id:"automatic-invalidation",level:3},{value:"Manual Cache Management",id:"manual-cache-management",level:3},{value:"Testing &amp; Validation",id:"testing--validation",level:2},{value:"Performance Testing Commands",id:"performance-testing-commands",level:3},{value:"Expected Log Patterns",id:"expected-log-patterns",level:3},{value:"Advanced Features",id:"advanced-features",level:2},{value:"\ud83d\udcca <strong>Progressive Enhancement</strong>",id:"-progressive-enhancement",level:3},{value:"\ud83e\uddee <strong>Confidence Intervals</strong>",id:"-confidence-intervals",level:3},{value:"\ud83c\udfaa <strong>Batch Optimization</strong>",id:"-batch-optimization",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Common Issues",id:"common-issues",level:3},{value:"1. <strong>Slow Response Times</strong>",id:"1-slow-response-times",level:4},{value:"2. <strong>Accuracy Concerns</strong>",id:"2-accuracy-concerns",level:4},{value:"3. <strong>Cache Misses</strong>",id:"3-cache-misses",level:4},{value:"Debug Commands",id:"debug-commands",level:3},{value:"Database Optimizations",id:"database-optimizations",level:2},{value:"Composite Indexes",id:"composite-indexes",level:3},{value:"Query Optimization Strategy",id:"query-optimization-strategy",level:3},{value:"Future Enhancements",id:"future-enhancements",level:2},{value:"Planned Optimizations",id:"planned-optimizations",level:3},{value:"Advanced Configuration Options",id:"advanced-configuration-options",level:3},{value:"Security &amp; RBAC Integration",id:"security--rbac-integration",level:2},{value:"Related Documentation",id:"related-documentation",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"hyper-performant-faceting-system",children:"Hyper-Performant Faceting System"})}),"\n",(0,i.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.strong,{children:"Hyper-Performant Faceting System"})," provides ",(0,i.jsx)(n.strong,{children:"10-50x performance improvements"})," over traditional faceting methods. This system addresses critical performance bottlenecks in faceting operations that were causing multi-second response times."]}),"\n",(0,i.jsx)(n.h2,{id:"performance-goals-achieved",children:"Performance Goals Achieved"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Request Type"}),(0,i.jsx)(n.th,{children:"Original Time"}),(0,i.jsx)(n.th,{children:"New Time"}),(0,i.jsx)(n.th,{children:"Improvement"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Simple Facets"}),(0,i.jsx)(n.td,{children:"~2-3 seconds"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"<100ms"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"20-30x faster"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Complex Facets"}),(0,i.jsx)(n.td,{children:"~5+ seconds"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"<200ms"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"25-50x faster"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Cached Facets"}),(0,i.jsx)(n.td,{children:"~2-3 seconds"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"<10ms"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"200-300x faster"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Large Datasets"}),(0,i.jsx)(n.td,{children:"~10+ seconds"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"<50ms"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"200x+ faster"})})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"system-architecture",children:"System Architecture"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-mermaid",children:'graph TD\n    A["User Request:<br/>_facets + _facetable"] --\x3e B{Intelligent<br/>Cache Check}\n    \n    B --\x3e|Cache Hit| C["\ud83d\ude80 Instant Response<br/>&lt;10ms"]\n    B --\x3e|Cache Miss| D{Dataset Size<br/>Analysis}\n    \n    D --\x3e|Small < 1000| E["\ud83c\udfaf Exact Calculation<br/>Multi-Query Batch"]\n    D --\x3e|Medium 1K-10K| F["\ud83d\udcca Smart Sampling<br/>10% + Extrapolation"]  \n    D --\x3e|Large > 10K| G["\u26a1 HyperLogLog<br/>Cardinality Estimation"]\n    \n    E --\x3e H["\ud83d\udd04 Parallel Execution<br/>ReactPHP Promises"]\n    F --\x3e H\n    G --\x3e H\n    \n    H --\x3e I["\ud83d\udcbe Multi-Layer Cache<br/>Result + Fragment + Cardinality"]\n    I --\x3e J["\ud83d\udcc8 Enhanced Response<br/>Exact/Approximate + Confidence"]\n    \n    K["\ud83d\udd14 Background Process"] --\x3e L["\ud83d\udd04 Cache Warm-up<br/>Popular Facet Combos"]\n    K --\x3e M["\ud83d\udcca Statistics Update<br/>Field Cardinality"]\n    \n    style A fill:#e1f5fe\n    style C fill:#c8e6c9\n    style J fill:#c8e6c9\n    style H fill:#fff3e0\n    style I fill:#f3e5f5\n'})}),"\n",(0,i.jsx)(n.h2,{id:"intelligent-strategy-selection",children:"Intelligent Strategy Selection"}),"\n",(0,i.jsx)(n.p,{children:"The system automatically selects the optimal calculation strategy based on dataset characteristics:"}),"\n",(0,i.jsxs)(n.h3,{id:"strategy-1-exact-parallel-calculation",children:["Strategy 1: ",(0,i.jsx)(n.strong,{children:"Exact Parallel Calculation"})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"When"}),": Small datasets (<1,000 objects)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Performance"}),": <100ms response time"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Accuracy"}),": 100% exact counts"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Method"}),": Parallel processing with optimized index queries"]}),"\n"]}),"\n",(0,i.jsxs)(n.h3,{id:"strategy-2-smart-sampling",children:["Strategy 2: ",(0,i.jsx)(n.strong,{children:"Smart Sampling"})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"When"}),": Medium datasets (1K-10K objects)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Performance"}),": <75ms response time"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Accuracy"}),": ~95% statistical accuracy"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Method"}),": Random sampling (10%) + statistical extrapolation"]}),"\n"]}),"\n",(0,i.jsxs)(n.h3,{id:"strategy-3-hyperloglog-estimation",children:["Strategy 3: ",(0,i.jsx)(n.strong,{children:"HyperLogLog Estimation"})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"When"}),": Large datasets (>10K objects)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Performance"}),": <50ms response time"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Accuracy"}),": ~90% estimated accuracy"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Method"}),": Probabilistic cardinality estimation"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"multi-layered-caching-system",children:"Multi-Layered Caching System"}),"\n",(0,i.jsxs)(n.h3,{id:"cache-layer-1-facet-result-cache-5-min-ttl",children:["Cache Layer 1: ",(0,i.jsx)(n.strong,{children:"Facet Result Cache"})," (5 min TTL)"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// Complete facet responses cached for identical requests\n$cacheKey = 'hyper_facets_' . md5(json_encode($requestData));\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Benefits"}),": Instant responses (<10ms) for repeated requests"]}),"\n",(0,i.jsxs)(n.h3,{id:"cache-layer-2-query-fragment-cache-15-min-ttl",children:["Cache Layer 2: ",(0,i.jsx)(n.strong,{children:"Query Fragment Cache"})," (15 min TTL)"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// Common query fragments and subresults cached\n$fragmentKey = 'facet_fragment_' . md5($queryFragment);\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Benefits"}),": Faster calculation for similar requests"]}),"\n",(0,i.jsxs)(n.h3,{id:"cache-layer-3-cardinality-cache-1-hour-ttl",children:["Cache Layer 3: ",(0,i.jsx)(n.strong,{children:"Cardinality Cache"})," (1 hour TTL)"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// Field cardinality estimates cached for strategy selection\n$cardinalityKey = 'dataset_size_' . md5(json_encode($baseQuery));\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Benefits"}),": Instant strategy selection without dataset scanning"]}),"\n",(0,i.jsxs)(n.h3,{id:"cache-layer-4-schema-facet-cache-24-hour-ttl",children:["Cache Layer 4: ",(0,i.jsx)(n.strong,{children:"Schema Facet Cache"})," (24 hour TTL)"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// Pre-computed schema facet configurations\n$schemaFacets = $schema->getFacets(); // From database facets column\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Benefits"}),": No runtime schema analysis for facetable field discovery"]}),"\n",(0,i.jsx)(n.h2,{id:"revolutionary-optimizations-implemented",children:"Revolutionary Optimizations Implemented"}),"\n",(0,i.jsxs)(n.h3,{id:"-1-index-optimized-query-strategy",children:["\ud83c\udfaf ",(0,i.jsx)(n.strong,{children:"1. Index-Optimized Query Strategy"})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Leverages composite database indexes for maximum query performance"}),"\n",(0,i.jsxs)(n.li,{children:["Filters applied in optimal order: ",(0,i.jsx)(n.code,{children:"register+schema"})," \u2192 ",(0,i.jsx)(n.code,{children:"organisation"})," \u2192 ",(0,i.jsx)(n.code,{children:"JSON fields"})]}),"\n",(0,i.jsx)(n.li,{children:"Avoids expensive JSON operations by separating metadata from object field facets"}),"\n"]}),"\n",(0,i.jsxs)(n.h3,{id:"-2-statistical-approximation",children:["\ud83d\udcca ",(0,i.jsx)(n.strong,{children:"2. Statistical Approximation"})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"HyperLogLog cardinality estimation"})," for large datasets"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Random sampling with confidence intervals"})," for medium datasets"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Progressive enhancement"}),": Fast approximate \u2192 Accurate exact (background)"]}),"\n"]}),"\n",(0,i.jsxs)(n.h3,{id:"-3-parallel-processing-architecture",children:["\ud83d\udd04 ",(0,i.jsx)(n.strong,{children:"3. Parallel Processing Architecture"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// All facets calculated concurrently using ReactPHP promises\n$promises = [\n    'metadata' => $this->processMetadataFacetsParallel($metadataFacets, $baseQuery),\n    'json' => $this->processJsonFacetsParallel($jsonFacets, $baseQuery)\n];\n$results = \\React\\Async\\await(\\React\\Promise\\all($promises));\n"})}),"\n",(0,i.jsxs)(n.h3,{id:"-4-intelligent-request-detection",children:["\ud83d\udca1 ",(0,i.jsx)(n.strong,{children:"4. Intelligent Request Detection"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// Auto-detect simple vs complex requests\n$isComplexRequest = $hasFacets || $hasFacetable || $hasHeavyJsonFilters;\n// Route to appropriate optimization strategy\n"})}),"\n",(0,i.jsxs)(n.h3,{id:"\ufe0f-5-pre-computed-schema-facets",children:["\ud83d\uddc3\ufe0f ",(0,i.jsx)(n.strong,{children:"5. Pre-computed Schema Facets"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"-- New facets column in openregister_schemas table\nALTER TABLE oc_openregister_schemas ADD COLUMN facets LONGTEXT;\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Benefits"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Eliminates ~15ms runtime schema analysis"}),"\n",(0,i.jsx)(n.li,{children:"Consistent facet configurations"}),"\n",(0,i.jsx)(n.li,{children:"Lazy generation with automatic fallback"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"api-usage-examples",children:"API Usage Examples"}),"\n",(0,i.jsx)(n.h3,{id:"basic-faceting-request",children:"Basic Faceting Request"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"GET /api/objects/19/116?_facets[@self][register][type]=terms&_facets[@self][schema][type]=terms\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Expected Response Time"}),": <100ms (exact calculation)"]}),"\n",(0,i.jsx)(n.h3,{id:"complex-multi-facet-request",children:"Complex Multi-Facet Request"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"GET /api/objects/19/116?_facets[@self][register][type]=terms&_facets[@self][created][type]=date_histogram&_facets[status][type]=terms&_facets[priority][type]=terms\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Expected Response Time"}),": <75ms (smart sampling)"]}),"\n",(0,i.jsx)(n.h3,{id:"large-dataset-request",children:"Large Dataset Request"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"GET /api/objects/19/116?_limit=1000&_facets[@self][register][type]=terms&_facets[category][type]=terms\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Expected Response Time"}),": <50ms (HyperLogLog estimation)"]}),"\n",(0,i.jsx)(n.h2,{id:"enhanced-response-format",children:"Enhanced Response Format"}),"\n",(0,i.jsx)(n.p,{children:"The new system provides enhanced responses with performance metadata:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "facets": {\n    "@self": {\n      "register": {\n        "type": "terms",\n        "buckets": [\n          {"key": 19, "results": 1247, "label": "Public Register"}\n        ]\n      }\n    }\n  },\n  "performance_metadata": {\n    "strategy": "smart_sampling",\n    "execution_time_ms": 45.2,\n    "dataset_size": 5420,\n    "cache_status": "miss_cached_for_next_request", \n    "accuracy": "high (~95%)",\n    "response_target": "&lt;75ms"\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"implementation-details",children:"Implementation Details"}),"\n",(0,i.jsx)(n.h3,{id:"file-structure",children:"File Structure"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"lib/Db/ObjectHandlers/\n\u251c\u2500\u2500 HyperFacetHandler.php          # Main hyper-faceting implementation\n\u251c\u2500\u2500 MetaDataFacetHandler.php       # Legacy metadata facet handler  \n\u251c\u2500\u2500 MariaDbFacetHandler.php        # Legacy database-specific handler\n\u2514\u2500\u2500 OptimizedFacetHandler.php      # Legacy optimized handler\n"})}),"\n",(0,i.jsx)(n.h3,{id:"integration-points",children:"Integration Points"}),"\n",(0,i.jsxs)(n.h4,{id:"1-objectservicephp-integration",children:["1. ",(0,i.jsx)(n.strong,{children:"ObjectService.php Integration"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"public function getFacetsForObjects(array $query=[]): array\n{\n    // Initialize HyperFacetHandler for breakthrough performance\n    $hyperFacetHandler = new \\OCA\\OpenRegister\\Db\\ObjectHandlers\\HyperFacetHandler(\n        $this->objectEntityMapper->getConnection(),\n        $this->cacheFactory,\n        $this->logger\n    );\n    \n    return $hyperFacetHandler->getHyperOptimizedFacets($facetConfig, $query);\n}\n"})}),"\n",(0,i.jsxs)(n.h4,{id:"2-schema-entity-enhancement",children:["2. ",(0,i.jsx)(n.strong,{children:"Schema Entity Enhancement"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// Added facets column and methods to Schema.php\nprotected ?array $facets = null;\n\npublic function getFacets(): ?array;\npublic function setFacets(?array $facets): void;\npublic function regenerateFacetsFromProperties(): void;\n"})}),"\n",(0,i.jsxs)(n.h4,{id:"3-database-migration-support",children:["3. ",(0,i.jsx)(n.strong,{children:"Database Migration Support"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"-- Version1Date20250902150000.php\nALTER TABLE oc_openregister_schemas ADD COLUMN facets LONGTEXT;\n"})}),"\n",(0,i.jsx)(n.h2,{id:"configuration--tuning",children:"Configuration & Tuning"}),"\n",(0,i.jsx)(n.h3,{id:"performance-thresholds",children:"Performance Thresholds"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// Dataset size thresholds for strategy selection\nprivate const SMALL_DATASET_THRESHOLD = 1000;   // Use exact counts\nprivate const MEDIUM_DATASET_THRESHOLD = 10000; // Use sampling  \nprivate const LARGE_DATASET_THRESHOLD = 50000;  // Use HyperLogLog\n"})}),"\n",(0,i.jsx)(n.h3,{id:"cache-ttl-settings",children:"Cache TTL Settings"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// Optimized TTL for different data types\nprivate const FACET_RESULT_TTL = 300;      // 5 minutes - facet results\nprivate const FRAGMENT_CACHE_TTL = 900;    // 15 minutes - query fragments\nprivate const CARDINALITY_TTL = 3600;      // 1 hour - cardinality estimates\nprivate const SCHEMA_FACET_TTL = 86400;    // 24 hours - schema configs\n"})}),"\n",(0,i.jsx)(n.h3,{id:"sampling-rates",children:"Sampling Rates"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// Adaptive sampling based on dataset size\nprivate const SMALL_SAMPLE_RATE = 1.0;    // 100% - exact\nprivate const MEDIUM_SAMPLE_RATE = 0.1;   // 10% sampling\nprivate const LARGE_SAMPLE_RATE = 0.05;   // 5% sampling\n"})}),"\n",(0,i.jsx)(n.h2,{id:"system-health--monitoring",children:"System Health & Monitoring"}),"\n",(0,i.jsx)(n.h3,{id:"performance-monitoring",children:"Performance Monitoring"}),"\n",(0,i.jsx)(n.p,{children:"The system includes comprehensive logging for performance monitoring:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$this->logger->debug('Hyper-optimized facets completed', [\n    'strategy' => $optimizationStrategy,\n    'executionTime' => $executionTime . 'ms',\n    'facetCount' => count($results),\n    'accuracy' => $this->getAccuracyLevel($optimizationStrategy)\n]);\n"})}),"\n",(0,i.jsx)(n.h3,{id:"key-metrics-to-monitor",children:"Key Metrics to Monitor"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Response Time"}),": Target <100ms for all requests"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Cache Hit Rate"}),": Should be >60% for production workloads"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Strategy Distribution"}),": Monitor which strategies are used most"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Accuracy Confidence"}),": Track statistical accuracy for sampling/estimation"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"cache-invalidation-strategy",children:"Cache Invalidation Strategy"}),"\n",(0,i.jsx)(n.h3,{id:"automatic-invalidation",children:"Automatic Invalidation"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Schema Changes"}),": Automatically regenerates facet configurations"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"TTL-Based"}),": Different cache layers expire at appropriate intervals"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Version-Based"}),": Cache keys include version for manual invalidation"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"manual-cache-management",children:"Manual Cache Management"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// Clear all facet caches when needed\n$hyperFacetHandler->clearAllCaches();\n\n// Warm up cache for popular queries\n$hyperFacetHandler->warmupPopularFacets($popularQueries);\n"})}),"\n",(0,i.jsx)(n.h2,{id:"testing--validation",children:"Testing & Validation"}),"\n",(0,i.jsx)(n.h3,{id:"performance-testing-commands",children:"Performance Testing Commands"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Test simple facets (should be &lt;100ms)\ntime curl -u 'admin:admin' \\\n  'http://localhost/api/objects/19/116?_facets[@self][register][type]=terms'\n\n# Test complex facets (should be &lt;200ms) \ntime curl -u 'admin:admin' \\\n  'http://localhost/api/objects/19/116?_facets[@self][register][type]=terms&_facets[@self][created][type]=date_histogram&_facets[status][type]=terms'\n\n# Test cached response (should be &lt;10ms)\ntime curl -u 'admin:admin' \\\n  'http://localhost/api/objects/19/116?_facets[@self][register][type]=terms'\n"})}),"\n",(0,i.jsx)(n.h3,{id:"expected-log-patterns",children:"Expected Log Patterns"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"[DEBUG] Dataset analysis completed: estimatedSize=5420, strategy=smart_sampling, analysisTime=2.1ms\n[DEBUG] Hyper-optimized facets completed: strategy=smart_sampling, executionTime=45.2ms, accuracy=high (~95%)\n[DEBUG] Cache hit - instant facet response: responseTime=&lt;10ms, source=cache_layer_1\n"})}),"\n",(0,i.jsx)(n.h2,{id:"advanced-features",children:"Advanced Features"}),"\n",(0,i.jsxs)(n.h3,{id:"-progressive-enhancement",children:["\ud83d\udcca ",(0,i.jsx)(n.strong,{children:"Progressive Enhancement"})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Phase 1"}),": Return fast approximate results immediately"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Phase 2"}),": Enhance with exact calculations in background (future feature)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Phase 3"}),": Update cache with refined results"]}),"\n"]}),"\n",(0,i.jsxs)(n.h3,{id:"-confidence-intervals",children:["\ud83e\uddee ",(0,i.jsx)(n.strong,{children:"Confidence Intervals"})]}),"\n",(0,i.jsx)(n.p,{children:"For sampled results, the system provides statistical confidence:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "key": "active",\n  "results": 847,\n  "approximate": true,\n  "confidence": 0.92,\n  "sample_size": 542,\n  "extrapolation_factor": 10.1\n}\n'})}),"\n",(0,i.jsxs)(n.h3,{id:"-batch-optimization",children:["\ud83c\udfaa ",(0,i.jsx)(n.strong,{children:"Batch Optimization"})]}),"\n",(0,i.jsx)(n.p,{children:"Multiple metadata facets calculated in single queries:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"-- Instead of 3 separate queries for register, schema, organisation facets:\nSELECT register, schema, organisation, COUNT(*) as doc_count \nFROM oc_openregister_objects \nGROUP BY register, schema, organisation \nORDER BY doc_count DESC;\n"})}),"\n",(0,i.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,i.jsx)(n.h3,{id:"common-issues",children:"Common Issues"}),"\n",(0,i.jsxs)(n.h4,{id:"1-slow-response-times",children:["1. ",(0,i.jsx)(n.strong,{children:"Slow Response Times"})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Check"}),": Cache configuration and TTL settings"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Solution"}),": Verify distributed cache (Redis/Memcached) is available"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Fallback"}),": System automatically falls back to local cache"]}),"\n"]}),"\n",(0,i.jsxs)(n.h4,{id:"2-accuracy-concerns",children:["2. ",(0,i.jsx)(n.strong,{children:"Accuracy Concerns"})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Check"}),": Dataset size and strategy selection"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Solution"}),": Adjust thresholds in ",(0,i.jsx)(n.code,{children:"HyperFacetHandler.php"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Options"}),": Force exact calculation by reducing dataset thresholds"]}),"\n"]}),"\n",(0,i.jsxs)(n.h4,{id:"3-cache-misses",children:["3. ",(0,i.jsx)(n.strong,{children:"Cache Misses"})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Check"}),": Cache key generation and user context"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Solution"}),": Monitor cache hit rates and key consistency"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Debug"}),": Enable debug logging for cache operations"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"debug-commands",children:"Debug Commands"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Check system status\ndocker exec -u 33 master-nextcloud-1 php /var/www/html/occ app:list | grep openregister\n\n# View faceting logs\ndocker logs master-nextcloud-1 --since 10m | grep -E \"(Hyper|facet|cache)\"\n\n# Test database indexes\ndocker exec -u 33 master-nextcloud-1 php -r \"\nrequire '/var/www/html/config/config.php';\n\\$pdo = new PDO('mysql:host='.\\$CONFIG['dbhost'].';dbname='.\\$CONFIG['dbname'], \\$CONFIG['dbuser'], \\$CONFIG['dbpassword']);\n\\$result = \\$pdo->query('SHOW INDEX FROM oc_openregister_objects');\nwhile (\\$row = \\$result->fetch()) { echo \\$row['Key_name'] . ' | ' . \\$row['Column_name'] . PHP_EOL; }\n\"\n"})}),"\n",(0,i.jsx)(n.h2,{id:"database-optimizations",children:"Database Optimizations"}),"\n",(0,i.jsx)(n.h3,{id:"composite-indexes",children:"Composite Indexes"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"-- Optimized indexes for facet queries\nCREATE INDEX objects_register_schema_idx ON oc_openregister_objects (register, schema);\nCREATE INDEX objects_register_schema_created_idx ON oc_openregister_objects (register, schema, created);\nCREATE INDEX objects_perf_super_idx ON oc_openregister_objects (register, schema, organisation);\n"})}),"\n",(0,i.jsx)(n.h3,{id:"query-optimization-strategy",children:"Query Optimization Strategy"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"First"}),": Apply ",(0,i.jsx)(n.code,{children:"register+schema"})," filters (uses ",(0,i.jsx)(n.code,{children:"objects_register_schema_idx"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Second"}),": Apply ",(0,i.jsx)(n.code,{children:"organisation"})," filter (uses ",(0,i.jsx)(n.code,{children:"objects_perf_super_idx"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Third"}),": Apply other indexed filters (",(0,i.jsx)(n.code,{children:"deleted"}),", ",(0,i.jsx)(n.code,{children:"published"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Last"}),": Apply expensive JSON filters (after dataset is reduced)"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"future-enhancements",children:"Future Enhancements"}),"\n",(0,i.jsx)(n.h3,{id:"planned-optimizations",children:"Planned Optimizations"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\ud83d\udd04 Background Cache Warming"}),": Automatically pre-calculate popular facet combinations"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\ud83d\udcca Machine Learning Strategy Selection"}),": Use ML to optimize strategy selection based on historical data"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\ud83c\udfaf Real-time Cache Invalidation"}),": Selective cache invalidation when objects are modified"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u26a1 GPU-Accelerated Processing"}),": For extremely large datasets using specialized hardware"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\ud83c\udf10 Distributed Facet Calculation"}),": Split calculation across multiple application instances"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"advanced-configuration-options",children:"Advanced Configuration Options"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// Future configuration options\n'hyperFaceting' => [\n    'enableBackgroundWarmup' => true,\n    'maxConcurrentOperations' => 10,\n    'adaptiveThresholds' => true,\n    'mlStrategySelection' => false,\n    'gpuAcceleration' => false\n]\n"})}),"\n",(0,i.jsx)(n.h2,{id:"security--rbac-integration",children:"Security & RBAC Integration"}),"\n",(0,i.jsx)(n.p,{children:"The hyper-faceting system fully respects existing security mechanisms:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"RBAC Compliance"}),": All facet calculations respect user permissions"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Multi-tenancy"}),": Organization filtering applied consistently"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Data Isolation"}),": Cache keys include user and organization context"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Permission Inheritance"}),": Facet results only include data user can access"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/Features/faceting",children:"Faceting System"})," - User-facing faceting documentation"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\ud83c\udf89 The Hyper-Performant Faceting System represents a breakthrough in OpenRegister's performance capabilities, delivering enterprise-grade faceting performance while maintaining full feature compatibility and security compliance."})})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>r,x:()=>c});var t=s(96540);const i={},a=t.createContext(i);function r(e){const n=t.useContext(a);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),t.createElement(a.Provider,{value:n},e.children)}}}]);