"use strict";(self.webpackChunkopen_catalogi_docs=self.webpackChunkopen_catalogi_docs||[]).push([[6741],{28453:(e,n,i)=>{i.d(n,{R:()=>r,x:()=>c});var s=i(96540);const l={},t=s.createContext(l);function r(e){const n=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:r(e.components),s.createElement(t.Provider,{value:n},e.children)}},96332:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>c,default:()=>u,frontMatter:()=>r,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"development/virus-scanning","title":"Virus Scanning Setup","description":"Version: 1.0","source":"@site/docs/development/virus-scanning.md","sourceDirName":"development","slug":"/development/virus-scanning","permalink":"/docs/development/virus-scanning","draft":false,"unlisted":false,"editUrl":"https://github.com/conductionnl/openregister/tree/main/website/docs/development/virus-scanning.md","tags":[],"version":"current","sidebarPosition":46,"frontMatter":{"title":"Virus Scanning Setup","sidebar_position":46},"sidebar":"tutorialSidebar","previous":{"title":"Security Architecture","permalink":"/docs/development/security-architecture"},"next":{"title":"Development Milestones","permalink":"/docs/development/epic-milestones"}}');var l=i(74848),t=i(28453);const r={title:"Virus Scanning Setup",sidebar_position:46},c="File Security & Virus Scanning in OpenRegister",o={},a=[{value:"Overview",id:"overview",level:2},{value:"Current Security Measures",id:"current-security-measures",level:2},{value:"Virus Scanning Options",id:"virus-scanning-options",level:2},{value:"Option 1: Nextcloud Built-in Antivirus App \u2b50 <strong>RECOMMENDED</strong>",id:"option-1-nextcloud-built-in-antivirus-app--recommended",level:3},{value:"Option 2: PHP ClamAV Library",id:"option-2-php-clamav-library",level:3},{value:"Option 3: VirusTotal API",id:"option-3-virustotal-api",level:3},{value:"Recommended Approach",id:"recommended-approach",level:2},{value:"Implementation Steps",id:"implementation-steps",level:2},{value:"Testing",id:"testing",level:2},{value:"EICAR Test File",id:"eicar-test-file",level:3},{value:"Related Documentation",id:"related-documentation",level:2}];function d(e){const n={a:"a",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"file-security--virus-scanning-in-openregister",children:"File Security & Virus Scanning in OpenRegister"})}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Version:"})," 1.0",(0,l.jsx)(n.br,{}),"\n",(0,l.jsx)(n.strong,{children:"Date:"})," October 2025",(0,l.jsx)(n.br,{}),"\n",(0,l.jsx)(n.strong,{children:"Status:"})," \ud83d\udccb Planning Document"]}),"\n",(0,l.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,l.jsx)(n.p,{children:"This document outlines options for implementing virus scanning and malicious content detection for file uploads in OpenRegister."}),"\n",(0,l.jsx)(n.h2,{id:"current-security-measures",children:"Current Security Measures"}),"\n",(0,l.jsxs)(n.p,{children:["\u2705 ",(0,l.jsx)(n.strong,{children:"Already Implemented:"})]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"MIME type validation against schema configuration"}),"\n",(0,l.jsx)(n.li,{children:"File size limits"}),"\n",(0,l.jsx)(n.li,{children:"Content-type detection (not just extension-based)"}),"\n",(0,l.jsx)(n.li,{children:"Filename sanitization"}),"\n",(0,l.jsx)(n.li,{children:"RBAC permissions"}),"\n",(0,l.jsx)(n.li,{children:"URL validation with timeouts"}),"\n",(0,l.jsx)(n.li,{children:"Executable file blocking (extension + magic bytes)"}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:["\u274c ",(0,l.jsx)(n.strong,{children:"Not Yet Implemented:"})]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Virus scanning"}),"\n",(0,l.jsx)(n.li,{children:"Malware detection"}),"\n",(0,l.jsx)(n.li,{children:"Content inspection beyond MIME type"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"virus-scanning-options",children:"Virus Scanning Options"}),"\n",(0,l.jsxs)(n.h3,{id:"option-1-nextcloud-built-in-antivirus-app--recommended",children:["Option 1: Nextcloud Built-in Antivirus App \u2b50 ",(0,l.jsx)(n.strong,{children:"RECOMMENDED"})]}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Nextcloud Antivirus for files"})," - Official Nextcloud app"]}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Description:"}),"\nNextcloud has an official ",(0,l.jsx)(n.strong,{children:"Antivirus for files"})," app that uses ClamAV to scan files on upload."]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Advantages:"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u2705 Native Nextcloud integration"}),"\n",(0,l.jsx)(n.li,{children:"\u2705 No extra PHP code needed"}),"\n",(0,l.jsx)(n.li,{children:"\u2705 Works automatically for all file uploads"}),"\n",(0,l.jsx)(n.li,{children:"\u2705 Supported by Nextcloud community"}),"\n",(0,l.jsx)(n.li,{children:"\u2705 Scans files asynchronously (background jobs)"}),"\n",(0,l.jsx)(n.li,{children:"\u2705 Configurable via admin panel"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Implementation:"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'# 1. Install ClamAV in Docker environment\ndocker exec master-nextcloud-1 apt-get update\ndocker exec master-nextcloud-1 apt-get install -y clamav clamav-daemon\n\n# 2. Start ClamAV daemon\ndocker exec master-nextcloud-1 service clamav-daemon start\n\n# 3. Install Nextcloud Antivirus app\ndocker exec -u 33 master-nextcloud-1 php occ app:install files_antivirus\n\n# 4. Enable the app\ndocker exec -u 33 master-nextcloud-1 php occ app:enable files_antivirus\n\n# 5. Configure to use ClamAV daemon\ndocker exec -u 33 master-nextcloud-1 php occ config:app:set files_antivirus av_mode --value="daemon"\ndocker exec -u 33 master-nextcloud-1 php occ config:app:set files_antivirus av_socket --value="/var/run/clamav/clamd.ctl"\n'})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"How it works:"})}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"User uploads file via OpenRegister"}),"\n",(0,l.jsx)(n.li,{children:"File is stored in Nextcloud"}),"\n",(0,l.jsx)(n.li,{children:"Nextcloud Antivirus app detects new file"}),"\n",(0,l.jsx)(n.li,{children:"ClamAV scans the file"}),"\n",(0,l.jsx)(n.li,{children:"If virus: file is blocked/removed"}),"\n",(0,l.jsx)(n.li,{children:"Admin gets notification"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Docker compose configuration:"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:'services:\n  nextcloud:\n    # ... existing config ...\n    \n  clamav:\n    image: clamav/clamav:latest\n    container_name: master-clamav-1\n    volumes:\n      - clamav-data:/var/lib/clamav\n    networks:\n      - nextcloud-network\n    healthcheck:\n      test: ["CMD", "clamdscan", "--ping", "1"]\n      interval: 60s\n      timeout: 10s\n      retries: 3\n\nvolumes:\n  clamav-data:\n'})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Configuration in Nextcloud:"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Admin Settings \u2192 Security \u2192 Antivirus Configuration"}),"\n",(0,l.jsx)(n.li,{children:"Choose: Daemon mode"}),"\n",(0,l.jsxs)(n.li,{children:["Socket: ",(0,l.jsx)(n.code,{children:"/var/run/clamav/clamd.ctl"})," (Unix socket)"]}),"\n",(0,l.jsxs)(n.li,{children:["Or: Host: ",(0,l.jsx)(n.code,{children:"clamav"}),", Port: ",(0,l.jsx)(n.code,{children:"3310"})," (TCP)"]}),"\n",(0,l.jsx)(n.li,{children:"Action on virus: Delete file / Only log"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"option-2-php-clamav-library",children:"Option 2: PHP ClamAV Library"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Library:"})," ",(0,l.jsx)(n.code,{children:"xenolope/quahog"})," or ",(0,l.jsx)(n.code,{children:"clamav/clamav-php"})]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Advantages:"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u2705 Direct integration in OpenRegister code"}),"\n",(0,l.jsx)(n.li,{children:"\u2705 More control over scanning behavior"}),"\n",(0,l.jsx)(n.li,{children:"\u2705 Can customize error handling"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Disadvantages:"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u274c Requires PHP extension or library"}),"\n",(0,l.jsx)(n.li,{children:"\u274c More code to maintain"}),"\n",(0,l.jsx)(n.li,{children:"\u274c Need to handle async scanning manually"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"option-3-virustotal-api",children:"Option 3: VirusTotal API"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Service:"})," VirusTotal Public API"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Advantages:"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u2705 No local installation needed"}),"\n",(0,l.jsx)(n.li,{children:"\u2705 Comprehensive threat database"}),"\n",(0,l.jsx)(n.li,{children:"\u2705 Multiple antivirus engines"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Disadvantages:"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u274c Rate limits (4 requests/minute free tier)"}),"\n",(0,l.jsx)(n.li,{children:"\u274c Privacy concerns (files sent to third party)"}),"\n",(0,l.jsx)(n.li,{children:"\u274c Requires API key"}),"\n",(0,l.jsx)(n.li,{children:"\u274c Cost for high volume"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"recommended-approach",children:"Recommended Approach"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Use Nextcloud Antivirus App"})," because:"]}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"\u2705 Native integration - works automatically"}),"\n",(0,l.jsx)(n.li,{children:"\u2705 No code changes needed in OpenRegister"}),"\n",(0,l.jsx)(n.li,{children:"\u2705 Well-maintained by Nextcloud community"}),"\n",(0,l.jsx)(n.li,{children:"\u2705 Background scanning - doesn't block uploads"}),"\n",(0,l.jsx)(n.li,{children:"\u2705 Configurable via admin UI"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"implementation-steps",children:"Implementation Steps"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Install ClamAV"})," in Docker environment"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Install Nextcloud Antivirus app"})," via ",(0,l.jsx)(n.code,{children:"occ"})]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Configure"})," ClamAV daemon connection"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Test"})," with EICAR test file"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Monitor"})," scan results in Nextcloud logs"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"testing",children:"Testing"}),"\n",(0,l.jsx)(n.h3,{id:"eicar-test-file",children:"EICAR Test File"}),"\n",(0,l.jsx)(n.p,{children:"Create a test file with EICAR signature (harmless test virus):"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"echo 'X5O!P%@AP[4\\PZX54(P^)7CC)7}$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$H+H*' > eicar.txt\n"})}),"\n",(0,l.jsx)(n.p,{children:"Upload via OpenRegister - should be detected and blocked by ClamAV."}),"\n",(0,l.jsx)(n.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"/docs/development/security-architecture",children:"Security Architecture"})," - Executable file blocking"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"/docs/Features/files",children:"Files"})," - File upload documentation"]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(d,{...e})}):d(e)}}}]);