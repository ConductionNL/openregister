"use strict";(self.webpackChunkopen_catalogi_docs=self.webpackChunkopen_catalogi_docs||[]).push([[853],{28453:(e,r,n)=>{n.d(r,{R:()=>o,x:()=>c});var i=n(96540);const s={},t=i.createContext(s);function o(e){const r=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function c(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),i.createElement(t.Provider,{value:r},e.children)}},90330:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"technical/import-service","title":"Import Service","description":"The Import Service handles data import operations from various formats (CSV, Excel) with efficient batch processing and proper categorization of results.","source":"@site/docs/technical/import-service.md","sourceDirName":"technical","slug":"/technical/import-service","permalink":"/docs/technical/import-service","draft":false,"unlisted":false,"editUrl":"https://github.com/conductionnl/openregister/tree/main/website/docs/technical/import-service.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Import and Export","permalink":"/docs/technical/import-export"},"next":{"title":"Multi-Tenancy Testing Framework","permalink":"/docs/technical/multi-tenancy-testing"}}');var s=n(74848),t=n(28453);const o={},c="Import Service",l={},a=[{value:"Overview",id:"overview",level:2},{value:"Key Features",id:"key-features",level:2},{value:"Import Methods",id:"import-methods",level:2},{value:"CSV Import",id:"csv-import",level:3},{value:"Excel Import",id:"excel-import",level:3},{value:"Data Structure Requirements",id:"data-structure-requirements",level:2},{value:"Object Format",id:"object-format",level:3},{value:"Special Property Handling",id:"special-property-handling",level:3},{value:"Processing Workflow",id:"processing-workflow",level:2},{value:"Performance Benefits",id:"performance-benefits",level:2},{value:"Error Handling",id:"error-handling",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Chunk Size",id:"chunk-size",level:3},{value:"Memory Considerations",id:"memory-considerations",level:3},{value:"Example Usage",id:"example-usage",level:2},{value:"Migration Notes",id:"migration-notes",level:2},{value:"From Previous Version",id:"from-previous-version",level:3},{value:"Breaking Changes",id:"breaking-changes",level:3},{value:"Testing",id:"testing",level:2},{value:"Dependencies",id:"dependencies",level:2}];function d(e){const r={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.header,{children:(0,s.jsx)(r.h1,{id:"import-service",children:"Import Service"})}),"\n",(0,s.jsx)(r.p,{children:"The Import Service handles data import operations from various formats (CSV, Excel) with efficient batch processing and proper categorization of results."}),"\n",(0,s.jsx)(r.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsxs)(r.p,{children:["The Import Service has been refactored to use the new ",(0,s.jsx)(r.code,{children:"saveObjects"})," method from ",(0,s.jsx)(r.code,{children:"ObjectService"})," for improved performance. Instead of processing objects one by one, it now processes them in batches and provides detailed feedback on what was created vs updated."]}),"\n",(0,s.jsx)(r.h2,{id:"key-features",children:"Key Features"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"Batch Processing"}),": Uses ",(0,s.jsx)(r.code,{children:"ObjectService::saveObjects"})," for efficient bulk operations"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"Proper Categorization"}),": Distinguishes between created and updated objects"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"CSV and Excel Support"}),": Handles both file formats with consistent processing"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"Chunked Processing"}),": Processes large files in configurable chunks to prevent memory issues"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"Error Handling"}),": Comprehensive error reporting for both individual rows and batch operations"]}),"\n"]}),"\n",(0,s.jsx)(r.h2,{id:"import-methods",children:"Import Methods"}),"\n",(0,s.jsx)(r.h3,{id:"csv-import",children:"CSV Import"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-php",children:"public function importFromCsv(\n    string $filePath, \n    ?Register $register = null, \n    ?Schema $schema = null, \n    int $chunkSize = 100\n): array\n"})}),"\n",(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.strong,{children:"Requirements"}),": CSV import requires a specific schema to be provided."]}),"\n",(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.strong,{children:"Return Format"}),":"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-php",children:"[\n    'Worksheet' => [\n        'found' => 5600,\n        'created' => ['uuid1', 'uuid2', ...],\n        'updated' => ['uuid3', 'uuid4', ...],\n        'unchanged' => [],\n        'errors' => [],\n        'schema' => [\n            'id' => 90,\n            'title' => 'Compliancy',\n            'slug' => 'compliancy'\n        ]\n    ]\n]\n"})}),"\n",(0,s.jsx)(r.h3,{id:"excel-import",children:"Excel Import"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-php",children:"public function importFromExcel(\n    string $filePath, \n    ?Register $register = null, \n    ?Schema $schema = null, \n    int $chunkSize = 100\n): array\n"})}),"\n",(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.strong,{children:"Multi-schema Support"}),": If a register is provided without a schema, each worksheet is processed as a different schema based on the worksheet name."]}),"\n",(0,s.jsx)(r.h2,{id:"data-structure-requirements",children:"Data Structure Requirements"}),"\n",(0,s.jsx)(r.h3,{id:"object-format",children:"Object Format"}),"\n",(0,s.jsx)(r.p,{children:"Each object in the import must follow this structure:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-php",children:"[\n    '@self' => [\n        'id' => 'optional-uuid-for-updates',\n        'register' => 1,\n        'schema' => 90,\n        'organisation' => 'org-slug',\n        // ... other system properties\n    ],\n    'property1' => 'value1',\n    'property2' => 'value2',\n    // ... other object properties\n]\n"})}),"\n",(0,s.jsx)(r.h3,{id:"special-property-handling",children:"Special Property Handling"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"System Properties"}),": Properties prefixed with ",(0,s.jsx)(r.code,{children:"_"})," or ",(0,s.jsx)(r.code,{children:"@self."})," are automatically placed in the ",(0,s.jsx)(r.code,{children:"@self"})," section"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"ID Handling"}),": If an ",(0,s.jsx)(r.code,{children:"id"})," is provided in the CSV/Excel, it will be used for updates; otherwise, a new UUID will be generated"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"Required Fields"}),": ",(0,s.jsx)(r.code,{children:"register"})," and ",(0,s.jsx)(r.code,{children:"schema"})," IDs must be set in the ",(0,s.jsx)(r.code,{children:"@self"})," section"]}),"\n"]}),"\n",(0,s.jsx)(r.h2,{id:"processing-workflow",children:"Processing Workflow"}),"\n",(0,s.jsxs)(r.ol,{children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"Column Mapping"}),": Headers are mapped to object properties"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"Chunking"}),": Data is processed in configurable chunks (default: 100 rows)"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"Transformation"}),": Each row is transformed into the required object format"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"Batch Saving"}),": All objects in a chunk are saved using ",(0,s.jsx)(r.code,{children:"ObjectService::saveObjects"})]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"Categorization"}),": Results are categorized as created vs updated based on input IDs"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"Error Collection"}),": Individual row errors and batch errors are collected"]}),"\n"]}),"\n",(0,s.jsx)(r.h2,{id:"performance-benefits",children:"Performance Benefits"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"Reduced Database Calls"}),": Single batch operation instead of individual saves"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"Transaction Efficiency"}),": All objects in a chunk are processed in one transaction"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"Memory Management"}),": Chunked processing prevents memory overflow"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"Scalability"}),": Performance scales better with large datasets"]}),"\n"]}),"\n",(0,s.jsx)(r.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,s.jsx)(r.p,{children:"The service provides comprehensive error reporting:"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"Row-level Errors"}),": Individual row processing errors with row number and data"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"Batch Errors"}),": Errors from the bulk save operation"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"Validation Errors"}),": Schema and data validation issues"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"System Errors"}),": File reading and processing errors"]}),"\n"]}),"\n",(0,s.jsx)(r.h2,{id:"configuration",children:"Configuration"}),"\n",(0,s.jsx)(r.h3,{id:"chunk-size",children:"Chunk Size"}),"\n",(0,s.jsx)(r.p,{children:"The default chunk size is 100 rows, but this can be customized:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-php",children:"$result = $importService->importFromCsv($filePath, $register, $schema, 500);\n"})}),"\n",(0,s.jsx)(r.h3,{id:"memory-considerations",children:"Memory Considerations"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"Larger chunk sizes improve performance but use more memory"}),"\n",(0,s.jsx)(r.li,{children:"Monitor memory usage when processing very large files"}),"\n",(0,s.jsx)(r.li,{children:"Consider reducing chunk size if memory issues occur"}),"\n"]}),"\n",(0,s.jsx)(r.h2,{id:"example-usage",children:"Example Usage"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-php",children:"// CSV Import with specific schema\n$result = $importService->importFromCsv(\n    '/path/to/data.csv',\n    $register,\n    $schema\n);\n\n// Check results\nif (!empty($result['Worksheet']['errors'])) {\n    echo \"Import completed with errors:\\n\";\n    foreach ($result['Worksheet']['errors'] as $error) {\n        echo \"Row {$error['row']}: {$error['error']}\\n\";\n    }\n}\n\necho \"Created: \" . count($result['Worksheet']['created']) . \" objects\\n\";\necho \"Updated: \" . count($result['Worksheet']['updated']) . \" objects\\n\";\n"})}),"\n",(0,s.jsx)(r.h2,{id:"migration-notes",children:"Migration Notes"}),"\n",(0,s.jsx)(r.h3,{id:"from-previous-version",children:"From Previous Version"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:["The ",(0,s.jsx)(r.code,{children:"updated"})," key is now properly populated in import results"]}),"\n",(0,s.jsxs)(r.li,{children:["Return structure includes both ",(0,s.jsx)(r.code,{children:"created"})," and ",(0,s.jsx)(r.code,{children:"updated"})," arrays"]}),"\n",(0,s.jsx)(r.li,{children:"Performance is significantly improved for large imports"}),"\n",(0,s.jsx)(r.li,{children:"Error handling is more comprehensive"}),"\n"]}),"\n",(0,s.jsx)(r.h3,{id:"breaking-changes",children:"Breaking Changes"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:["The ",(0,s.jsx)(r.code,{children:"updated"})," key is now always present (previously missing)"]}),"\n",(0,s.jsx)(r.li,{children:"Return type annotations have been updated to reflect the new structure"}),"\n",(0,s.jsx)(r.li,{children:"Individual row processing has been replaced with batch processing"}),"\n"]}),"\n",(0,s.jsx)(r.h2,{id:"testing",children:"Testing"}),"\n",(0,s.jsx)(r.p,{children:"The service includes comprehensive unit tests covering:"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"Successful imports with mixed create/update operations"}),"\n",(0,s.jsx)(r.li,{children:"Error handling scenarios"}),"\n",(0,s.jsx)(r.li,{children:"Empty file handling"}),"\n",(0,s.jsx)(r.li,{children:"Schema validation"}),"\n",(0,s.jsx)(r.li,{children:"Asynchronous operation wrappers"}),"\n"]}),"\n",(0,s.jsx)(r.p,{children:"Run tests with:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-bash",children:"vendor/bin/phpunit tests/unit/Service/ImportServiceTest.php\n"})}),"\n",(0,s.jsx)(r.h2,{id:"dependencies",children:"Dependencies"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"PhpOffice\\PhpSpreadsheet"}),": For CSV and Excel file reading"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"ObjectService"}),": For batch object saving"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"SchemaMapper"}),": For schema validation and lookup"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"ObjectEntityMapper"}),": For database operations"]}),"\n"]})]})}function h(e={}){const{wrapper:r}={...(0,t.R)(),...e.components};return r?(0,s.jsx)(r,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}}}]);