"use strict";(self.webpackChunkopen_catalogi_docs=self.webpackChunkopen_catalogi_docs||[]).push([[8202],{28453:(e,n,i)=>{i.d(n,{R:()=>t,x:()=>l});var a=i(96540);const c={},s=a.createContext(c);function t(e){const n=a.useContext(s);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:t(e.components),a.createElement(s.Provider,{value:n},e.children)}},41721:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>r,contentTitle:()=>l,default:()=>h,frontMatter:()=>t,metadata:()=>a,toc:()=>o});const a=JSON.parse('{"id":"technical/cache-invalidation-system","title":"Cache Invalidation System","description":"Overview","source":"@site/docs/technical/cache-invalidation-system.md","sourceDirName":"technical","slug":"/technical/cache-invalidation-system","permalink":"/docs/technical/cache-invalidation-system","draft":false,"unlisted":false,"editUrl":"https://github.com/conductionnl/openregister/tree/main/website/docs/technical/cache-invalidation-system.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Bulk Operations Implementation","permalink":"/docs/technical/bulk-operations-implementation"},"next":{"title":"File Processing: Supported Formats and Limits","permalink":"/docs/technical/file-processing-formats"}}');var c=i(74848),s=i(28453);const t={},l="Cache Invalidation System",r={},o=[{value:"Overview",id:"overview",level:2},{value:"Architecture Overview",id:"architecture-overview",level:2},{value:"Components",id:"components",level:2},{value:"CacheInvalidationService",id:"cacheinvalidationservice",level:3},{value:"Integration Points",id:"integration-points",level:3},{value:"Object CRUD Operations",id:"object-crud-operations",level:4},{value:"Schema CRUD Operations",id:"schema-crud-operations",level:4},{value:"Bulk Operations",id:"bulk-operations",level:4},{value:"Cache Types and Invalidation Strategies",id:"cache-types-and-invalidation-strategies",level:2},{value:"Search/Collection Cache",id:"searchcollection-cache",level:3},{value:"Entity Cache",id:"entity-cache",level:3},{value:"Facet Response Cache",id:"facet-response-cache",level:3},{value:"Schema-Specific Caches",id:"schema-specific-caches",level:3},{value:"RBAC Compliance",id:"rbac-compliance",level:2},{value:"User-Based Cache Keys",id:"user-based-cache-keys",level:3},{value:"Anonymous User Handling",id:"anonymous-user-handling",level:3},{value:"Performance Benefits",id:"performance-benefits",level:2},{value:"Before Implementation",id:"before-implementation",level:3},{value:"After Implementation",id:"after-implementation",level:3},{value:"Performance Monitoring",id:"performance-monitoring",level:3},{value:"Usage Examples",id:"usage-examples",level:2},{value:"Individual Object Operations",id:"individual-object-operations",level:3},{value:"Bulk Operations",id:"bulk-operations-1",level:3},{value:"Schema Operations",id:"schema-operations",level:3},{value:"Cache Invalidation Flow",id:"cache-invalidation-flow",level:2},{value:"Individual Object Flow",id:"individual-object-flow",level:3},{value:"Schema Change Flow",id:"schema-change-flow",level:3},{value:"Bulk Operation Flow",id:"bulk-operation-flow",level:3},{value:"Cache Key Patterns",id:"cache-key-patterns",level:2},{value:"Collection Cache Keys",id:"collection-cache-keys",level:3},{value:"Entity Cache Keys",id:"entity-cache-keys",level:3},{value:"Facet Cache Keys",id:"facet-cache-keys",level:3},{value:"Error Handling",id:"error-handling",level:2},{value:"Non-Blocking Cache Operations",id:"non-blocking-cache-operations",level:3},{value:"Graceful Degradation",id:"graceful-degradation",level:3},{value:"Configuration",id:"configuration",level:2},{value:"Cache TTL Settings",id:"cache-ttl-settings",level:3},{value:"Environment Detection",id:"environment-detection",level:3},{value:"Monitoring and Debugging",id:"monitoring-and-debugging",level:2},{value:"Debug Logging",id:"debug-logging",level:3},{value:"Performance Metrics",id:"performance-metrics",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"For Developers",id:"for-developers",level:3},{value:"For Operations",id:"for-operations",level:3},{value:"Future Enhancements",id:"future-enhancements",level:2},{value:"Planned Improvements",id:"planned-improvements",level:3},{value:"Extension Points",id:"extension-points",level:3},{value:"External App Optimization",id:"external-app-optimization",level:2},{value:"Cache Isolation for External Apps",id:"cache-isolation-for-external-apps",level:3},{value:"Usage for External Apps",id:"usage-for-external-apps",level:3}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(n.header,{children:(0,c.jsx)(n.h1,{id:"cache-invalidation-system",children:"Cache Invalidation System"})}),"\n",(0,c.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,c.jsxs)(n.p,{children:["The OpenRegister Cache Invalidation System provides ",(0,c.jsx)(n.strong,{children:"enterprise-grade cache consistency"})," across all CRUD operations, ensuring that cached data remains synchronized with database changes. This system was designed to solve critical performance and consistency challenges while maintaining RBAC compliance and multi-tenant isolation."]}),"\n",(0,c.jsx)(n.h2,{id:"architecture-overview",children:"Architecture Overview"}),"\n",(0,c.jsx)(n.mermaid,{value:'graph TD\n    subgraph "CRUD Operations"\n        A[Individual Object CRUD]\n        B[Bulk Object Operations] \n        C[Schema CRUD Operations]\n    end\n    \n    subgraph "Cache Invalidation Service"\n        D[CacheInvalidationService]\n        D --\x3e E[Object Cache Invalidation]\n        D --\x3e F[Schema Cache Invalidation]\n        D --\x3e G[Bulk Cache Coordination]\n    end\n    \n    subgraph "Cache Layers"\n        H[Search/Collection Cache]\n        I[Facet Response Cache]\n        J[Entity Cache]\n        K[Schema Config Cache]\n        L[Schema Facet Cache]\n    end\n    \n    A --\x3e D\n    B --\x3e D  \n    C --\x3e D\n    E --\x3e H\n    E --\x3e I\n    E --\x3e J\n    F --\x3e K\n    F --\x3e L\n    F --\x3e H\n    F --\x3e I\n    G --\x3e H\n    G --\x3e I\n    G --\x3e J\n    \n    style D fill:#e1f5fe\n    style H fill:#c8e6c9\n    style I fill:#c8e6c9\n    style J fill:#c8e6c9\n    style K fill:#fff3e0\n    style L fill:#fff3e0'}),"\n",(0,c.jsx)(n.h2,{id:"components",children:"Components"}),"\n",(0,c.jsx)(n.h3,{id:"cacheinvalidationservice",children:"CacheInvalidationService"}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.strong,{children:"Location"}),": ",(0,c.jsx)(n.code,{children:"lib/Service/CacheInvalidationService.php"})]}),"\n",(0,c.jsx)(n.p,{children:"Central service that coordinates cache invalidation across all cache layers. Provides methods for:"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Individual object invalidation"}),": ",(0,c.jsx)(n.code,{children:"invalidateObjectRelatedCaches()"})]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Schema-related invalidation"}),": ",(0,c.jsx)(n.code,{children:"invalidateSchemaRelatedCaches()"})]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Bulk operation coordination"}),": Used by ",(0,c.jsx)(n.code,{children:"ObjectService"})," bulk methods"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"RBAC-compliant cache management"}),": User and organization-aware cache keys"]}),"\n"]}),"\n",(0,c.jsx)(n.h3,{id:"integration-points",children:"Integration Points"}),"\n",(0,c.jsx)(n.h4,{id:"object-crud-operations",children:"Object CRUD Operations"}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.strong,{children:"SaveObject Handler"})," (",(0,c.jsx)(n.code,{children:"lib/Service/ObjectHandlers/SaveObject.php"}),"):"]}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"Automatically invalidates caches after object create/update operations"}),"\n",(0,c.jsx)(n.li,{children:"Includes register, schema, and object-specific cache clearing"}),"\n"]}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.strong,{children:"DeleteObject Handler"})," (",(0,c.jsx)(n.code,{children:"lib/Service/ObjectHandlers/DeleteObject.php"}),"):"]}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"Automatically invalidates caches after object deletion"}),"\n",(0,c.jsx)(n.li,{children:"Ensures deleted objects disappear from collection queries immediately"}),"\n"]}),"\n",(0,c.jsx)(n.h4,{id:"schema-crud-operations",children:"Schema CRUD Operations"}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.strong,{children:"SchemasController"})," (",(0,c.jsx)(n.code,{children:"lib/Controller/SchemasController.php"}),"):"]}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"Invalidates schema-related caches on schema create/update/delete"}),"\n",(0,c.jsx)(n.li,{children:"Coordinates with dependent cache layers (collections, facets)"}),"\n"]}),"\n",(0,c.jsx)(n.h4,{id:"bulk-operations",children:"Bulk Operations"}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.strong,{children:"ObjectService"})," (",(0,c.jsx)(n.code,{children:"lib/Service/ObjectService.php"}),"):"]}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"saveObjects()"}),": Invalidates caches after bulk create/update operations"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"deleteObjects()"}),": Clears collection caches after mass deletion"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"publishObjects()"}),": Updates facet caches after bulk publication changes"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"depublishObjects()"}),": Synchronizes visibility caches after bulk depublication"]}),"\n"]}),"\n",(0,c.jsx)(n.h2,{id:"cache-types-and-invalidation-strategies",children:"Cache Types and Invalidation Strategies"}),"\n",(0,c.jsx)(n.h3,{id:"searchcollection-cache",children:"Search/Collection Cache"}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.strong,{children:"Purpose"}),": Caches complete API responses for collection endpoints\n",(0,c.jsx)(n.strong,{children:"Key Pattern"}),": ",(0,c.jsx)(n.code,{children:"obj_search_{hash}"})," with user and organization context\n",(0,c.jsx)(n.strong,{children:"Invalidation"}),": Cleared on any object CRUD operation affecting the collection"]}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.strong,{children:"Cache Keys"}),":"]}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:["Include ",(0,c.jsx)(n.strong,{children:"user ID"})," for RBAC isolation"]}),"\n",(0,c.jsxs)(n.li,{children:["Include ",(0,c.jsx)(n.strong,{children:"organization ID"})," for multi-tenancy"]}),"\n",(0,c.jsxs)(n.li,{children:["Include ",(0,c.jsx)(n.strong,{children:"query hash"})," for request-specific caching"]}),"\n"]}),"\n",(0,c.jsx)(n.mermaid,{value:"graph LR\n    A[User Request] --\x3e B{Cache Key Generation}\n    B --\x3e C[User ID + Org ID + Query Hash]\n    C --\x3e D[obj_search_abc123...]\n    D --\x3e E{Cache Hit?}\n    E --\x3e|Yes| F[Return Cached Response]\n    E --\x3e|No| G[Execute Query]\n    G --\x3e H[Cache Response]\n    H --\x3e I[Return Fresh Response]\n    \n    style E fill:#fff3e0\n    style F fill:#c8e6c9\n    style G fill:#ffcdd2"}),"\n",(0,c.jsx)(n.h3,{id:"entity-cache",children:"Entity Cache"}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.strong,{children:"Purpose"}),": Caches frequently accessed schemas and registers\n",(0,c.jsx)(n.strong,{children:"Key Pattern"}),": ",(0,c.jsx)(n.code,{children:"entity_{type}_{ids}"}),"\n",(0,c.jsx)(n.strong,{children:"Invalidation"}),": Cleared when specific entities are modified"]}),"\n",(0,c.jsx)(n.h3,{id:"facet-response-cache",children:"Facet Response Cache"}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.strong,{children:"Purpose"}),": Caches facet calculation results for complex aggregations\n",(0,c.jsx)(n.strong,{children:"Key Pattern"}),": Includes query filters and user context\n",(0,c.jsx)(n.strong,{children:"Invalidation"}),": Cleared when underlying data changes affect facet counts"]}),"\n",(0,c.jsx)(n.h3,{id:"schema-specific-caches",children:"Schema-Specific Caches"}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.strong,{children:"Purpose"}),":"]}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Schema Config Cache"}),": Schema configuration data"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Schema Facet Cache"}),": Pre-computed facetable field definitions"]}),"\n"]}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.strong,{children:"Invalidation"}),": Cleared when schemas are created, updated, or deleted"]}),"\n",(0,c.jsx)(n.h2,{id:"rbac-compliance",children:"RBAC Compliance"}),"\n",(0,c.jsx)(n.h3,{id:"user-based-cache-keys",children:"User-Based Cache Keys"}),"\n",(0,c.jsx)(n.p,{children:"All cache keys include user and organization context to ensure data isolation:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-php",children:"$keyData = [\n    'query' => $query,\n    'user' => $userId,           // RBAC isolation\n    'org' => $orgId,             // Multi-tenancy isolation\n    'version' => '1.0'           // Cache versioning\n];\n"})}),"\n",(0,c.jsx)(n.h3,{id:"anonymous-user-handling",children:"Anonymous User Handling"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Anonymous users"})," get separate cache namespace"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Authenticated users"})," have individual cache isolation"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Cross-organization access"})," prevented through cache key separation"]}),"\n"]}),"\n",(0,c.jsx)(n.h2,{id:"performance-benefits",children:"Performance Benefits"}),"\n",(0,c.jsx)(n.h3,{id:"before-implementation",children:"Before Implementation"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Stale data"}),": New objects not visible until cache expiry (5+ minutes)"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Inconsistent facets"}),": Facet counts don't reflect recent changes"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Cross-user data leakage"}),": RBAC violations through shared caches"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Bulk operation invisibility"}),": Mass imports invisible until manual cache clear"]}),"\n"]}),"\n",(0,c.jsx)(n.h3,{id:"after-implementation",children:"After Implementation"}),"\n",(0,c.jsxs)(n.table,{children:[(0,c.jsx)(n.thead,{children:(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.th,{children:(0,c.jsx)(n.strong,{children:"Metric"})}),(0,c.jsx)(n.th,{children:(0,c.jsx)(n.strong,{children:"Before"})}),(0,c.jsx)(n.th,{children:(0,c.jsx)(n.strong,{children:"After"})}),(0,c.jsx)(n.th,{children:(0,c.jsx)(n.strong,{children:"Improvement"})})]})}),(0,c.jsxs)(n.tbody,{children:[(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.strong,{children:"New object visibility"})}),(0,c.jsx)(n.td,{children:"5+ minutes"}),(0,c.jsx)(n.td,{children:"Immediate"}),(0,c.jsx)(n.td,{children:(0,c.jsx)(n.strong,{children:"100% instant"})})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.strong,{children:"Facet accuracy"})}),(0,c.jsx)(n.td,{children:"Stale counts"}),(0,c.jsx)(n.td,{children:"Real-time"}),(0,c.jsx)(n.td,{children:(0,c.jsx)(n.strong,{children:"Always accurate"})})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.strong,{children:"RBAC compliance"})}),(0,c.jsx)(n.td,{children:"\u274c Shared caches"}),(0,c.jsx)(n.td,{children:"\u2705 Isolated"}),(0,c.jsx)(n.td,{children:(0,c.jsx)(n.strong,{children:"100% secure"})})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.strong,{children:"Bulk operation consistency"})}),(0,c.jsx)(n.td,{children:"\u274c Invisible"}),(0,c.jsx)(n.td,{children:"\u2705 Immediate"}),(0,c.jsx)(n.td,{children:(0,c.jsx)(n.strong,{children:"100% consistent"})})]})]})]}),"\n",(0,c.jsx)(n.h3,{id:"performance-monitoring",children:"Performance Monitoring"}),"\n",(0,c.jsx)(n.p,{children:"Detailed logging provides visibility into cache invalidation performance:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-php",children:"$this->logger->info('Object cache invalidation completed', [\n    'register' => $registerId,\n    'schema' => $schemaId, \n    'operation' => $operation,\n    'executionTime' => $executionTime . 'ms',\n    'invalidatedCaches' => $invalidatedCaches\n]);\n"})}),"\n",(0,c.jsx)(n.h2,{id:"usage-examples",children:"Usage Examples"}),"\n",(0,c.jsx)(n.h3,{id:"individual-object-operations",children:"Individual Object Operations"}),"\n",(0,c.jsx)(n.p,{children:"Cache invalidation happens automatically:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-php",children:"// Create object - caches automatically invalidated\n$object = $objectService->createFromArray($data, [], $register, $schema);\n\n// Update object - caches automatically invalidated  \n$object = $objectService->updateFromArray($uuid, $data, true);\n\n// Delete object - caches automatically invalidated\n$result = $objectService->deleteObject($uuid);\n"})}),"\n",(0,c.jsx)(n.h3,{id:"bulk-operations-1",children:"Bulk Operations"}),"\n",(0,c.jsx)(n.p,{children:"Cache invalidation coordinates across bulk operations:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-php",children:"// Bulk save - collection caches invalidated after completion\n$result = $objectService->saveObjects($objectsArray, $register, $schema);\n\n// Bulk delete - global cache invalidation\n$result = $objectService->deleteObjects($uuidArray);\n\n// Bulk publish - facet caches updated\n$result = $objectService->publishObjects($uuidArray, new \\DateTime());\n"})}),"\n",(0,c.jsx)(n.h3,{id:"schema-operations",children:"Schema Operations"}),"\n",(0,c.jsx)(n.p,{children:"Schema changes trigger comprehensive cache invalidation:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-php",children:"// Schema update - affects facets, collections, and entity caches\n$schema = $schemaMapper->updateFromArray($id, $schemaData);\n// Cache invalidation happens automatically in SchemasController\n\n// Schema delete - all dependent caches cleared\n$schemaMapper->delete($schema);\n// Comprehensive cache cleanup happens automatically\n"})}),"\n",(0,c.jsx)(n.h2,{id:"cache-invalidation-flow",children:"Cache Invalidation Flow"}),"\n",(0,c.jsx)(n.h3,{id:"individual-object-flow",children:"Individual Object Flow"}),"\n",(0,c.jsx)(n.mermaid,{value:"sequenceDiagram\n    participant Client\n    participant Controller  \n    participant SaveObject\n    participant CacheService\n    participant Cache\n    \n    Client->>Controller: POST /api/objects\n    Controller->>SaveObject: Save object\n    SaveObject->>SaveObject: Validate & persist\n    SaveObject->>CacheService: invalidateObjectRelatedCaches()\n    CacheService->>Cache: Clear search cache\n    CacheService->>Cache: Clear facet cache  \n    CacheService->>Cache: Clear entity cache\n    SaveObject--\x3e>Controller: Saved object\n    Controller--\x3e>Client: 201 Created\n    \n    Note over Cache: Next GET request sees new data immediately"}),"\n",(0,c.jsx)(n.h3,{id:"schema-change-flow",children:"Schema Change Flow"}),"\n",(0,c.jsx)(n.mermaid,{value:"sequenceDiagram\n    participant Admin\n    participant SchemasController\n    participant CacheService\n    participant MultipleServices\n    participant Cache\n    \n    Admin->>SchemasController: PUT /api/schemas/{id}\n    SchemasController->>SchemasController: Update schema\n    SchemasController->>CacheService: invalidateSchemaRelatedCaches()\n    CacheService->>Cache: Clear entity cache\n    CacheService->>MultipleServices: Clear schema config cache\n    CacheService->>MultipleServices: Clear schema facet cache\n    CacheService->>Cache: Clear collection cache\n    CacheService->>Cache: Clear facet response cache\n    SchemasController--\x3e>Admin: 200 Updated\n    \n    Note over Cache: All schema-dependent caches updated"}),"\n",(0,c.jsx)(n.h3,{id:"bulk-operation-flow",children:"Bulk Operation Flow"}),"\n",(0,c.jsx)(n.mermaid,{value:"sequenceDiagram\n    participant Client\n    participant ObjectService\n    participant SaveObjectsHandler\n    participant CacheService\n    participant Cache\n    \n    Client->>ObjectService: saveObjects(100 objects)\n    ObjectService->>SaveObjectsHandler: Bulk processing\n    SaveObjectsHandler->>SaveObjectsHandler: Create/update objects\n    SaveObjectsHandler--\x3e>ObjectService: Bulk result\n    ObjectService->>CacheService: invalidateObjectRelatedCaches()\n    CacheService->>Cache: Clear collection caches\n    CacheService->>Cache: Clear facet caches\n    ObjectService--\x3e>Client: Bulk result\n    \n    Note over Cache: All 100 objects immediately visible in collections"}),"\n",(0,c.jsx)(n.h2,{id:"cache-key-patterns",children:"Cache Key Patterns"}),"\n",(0,c.jsx)(n.h3,{id:"collection-cache-keys",children:"Collection Cache Keys"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-php",children:"// Pattern: obj_search_{hash}\n// Hash includes: query + user + organization + version\n'obj_search_abc123def456...' \n"})}),"\n",(0,c.jsx)(n.h3,{id:"entity-cache-keys",children:"Entity Cache Keys"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-php",children:"// Specific entities\n'entity_schema_42'\n'entity_register_15'\n\n// Multiple entities  \n'entity_schema_md5(42,43,44)'\n\n// All entities\n'entity_schema_all'\n'entity_register_all'\n"})}),"\n",(0,c.jsx)(n.h3,{id:"facet-cache-keys",children:"Facet Cache Keys"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-php",children:"// Pattern includes user and organization context\n'facet_{userId}_{orgId}_{queryHash}'\n"})}),"\n",(0,c.jsx)(n.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,c.jsx)(n.h3,{id:"non-blocking-cache-operations",children:"Non-Blocking Cache Operations"}),"\n",(0,c.jsx)(n.p,{children:"Cache invalidation failures never block the primary operation:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-php",children:"try {\n    // Perform cache invalidation\n    $this->cacheInvalidationService->invalidateObjectRelatedCaches(/*...*/);\n} catch (\\Exception $e) {\n    // Log error but continue with primary operation\n    $this->logger->warning('Cache invalidation failed', ['error' => $e->getMessage()]);\n}\n"})}),"\n",(0,c.jsx)(n.h3,{id:"graceful-degradation",children:"Graceful Degradation"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Cache unavailable"}),": System continues without caching"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Partial invalidation failures"}),": Logs warnings but continues"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Invalid cache data"}),": Automatically falls back to database"]}),"\n"]}),"\n",(0,c.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,c.jsx)(n.h3,{id:"cache-ttl-settings",children:"Cache TTL Settings"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-php",children:"// Response cache (collection queries)\nprivate const CACHE_TTL = 300; // 5 minutes\n\n// Entity cache (schemas/registers) \nprivate const ENTITY_CACHE_TTL = 900; // 15 minutes\n"})}),"\n",(0,c.jsx)(n.h3,{id:"environment-detection",children:"Environment Detection"}),"\n",(0,c.jsx)(n.p,{children:"The system automatically detects slow environments and adjusts caching strategies:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-php",children:"private function isSlowEnvironment(): bool\n{\n    // Checks for AC environment variables\n    // Measures database response time\n    // Adjusts caching aggressiveness accordingly\n}\n"})}),"\n",(0,c.jsx)(n.h2,{id:"monitoring-and-debugging",children:"Monitoring and Debugging"}),"\n",(0,c.jsx)(n.h3,{id:"debug-logging",children:"Debug Logging"}),"\n",(0,c.jsx)(n.p,{children:"Enable detailed cache logging by checking Docker logs:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"# View real-time cache invalidation logs\ndocker logs -f master-nextcloud-1 | grep -E \"(cache.*invalidation|Cache.*invalidation)\"\n\n# View recent cache operations\ndocker logs master-nextcloud-1 --since 10m | grep 'invalidation'\n"})}),"\n",(0,c.jsx)(n.h3,{id:"performance-metrics",children:"Performance Metrics"}),"\n",(0,c.jsx)(n.p,{children:"The system logs detailed performance metrics:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-json",children:'{\n  "message": "Object cache invalidation completed",\n  "register": 19,\n  "schema": 116,\n  "operation": "create",\n  "executionTime": "2.3ms",\n  "invalidatedCaches": {\n    "search": 15,\n    "facets": 8,\n    "entity": 2\n  }\n}\n'})}),"\n",(0,c.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,c.jsx)(n.h3,{id:"for-developers",children:"For Developers"}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Always use the service methods"}),": Don't bypass cache invalidation by calling mappers directly"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Monitor performance"}),": Use debug logging to track cache invalidation overhead"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Test cache scenarios"}),": Verify that changes are immediately visible in collection calls"]}),"\n"]}),"\n",(0,c.jsx)(n.h3,{id:"for-operations",children:"For Operations"}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Cache warming"}),": Popular queries are automatically cached on first access"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Memory monitoring"}),": Entity caches use distributed storage (Redis/Memcached in production)"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Cache clearing"}),": Use ",(0,c.jsx)(n.code,{children:"clearAllCaches()"})," method for maintenance operations"]}),"\n"]}),"\n",(0,c.jsx)(n.h2,{id:"future-enhancements",children:"Future Enhancements"}),"\n",(0,c.jsx)(n.h3,{id:"planned-improvements",children:"Planned Improvements"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Tagged caching"}),": Use cache tags for more selective invalidation"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Reverse mapping"}),": Track cache dependencies for precise invalidation"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Metrics collection"}),": Expose cache hit/miss rates through API"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Cache warming strategies"}),": Proactive cache population for popular queries"]}),"\n"]}),"\n",(0,c.jsx)(n.h3,{id:"extension-points",children:"Extension Points"}),"\n",(0,c.jsxs)(n.p,{children:["The ",(0,c.jsx)(n.code,{children:"CacheInvalidationService"})," can be extended for additional cache types:"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-php",children:"public function invalidateCustomCache(string $cacheType, $identifier): void\n{\n    // Add custom cache invalidation logic\n}\n"})}),"\n",(0,c.jsx)(n.h2,{id:"external-app-optimization",children:"External App Optimization"}),"\n",(0,c.jsx)(n.h3,{id:"cache-isolation-for-external-apps",children:"Cache Isolation for External Apps"}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.strong,{children:"Problem Solved"}),": External apps calling ",(0,c.jsx)(n.code,{children:"ObjectService"})," directly were experiencing cache thrashing due to shared ",(0,c.jsx)(n.code,{children:"'anonymous'"})," cache namespace."]}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.strong,{children:"Solution Implemented"}),": Enhanced cache key generation with app-specific isolation:"]}),"\n",(0,c.jsx)(n.mermaid,{value:"graph LR\n    A[External App Call] --\x3e B{User Session?}\n    B --\x3e|Yes| C[User-based Cache Key]\n    B --\x3e|No| D{App Context Set?}\n    D --\x3e|Yes| E[external_app_myapp]\n    D --\x3e|No| F{Auto-Detection?}\n    F --\x3e|Yes| G[external_app_detected]\n    F --\x3e|No| H[anonymous_fingerprint]\n    \n    E --\x3e I[Isolated Cache Namespace]\n    G --\x3e I\n    H --\x3e J[Pattern-based Cache]\n    \n    style I fill:#c8e6c9\n    style J fill:#fff3e0"}),"\n",(0,c.jsx)(n.h3,{id:"usage-for-external-apps",children:"Usage for External Apps"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-php",children:"// **RECOMMENDED**: Set explicit app context\n$objectService = \\OC::$server->get(\\OCA\\OpenRegister\\Service\\ObjectService::class);\n$objectService->setExternalAppContext('myapp');\n$results = $objectService->searchObjectsPaginated($query);\n"})}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.strong,{children:"Performance Impact"}),": External apps can see ",(0,c.jsx)(n.strong,{children:"10-30x performance improvements"})," with proper app context."]}),"\n",(0,c.jsxs)(n.p,{children:["For detailed implementation guide, see: ",(0,c.jsx)(n.a,{href:"/docs/developers/external-app-optimization",children:"External App Cache Optimization"})]}),"\n",(0,c.jsx)(n.hr,{}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.strong,{children:"Related Documentation"}),":"]}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:(0,c.jsx)(n.a,{href:"/docs/developers/external-app-optimization",children:"External App Cache Optimization"})}),"\n",(0,c.jsx)(n.li,{children:(0,c.jsx)(n.a,{href:"/docs/technical/schema-based-facets",children:"Schema-Based Facets"})}),"\n",(0,c.jsx)(n.li,{children:(0,c.jsx)(n.a,{href:"/docs/technical/bulk-operations-implementation",children:"Bulk Operations Implementation"})}),"\n",(0,c.jsx)(n.li,{children:(0,c.jsx)(n.a,{href:"/docs/developers/object-handlers",children:"Object Handlers"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(d,{...e})}):d(e)}}}]);