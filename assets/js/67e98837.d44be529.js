"use strict";(self.webpackChunkopen_catalogi_docs=self.webpackChunkopen_catalogi_docs||[]).push([[8858],{28453:(n,e,i)=>{i.d(e,{R:()=>r,x:()=>o});var s=i(96540);const t={},a=s.createContext(t);function r(n){const e=s.useContext(a);return s.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function o(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(t):n.components||t:r(n.components),s.createElement(a.Provider,{value:e},n.children)}},87635:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>l,contentTitle:()=>o,default:()=>g,frontMatter:()=>r,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"Features/multi-tenancy","title":"Multi-Tenancy","description":"OpenRegister\'s multi-tenancy system provides complete organisation-based data isolation, enabling multiple organizations to securely share the same application instance while maintaining strict data segregation.","source":"@site/docs/Features/multi-tenancy.md","sourceDirName":"Features","slug":"/Features/multi-tenancy","permalink":"/docs/Features/multi-tenancy","draft":false,"unlisted":false,"editUrl":"https://github.com/conductionnl/openregister/tree/main/website/docs/Features/multi-tenancy.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Comprehensive Faceting System","permalink":"/docs/Features/faceting"},"next":{"title":"Search Trails","permalink":"/docs/Features/search-trails"}}');var t=i(74848),a=i(28453);const r={},o="Multi-Tenancy",l={},c=[{value:"Overview",id:"overview",level:2},{value:"Core Components",id:"core-components",level:2},{value:"Organisation Management",id:"organisation-management",level:3},{value:"Session Management",id:"session-management",level:3},{value:"Automatic Entity Assignment",id:"automatic-entity-assignment",level:3},{value:"Key Features",id:"key-features",level:2},{value:"Enterprise Scalability",id:"enterprise-scalability",level:3},{value:"Security Model",id:"security-model",level:3},{value:"Performance Optimizations",id:"performance-optimizations",level:3},{value:"API Endpoints",id:"api-endpoints",level:2},{value:"Organisation Management",id:"organisation-management-1",level:3},{value:"Active Organisation",id:"active-organisation",level:3},{value:"User-Organisation Relationships",id:"user-organisation-relationships",level:3},{value:"System Management",id:"system-management",level:3},{value:"Implementation Benefits",id:"implementation-benefits",level:2},{value:"For Organizations",id:"for-organizations",level:3},{value:"For Administrators",id:"for-administrators",level:3},{value:"For Developers",id:"for-developers",level:3},{value:"Migration Support",id:"migration-support",level:2},{value:"Testing &amp; Quality Assurance",id:"testing--quality-assurance",level:2},{value:"Comprehensive Test Suite",id:"comprehensive-test-suite",level:3},{value:"Quality Metrics",id:"quality-metrics",level:3},{value:"Usage Examples",id:"usage-examples",level:2},{value:"Creating Organization-Scoped Entities",id:"creating-organization-scoped-entities",level:3},{value:"Organisation Management",id:"organisation-management-2",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"For Implementation",id:"for-implementation",level:3},{value:"For Security",id:"for-security",level:3},{value:"Integration with Other Features",id:"integration-with-other-features",level:2},{value:"RBAC Integration",id:"rbac-integration",level:3},{value:"Search and Faceting",id:"search-and-faceting",level:3},{value:"Audit Trails",id:"audit-trails",level:3},{value:"Future Enhancements",id:"future-enhancements",level:2},{value:"Technical Implementation",id:"technical-implementation",level:2},{value:"Architecture Overview",id:"architecture-overview",level:3},{value:"Tenant Isolation Strategy",id:"tenant-isolation-strategy",level:3},{value:"Organisation Context Flow",id:"organisation-context-flow",level:3},{value:"Tenant Collection Management",id:"tenant-collection-management",level:3},{value:"Database Schema",id:"database-schema",level:3},{value:"Performance Optimizations",id:"performance-optimizations-1",level:3},{value:"Code Examples",id:"code-examples",level:3},{value:"Best Practices",id:"best-practices-1",level:3},{value:"Monitoring",id:"monitoring",level:3}];function d(n){const e={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.header,{children:(0,t.jsx)(e.h1,{id:"multi-tenancy",children:"Multi-Tenancy"})}),"\n",(0,t.jsx)(e.p,{children:"OpenRegister's multi-tenancy system provides complete organisation-based data isolation, enabling multiple organizations to securely share the same application instance while maintaining strict data segregation."}),"\n",(0,t.jsx)(e.h2,{id:"overview",children:"Overview"}),"\n",(0,t.jsx)(e.p,{children:"Multi-tenancy enables organizations to:"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Maintain Complete Data Isolation"}),": Each organisation's data remains completely separate"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Manage User Memberships"}),": Users can belong to multiple organisations with flexible switching"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Automatic Entity Assignment"}),": All registers, schemas, and objects automatically assigned to active organisation"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Session-Based Context"}),": Active organisation context maintained throughout user sessions"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Enterprise-Grade Security"}),": Prevents cross-organisation data access and maintains audit trails"]}),"\n"]}),"\n",(0,t.jsx)(e.h2,{id:"core-components",children:"Core Components"}),"\n",(0,t.jsx)(e.h3,{id:"organisation-management",children:"Organisation Management"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Organisation Creation"}),": Create and manage organisations with names, descriptions, and settings"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"User Membership"}),": Manage which users belong to which organisations"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"User Selection for Joining"}),": Optionally specify which user to add when joining an organisation (defaults to current user)"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Default Organisation"}),": Automatic fallback organisation for users without specific memberships"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Organisation Statistics"}),": Track usage, user counts, and system metrics"]}),"\n"]}),"\n",(0,t.jsx)(e.h3,{id:"session-management",children:"Session Management"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Active Organisation"}),": Users have one active organisation per session"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Context Switching"}),": Seamless switching between organisations the user belongs to"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Session Persistence"}),": Active organisation maintained across requests and sessions"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Cache Management"}),": Performance-optimized with intelligent caching and cache clearing"]}),"\n"]}),"\n",(0,t.jsx)(e.h3,{id:"automatic-entity-assignment",children:"Automatic Entity Assignment"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Registers"}),": Automatically assigned to user's active organisation when created"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Schemas"}),": Inherit organisation context from active organisation"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Objects"}),": Scoped to organisation context with automatic assignment"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Cross-Organisation Prevention"}),": Prevents users from creating entities in organisations they don't belong to"]}),"\n"]}),"\n",(0,t.jsx)(e.h2,{id:"key-features",children:"Key Features"}),"\n",(0,t.jsx)(e.h3,{id:"enterprise-scalability",children:"Enterprise Scalability"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-mermaid",children:"graph LR\n    A[User] --\x3e B[Multiple Organisations]\n    B --\x3e C[Active Context]\n    C --\x3e D[Entity Creation]\n    D --\x3e E[Organisation Assignment]\n    E --\x3e F[Data Isolation]\n"})}),"\n",(0,t.jsx)(e.h3,{id:"security-model",children:"Security Model"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Access Control Integration"}),": Works seamlessly with existing RBAC system"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Cross-Organisation Prevention"}),": Users cannot access data from other organisations"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Audit Trails"}),": All actions include organisation context for compliance"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Session Isolation"}),": User sessions isolated by organisation context"]}),"\n"]}),"\n",(0,t.jsx)(e.h3,{id:"performance-optimizations",children:"Performance Optimizations"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Database Query Filtering"}),": Efficient filtering at database level using joins"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Session-Based Caching"}),": Active organisation cached in user sessions"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Lazy Loading"}),": Organisation data loaded only when needed"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Query Optimization"}),": Optimized queries prevent unnecessary cross-organisation data retrieval"]}),"\n"]}),"\n",(0,t.jsx)(e.h2,{id:"api-endpoints",children:"API Endpoints"}),"\n",(0,t.jsx)(e.h3,{id:"organisation-management-1",children:"Organisation Management"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"GET /api/organisations"})," - List user's organisations with active organisation"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"POST /api/organisations"})," - Create new organisation"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"GET /api/organisations/{uuid}"})," - Get organisation details"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"PUT /api/organisations/{uuid}"})," - Update organisation"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"GET /api/organisations/search"})," - Search organisations"]}),"\n"]}),"\n",(0,t.jsx)(e.h3,{id:"active-organisation",children:"Active Organisation"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"GET /api/organisations/active"})," - Get current active organisation"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"POST /api/organisations/{uuid}/set-active"})," - Set active organisation"]}),"\n"]}),"\n",(0,t.jsx)(e.h3,{id:"user-organisation-relationships",children:"User-Organisation Relationships"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"POST /api/organisations/{uuid}/join"})," - Join organisation (with optional user selection)"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"POST /api/organisations/{uuid}/leave"})," - Leave organisation"]}),"\n"]}),"\n",(0,t.jsx)(e.h3,{id:"system-management",children:"System Management"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"GET /api/organisations/stats"})," - System-wide statistics"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"POST /api/organisations/clear-cache"})," - Clear organisation cache"]}),"\n"]}),"\n",(0,t.jsx)(e.h2,{id:"implementation-benefits",children:"Implementation Benefits"}),"\n",(0,t.jsx)(e.h3,{id:"for-organizations",children:"For Organizations"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Complete Data Isolation"}),": Guarantee that organizational data remains separate and secure"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Flexible User Management"}),": Users can belong to multiple organisations as needed"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Seamless Experience"}),": Transparent organisation switching without losing context"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Enterprise Ready"}),": Built for enterprise-scale deployments with multiple tenant organizations"]}),"\n"]}),"\n",(0,t.jsx)(e.h3,{id:"for-administrators",children:"For Administrators"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Centralized Management"}),": Single application instance serving multiple organizations"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Resource Efficiency"}),": Shared infrastructure with isolated data"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Monitoring & Analytics"}),": Organization-scoped metrics and usage statistics"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Maintenance Simplicity"}),": Single codebase serving all organizations"]}),"\n"]}),"\n",(0,t.jsx)(e.h3,{id:"for-developers",children:"For Developers"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Automatic Implementation"}),": Entity assignment handled automatically"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Session Integration"}),": Organisation context available throughout the application"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Performance Optimized"}),": Efficient queries with proper database indexing"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Testing Framework"}),": Comprehensive 113 test cases ensuring reliability"]}),"\n"]}),"\n",(0,t.jsx)(e.h2,{id:"migration-support",children:"Migration Support"}),"\n",(0,t.jsx)(e.p,{children:"The multi-tenancy system includes comprehensive migration support:"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Default Organisation Creation"}),": Automatically creates default organisation if none exists"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Legacy Data Assignment"}),": Assigns existing registers, schemas, and objects to default organisation"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"User Auto-Assignment"}),": Users without organisations automatically assigned to default"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Backwards Compatibility"}),": Existing functionality continues working seamlessly"]}),"\n"]}),"\n",(0,t.jsx)(e.h2,{id:"testing--quality-assurance",children:"Testing & Quality Assurance"}),"\n",(0,t.jsx)(e.h3,{id:"comprehensive-test-suite",children:"Comprehensive Test Suite"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"113 Test Scenarios"}),": Complete coverage of all multi-tenancy functionality"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"10 Specialized Test Files"}),": Organized by functional area for maintainability"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Unit Testing"}),": PHPUnit-based testing with mock dependencies"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Integration Testing"}),": Full API testing with real database operations"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Performance Testing"}),": Load testing for scalability verification"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Security Testing"}),": Cross-organisation access prevention validation"]}),"\n"]}),"\n",(0,t.jsx)(e.h3,{id:"quality-metrics",children:"Quality Metrics"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"100% Feature Coverage"}),": All multi-tenancy features tested"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Edge Case Handling"}),": Comprehensive error scenarios and boundary conditions"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Security Validation"}),": Complete access control and data isolation verification"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Performance Benchmarks"}),": Response time and scalability metrics"]}),"\n"]}),"\n",(0,t.jsx)(e.h2,{id:"usage-examples",children:"Usage Examples"}),"\n",(0,t.jsx)(e.h3,{id:"creating-organization-scoped-entities",children:"Creating Organization-Scoped Entities"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-php",children:"// Register automatically assigned to active organisation\n$register = $registerService->createFromArray([\n    'title' => 'Customer Database',\n    'description' => 'Customer records for ACME Corp'\n]);\n// organisation: 'uuid-of-active-org' (automatically set)\n\n// Schema inherits organisation context  \n$schema = $schemaService->createFromArray([\n    'title' => 'Customer Schema',\n    'version' => '1.0.0'\n]);\n// organisation: 'uuid-of-active-org' (automatically set)\n"})}),"\n",(0,t.jsx)(e.h3,{id:"organisation-management-2",children:"Organisation Management"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-php",children:"// Get user's organisations with active context\n$organisations = $organisationService->getUserOrganisations();\n\n// Switch active organisation\n$organisationService->setActiveOrganisation('uuid-of-new-org');\n\n// Create new organisation\n$newOrg = $organisationService->createOrganisation(\n    'New Department', \n    'Department for special projects'\n);\n"})}),"\n",(0,t.jsx)(e.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,t.jsx)(e.h3,{id:"for-implementation",children:"For Implementation"}),"\n",(0,t.jsxs)(e.ol,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Always use Organisation Service"}),": Use the OrganisationService for all organisation operations"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Check Active Context"}),": Verify active organisation before entity creation"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Handle Membership"}),": Ensure users belong to organisations before setting as active"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Cache Appropriately"}),": Use session caching for performance, clear when necessary"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Test Cross-Organisation"}),": Always test cross-organisation access prevention"]}),"\n"]}),"\n",(0,t.jsx)(e.h3,{id:"for-security",children:"For Security"}),"\n",(0,t.jsxs)(e.ol,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Validate Organisation Access"}),": Always check user belongs to organisation before operations"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Use Database Filtering"}),": Filter queries by organisation at database level"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Audit Organisation Context"}),": Include organisation in all audit logs"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Session Management"}),": Properly manage organisation context in sessions"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Regular Testing"}),": Run comprehensive security tests regularly"]}),"\n"]}),"\n",(0,t.jsx)(e.h2,{id:"integration-with-other-features",children:"Integration with Other Features"}),"\n",(0,t.jsx)(e.h3,{id:"rbac-integration",children:"RBAC Integration"}),"\n",(0,t.jsx)(e.p,{children:"Multi-tenancy works seamlessly with the existing Role-Based Access Control system:"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Organisation-Scoped Permissions"}),": RBAC permissions apply within organisation context"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Cross-Organisation Prevention"}),": RBAC prevents access to other organisations' data"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Admin Override"}),": Admin users can access all organisations within their scope"]}),"\n"]}),"\n",(0,t.jsx)(e.h3,{id:"search-and-faceting",children:"Search and Faceting"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Organisation Filtering"}),": Search results automatically filtered by active organisation"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Facet Scoping"}),": Facets calculated only for organisation's data"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Performance Optimization"}),": Efficient organisation-aware search queries"]}),"\n"]}),"\n",(0,t.jsx)(e.h3,{id:"audit-trails",children:"Audit Trails"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Organisation Context"}),": All audit entries include organisation information"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Compliance Support"}),": Organisation-scoped audit trails for regulatory compliance"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Cross-Reference Prevention"}),": Cannot view audit trails from other organisations"]}),"\n"]}),"\n",(0,t.jsx)(e.h2,{id:"future-enhancements",children:"Future Enhancements"}),"\n",(0,t.jsx)(e.p,{children:"Planned enhancements for the multi-tenancy system include:"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Organisation Hierarchies"}),": Parent-child organisation relationships"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Role-Based Organisation Access"}),": Organisation-specific role assignments"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Organisation Templates"}),": Predefined organisation setups for quick deployment"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Cross-Organisation Sharing"}),": Controlled data sharing between organisations"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Organisation Branding"}),": Custom branding and themes per organisation"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Usage Analytics"}),": Detailed organisation usage metrics and reporting"]}),"\n"]}),"\n",(0,t.jsx)(e.hr,{}),"\n",(0,t.jsx)(e.h2,{id:"technical-implementation",children:"Technical Implementation"}),"\n",(0,t.jsx)(e.h3,{id:"architecture-overview",children:"Architecture Overview"}),"\n",(0,t.jsx)(e.p,{children:"Multi-tenancy in OpenRegister uses a combination of organisation-based filtering and Solr tenant collections:"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-mermaid",children:'graph TB\n    subgraph "User Layer"\n        User[User Session]\n        ActiveOrg[Active Organisation]\n    end\n    \n    subgraph "Application Layer"\n        OrgService[Organisation Service]\n        ObjectMapper[Object Mapper]\n        SchemaMapper[Schema Mapper]\n        RegisterMapper[Register Mapper]\n    end\n    \n    subgraph "Data Layer"\n        DB[(MySQL Database<br/>Organisation Field)]\n        SolrBase[Solr Base Collection]\n        SolrTenant1[Solr Tenant Collection<br/>org-uuid-1]\n        SolrTenant2[Solr Tenant Collection<br/>org-uuid-2]\n    end\n    \n    User --\x3e|has| ActiveOrg\n    ActiveOrg --\x3e|managed by| OrgService\n    \n    ObjectMapper --\x3e|filters by organisation| DB\n    SchemaMapper --\x3e|filters by organisation| DB\n    RegisterMapper --\x3e|filters by organisation| DB\n    \n    ObjectMapper --\x3e|indexes to| SolrTenant1\n    ObjectMapper --\x3e|indexes to| SolrTenant2\n    \n    SolrBase -.->|creates| SolrTenant1\n    SolrBase -.->|creates| SolrTenant2\n    \n    style ActiveOrg fill:#e1f5ff\n    style OrgService fill:#fff4e1\n'})}),"\n",(0,t.jsx)(e.h3,{id:"tenant-isolation-strategy",children:"Tenant Isolation Strategy"}),"\n",(0,t.jsx)(e.p,{children:"OpenRegister implements multi-tenancy at two levels:"}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"1. Database-Level Filtering"})}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["All entities have ",(0,t.jsx)(e.code,{children:"organisation"})," field"]}),"\n",(0,t.jsx)(e.li,{children:"Queries automatically filtered by active organisation"}),"\n",(0,t.jsx)(e.li,{children:"Prevents cross-organisation data access"}),"\n"]}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"2. Solr Collection Isolation"})}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"Each tenant gets separate Solr collection"}),"\n",(0,t.jsxs)(e.li,{children:["Collection naming: ",(0,t.jsx)(e.code,{children:"{base-collection}-{org-uuid}"})]}),"\n",(0,t.jsx)(e.li,{children:"Complete search index isolation"}),"\n"]}),"\n",(0,t.jsx)(e.h3,{id:"organisation-context-flow",children:"Organisation Context Flow"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-mermaid",children:"sequenceDiagram\n    participant User as User\n    participant Session as Session\n    participant OrgService as Organisation Service\n    participant Mapper as Entity Mapper\n    participant DB as Database\n    participant Solr as Solr (Tenant Collection)\n    \n    User->>OrgService: setActiveOrganisation(orgUuid)\n    OrgService->>Session: Store active org in session\n    Session--\x3e>User: Context switched\n    \n    Note over User: Create Object\n    \n    User->>Mapper: createObject(data)\n    Mapper->>OrgService: getActiveOrganisation()\n    OrgService->>Session: Retrieve active org\n    Session--\x3e>OrgService: orgUuid\n    OrgService--\x3e>Mapper: organisationUuid\n    \n    Mapper->>Mapper: Set object.organisation = orgUuid\n    Mapper->>DB: INSERT with organisation field\n    DB--\x3e>Mapper: Object saved\n    \n    Mapper->>Solr: Index to tenant collection\n    Note over Solr: Collection: base-{orgUuid}\n    Solr--\x3e>Mapper: Indexed\n    \n    Mapper--\x3e>User: Object created\n"})}),"\n",(0,t.jsx)(e.h3,{id:"tenant-collection-management",children:"Tenant Collection Management"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-mermaid",children:"graph TD\n    Start[User Request] --\x3e CheckCollection{Tenant collection<br/>exists?}\n    \n    CheckCollection --\x3e|Yes| UseCollection[Use Tenant Collection<br/>{base}-{org-uuid}]\n    CheckCollection --\x3e|No| CreateCollection[Create Tenant Collection]\n    \n    CreateCollection --\x3e ConfigSet[Apply ConfigSet<br/>openregister]\n    ConfigSet --\x3e SetupShards[Configure Shards<br/>& Replicas]\n    SetupShards --\x3e CollectionReady[Collection Ready]\n    CollectionReady --\x3e UseCollection\n    \n    UseCollection --\x3e IndexData[Index/Search Data]\n    IndexData --\x3e Success[\u2713 Operation Complete]\n    \n    style Success fill:#90EE90\n"})}),"\n",(0,t.jsx)(e.h3,{id:"database-schema",children:"Database Schema"}),"\n",(0,t.jsx)(e.p,{children:"Organisation field added to all tenant-aware tables:"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:"-- Objects table\nALTER TABLE oc_openregister_objects \nADD COLUMN organisation VARCHAR(255),\nADD INDEX idx_organisation (organisation);\n\n-- Schemas table\nALTER TABLE oc_openregister_schemas\nADD COLUMN organisation VARCHAR(255),\nADD INDEX idx_organisation (organisation);\n\n-- Registers table\nALTER TABLE oc_openregister_registers\nADD COLUMN organisation VARCHAR(255),\nADD INDEX idx_organisation (organisation);\n\n-- Organisations table\nCREATE TABLE oc_openregister_organisations (\n    id INTEGER PRIMARY KEY AUTO_INCREMENT,\n    uuid VARCHAR(255) UNIQUE NOT NULL,\n    name VARCHAR(255) NOT NULL,\n    description TEXT,\n    settings JSON,\n    created DATETIME,\n    updated DATETIME,\n    INDEX idx_uuid (uuid),\n    INDEX idx_name (name)\n);\n\n-- User-Organisation mapping\nCREATE TABLE oc_openregister_user_organisations (\n    id INTEGER PRIMARY KEY AUTO_INCREMENT,\n    user_id VARCHAR(255) NOT NULL,\n    organisation_uuid VARCHAR(255) NOT NULL,\n    role VARCHAR(50) DEFAULT 'member',\n    created DATETIME,\n    UNIQUE KEY unique_user_org (user_id, organisation_uuid),\n    INDEX idx_user (user_id),\n    INDEX idx_org (organisation_uuid)\n);\n"})}),"\n",(0,t.jsx)(e.h3,{id:"performance-optimizations-1",children:"Performance Optimizations"}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"1. Session Caching"})}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"Active organisation cached in user session"}),"\n",(0,t.jsx)(e.li,{children:"Reduces database queries"}),"\n"]}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"2. Database Indexes"})}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["Indexed ",(0,t.jsx)(e.code,{children:"organisation"})," field on all tables"]}),"\n",(0,t.jsx)(e.li,{children:"Fast filtering queries"}),"\n"]}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"3. Lazy Collection Creation"})}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"Tenant collections created on-demand"}),"\n",(0,t.jsx)(e.li,{children:"Reduces initial overhead"}),"\n"]}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"4. Query Optimization"})}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["Automatic ",(0,t.jsx)(e.code,{children:"WHERE organisation = ?"})," in all queries"]}),"\n",(0,t.jsx)(e.li,{children:"Prevents full table scans"}),"\n"]}),"\n",(0,t.jsx)(e.h3,{id:"code-examples",children:"Code Examples"}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"Setting Active Organisation:"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-php",children:"use OCA\\OpenRegister\\Service\\OrganisationService;\n\n$organisationService->setActiveOrganisation($organisationUuid);\n\n// All subsequent operations use this organisation context\n$object = $objectService->create($data);\n// object.organisation automatically set to $organisationUuid\n"})}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"Querying with Organisation Filter:"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-php",children:"// Automatic organisation filtering\n$objects = $objectMapper->findAll();\n// SELECT * FROM objects WHERE organisation = '{active-org-uuid}'\n\n// Explicit organisation override (admin only)\n$objects = $objectMapper->findByOrganisation($specificOrgUuid);\n"})}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"Tenant Collection Operations:"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-php",children:'use OCA\\OpenRegister\\Service\\GuzzleSolrService;\n\n// Ensure tenant collection exists\n$solrService->ensureTenantCollection();\n\n// Get active collection name\n$collectionName = $solrService->getActiveCollectionName();\n// Returns: "openregister-{org-uuid}"\n\n// Index to tenant collection\n$solrService->indexObject($object);\n// Automatically uses tenant collection\n'})}),"\n",(0,t.jsx)(e.h3,{id:"best-practices-1",children:"Best Practices"}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"\u2713 DO:"})}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"Always check active organisation before operations"}),"\n",(0,t.jsx)(e.li,{children:"Use session-based context switching"}),"\n",(0,t.jsx)(e.li,{children:"Validate user membership before switching"}),"\n",(0,t.jsx)(e.li,{children:"Monitor tenant collection sizes"}),"\n",(0,t.jsx)(e.li,{children:"Implement organisation-scoped audit logs"}),"\n"]}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"\u2717 DON'T:"})}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"Don't bypass organisation filtering"}),"\n",(0,t.jsx)(e.li,{children:"Don't share collections between tenants"}),"\n",(0,t.jsx)(e.li,{children:"Don't hard-code organisation UUIDs"}),"\n",(0,t.jsx)(e.li,{children:"Don't skip permission checks"}),"\n",(0,t.jsx)(e.li,{children:"Don't forget to clear caches on context switch"}),"\n"]}),"\n",(0,t.jsx)(e.h3,{id:"monitoring",children:"Monitoring"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:'# Check organisation isolation\nSELECT organisation, COUNT(*) as count\nFROM oc_openregister_objects\nGROUP BY organisation;\n\n# List tenant collections\ncurl "http://solr:8983/solr/admin/collections?action=LIST"\n\n# Monitor collection sizes\ncurl "http://solr:8983/solr/admin/collections?action=CLUSTERSTATUS"\n'})}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsxs)(e.em,{children:["For testing information, see ",(0,t.jsx)(e.a,{href:"/docs/technical/multi-tenancy-testing",children:"Multi-Tenancy Testing Framework"})]}),"\n",(0,t.jsxs)(e.em,{children:["For API details, see ",(0,t.jsx)(e.a,{href:"/docs/api/organisations",children:"Organisations API"})]})]})]})}function g(n={}){const{wrapper:e}={...(0,a.R)(),...n.components};return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(d,{...n})}):d(n)}}}]);