"use strict";(self.webpackChunkopen_catalogi_docs=self.webpackChunkopen_catalogi_docs||[]).push([[5045],{28453:(e,n,i)=>{i.d(n,{R:()=>r,x:()=>o});var t=i(96540);const a={},s=t.createContext(a);function r(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),t.createElement(s.Provider,{value:n},e.children)}},52893:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>g,frontMatter:()=>r,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"features/organisation-default-configuration","title":"Default Organisation Configuration","description":"Managing the default organisation through settings","source":"@site/docs/features/organisation-default-configuration.md","sourceDirName":"features","slug":"/features/organisation-default-configuration","permalink":"/docs/features/organisation-default-configuration","draft":false,"unlisted":false,"editUrl":"https://github.com/conductionnl/openregister/tree/main/website/docs/features/organisation-default-configuration.md","tags":[],"version":"current","sidebarPosition":9,"frontMatter":{"sidebar_position":9,"title":"Default Organisation Configuration","description":"Managing the default organisation through settings"},"sidebar":"tutorialSidebar","previous":{"title":"Organisation Roles (RBAC)","permalink":"/docs/features/organisation-roles"},"next":{"title":"Text Extraction Sources","permalink":"/docs/features/text-extraction-sources"}}');var a=i(74848),s=i(28453);const r={sidebar_position:9,title:"Default Organisation Configuration",description:"Managing the default organisation through settings"},o="Default Organisation Configuration",l={},d=[{value:"Overview",id:"overview",level:2},{value:"Why Settings Instead of Database Column?",id:"why-settings-instead-of-database-column",level:3},{value:"Configuration",id:"configuration",level:2},{value:"Via UI (Admin Settings)",id:"via-ui-admin-settings",level:3},{value:"Via API",id:"via-api",level:3},{value:"Get Current Default Organisation Setting",id:"get-current-default-organisation-setting",level:4},{value:"Update Default Organisation Setting",id:"update-default-organisation-setting",level:4},{value:"Settings",id:"settings",level:2},{value:"<code>default_organisation</code>",id:"default_organisation",level:3},{value:"<code>auto_create_default_organisation</code>",id:"auto_create_default_organisation",level:3},{value:"How It Works",id:"how-it-works",level:2},{value:"Initialization Flow",id:"initialization-flow",level:3},{value:"Backend Implementation",id:"backend-implementation",level:3},{value:"SettingsService",id:"settingsservice",level:4},{value:"OrganisationService",id:"organisationservice",level:4},{value:"Backward Compatibility",id:"backward-compatibility",level:2},{value:"Legacy Support",id:"legacy-support",level:3},{value:"Database Column",id:"database-column",level:3},{value:"Migration from Legacy",id:"migration-from-legacy",level:2},{value:"Automatic Migration",id:"automatic-migration",level:3},{value:"Manual Migration",id:"manual-migration",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"1. Always Set a Default",id:"1-always-set-a-default",level:3},{value:"2. Validate Before Changing",id:"2-validate-before-changing",level:3},{value:"3. Communicate Changes",id:"3-communicate-changes",level:3},{value:"4. Monitor Default Organisation",id:"4-monitor-default-organisation",level:3},{value:"5. Consider Organization Structure",id:"5-consider-organization-structure",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"No Default Organisation Error",id:"no-default-organisation-error",level:3},{value:"Wrong Organisation as Default",id:"wrong-organisation-as-default",level:3},{value:"Settings Not Persisting",id:"settings-not-persisting",level:3},{value:"Statistics",id:"statistics",level:2},{value:"PHP API",id:"php-api",level:2},{value:"Reading Settings",id:"reading-settings",level:3},{value:"Writing Settings",id:"writing-settings",level:3},{value:"Getting Default Organisation",id:"getting-default-organisation",level:3},{value:"Related Documentation",id:"related-documentation",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"default-organisation-configuration",children:"Default Organisation Configuration"})}),"\n",(0,a.jsxs)(n.p,{children:["OpenRegister uses a ",(0,a.jsx)(n.strong,{children:"settings-based approach"})," for configuring the default organisation, rather than a database column flag. This provides better centralized configuration management and makes it easy to change the default organisation without modifying database records."]}),"\n",(0,a.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,a.jsx)(n.p,{children:"The default organisation is the organisation that new users are automatically added to when they don't have any specific organisation membership. This is essential for ensuring all users have at least one organisation context."}),"\n",(0,a.jsx)(n.h3,{id:"why-settings-instead-of-database-column",children:"Why Settings Instead of Database Column?"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Single Source of Truth"}),": One organisation UUID stored in application settings"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Easy to Change"}),": Admins can change the default organisation through the UI without database modifications"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Centralized Configuration"}),": Managed alongside other application settings"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"No Database Overhead"}),": No need for unique constraints or queries on ",(0,a.jsx)(n.code,{children:"is_default"})," flags"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Better for Multi-Instance"}),": Settings are managed per-instance, not in shared database"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,a.jsx)(n.h3,{id:"via-ui-admin-settings",children:"Via UI (Admin Settings)"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["Navigate to ",(0,a.jsx)(n.strong,{children:"Settings"})," \u2192 ",(0,a.jsx)(n.strong,{children:"OpenRegister"})," \u2192 ",(0,a.jsx)(n.strong,{children:"Organisation Configuration"})]}),"\n",(0,a.jsx)(n.li,{children:"Select the default organisation from the dropdown"}),"\n",(0,a.jsx)(n.li,{children:"Optionally enable/disable auto-creation of default organisation"}),"\n",(0,a.jsxs)(n.li,{children:["Click ",(0,a.jsx)(n.strong,{children:"Save Settings"})]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"via-api",children:"Via API"}),"\n",(0,a.jsx)(n.h4,{id:"get-current-default-organisation-setting",children:"Get Current Default Organisation Setting"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"GET /apps/openregister/api/settings/organisation\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Response:"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'{\n  "organisation": {\n    "default_organisation": "uuid-of-default-org",\n    "auto_create_default_organisation": true\n  }\n}\n'})}),"\n",(0,a.jsx)(n.h4,{id:"update-default-organisation-setting",children:"Update Default Organisation Setting"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'PUT /apps/openregister/api/settings/organisation\nContent-Type: application/json\n\n{\n  "default_organisation": "new-uuid-here",\n  "auto_create_default_organisation": true\n}\n'})}),"\n",(0,a.jsx)(n.h2,{id:"settings",children:"Settings"}),"\n",(0,a.jsx)(n.h3,{id:"default_organisation",children:(0,a.jsx)(n.code,{children:"default_organisation"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Type"}),": ",(0,a.jsx)(n.code,{children:"string"})," (UUID) or ",(0,a.jsx)(n.code,{children:"null"})]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Default"}),": ",(0,a.jsx)(n.code,{children:"null"})]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Description"}),": UUID of the organisation that should be used as default"]}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["When set to ",(0,a.jsx)(n.code,{children:"null"})," and a default organisation is needed:"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["If ",(0,a.jsx)(n.code,{children:"auto_create_default_organisation"})," is ",(0,a.jsx)(n.code,{children:"true"}),", a new default organisation will be created"]}),"\n",(0,a.jsxs)(n.li,{children:["If ",(0,a.jsx)(n.code,{children:"auto_create_default_organisation"})," is ",(0,a.jsx)(n.code,{children:"false"}),", an error will occur"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"auto_create_default_organisation",children:(0,a.jsx)(n.code,{children:"auto_create_default_organisation"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Type"}),": ",(0,a.jsx)(n.code,{children:"boolean"})]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Default"}),": ",(0,a.jsx)(n.code,{children:"true"})]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Description"}),": Whether to automatically create a default organisation if none exists"]}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["When ",(0,a.jsx)(n.code,{children:"true"}),":"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"On app initialization, if no default organisation is configured, one will be created automatically"}),"\n",(0,a.jsx)(n.li,{children:'Named "Default Organisation"'}),"\n",(0,a.jsx)(n.li,{children:"System owner"}),"\n",(0,a.jsx)(n.li,{children:"All admin users are added as members"}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["When ",(0,a.jsx)(n.code,{children:"false"}),":"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Admin must manually select a default organisation in settings"}),"\n",(0,a.jsx)(n.li,{children:"System will not function properly until a default is configured"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"how-it-works",children:"How It Works"}),"\n",(0,a.jsx)(n.h3,{id:"initialization-flow",children:"Initialization Flow"}),"\n",(0,a.jsx)(n.mermaid,{value:"graph TD\n    A[User Requests Data] --\x3e B{Default Org in Settings?}\n    B --\x3e|Yes| C[Load Organisation by UUID]\n    C --\x3e D{Organisation Exists?}\n    D --\x3e|Yes| E[Return Organisation]\n    D --\x3e|No| F[Create New Default Org]\n    F --\x3e G[Save UUID to Settings]\n    G --\x3e E\n    \n    B --\x3e|No| H{Legacy is_default Flag?}\n    H --\x3e|Yes| I[Load Legacy Default]\n    I --\x3e J[Migrate to Settings]\n    J --\x3e E\n    \n    H --\x3e|No| K{Auto-Create Enabled?}\n    K --\x3e|Yes| F\n    K --\x3e|No| L[Error: No Default Org]"}),"\n",(0,a.jsx)(n.h3,{id:"backend-implementation",children:"Backend Implementation"}),"\n",(0,a.jsx)(n.h4,{id:"settingsservice",children:"SettingsService"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"// Get default organisation UUID\n$uuid = $settingsService->getDefaultOrganisationUuid();\n\n// Set default organisation UUID\n$settingsService->setDefaultOrganisationUuid($organisationUuid);\n"})}),"\n",(0,a.jsx)(n.h4,{id:"organisationservice",children:"OrganisationService"}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.code,{children:"OrganisationService"})," checks for the default organisation in this order:"]}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Settings UUID"}),": Loads UUID from ",(0,a.jsx)(n.code,{children:"organisation.default_organisation"})," setting"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Legacy Database Flag"}),": Falls back to ",(0,a.jsx)(n.code,{children:"is_default = true"})," column (for backward compatibility)"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Auto-Create"}),": Creates new default if auto-create is enabled"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Error"}),": Throws exception if no default found and auto-create is disabled"]}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"private function fetchDefaultOrganisationFromDatabase(): Organisation\n{\n    // 1. Try settings UUID first\n    $defaultOrgUuid = $this->settingsService->getDefaultOrganisationUuid();\n    \n    if ($defaultOrgUuid !== null) {\n        try {\n            return $this->organisationMapper->findByUuid($defaultOrgUuid);\n        } catch (DoesNotExistException $e) {\n            // UUID doesn't exist, create new\n            $org = $this->organisationMapper->createDefault();\n            $this->settingsService->setDefaultOrganisationUuid($org->getUuid());\n            return $org;\n        }\n    }\n    \n    // 2. Fall back to legacy is_default flag\n    try {\n        $org = $this->organisationMapper->findDefault();\n        // Migrate to settings\n        $this->settingsService->setDefaultOrganisationUuid($org->getUuid());\n        return $org;\n    } catch (DoesNotExistException $e) {\n        // 3. Create new if auto-create enabled\n        $org = $this->organisationMapper->createDefault();\n        $this->settingsService->setDefaultOrganisationUuid($org->getUuid());\n        return $org;\n    }\n}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"backward-compatibility",children:"Backward Compatibility"}),"\n",(0,a.jsxs)(n.p,{children:["The system maintains backward compatibility with the legacy ",(0,a.jsx)(n.code,{children:"is_default"})," database column:"]}),"\n",(0,a.jsx)(n.h3,{id:"legacy-support",children:"Legacy Support"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Existing installations with ",(0,a.jsx)(n.code,{children:"is_default = 1"})," flag will continue to work"]}),"\n",(0,a.jsxs)(n.li,{children:["On first access, the system will:","\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["Detect organisation with ",(0,a.jsx)(n.code,{children:"is_default = 1"})]}),"\n",(0,a.jsx)(n.li,{children:"Read its UUID"}),"\n",(0,a.jsx)(n.li,{children:"Store UUID in settings"}),"\n",(0,a.jsx)(n.li,{children:"Use settings for all future operations"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"database-column",children:"Database Column"}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.code,{children:"is_default"})," column remains in the database but is ",(0,a.jsx)(n.strong,{children:"no longer the primary source of truth"}),":"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"It's still checked as a fallback for legacy installations"}),"\n",(0,a.jsx)(n.li,{children:"New installations ignore it"}),"\n",(0,a.jsx)(n.li,{children:"Can be safely removed in a future major version"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"migration-from-legacy",children:"Migration from Legacy"}),"\n",(0,a.jsx)(n.h3,{id:"automatic-migration",children:"Automatic Migration"}),"\n",(0,a.jsxs)(n.p,{children:["For existing installations using the ",(0,a.jsx)(n.code,{children:"is_default"})," flag, migration happens automatically on first access:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"// OrganisationService detects legacy setup\n$org = $this->organisationMapper->findDefault(); // Uses is_default = 1\n\n// Migrates to settings\n$this->settingsService->setDefaultOrganisationUuid($org->getUuid());\n\n// Future requests use settings, not database flag\n"})}),"\n",(0,a.jsx)(n.h3,{id:"manual-migration",children:"Manual Migration"}),"\n",(0,a.jsx)(n.p,{children:"If you need to manually migrate:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'# Get current default organisation\nphp occ config:app:get openregister organisation\n\n# If empty, find organisation with is_default = 1\nmysql -u nextcloud -p -e "SELECT uuid FROM oc_openregister_organisations WHERE is_default = 1"\n\n# Set in settings\nphp occ config:app:set openregister organisation --value=\'{"default_organisation":"<uuid>","auto_create_default_organisation":true}\'\n'})}),"\n",(0,a.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,a.jsx)(n.h3,{id:"1-always-set-a-default",children:"1. Always Set a Default"}),"\n",(0,a.jsx)(n.p,{children:"Ensure a default organisation is always configured:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"$defaultUuid = $settingsService->getDefaultOrganisationUuid();\nif ($defaultUuid === null) {\n    // Create and set default\n    $org = $organisationService->ensureDefaultOrganisation();\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"2-validate-before-changing",children:"2. Validate Before Changing"}),"\n",(0,a.jsx)(n.p,{children:"Before changing the default organisation, validate:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"The organisation exists"}),"\n",(0,a.jsx)(n.li,{children:"The organisation is active"}),"\n",(0,a.jsx)(n.li,{children:"The organisation has at least one admin user"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"3-communicate-changes",children:"3. Communicate Changes"}),"\n",(0,a.jsx)(n.p,{children:"When changing the default organisation:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Notify users who will be affected"}),"\n",(0,a.jsx)(n.li,{children:"Ensure new default has appropriate resources"}),"\n",(0,a.jsx)(n.li,{children:"Update documentation if using specific default"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"4-monitor-default-organisation",children:"4. Monitor Default Organisation"}),"\n",(0,a.jsx)(n.p,{children:"Track metrics:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Number of users in default organisation"}),"\n",(0,a.jsx)(n.li,{children:"Creation rate of new users"}),"\n",(0,a.jsx)(n.li,{children:"Resources consumed by default organisation"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"5-consider-organization-structure",children:"5. Consider Organization Structure"}),"\n",(0,a.jsx)(n.p,{children:"Choose your default organisation based on your needs:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Small Teams"}),": Single default for all users"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Departments"}),": Different defaults per department (requires custom logic)"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Multi-Tenant"}),": Separate defaults per tenant"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,a.jsx)(n.h3,{id:"no-default-organisation-error",children:"No Default Organisation Error"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Symptoms"}),': "No default organisation found" error']}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Solutions"}),":"]}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"Check settings:"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"php occ config:app:get openregister organisation\n"})}),"\n",(0,a.jsxs)(n.ol,{start:"2",children:["\n",(0,a.jsx)(n.li,{children:"Verify organisation exists:"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"SELECT * FROM oc_openregister_organisations WHERE uuid = '<uuid-from-settings>';\n"})}),"\n",(0,a.jsxs)(n.ol,{start:"3",children:["\n",(0,a.jsx)(n.li,{children:"Enable auto-create:"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"php occ config:app:set openregister organisation --value='{\"auto_create_default_organisation\":true}'\n"})}),"\n",(0,a.jsx)(n.h3,{id:"wrong-organisation-as-default",children:"Wrong Organisation as Default"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Symptoms"}),": Users added to unexpected organisation"]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Solutions"}),":"]}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"Check current default:"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"php occ config:app:get openregister organisation\n"})}),"\n",(0,a.jsxs)(n.ol,{start:"2",children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"Update via UI (Settings \u2192 OpenRegister \u2192 Organisation Configuration)"}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"Or update via command:"}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'php occ config:app:set openregister organisation --value=\'{"default_organisation":"<correct-uuid>"}\'\n'})}),"\n",(0,a.jsx)(n.h3,{id:"settings-not-persisting",children:"Settings Not Persisting"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Symptoms"}),": Default organisation setting resets after save"]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Solutions"}),":"]}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"Check file permissions on Nextcloud config directory"}),"\n",(0,a.jsx)(n.li,{children:"Verify database connection"}),"\n",(0,a.jsx)(n.li,{children:"Check logs for errors:"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"docker logs -f <nextcloud-container> | grep 'Organisation'\n"})}),"\n",(0,a.jsx)(n.h2,{id:"statistics",children:"Statistics"}),"\n",(0,a.jsx)(n.p,{children:"The Organisation Configuration settings page displays:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Total Organisations"}),": Count of all organisations"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Active Organisations"}),": Count of active organisations (",(0,a.jsx)(n.code,{children:"active = 1"}),")"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Total Members"}),": Sum of all users across all organisations"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Avg Members/Org"}),": Average number of members per organisation"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"php-api",children:"PHP API"}),"\n",(0,a.jsx)(n.h3,{id:"reading-settings",children:"Reading Settings"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"use OCA\\OpenRegister\\Service\\SettingsService;\n\n// Get default UUID\n$uuid = $settingsService->getDefaultOrganisationUuid();\n\n// Get all organisation settings\n$settings = $settingsService->getOrganisationSettingsOnly();\n// Returns:\n// [\n//   'organisation' => [\n//     'default_organisation' => '...',\n//     'auto_create_default_organisation' => true\n//   ]\n// ]\n"})}),"\n",(0,a.jsx)(n.h3,{id:"writing-settings",children:"Writing Settings"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"// Set default UUID\n$settingsService->setDefaultOrganisationUuid($newUuid);\n\n// Update all settings\n$settingsService->updateOrganisationSettingsOnly([\n    'default_organisation' => $newUuid,\n    'auto_create_default_organisation' => false\n]);\n"})}),"\n",(0,a.jsx)(n.h3,{id:"getting-default-organisation",children:"Getting Default Organisation"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"use OCA\\OpenRegister\\Service\\OrganisationService;\n\n// Always returns a valid organisation (creates if needed)\n$defaultOrg = $organisationService->ensureDefaultOrganisation();\n"})}),"\n",(0,a.jsx)(n.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"/docs/Features/organisations",children:"Organisation Management"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"/docs/features/organisation-roles",children:"Organisation Roles (RBAC)"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"/docs/user/settings-configuration",children:"Settings Configuration"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"/docs/development/rbac",children:"RBAC (Role-Based Access Control)"})}),"\n"]})]})}function g(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}}}]);