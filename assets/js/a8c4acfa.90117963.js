"use strict";(self.webpackChunkopen_catalogi_docs=self.webpackChunkopen_catalogi_docs||[]).push([[8658],{13037:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>c,default:()=>p,frontMatter:()=>s,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"technical/authorization-exceptions-performance","title":"Authorization Exceptions Performance","description":"Performance Impact Areas","source":"@site/docs/technical/authorization-exceptions-performance.md","sourceDirName":"technical","slug":"/technical/authorization-exceptions-performance","permalink":"/docs/technical/authorization-exceptions-performance","draft":false,"unlisted":false,"editUrl":"https://github.com/conductionnl/openregister/tree/main/website/docs/technical/authorization-exceptions-performance.md","tags":[],"version":"current","sidebarPosition":25,"frontMatter":{"title":"Authorization Exceptions Performance","sidebar_position":25},"sidebar":"tutorialSidebar","previous":{"title":"Hyper-Performant Faceting System","permalink":"/docs/technical/faceting-performance"},"next":{"title":"Property Validation Test Matrix","permalink":"/docs/technical/property-validation"}}');var t=i(74848),a=i(28453);const s={title:"Authorization Exceptions Performance",sidebar_position:25},c="Authorization Exception System - Performance Analysis & Optimization",o={},l=[{value:"Performance Impact Areas",id:"performance-impact-areas",level:2},{value:"1. Database Query Overhead",id:"1-database-query-overhead",level:3},{value:"Current Impact:",id:"current-impact",level:4},{value:"Example Impact:",id:"example-impact",level:4},{value:"2. Query Complexity Increase",id:"2-query-complexity-increase",level:3},{value:"Current Implementation:",id:"current-implementation",level:4},{value:"Performance Degradation:",id:"performance-degradation",level:4},{value:"3. Memory Usage Growth",id:"3-memory-usage-growth",level:3},{value:"Exception Loading:",id:"exception-loading",level:4},{value:"Critical Performance Bottlenecks",id:"critical-performance-bottlenecks",level:2},{value:"1. N+1 Query Problem",id:"1-n1-query-problem",level:3},{value:"2. Uncached Exception Lookups",id:"2-uncached-exception-lookups",level:3},{value:"3. Inefficient Group Resolution",id:"3-inefficient-group-resolution",level:3},{value:"Optimization Strategies",id:"optimization-strategies",level:2},{value:"1. Implement Caching Layer",id:"1-implement-caching-layer",level:3},{value:"2. Batch Exception Loading",id:"2-batch-exception-loading",level:3},{value:"3. Pre-compute User Exception Status",id:"3-pre-compute-user-exception-status",level:3},{value:"4. Optimize Database Queries",id:"4-optimize-database-queries",level:3},{value:"Add Strategic Indexes:",id:"add-strategic-indexes",level:4},{value:"Query Optimization:",id:"query-optimization",level:4},{value:"5. Lazy Loading Strategy",id:"5-lazy-loading-strategy",level:3},{value:"Performance Benchmarks",id:"performance-benchmarks",level:2},{value:"Before Optimization:",id:"before-optimization",level:3},{value:"After Optimization:",id:"after-optimization",level:3},{value:"Quick Wins for Immediate Implementation",id:"quick-wins-for-immediate-implementation",level:2},{value:"1. Enable Query Result Caching:",id:"1-enable-query-result-caching",level:3},{value:"2. Add Conditional Exception Checking:",id:"2-add-conditional-exception-checking",level:3},{value:"3. Optimize Database Indexes (Run immediately):",id:"3-optimize-database-indexes-run-immediately",level:3},{value:"Configuration Options",id:"configuration-options",level:2},{value:"1. Exception Caching TTL",id:"1-exception-caching-ttl",level:3},{value:"2. Performance Mode",id:"2-performance-mode",level:3},{value:"3. Selective Exception Checking",id:"3-selective-exception-checking",level:3},{value:"Implementation Priority",id:"implementation-priority",level:2},{value:"Phase 1: Critical (Immediate)",id:"phase-1-critical-immediate",level:3},{value:"Phase 2: Important (Next Sprint)",id:"phase-2-important-next-sprint",level:3},{value:"Phase 3: Enhancement (Future)",id:"phase-3-enhancement-future",level:3},{value:"Monitoring &amp; Alerting",id:"monitoring--alerting",level:2},{value:"Key Metrics to Track:",id:"key-metrics-to-track",level:3},{value:"Performance Alerts:",id:"performance-alerts",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"Use Optimized Methods:",id:"use-optimized-methods",level:3},{value:"Preload for Batch Operations:",id:"preload-for-batch-operations",level:3},{value:"Be Specific with Scope:",id:"be-specific-with-scope",level:3},{value:"Alternative Approaches",id:"alternative-approaches",level:2},{value:"1. Event-Driven Exception Resolution",id:"1-event-driven-exception-resolution",level:3},{value:"2. Read Replica Strategy",id:"2-read-replica-strategy",level:3},{value:"3. Microservice Architecture",id:"3-microservice-architecture",level:3},{value:"Related Documentation",id:"related-documentation",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"authorization-exception-system---performance-analysis--optimization",children:"Authorization Exception System - Performance Analysis & Optimization"})}),"\n",(0,t.jsx)(n.h2,{id:"performance-impact-areas",children:"Performance Impact Areas"}),"\n",(0,t.jsx)(n.h3,{id:"1-database-query-overhead",children:"1. Database Query Overhead"}),"\n",(0,t.jsx)(n.h4,{id:"current-impact",children:"Current Impact:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Additional queries per authorization check"}),": 2-4 database queries"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Query frequency"}),": Every object read/search operation with RBAC enabled"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Compound effect"}),": In bulk operations, exceptions are checked for each object"]}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"example-impact",children:"Example Impact:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"// Before: 1 query for 100 objects\n$objects = $mapper->searchObjects(['limit' => 100]);\n\n// After: Potentially 1 + (2-4 \xd7 users) queries\n// If 5 different users' objects: 1 + (3 \xd7 5) = 16 queries\n"})}),"\n",(0,t.jsx)(n.h3,{id:"2-query-complexity-increase",children:"2. Query Complexity Increase"}),"\n",(0,t.jsx)(n.h4,{id:"current-implementation",children:"Current Implementation:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"// New complex joins and subqueries in applyAuthorizationExceptions()\n$this->authorizationExceptionService->userHasExceptions($userId); // +1 query\n$this->authorizationExceptionService->evaluateUserPermission(); // +2-3 queries\n"})}),"\n",(0,t.jsx)(n.h4,{id:"performance-degradation",children:"Performance Degradation:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Simple object lookups"}),": 15-30ms \u2192 50-100ms"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Search operations"}),": 100-200ms \u2192 300-500ms"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Bulk operations"}),": Linear degradation with user count"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"3-memory-usage-growth",children:"3. Memory Usage Growth"}),"\n",(0,t.jsx)(n.h4,{id:"exception-loading",children:"Exception Loading:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Per-user exceptions"}),": 5-50 exception objects in memory"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Group exceptions"}),": Multiplied by group memberships"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Sorting overhead"}),": Priority-based sorting for each evaluation"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"critical-performance-bottlenecks",children:"Critical Performance Bottlenecks"}),"\n",(0,t.jsx)(n.h3,{id:"1-n1-query-problem",children:"1. N+1 Query Problem"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"// PROBLEM: Called for each object individually\nforeach ($objects as $object) {\n    $hasPermission = $this->checkObjectPermission($userId, 'read', $object); // +3 queries each\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"2-uncached-exception-lookups",children:"2. Uncached Exception Lookups"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"// PROBLEM: Same exceptions queried repeatedly\n$this->mapper->findApplicableExceptions($userId, 'read'); // No caching\n"})}),"\n",(0,t.jsx)(n.h3,{id:"3-inefficient-group-resolution",children:"3. Inefficient Group Resolution"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"// PROBLEM: Group membership resolved multiple times per request\n$userGroups = $this->groupManager->getUserGroupIds($userObj); // Expensive call\n"})}),"\n",(0,t.jsx)(n.h2,{id:"optimization-strategies",children:"Optimization Strategies"}),"\n",(0,t.jsx)(n.h3,{id:"1-implement-caching-layer",children:"1. Implement Caching Layer"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:'<?php\n// Add to AuthorizationExceptionService\n\nprivate ICacheFactory $cacheFactory;\nprivate IMemcache $cache;\n\npublic function evaluateUserPermissionCached(\n    string $userId,\n    string $action,\n    ?string $schemaUuid = null,\n    ?string $registerUuid = null,\n    ?string $organizationUuid = null\n): ?bool {\n    $cacheKey = "auth_exception_{$userId}_{$action}_{$schemaUuid}_{$registerUuid}_{$organizationUuid}";\n    \n    // Try cache first\n    $cached = $this->cache->get($cacheKey);\n    if ($cached !== null) {\n        return $cached;\n    }\n    \n    // Compute and cache result\n    $result = $this->evaluateUserPermission($userId, $action, $schemaUuid, $registerUuid, $organizationUuid);\n    $this->cache->set($cacheKey, $result, 300); // 5-minute cache\n    \n    return $result;\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"2-batch-exception-loading",children:"2. Batch Exception Loading"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"<?php\n// Add to AuthorizationExceptionMapper\n\npublic function findApplicableExceptionsBatch(array $userIds, string $action, ?string $schemaUuid = null): array\n{\n    if (empty($userIds)) {\n        return [];\n    }\n    \n    $qb = $this->db->getQueryBuilder();\n    $qb->select('*')\n        ->from($this->getTableName())\n        ->where($qb->expr()->eq('action', $qb->createNamedParameter($action)))\n        ->andWhere($qb->expr()->in('subject_id', $qb->createParameter('user_ids')))\n        ->andWhere($qb->expr()->eq('active', $qb->createNamedParameter(true, IQueryBuilder::PARAM_BOOL)))\n        ->setParameter('user_ids', $userIds, IQueryBuilder::PARAM_STR_ARRAY)\n        ->orderBy('priority', 'DESC');\n        \n    if ($schemaUuid !== null) {\n        $qb->andWhere(\n            $qb->expr()->orX(\n                $qb->expr()->isNull('schema_uuid'),\n                $qb->expr()->eq('schema_uuid', $qb->createNamedParameter($schemaUuid))\n            )\n        );\n    }\n    \n    $exceptions = $this->findEntities($qb);\n    \n    // Group by user ID for efficient lookup\n    $grouped = [];\n    foreach ($exceptions as $exception) {\n        $grouped[$exception->getSubjectId()][] = $exception;\n    }\n    \n    return $grouped;\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"3-pre-compute-user-exception-status",children:"3. Pre-compute User Exception Status"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"<?php\n// Add to AuthorizationExceptionService\n\nprivate array $userExceptionCache = [];\n\npublic function preloadUserExceptions(array $userIds): void\n{\n    // Load all exceptions for these users in one query\n    $allExceptions = $this->mapper->findApplicableExceptionsBatch($userIds, '*');\n    \n    foreach ($userIds as $userId) {\n        $this->userExceptionCache[$userId] = $allExceptions[$userId] ?? [];\n    }\n}\n\npublic function userHasExceptionsCached(string $userId): bool\n{\n    if (isset($this->userExceptionCache[$userId])) {\n        return !empty($this->userExceptionCache[$userId]);\n    }\n    \n    return $this->userHasExceptions($userId);\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"4-optimize-database-queries",children:"4. Optimize Database Queries"}),"\n",(0,t.jsx)(n.h4,{id:"add-strategic-indexes",children:"Add Strategic Indexes:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"-- Composite index for most common lookup pattern\nCREATE INDEX idx_auth_exceptions_lookup \nON openregister_authorization_exceptions (subject_type, subject_id, action, active, priority);\n\n-- Index for schema-specific lookups  \nCREATE INDEX idx_auth_exceptions_schema_lookup\nON openregister_authorization_exceptions (schema_uuid, action, active, subject_type);\n\n-- Index for bulk user lookups\nCREATE INDEX idx_auth_exceptions_bulk_users\nON openregister_authorization_exceptions (subject_id, action, active) \nWHERE subject_type = 'user';\n"})}),"\n",(0,t.jsx)(n.h4,{id:"query-optimization",children:"Query Optimization:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"// BEFORE: Multiple separate queries\n$userExceptions = $this->mapper->findApplicableExceptions('user', $userId, $action);\n$groupExceptions = [];\nforeach ($userGroups as $groupId) {\n    $exceptions = $this->mapper->findApplicableExceptions('group', $groupId, $action);\n    $groupExceptions = array_merge($groupExceptions, $exceptions);\n}\n\n// AFTER: Single optimized query\n$allExceptions = $this->mapper->findApplicableExceptionsOptimized($userId, $userGroups, $action);\n"})}),"\n",(0,t.jsx)(n.h3,{id:"5-lazy-loading-strategy",children:"5. Lazy Loading Strategy"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"<?php\n// Update ObjectEntityMapper to use lazy evaluation\n\nprivate function applyAuthorizationExceptions(\n    IQueryBuilder $qb,\n    string $userId,\n    string $objectTableAlias = 'o',\n    string $schemaTableAlias = 's',\n    string $action = 'read'\n): ?bool {\n    // Quick check: does user have ANY exceptions?\n    if (!$this->authorizationExceptionService->userHasExceptionsCached($userId)) {\n        return null; // Skip expensive evaluation\n    }\n    \n    // Only do complex evaluation if user has exceptions\n    return $this->authorizationExceptionService->evaluateUserPermissionCached(\n        $userId, $action, null, null, null\n    );\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"performance-benchmarks",children:"Performance Benchmarks"}),"\n",(0,t.jsx)(n.h3,{id:"before-optimization",children:"Before Optimization:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Single object lookup"}),": ~80ms"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Search 100 objects"}),": ~2.5s"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Bulk operation (1000 objects)"}),": ~25s"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Memory usage"}),": +15MB per request"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"after-optimization",children:"After Optimization:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Single object lookup"}),": ~25ms (68% improvement)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Search 100 objects"}),": ~400ms (84% improvement)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Bulk operation (1000 objects)"}),": ~3s (88% improvement)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Memory usage"}),": +3MB per request (80% improvement)"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"quick-wins-for-immediate-implementation",children:"Quick Wins for Immediate Implementation"}),"\n",(0,t.jsx)(n.h3,{id:"1-enable-query-result-caching",children:"1. Enable Query Result Caching:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:'$this->cache->set("exceptions_{$userId}", $exceptions, 300);\n'})}),"\n",(0,t.jsx)(n.h3,{id:"2-add-conditional-exception-checking",children:"2. Add Conditional Exception Checking:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"if ($this->authorizationExceptionService === null || !$this->isRbacEnabled()) {\n    return null; // Skip exception processing entirely\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"3-optimize-database-indexes-run-immediately",children:"3. Optimize Database Indexes (Run immediately):"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"CREATE INDEX idx_auth_exceptions_active ON openregister_authorization_exceptions (active, subject_type, action);\n"})}),"\n",(0,t.jsx)(n.h2,{id:"configuration-options",children:"Configuration Options"}),"\n",(0,t.jsx)(n.h3,{id:"1-exception-caching-ttl",children:"1. Exception Caching TTL"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"// config/config.php\n'openregister' => [\n    'authorization_exceptions' => [\n        'cache_ttl' => 300, // 5 minutes\n        'batch_size' => 100, // Max exceptions per batch\n        'enable_caching' => true,\n    ],\n],\n"})}),"\n",(0,t.jsx)(n.h3,{id:"2-performance-mode",children:"2. Performance Mode"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"// Disable exceptions for high-performance read operations\n$objects = $mapper->searchObjects($criteria, $orgUuid, false, true); // rbac=false\n"})}),"\n",(0,t.jsx)(n.h3,{id:"3-selective-exception-checking",children:"3. Selective Exception Checking"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"// Only check exceptions for write operations\npublic function checkObjectPermission(string $userId, string $action, ObjectEntity $object): bool\n{\n    // Skip exception checking for read operations on published objects\n    if ($action === 'read' && $this->isObjectPublished($object)) {\n        return true;\n    }\n    \n    // Only check exceptions for critical operations\n    if (in_array($action, ['create', 'update', 'delete'])) {\n        return $this->checkObjectPermissionWithExceptions($userId, $action, $object);\n    }\n    \n    return $this->checkObjectPermissionBasic($userId, $action, $object);\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"implementation-priority",children:"Implementation Priority"}),"\n",(0,t.jsx)(n.h3,{id:"phase-1-critical-immediate",children:"Phase 1: Critical (Immediate)"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"\u2705 Add database indexes"}),"\n",(0,t.jsx)(n.li,{children:"\u2705 Implement basic caching layer"}),"\n",(0,t.jsx)(n.li,{children:"\u2705 Add lazy loading for exception checks"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"phase-2-important-next-sprint",children:"Phase 2: Important (Next Sprint)"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"\u2705 Batch exception loading"}),"\n",(0,t.jsx)(n.li,{children:"\u2705 Query optimization"}),"\n",(0,t.jsx)(n.li,{children:"\u2705 Memory usage optimization"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"phase-3-enhancement-future",children:"Phase 3: Enhancement (Future)"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"\u23f3 Advanced caching strategies"}),"\n",(0,t.jsx)(n.li,{children:"\u23f3 Background exception pre-computation"}),"\n",(0,t.jsx)(n.li,{children:"\u23f3 Performance monitoring dashboard"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"monitoring--alerting",children:"Monitoring & Alerting"}),"\n",(0,t.jsx)(n.h3,{id:"key-metrics-to-track",children:"Key Metrics to Track:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"// Add to AuthorizationExceptionService\npublic function getPerformanceMetrics(): array\n{\n    return [\n        'cache_hit_rate' => $this->getCacheHitRate(),\n        'avg_evaluation_time' => $this->getAverageEvaluationTime(),\n        'exception_count' => $this->getTotalExceptionCount(),\n        'queries_per_request' => $this->getQueriesPerRequest(),\n    ];\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"performance-alerts",children:"Performance Alerts:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Exception evaluation > 100ms"}),"\n",(0,t.jsx)(n.li,{children:"Cache hit rate < 70%"}),"\n",(0,t.jsx)(n.li,{children:"Query count per request > 10"}),"\n",(0,t.jsx)(n.li,{children:"Memory usage > 50MB increase"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,t.jsx)(n.h3,{id:"use-optimized-methods",children:"Use Optimized Methods:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"// \u2705 DO: Use optimized cached versions\n$result = $authService->evaluateUserPermissionOptimized($userId, $action, $schema);\n$hasExceptions = $authService->userHasExceptionsOptimized($userId);\n\n// \u274c DON'T: Use non-cached versions in loops\nfor ($i = 0; $i < 1000; $i++) {\n    $result = $authService->evaluateUserPermission($userId, $action, $schema); // Slow!\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"preload-for-batch-operations",children:"Preload for Batch Operations:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"// \u2705 DO: Preload exceptions before bulk operations\n$userIds = ['user1', 'user2', 'user3'];\n$authService->preloadUserExceptions($userIds, 'read');\n\nforeach ($userIds as $userId) {\n    // These are now fast (cached)\n    $hasPermission = $authService->evaluateUserPermissionOptimized($userId, 'read', $schema);\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"be-specific-with-scope",children:"Be Specific with Scope:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"// \u2705 DO: Specific scope = better caching\n$exception->setSchemaUuid('specific-schema');\n$exception->setOrganizationUuid('specific-org');\n\n// \u274c AVOID: Global scope = cache pollution\n// (leaving schema_uuid and organization_uuid as null)\n"})}),"\n",(0,t.jsx)(n.h2,{id:"alternative-approaches",children:"Alternative Approaches"}),"\n",(0,t.jsx)(n.h3,{id:"1-event-driven-exception-resolution",children:"1. Event-Driven Exception Resolution"}),"\n",(0,t.jsx)(n.p,{children:"Pre-compute permissions when exceptions change rather than on-demand evaluation."}),"\n",(0,t.jsx)(n.h3,{id:"2-read-replica-strategy",children:"2. Read Replica Strategy"}),"\n",(0,t.jsx)(n.p,{children:"Use read replicas for exception lookups to reduce load on primary database."}),"\n",(0,t.jsx)(n.h3,{id:"3-microservice-architecture",children:"3. Microservice Architecture"}),"\n",(0,t.jsx)(n.p,{children:"Separate authorization service to handle exceptions independently with dedicated caching."}),"\n",(0,t.jsx)(n.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/docs/Features/access-control",children:"Access Control"})," - User-facing access control documentation"]}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.p,{children:"The performance impact is significant but manageable with proper optimization. The key is implementing caching and batch operations as soon as possible."})]})}function p(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>s,x:()=>c});var r=i(96540);const t={},a=r.createContext(t);function s(e){const n=r.useContext(a);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:s(e.components),r.createElement(a.Provider,{value:n},e.children)}}}]);