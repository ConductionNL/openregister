"use strict";(self.webpackChunkopen_catalogi_docs=self.webpackChunkopen_catalogi_docs||[]).push([[1942],{28453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>l});var i=t(96540);const r={},s=i.createContext(r);function o(e){const n=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),i.createElement(s.Provider,{value:n},e.children)}},46492:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>p,frontMatter:()=>o,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"development/tool-registration","title":"Tool Registration for OpenRegister Agents","description":"Comprehensive guide for developers to create and register custom tools for OpenRegister agents","source":"@site/docs/development/tool-registration.md","sourceDirName":"development","slug":"/development/tool-registration","permalink":"/docs/development/tool-registration","draft":false,"unlisted":false,"editUrl":"https://github.com/conductionnl/openregister/tree/main/website/docs/development/tool-registration.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5,"sidebar_label":"Tool Registration","title":"Tool Registration for OpenRegister Agents","description":"Comprehensive guide for developers to create and register custom tools for OpenRegister agents","keywords":["agents","tools","function calling","LLM","development"]},"sidebar":"tutorialSidebar","previous":{"title":"External App Cache Optimization","permalink":"/docs/development/external-app-optimization"},"next":{"title":"Tool Testing Guide","permalink":"/docs/development/tool-registration-testing"}}');var r=t(74848),s=t(28453);const o={sidebar_position:5,sidebar_label:"Tool Registration",title:"Tool Registration for OpenRegister Agents",description:"Comprehensive guide for developers to create and register custom tools for OpenRegister agents",keywords:["agents","tools","function calling","LLM","development"]},l="Tool Registration for OpenRegister Agents",a={},c=[{value:"Overview",id:"overview",level:2},{value:"Key Concepts",id:"key-concepts",level:3},{value:"Architecture",id:"architecture",level:2},{value:"Creating a Tool",id:"creating-a-tool",level:2},{value:"Step 1: Implement the ToolInterface",id:"step-1-implement-the-toolinterface",level:3},{value:"Step 2: Register the Tool",id:"step-2-register-the-tool",level:3},{value:"Step 3: Create a Tool Registration Listener",id:"step-3-create-a-tool-registration-listener",level:3},{value:"Tool Metadata",id:"tool-metadata",level:2},{value:"Why This Architecture?",id:"why-this-architecture",level:3},{value:"Tool ID Format",id:"tool-id-format",level:3},{value:"Available Icons",id:"available-icons",level:3},{value:"Function Definition Schema",id:"function-definition-schema",level:2},{value:"Best Practices",id:"best-practices",level:2},{value:"1. Security &amp; Permissions",id:"1-security--permissions",level:3},{value:"2. Error Handling",id:"2-error-handling",level:3},{value:"3. Clear Function Descriptions",id:"3-clear-function-descriptions",level:3},{value:"4. Input Validation",id:"4-input-validation",level:3},{value:"5. Logging",id:"5-logging",level:3},{value:"Testing Your Tool",id:"testing-your-tool",level:2},{value:"Unit Tests",id:"unit-tests",level:3},{value:"Manual Testing",id:"manual-testing",level:3},{value:"Example: CMS Tool for OpenCatalogi",id:"example-cms-tool-for-opencatalogi",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Tool Not Appearing in Agent Editor",id:"tool-not-appearing-in-agent-editor",level:3},{value:"Function Calls Failing",id:"function-calls-failing",level:3},{value:"LLM Not Using Your Tool",id:"llm-not-using-your-tool",level:3},{value:"API Reference",id:"api-reference",level:2},{value:"ToolInterface",id:"toolinterface",level:3},{value:"ToolRegistrationEvent",id:"toolregistrationevent",level:3},{value:"ToolRegistry",id:"toolregistry",level:3},{value:"Implementation Summary",id:"implementation-summary",level:2},{value:"Architecture Overview",id:"architecture-overview",level:3},{value:"Key Components",id:"key-components",level:3},{value:"Built-in Tools",id:"built-in-tools",level:3},{value:"UI Improvements",id:"ui-improvements",level:3},{value:"Security Features",id:"security-features",level:3},{value:"Benefits",id:"benefits",level:3},{value:"Further Reading",id:"further-reading",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"tool-registration-for-openregister-agents",children:"Tool Registration for OpenRegister Agents"})}),"\n",(0,r.jsx)(n.p,{children:"This guide explains how to create and register custom tools for OpenRegister agents. Tools enable AI agents to perform actions through function calling, allowing them to interact with your app's data and functionality."}),"\n",(0,r.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsx)(n.p,{children:"OpenRegister provides a plugin architecture for tools that allows any Nextcloud app to register custom functions that agents can use. Tools are automatically discovered and made available to all agents through a central registry."}),"\n",(0,r.jsx)(n.h3,{id:"key-concepts",children:"Key Concepts"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Tool"}),": A collection of related functions that an agent can call"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"ToolRegistry"}),": Central service that manages all available tools"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"ToolRegistrationEvent"}),": Event dispatched when tools are being collected"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"ToolInterface"}),": Contract that all tools must implement"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"architecture",children:"Architecture"}),"\n",(0,r.jsx)(n.mermaid,{value:"graph TD\n    A[Your App] --\x3e B[ToolRegistrationEvent]\n    B --\x3e C[ToolRegistry]\n    C --\x3e D[Agent Chat Service]\n    D --\x3e E[LLM with Function Calling]\n    E --\x3e F[Your Tool Functions]\n    F --\x3e G[Your App Services]"}),"\n",(0,r.jsx)(n.h2,{id:"creating-a-tool",children:"Creating a Tool"}),"\n",(0,r.jsx)(n.h3,{id:"step-1-implement-the-toolinterface",children:"Step 1: Implement the ToolInterface"}),"\n",(0,r.jsxs)(n.p,{children:["Create a new tool class in your app that implements the ",(0,r.jsx)(n.code,{children:"OCA\\OpenRegister\\Tool\\ToolInterface"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"<?php\n\ndeclare(strict_types=1);\n\nnamespace OCA\\MyApp\\Tool;\n\nuse OCA\\OpenRegister\\Tool\\ToolInterface;\nuse OCA\\OpenRegister\\Db\\Agent;\nuse OCA\\MyApp\\Service\\MyService;\nuse Psr\\Log\\LoggerInterface;\n\nclass MyCustomTool implements ToolInterface\n{\n    private ?Agent $agent = null;\n    \n    public function __construct(\n        private MyService $myService,\n        private LoggerInterface $logger\n    ) {\n    }\n    \n    public function getName(): string\n    {\n        return 'My Custom Tool';\n    }\n    \n    public function getDescription(): string\n    {\n        return 'Allows agents to interact with MyApp data';\n    }\n    \n    public function setAgent(Agent $agent): void\n    {\n        $this->agent = $agent;\n    }\n    \n    public function getFunctions(): array\n    {\n        return [\n            [\n                'name' => 'myapp_create_item',\n                'description' => 'Create a new item in MyApp',\n                'parameters' => [\n                    'type' => 'object',\n                    'properties' => [\n                        'name' => [\n                            'type' => 'string',\n                            'description' => 'Name of the item to create'\n                        ],\n                        'description' => [\n                            'type' => 'string',\n                            'description' => 'Optional description'\n                        ]\n                    ],\n                    'required' => ['name']\n                ]\n            ],\n            [\n                'name' => 'myapp_list_items',\n                'description' => 'List all items in MyApp',\n                'parameters' => [\n                    'type' => 'object',\n                    'properties' => [\n                        'limit' => [\n                            'type' => 'integer',\n                            'description' => 'Maximum number of items to return'\n                        ]\n                    ],\n                    'required' => []\n                ]\n            ]\n        ];\n    }\n    \n    public function executeFunction(string $functionName, array $parameters, ?string $userId = null): array\n    {\n        try {\n            switch ($functionName) {\n                case 'myapp_create_item':\n                    $item = $this->myService->createItem(\n                        $parameters['name'],\n                        $parameters['description'] ?? '',\n                        $userId\n                    );\n                    return [\n                        'success' => true,\n                        'data' => ['id' => $item->getId(), 'name' => $item->getName()]\n                    ];\n                    \n                case 'myapp_list_items':\n                    $items = $this->myService->listItems(\n                        $parameters['limit'] ?? 10,\n                        $userId\n                    );\n                    return [\n                        'success' => true,\n                        'data' => ['items' => $items]\n                    ];\n                    \n                default:\n                    return [\n                        'success' => false,\n                        'error' => 'Unknown function: ' . $functionName\n                    ];\n            }\n        } catch (\\Exception $e) {\n            $this->logger->error('[MyCustomTool] Error executing function', [\n                'function' => $functionName,\n                'error' => $e->getMessage()\n            ]);\n            \n            return [\n                'success' => false,\n                'error' => $e->getMessage()\n            ];\n        }\n    }\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"step-2-register-the-tool",children:"Step 2: Register the Tool"}),"\n",(0,r.jsxs)(n.p,{children:["In your app's ",(0,r.jsx)(n.code,{children:"lib/AppInfo/Application.php"}),", listen to the ",(0,r.jsx)(n.code,{children:"ToolRegistrationEvent"})," and register your tool:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"<?php\n\nnamespace OCA\\MyApp\\AppInfo;\n\nuse OCA\\OpenRegister\\Event\\ToolRegistrationEvent;\nuse OCA\\MyApp\\Tool\\MyCustomTool;\nuse OCP\\AppFramework\\App;\nuse OCP\\AppFramework\\Bootstrap\\IBootContext;\nuse OCP\\AppFramework\\Bootstrap\\IBootstrap;\nuse OCP\\AppFramework\\Bootstrap\\IRegistrationContext;\nuse OCP\\EventDispatcher\\IEventDispatcher;\n\nclass Application extends App implements IBootstrap\n{\n    public const APP_ID = 'myapp';\n\n    public function __construct()\n    {\n        parent::__construct(self::APP_ID);\n    }\n\n    public function register(IRegistrationContext $context): void\n    {\n        // Register the tool registration listener\n        $context->registerEventListener(\n            ToolRegistrationEvent::class,\n            \\OCA\\MyApp\\Listener\\ToolRegistrationListener::class\n        );\n    }\n\n    public function boot(IBootContext $context): void\n    {\n        // Boot logic here\n    }\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"step-3-create-a-tool-registration-listener",children:"Step 3: Create a Tool Registration Listener"}),"\n",(0,r.jsxs)(n.p,{children:["Create a listener class in ",(0,r.jsx)(n.code,{children:"lib/Listener/ToolRegistrationListener.php"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"<?php\n\ndeclare(strict_types=1);\n\nnamespace OCA\\MyApp\\Listener;\n\nuse OCA\\OpenRegister\\Event\\ToolRegistrationEvent;\nuse OCA\\MyApp\\Tool\\MyCustomTool;\nuse OCP\\EventDispatcher\\Event;\nuse OCP\\EventDispatcher\\IEventListener;\n\nclass ToolRegistrationListener implements IEventListener\n{\n    public function __construct(\n        private MyCustomTool $myCustomTool\n    ) {\n    }\n\n    public function handle(Event $event): void\n    {\n        if (!($event instanceof ToolRegistrationEvent)) {\n            return;\n        }\n\n        // Register your tool with metadata\n        // BEST PRACTICE: Pull name/description from the tool class to avoid duplication\n        $event->registerTool('myapp.mycustom', $this->myCustomTool, [\n            'name' => $this->myCustomTool->getName(),\n            'description' => $this->myCustomTool->getDescription(),\n            'icon' => 'icon-category-customization',  // Nextcloud icon class or MDI icon\n            'app' => 'myapp'  // Your app ID\n        ]);\n    }\n}\n"})}),"\n",(0,r.jsx)(n.admonition,{title:"Best Practice",type:"tip",children:(0,r.jsxs)(n.p,{children:["Use ",(0,r.jsx)(n.code,{children:"$tool->getName()"})," and ",(0,r.jsx)(n.code,{children:"$tool->getDescription()"})," in the metadata to avoid duplication. This ensures the tool's self-reported name/description is always used in the UI."]})}),"\n",(0,r.jsxs)(n.admonition,{title:"Icon & App Metadata",type:"info",children:[(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"icon"})," and ",(0,r.jsx)(n.code,{children:"app"})," fields are ",(0,r.jsx)(n.strong,{children:"only"})," defined during registration (not in the tool class). This is intentional:"]}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Icon"}),": UI presentation concern (which icon to show in the agent editor)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"App"}),": Metadata for filtering/grouping tools by source app"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Name/Description"}),": Should come from the tool class for consistency"]}),"\n"]})]}),"\n",(0,r.jsx)(n.h2,{id:"tool-metadata",children:"Tool Metadata"}),"\n",(0,r.jsx)(n.p,{children:"When registering a tool, you must provide the following metadata:"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Field"}),(0,r.jsx)(n.th,{children:"Type"}),(0,r.jsx)(n.th,{children:"Required"}),(0,r.jsx)(n.th,{children:"Source"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"name"})}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:"Yes"}),(0,r.jsx)(n.td,{children:"Tool class"}),(0,r.jsxs)(n.td,{children:["Human-readable name displayed in the agent editor. ",(0,r.jsx)(n.strong,{children:"Best practice"}),": Use ",(0,r.jsx)(n.code,{children:"$tool->getName()"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"description"})}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:"Yes"}),(0,r.jsx)(n.td,{children:"Tool class"}),(0,r.jsxs)(n.td,{children:["Brief description of what the tool does. ",(0,r.jsx)(n.strong,{children:"Best practice"}),": Use ",(0,r.jsx)(n.code,{children:"$tool->getDescription()"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"icon"})}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:"Yes"}),(0,r.jsx)(n.td,{children:"Registration"}),(0,r.jsxs)(n.td,{children:["Nextcloud icon class (e.g., ",(0,r.jsx)(n.code,{children:"icon-category-office"}),") or MDI icon name"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"app"})}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:"Yes"}),(0,r.jsx)(n.td,{children:"Registration"}),(0,r.jsxs)(n.td,{children:["Your app ID (e.g., ",(0,r.jsx)(n.code,{children:"myapp"}),"). Used for filtering and app badges"]})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"why-this-architecture",children:"Why This Architecture?"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Tool Class"})," (ToolInterface):"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Defines ",(0,r.jsx)(n.strong,{children:"what"})," the tool does (functions, logic)"]}),"\n",(0,r.jsxs)(n.li,{children:["Self-describes its ",(0,r.jsx)(n.strong,{children:"name"})," and ",(0,r.jsx)(n.strong,{children:"description"})]}),"\n",(0,r.jsx)(n.li,{children:"Agnostic to UI presentation"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Registration Metadata"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Defines ",(0,r.jsx)(n.strong,{children:"how"})," to display the tool in the UI (icon)"]}),"\n",(0,r.jsxs)(n.li,{children:["Provides ",(0,r.jsx)(n.strong,{children:"context"})," about the tool's source (app ID)"]}),"\n",(0,r.jsx)(n.li,{children:"Can override tool class metadata if needed (though not recommended)"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"This separation allows:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Tools to be self-documenting"}),"\n",(0,r.jsx)(n.li,{children:"UI presentation to be flexible"}),"\n",(0,r.jsx)(n.li,{children:"Tools to be tested independently of registration"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"tool-id-format",children:"Tool ID Format"}),"\n",(0,r.jsxs)(n.p,{children:["Tool IDs must follow the format: ",(0,r.jsx)(n.code,{children:"app_name.tool_name"})]}),"\n",(0,r.jsx)(n.p,{children:"Examples:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"myapp.mycustom"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"opencatalogi.cms"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"openregister.register"})}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"available-icons",children:"Available Icons"}),"\n",(0,r.jsx)(n.p,{children:"You can use either Nextcloud built-in icons or MDI (Material Design Icons):"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Nextcloud Icon Classes"})," (recommended):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"'icon' => 'icon-category-office'         // Office/document icon\n'icon' => 'icon-category-customization'  // Customization/settings icon\n'icon' => 'icon-category-organization'   // Organization/structure icon\n'icon' => 'icon-category-monitoring'     // Monitoring/analytics icon\n'icon' => 'icon-category-integration'    // Integration/connection icon\n'icon' => 'icon-category-workflow'       // Workflow/automation icon\n'icon' => 'icon-category-auth'          // Authentication/security icon\n'icon' => 'icon-category-social'        // Social/communication icon\n'icon' => 'icon-folder'                 // Folder icon\n'icon' => 'icon-file'                   // File icon\n'icon' => 'icon-user'                   // User icon\n'icon' => 'icon-settings'               // Settings icon\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"MDI Icons"})," (use the class name from ",(0,r.jsx)(n.a,{href:"https://pictogrammers.com/library/mdi/",children:"Pictogrammers"}),"):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"'icon' => 'mdi-database'       // Database icon\n'icon' => 'mdi-web'           // Website icon\n'icon' => 'mdi-api'           // API icon\n'icon' => 'mdi-robot'         // Robot/AI icon\n'icon' => 'mdi-tools'         // Tools icon\n"})}),"\n",(0,r.jsx)(n.p,{children:"The icon appears next to the tool name in the agent editor, helping users quickly identify tool types."}),"\n",(0,r.jsx)(n.h2,{id:"function-definition-schema",children:"Function Definition Schema"}),"\n",(0,r.jsx)(n.p,{children:"Functions must follow the OpenAI function calling schema:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"[\n    'name' => 'function_name',           // Unique function identifier\n    'description' => 'What it does',     // Clear description for the LLM\n    'parameters' => [\n        'type' => 'object',\n        'properties' => [\n            'param_name' => [\n                'type' => 'string',      // string, integer, boolean, array, object\n                'description' => 'What this parameter is for',\n                'enum' => ['option1', 'option2']  // Optional: restrict to specific values\n            ]\n        ],\n        'required' => ['param_name']     // List of required parameters\n    ]\n]\n"})}),"\n",(0,r.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,r.jsx)(n.h3,{id:"1-security--permissions",children:"1. Security & Permissions"}),"\n",(0,r.jsx)(n.p,{children:"Always respect the user's permissions and the agent's configuration:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"public function executeFunction(string $functionName, array $parameters, ?string $userId = null): array\n{\n    // Check user permissions\n    if (!$this->hasPermission($userId, 'myapp.create')) {\n        return [\n            'success' => false,\n            'error' => 'Insufficient permissions'\n        ];\n    }\n    \n    // Check agent organization limits\n    $organisation = $this->agent?->getOrganisation();\n    if ($organisation && !$this->belongsToOrganisation($item, $organisation)) {\n        return [\n            'success' => false,\n            'error' => 'Access denied to this organization'\n        ];\n    }\n    \n    // Execute function...\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"2-error-handling",children:"2. Error Handling"}),"\n",(0,r.jsx)(n.p,{children:"Always wrap function execution in try-catch and return structured responses:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"try {\n    $result = $this->myService->doSomething($parameters);\n    return [\n        'success' => true,\n        'data' => $result\n    ];\n} catch (\\Exception $e) {\n    $this->logger->error('[MyTool] Error', [\n        'error' => $e->getMessage()\n    ]);\n    \n    return [\n        'success' => false,\n        'error' => 'Failed to execute: ' . $e->getMessage()\n    ];\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"3-clear-function-descriptions",children:"3. Clear Function Descriptions"}),"\n",(0,r.jsx)(n.p,{children:"Write clear, concise descriptions for the LLM:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Good"}),": 'Create a new page with the given title and content'"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Bad"}),": 'Creates page'"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"4-input-validation",children:"4. Input Validation"}),"\n",(0,r.jsx)(n.p,{children:"Validate all parameters before processing:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"// Validate required parameters\nif (empty($parameters['name'])) {\n    return [\n        'success' => false,\n        'error' => 'Name parameter is required'\n    ];\n}\n\n// Validate parameter types\nif (!is_string($parameters['name'])) {\n    return [\n        'success' => false,\n        'error' => 'Name must be a string'\n    ];\n}\n\n// Validate parameter values\nif (strlen($parameters['name']) > 255) {\n    return [\n        'success' => false,\n        'error' => 'Name must not exceed 255 characters'\n    ];\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"5-logging",children:"5. Logging"}),"\n",(0,r.jsx)(n.p,{children:"Log all tool executions for debugging and auditing:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"$this->logger->info('[MyTool] Executing function', [\n    'function' => $functionName,\n    'userId' => $userId,\n    'agentId' => $this->agent?->getId()\n]);\n"})}),"\n",(0,r.jsx)(n.h2,{id:"testing-your-tool",children:"Testing Your Tool"}),"\n",(0,r.jsx)(n.h3,{id:"unit-tests",children:"Unit Tests"}),"\n",(0,r.jsx)(n.p,{children:"Create PHPUnit tests for your tool:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"<?php\n\nnamespace OCA\\MyApp\\Tests\\Tool;\n\nuse OCA\\MyApp\\Tool\\MyCustomTool;\nuse PHPUnit\\Framework\\TestCase;\n\nclass MyCustomToolTest extends TestCase\n{\n    private MyCustomTool $tool;\n    \n    protected function setUp(): void\n    {\n        parent::setUp();\n        $this->tool = new MyCustomTool(/* dependencies */);\n    }\n    \n    public function testCreateItem(): void\n    {\n        $result = $this->tool->executeFunction('myapp_create_item', [\n            'name' => 'Test Item'\n        ], 'testuser');\n        \n        $this->assertTrue($result['success']);\n        $this->assertArrayHasKey('data', $result);\n    }\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"manual-testing",children:"Manual Testing"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Enable your app in Nextcloud"}),"\n",(0,r.jsx)(n.li,{children:"Navigate to OpenRegister Agents"}),"\n",(0,r.jsx)(n.li,{children:"Create or edit an agent"}),"\n",(0,r.jsx)(n.li,{children:"Go to the 'Tools' tab"}),"\n",(0,r.jsx)(n.li,{children:"Your tool should appear in the list"}),"\n",(0,r.jsx)(n.li,{children:"Enable your tool"}),"\n",(0,r.jsx)(n.li,{children:"Start a chat with the agent"}),"\n",(0,r.jsx)(n.li,{children:"Ask the agent to use your tool's functions"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"example-cms-tool-for-opencatalogi",children:"Example: CMS Tool for OpenCatalogi"}),"\n",(0,r.jsx)(n.p,{children:"Here's a complete example of a CMS tool that manages pages, menus, and menu items:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"<?php\n\ndeclare(strict_types=1);\n\nnamespace OCA\\OpenCatalogi\\Tool;\n\nuse OCA\\OpenRegister\\Tool\\ToolInterface;\nuse OCA\\OpenRegister\\Db\\Agent;\nuse OCA\\OpenCatalogi\\Service\\PageService;\nuse OCA\\OpenCatalogi\\Service\\MenuService;\nuse Psr\\Log\\LoggerInterface;\n\nclass CMSTool implements ToolInterface\n{\n    private ?Agent $agent = null;\n    \n    public function __construct(\n        private PageService $pageService,\n        private MenuService $menuService,\n        private LoggerInterface $logger\n    ) {\n    }\n    \n    public function getName(): string\n    {\n        return 'CMS Tool';\n    }\n    \n    public function getDescription(): string\n    {\n        return 'Manage website content: pages, menus, and menu items';\n    }\n    \n    public function setAgent(Agent $agent): void\n    {\n        $this->agent = $agent;\n    }\n    \n    public function getFunctions(): array\n    {\n        return [\n            // Page functions\n            [\n                'name' => 'cms_create_page',\n                'description' => 'Create a new page with title and content',\n                'parameters' => [\n                    'type' => 'object',\n                    'properties' => [\n                        'title' => ['type' => 'string', 'description' => 'Page title'],\n                        'content' => ['type' => 'string', 'description' => 'Page content in HTML'],\n                        'slug' => ['type' => 'string', 'description' => 'URL-friendly slug']\n                    ],\n                    'required' => ['title', 'content']\n                ]\n            ],\n            [\n                'name' => 'cms_list_pages',\n                'description' => 'List all pages',\n                'parameters' => [\n                    'type' => 'object',\n                    'properties' => [\n                        'limit' => ['type' => 'integer', 'description' => 'Max results']\n                    ],\n                    'required' => []\n                ]\n            ],\n            // Menu functions\n            [\n                'name' => 'cms_create_menu',\n                'description' => 'Create a new menu',\n                'parameters' => [\n                    'type' => 'object',\n                    'properties' => [\n                        'name' => ['type' => 'string', 'description' => 'Menu name'],\n                        'location' => ['type' => 'string', 'description' => 'Menu location (header, footer, sidebar)']\n                    ],\n                    'required' => ['name']\n                ]\n            ],\n            [\n                'name' => 'cms_add_menu_item',\n                'description' => 'Add an item to a menu',\n                'parameters' => [\n                    'type' => 'object',\n                    'properties' => [\n                        'menuId' => ['type' => 'string', 'description' => 'Menu UUID'],\n                        'label' => ['type' => 'string', 'description' => 'Menu item label'],\n                        'url' => ['type' => 'string', 'description' => 'Link URL'],\n                        'pageId' => ['type' => 'string', 'description' => 'Link to a page UUID (alternative to url)']\n                    ],\n                    'required' => ['menuId', 'label']\n                ]\n            ]\n        ];\n    }\n    \n    public function executeFunction(string $functionName, array $parameters, ?string $userId = null): array\n    {\n        try {\n            return match ($functionName) {\n                'cms_create_page' => $this->createPage($parameters, $userId),\n                'cms_list_pages' => $this->listPages($parameters, $userId),\n                'cms_create_menu' => $this->createMenu($parameters, $userId),\n                'cms_add_menu_item' => $this->addMenuItem($parameters, $userId),\n                default => ['success' => false, 'error' => 'Unknown function']\n            };\n        } catch (\\Exception $e) {\n            $this->logger->error('[CMSTool] Error', [\n                'function' => $functionName,\n                'error' => $e->getMessage()\n            ]);\n            \n            return ['success' => false, 'error' => $e->getMessage()];\n        }\n    }\n    \n    private function createPage(array $parameters, ?string $userId): array\n    {\n        $page = $this->pageService->create([\n            'title' => $parameters['title'],\n            'content' => $parameters['content'],\n            'slug' => $parameters['slug'] ?? $this->generateSlug($parameters['title']),\n            'owner' => $userId,\n            'organisation' => $this->agent?->getOrganisation()\n        ]);\n        \n        return [\n            'success' => true,\n            'data' => ['pageId' => $page->getUuid(), 'slug' => $page->getSlug()]\n        ];\n    }\n    \n    private function listPages(array $parameters, ?string $userId): array\n    {\n        $pages = $this->pageService->findAll(\n            $parameters['limit'] ?? 50,\n            $userId,\n            $this->agent?->getOrganisation()\n        );\n        \n        return [\n            'success' => true,\n            'data' => ['pages' => array_map(fn($p) => [\n                'id' => $p->getUuid(),\n                'title' => $p->getTitle(),\n                'slug' => $p->getSlug()\n            ], $pages)]\n        ];\n    }\n    \n    private function generateSlug(string $title): string\n    {\n        return strtolower(preg_replace('/[^a-z0-9]+/i', '-', $title));\n    }\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,r.jsx)(n.h3,{id:"tool-not-appearing-in-agent-editor",children:"Tool Not Appearing in Agent Editor"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Check that your app is enabled"}),"\n",(0,r.jsxs)(n.li,{children:["Verify the event listener is registered in ",(0,r.jsx)(n.code,{children:"Application.php"})]}),"\n",(0,r.jsx)(n.li,{children:"Check logs for registration errors"}),"\n",(0,r.jsxs)(n.li,{children:["Ensure tool ID follows the ",(0,r.jsx)(n.code,{children:"app.tool"})," format"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"function-calls-failing",children:"Function Calls Failing"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Check parameter validation"}),"\n",(0,r.jsx)(n.li,{children:"Verify user permissions"}),"\n",(0,r.jsx)(n.li,{children:"Review logs for exceptions"}),"\n",(0,r.jsx)(n.li,{children:"Test the function directly (not through the agent)"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"llm-not-using-your-tool",children:"LLM Not Using Your Tool"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Improve function descriptions"}),"\n",(0,r.jsx)(n.li,{children:"Make parameter names more intuitive"}),"\n",(0,r.jsx)(n.li,{children:"Ensure the agent has the tool enabled"}),"\n",(0,r.jsx)(n.li,{children:"Test with explicit instructions (e.g., 'Use the CMS tool to create a page')"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"api-reference",children:"API Reference"}),"\n",(0,r.jsx)(n.h3,{id:"toolinterface",children:"ToolInterface"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"interface ToolInterface\n{\n    public function getName(): string;\n    public function getDescription(): string;\n    public function getFunctions(): array;\n    public function executeFunction(string $functionName, array $parameters, ?string $userId = null): array;\n    public function setAgent(Agent $agent): void;\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"toolregistrationevent",children:"ToolRegistrationEvent"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"class ToolRegistrationEvent extends Event\n{\n    public function registerTool(string $id, ToolInterface $tool, array $metadata): void;\n    public function getRegistry(): ToolRegistry;\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"toolregistry",children:"ToolRegistry"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"class ToolRegistry\n{\n    public function registerTool(string $id, ToolInterface $tool, array $metadata): void;\n    public function getTool(string $id): ?ToolInterface;\n    public function getAllTools(): array;\n    public function getTools(array $ids): array;\n    public function hasTool(string $id): bool;\n    public function getToolsByApp(string $appName): array;\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"implementation-summary",children:"Implementation Summary"}),"\n",(0,r.jsx)(n.h3,{id:"architecture-overview",children:"Architecture Overview"}),"\n",(0,r.jsx)(n.p,{children:"The tool registration system uses a plugin architecture that allows any Nextcloud app to register custom tools:"}),"\n",(0,r.jsx)(n.mermaid,{value:"graph TD\n    A[Nextcloud Apps] --\x3e B[ToolRegistrationEvent]\n    B --\x3e C[ToolRegistry]\n    C --\x3e D[ChatService]\n    D --\x3e E[LLM with Function Calling]\n    E --\x3e F[Tool Functions]\n    F --\x3e G[App Services]\n    \n    H[Frontend EditAgent] --\x3e I[GET /api/agents/tools]\n    I --\x3e C\n    \n    J[Agent Configuration] --\x3e D"}),"\n",(0,r.jsx)(n.h3,{id:"key-components",children:"Key Components"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Backend:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"ToolRegistry"})," - Central service managing all available tools"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"ToolRegistrationEvent"})," - Event dispatched when tools are collected"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"ToolRegistrationListener"})," - Registers OpenRegister's built-in tools"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"ChatService"})," - Uses ToolRegistry for dynamic tool loading"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"AgentsController"})," - API endpoint ",(0,r.jsx)(n.code,{children:"/api/agents/tools"})," for frontend"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Frontend:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"EditAgent.vue"})," - Dynamically loads available tools"]}),"\n",(0,r.jsx)(n.li,{children:"Displays tool name, description, icon, and app badge"}),"\n",(0,r.jsx)(n.li,{children:"Supports toggle switches for enabling/disabling tools"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"built-in-tools",children:"Built-in Tools"}),"\n",(0,r.jsx)(n.p,{children:"OpenRegister provides three built-in tools:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"openregister.register"})," - Manage registers"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"openregister.schema"})," - Manage schemas"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"openregister.objects"})," - Manage objects"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"ui-improvements",children:"UI Improvements"}),"\n",(0,r.jsx)(n.p,{children:"The tool selection interface features:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"64px icons"})," with colored backgrounds for visual prominence"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Toggle switches"})," instead of checkboxes for better UX"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Enhanced styling"})," with hover effects, borders, and spacing"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"App badges"})," showing the source app for each tool"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Responsive layout"})," with proper alignment and typography"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"security-features",children:"Security Features"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"RBAC enforcement at tool level"}),"\n",(0,r.jsx)(n.li,{children:"Organization boundary respect"}),"\n",(0,r.jsx)(n.li,{children:"User context for permissions"}),"\n",(0,r.jsx)(n.li,{children:"Input validation in all tools"}),"\n",(0,r.jsx)(n.li,{children:"Audit trail logging"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"benefits",children:"Benefits"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"For End Users:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Agents can perform real actions (not just chat)"}),"\n",(0,r.jsx)(n.li,{children:"Multi-app functionality in single conversation"}),"\n",(0,r.jsx)(n.li,{children:"Secure with proper permission checks"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"For Developers:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Simple API to add new capabilities"}),"\n",(0,r.jsx)(n.li,{children:"Reuse existing services"}),"\n",(0,r.jsx)(n.li,{children:"Comprehensive documentation"}),"\n",(0,r.jsx)(n.li,{children:"Working examples to follow"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"further-reading",children:"Further Reading"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://platform.openai.com/docs/guides/function-calling",children:"OpenAI Function Calling"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://llphant.gitbook.io/llphant",children:"LLPhant Documentation"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/docs/features/agents",children:"OpenRegister Agent Documentation"})}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/docs/development/tool-metadata-architecture",children:"Tool Metadata Architecture"})," - Deep dive into metadata architecture"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/docs/development/tool-registration-testing",children:"Tool Testing Guide"})," - Comprehensive testing procedures"]}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://docs.nextcloud.com/server/latest/developer_manual/",children:"Nextcloud App Development"})}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}}}]);