"use strict";(self.webpackChunkopen_catalogi_docs=self.webpackChunkopen_catalogi_docs||[]).push([[597],{28453:(e,n,i)=>{i.d(n,{R:()=>l,x:()=>c});var s=i(96540);const r={},t=s.createContext(r);function l(e){const n=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),s.createElement(t.Provider,{value:n},e.children)}},69908:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>c,default:()=>h,frontMatter:()=>l,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"development/performance-optimization","title":"Performance Optimization","description":"Guide to optimizing OpenRegister performance, especially for chat responses and vector search","source":"@site/docs/development/performance-optimization.md","sourceDirName":"development","slug":"/development/performance-optimization","permalink":"/docs/development/performance-optimization","draft":false,"unlisted":false,"editUrl":"https://github.com/conductionnl/openregister/tree/main/website/docs/development/performance-optimization.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"title":"Performance Optimization","sidebar_position":2,"description":"Guide to optimizing OpenRegister performance, especially for chat responses and vector search","keywords":["Open Register","Performance","Optimization","Chat","Vector Search"]},"sidebar":"tutorialSidebar","previous":{"title":"Docker Development Setup","permalink":"/docs/development/docker-setup"},"next":{"title":"Ollama Setup and Configuration","permalink":"/docs/development/ollama"}}');var r=i(74848),t=i(28453);const l={title:"Performance Optimization",sidebar_position:2,description:"Guide to optimizing OpenRegister performance, especially for chat responses and vector search",keywords:["Open Register","Performance","Optimization","Chat","Vector Search"]},c="Performance Optimization Guide",a={},o=[{value:"Performance Monitoring",id:"performance-monitoring",level:2},{value:"Checking Performance Logs",id:"checking-performance-logs",level:3},{value:"Optimization Strategies",id:"optimization-strategies",level:2},{value:"1. Streaming Responses",id:"1-streaming-responses",level:3},{value:"2. Ollama Model Selection",id:"2-ollama-model-selection",level:3},{value:"3. GPU Acceleration",id:"3-gpu-acceleration",level:3},{value:"4. Context Window Optimization",id:"4-context-window-optimization",level:3},{value:"5. Tool Call Optimization",id:"5-tool-call-optimization",level:3},{value:"6. Vector Search Optimization",id:"6-vector-search-optimization",level:3},{value:"7. Model Keep-Alive",id:"7-model-keep-alive",level:3},{value:"8. Prompt Optimization",id:"8-prompt-optimization",level:3},{value:"Quick Wins",id:"quick-wins",level:2},{value:"Enable Performance Logging",id:"enable-performance-logging",level:3},{value:"Switch to Smaller Model",id:"switch-to-smaller-model",level:3},{value:"Disable RAG for Fast Responses",id:"disable-rag-for-fast-responses",level:3},{value:"Streaming Implementation",id:"streaming-implementation",level:2},{value:"Response Caching",id:"response-caching",level:2},{value:"Parallel Processing",id:"parallel-processing",level:2},{value:"Monitoring",id:"monitoring",level:2},{value:"Testing Performance",id:"testing-performance",level:2},{value:"Expected Performance",id:"expected-performance",level:2},{value:"Priority Order",id:"priority-order",level:2},{value:"Database Performance",id:"database-performance",level:2},{value:"Database Index Optimization",id:"database-index-optimization",level:2},{value:"Performance Issues Identified",id:"performance-issues-identified",level:3},{value:"Issue 1: Missing Database Indexes",id:"issue-1-missing-database-indexes",level:4},{value:"Issue 2: External App Cache Miss",id:"issue-2-external-app-cache-miss",level:4},{value:"Comprehensive Database Index Migration",id:"comprehensive-database-index-migration",level:3},{value:"Expected Performance Improvements",id:"expected-performance-improvements",level:3},{value:"Search Optimization",id:"search-optimization",level:2},{value:"Database Index Optimization",id:"database-index-optimization-1",level:3},{value:"Single-Column Search Indexes",id:"single-column-search-indexes",level:4},{value:"Composite Search Indexes",id:"composite-search-indexes",level:4},{value:"Schema Caching System",id:"schema-caching-system",level:3},{value:"Optimized Search Query Execution",id:"optimized-search-query-execution",level:3},{value:"Search Priority Order",id:"search-priority-order",level:4},{value:"Performance Expected Improvements",id:"performance-expected-improvements",level:3},{value:"Search Performance",id:"search-performance",level:4},{value:"Schema Loading Performance",id:"schema-loading-performance",level:4},{value:"Related Documentation",id:"related-documentation",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"performance-optimization-guide",children:"Performance Optimization Guide"})}),"\n",(0,r.jsx)(n.p,{children:"This guide covers performance optimization strategies for OpenRegister, with a focus on chat responses and vector search operations."}),"\n",(0,r.jsx)(n.h2,{id:"performance-monitoring",children:"Performance Monitoring"}),"\n",(0,r.jsx)(n.p,{children:"OpenRegister includes detailed timing logs to track where time is spent during chat operations:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"[ChatService] Message processed - OVERALL PERFORMANCE\n- contextRetrieval: Time to search vectors and build context\n- historyBuilding: Time to load conversation history\n- llmGeneration: Time for LLM to generate response (includes tool calls)\n\n[ChatService] Response generated - PERFORMANCE\n- toolsLoading: Time to load agent tools\n- llmGeneration: Actual LLM inference time\n- overhead: Time spent in framework/serialization\n"})}),"\n",(0,r.jsx)(n.h3,{id:"checking-performance-logs",children:"Checking Performance Logs"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'docker logs -f master-nextcloud-1 | grep "PERFORMANCE"\n'})}),"\n",(0,r.jsx)(n.h2,{id:"optimization-strategies",children:"Optimization Strategies"}),"\n",(0,r.jsx)(n.h3,{id:"1-streaming-responses",children:"1. Streaming Responses"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Current Implementation:"})," Responses can be streamed using Server-Sent Events (SSE) for improved perceived performance."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Benefits:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Frontend shows response as it's generated"}),"\n",(0,r.jsx)(n.li,{children:"Perceived performance improvement of 10x+"}),"\n",(0,r.jsx)(n.li,{children:"User sees first tokens in <1s instead of waiting for complete response"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Implementation:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"ChatController::sendMessage()"})," can return SSE stream"]}),"\n",(0,r.jsxs)(n.li,{children:["Use ",(0,r.jsx)(n.code,{children:"$chat->generateStreamOfText()"})," for Ollama"]}),"\n",(0,r.jsx)(n.li,{children:"Frontend consumes SSE and displays progressively"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"2-ollama-model-selection",children:"2. Ollama Model Selection"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Model Size Impact:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Small models (1-3B parameters): 5-10s response time"}),"\n",(0,r.jsx)(n.li,{children:"Medium models (7-8B parameters): 20-30s response time"}),"\n",(0,r.jsx)(n.li,{children:"Large models (70B+ parameters): 60-120s response time"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Recommended Models:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Faster models for Ollama:\ndocker exec openregister-ollama ollama pull llama3.2:1b    # Tiny (faster)\ndocker exec openregister-ollama ollama pull phi3:mini      # Microsoft Phi3 (fast)\ndocker exec openregister-ollama ollama pull gemma2:2b      # Google Gemma (balanced)\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Configuration:"})," Select models in Settings \u2192 LLM Configuration \u2192 Chat Provider"]}),"\n",(0,r.jsx)(n.h3,{id:"3-gpu-acceleration",children:"3. GPU Acceleration"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Current Support:"})," GPU acceleration is supported for Ollama when configured in ",(0,r.jsx)(n.code,{children:"docker-compose.yml"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"services:\n  ollama:\n    image: ollama/ollama:latest\n    deploy:\n      resources:\n        reservations:\n          devices:\n            - driver: nvidia\n              count: all\n              capabilities: [gpu]\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Speed improvement:"})," 10-50x faster inference when GPU is available."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Verification:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Check if GPU is being used\ndocker exec openregister-ollama nvidia-smi\n"})}),"\n",(0,r.jsx)(n.h3,{id:"4-context-window-optimization",children:"4. Context Window Optimization"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Current Behavior:"})," Full conversation history + RAG context is sent to LLM."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Optimization Options:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Limit conversation history to last N messages"}),"\n",(0,r.jsx)(n.li,{children:"Truncate RAG context to top 3-5 most relevant chunks"}),"\n",(0,r.jsx)(n.li,{children:"Implement smart summarization for long conversations"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Configuration:"})," Adjust in ",(0,r.jsx)(n.code,{children:"buildMessageHistory()"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"// Limit to last 10 messages instead of all\n$limit = 10;\n"})}),"\n",(0,r.jsx)(n.h3,{id:"5-tool-call-optimization",children:"5. Tool Call Optimization"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Current Behavior:"})," Sequential tool calls require multiple LLM roundtrips."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Example Flow:"})}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:'User: "List registers and schemas"'}),"\n",(0,r.jsxs)(n.li,{children:["LLM generates \u2192 calls ",(0,r.jsx)(n.code,{children:"list_registers"})," \u2192 waits"]}),"\n",(0,r.jsxs)(n.li,{children:["LLM receives result \u2192 calls ",(0,r.jsx)(n.code,{children:"list_schemas"})," \u2192 waits"]}),"\n",(0,r.jsx)(n.li,{children:"Total time accumulates for each call"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Optimization Strategies:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Implement parallel tool calls where possible"}),"\n",(0,r.jsx)(n.li,{children:"Cache tool results for session"}),"\n",(0,r.jsx)(n.li,{children:"Reduce tool call iterations with better prompting"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"6-vector-search-optimization",children:"6. Vector Search Optimization"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Current Implementation:"})," Vector search can be optimized through several methods:"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Optimization Options:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Disable RAG for agents that don't need it"}),"\n",(0,r.jsx)(n.li,{children:"Use faster embedding models (nomic-embed-text)"}),"\n",(0,r.jsx)(n.li,{children:"Implement vector search caching"}),"\n",(0,r.jsx)(n.li,{children:"Index optimization in vector database"}),"\n",(0,r.jsx)(n.li,{children:"Use PostgreSQL + pgvector for database-level vector operations"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Configuration:"})," Adjust RAG settings per agent in agent configuration."]}),"\n",(0,r.jsx)(n.h3,{id:"7-model-keep-alive",children:"7. Model Keep-Alive"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Current Configuration:"})," Model keep-alive is configured in ",(0,r.jsx)(n.code,{children:"docker-compose.yml"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"environment:\n  - OLLAMA_KEEP_ALIVE=30m  # Keep model in memory\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Purpose:"})," Prevents model from unloading from memory between requests, reducing reload time."]}),"\n",(0,r.jsx)(n.h3,{id:"8-prompt-optimization",children:"8. Prompt Optimization"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Current Approach:"})," System prompts are optimized for clarity and conciseness."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Best Practices:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Keep prompts concise"}),"\n",(0,r.jsx)(n.li,{children:"Avoid redundant instructions"}),"\n",(0,r.jsx)(n.li,{children:"Use tool descriptions instead of prompt examples"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"quick-wins",children:"Quick Wins"}),"\n",(0,r.jsx)(n.h3,{id:"enable-performance-logging",children:"Enable Performance Logging"}),"\n",(0,r.jsx)(n.p,{children:"Performance logging is already implemented - check logs to identify bottlenecks:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'docker logs -f master-nextcloud-1 | grep "PERFORMANCE"\n'})}),"\n",(0,r.jsx)(n.h3,{id:"switch-to-smaller-model",children:"Switch to Smaller Model"}),"\n",(0,r.jsx)(n.p,{children:"In OpenRegister settings:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Navigate to Settings \u2192 LLM Configuration \u2192 Chat Provider"}),"\n",(0,r.jsxs)(n.li,{children:["Change Chat Model from large models (llama3.2) to smaller models (phi3",":mini"," or gemma2:2b)"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"disable-rag-for-fast-responses",children:"Disable RAG for Fast Responses"}),"\n",(0,r.jsx)(n.p,{children:"For agents that don't need context search:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"// In agent settings:\nenableRag: false  // For agents that don't need context search\n"})}),"\n",(0,r.jsx)(n.h2,{id:"streaming-implementation",children:"Streaming Implementation"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Backend:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:'public function sendMessageStream(int $conversationId): StreamResponse {\n    $stream = function () use ($conversationId) {\n        // ... setup ...\n        \n        foreach ($chat->generateStreamOfText($prompt) as $chunk) {\n            yield "data: " . json_encode([\'chunk\' => $chunk]) . "\\n\\n";\n        }\n        \n        yield "data: [DONE]\\n\\n";\n    };\n    \n    return new StreamResponse($stream);\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Frontend:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"const eventSource = new EventSource('/api/chat/stream');\neventSource.onmessage = (event) => {\n    const data = JSON.parse(event.data);\n    if (data.chunk) {\n        appendToMessage(data.chunk);\n    }\n};\n"})}),"\n",(0,r.jsx)(n.h2,{id:"response-caching",children:"Response Caching"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Current Support:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Cache LLM responses for identical queries"}),"\n",(0,r.jsx)(n.li,{children:"Cache tool call results for session"}),"\n",(0,r.jsx)(n.li,{children:"Redis support for distributed caching"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"parallel-processing",children:"Parallel Processing"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Current Capabilities:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Run vector search and history building in parallel"}),"\n",(0,r.jsx)(n.li,{children:"Execute independent tool calls in parallel"}),"\n",(0,r.jsx)(n.li,{children:"Use async PHP with ReactPHP/Amp"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"monitoring",children:"Monitoring"}),"\n",(0,r.jsx)(n.p,{children:"Performance metrics can be added to response headers:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"$response->addHeader('X-Generation-Time', round($llmTime, 2));\n$response->addHeader('X-Context-Time', round($contextTime, 2));\n"})}),"\n",(0,r.jsx)(n.p,{children:'Frontend can then display: "Generated in 25.3s"'}),"\n",(0,r.jsx)(n.h2,{id:"testing-performance",children:"Testing Performance"}),"\n",(0,r.jsx)(n.p,{children:"After each optimization, test with:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# Simple query (no tools)\ncurl -X POST /api/chat/send -d \'{"message": "Hello"}\'\n\n# Complex query (with tools)\ncurl -X POST /api/chat/send -d \'{"message": "List all registers"}\'\n\n# Measure response time\ntime curl -X POST /api/chat/send -d \'{"message": "Hello"}\'\n'})}),"\n",(0,r.jsx)(n.h2,{id:"expected-performance",children:"Expected Performance"}),"\n",(0,r.jsx)(n.p,{children:"With optimizations applied:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Simple query:"})," 2-5s (down from 15-20s)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Tool query:"})," 8-15s (down from 50s+)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"With streaming:"})," Perceived as <1s (first tokens immediate)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"With GPU:"})," 0.5-2s (down from 15-20s)"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"priority-order",children:"Priority Order"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\ud83d\udd34 ",(0,r.jsx)(n.strong,{children:"Enable GPU"})," \u2192 10-50x speedup"]}),"\n",(0,r.jsxs)(n.li,{children:["\ud83d\udd34 ",(0,r.jsx)(n.strong,{children:"Switch to smaller model"})," \u2192 2-3x speedup"]}),"\n",(0,r.jsxs)(n.li,{children:["\ud83d\udd34 ",(0,r.jsx)(n.strong,{children:"Implement streaming"})," \u2192 Perceived 10x+ improvement"]}),"\n",(0,r.jsxs)(n.li,{children:["\ud83d\udfe1 ",(0,r.jsx)(n.strong,{children:"Optimize context window"})," \u2192 1.5-2x speedup"]}),"\n",(0,r.jsxs)(n.li,{children:["\ud83d\udfe1 ",(0,r.jsx)(n.strong,{children:"Tool call optimization"})," \u2192 2x speedup for multi-tool queries"]}),"\n",(0,r.jsxs)(n.li,{children:["\ud83d\udfe2 ",(0,r.jsx)(n.strong,{children:"Prompt optimization"})," \u2192 1.2x speedup"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"database-performance",children:"Database Performance"}),"\n",(0,r.jsx)(n.p,{children:"For vector search operations, database choice significantly impacts performance:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"MariaDB/MySQL"}),": Vector similarity calculated in PHP (slower)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"PostgreSQL + pgvector"}),": Database-level vector operations (10-100x faster)"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["See ",(0,r.jsx)(n.a,{href:"/docs/Features/configurations#database-status-tile",children:"Database Status Tile"})," in LLM Configuration settings for current database status and recommendations."]}),"\n",(0,r.jsx)(n.h2,{id:"database-index-optimization",children:"Database Index Optimization"}),"\n",(0,r.jsx)(n.h3,{id:"performance-issues-identified",children:"Performance Issues Identified"}),"\n",(0,r.jsx)(n.h4,{id:"issue-1-missing-database-indexes",children:"Issue 1: Missing Database Indexes"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Problem"}),": Object queries taking 30 seconds first time"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Root Cause"}),": Missing indexes on commonly searched fields (uuid, slug, name, summary, description)"]}),"\n",(0,r.jsx)(n.h4,{id:"issue-2-external-app-cache-miss",children:"Issue 2: External App Cache Miss"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Problem"}),": External app queries taking 4 seconds every time (no caching)"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Root Cause"}),": External app context detection creating different cache keys each time"]}),"\n",(0,r.jsx)(n.h3,{id:"comprehensive-database-index-migration",children:"Comprehensive Database Index Migration"}),"\n",(0,r.jsxs)(n.p,{children:["Created migration with ",(0,r.jsx)(n.strong,{children:"12 strategic performance indexes"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"-- Critical single-column indexes\nCREATE INDEX objects_uuid_perf_idx ON openregister_objects (uuid);\nCREATE INDEX objects_slug_perf_idx ON openregister_objects (slug);\nCREATE INDEX objects_name_perf_idx ON openregister_objects (name);\nCREATE INDEX objects_summary_perf_idx ON openregister_objects (summary);\nCREATE INDEX objects_description_perf_idx ON openregister_objects (description);\n\n-- Critical composite indexes  \nCREATE INDEX objects_main_search_idx ON openregister_objects (register, schema, organisation, published);\nCREATE INDEX objects_publication_filter_idx ON openregister_objects (published, depublished, created);\nCREATE INDEX objects_rbac_tenancy_idx ON openregister_objects (owner, organisation, register, schema);\nCREATE INDEX objects_ultimate_perf_idx ON openregister_objects (register, schema, organisation, published, owner);\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Run the Migration:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Apply the new indexes\ndocker exec -u 33 master-nextcloud-1 php /var/www/html/occ upgrade\n\n# Verify indexes were created\ndocker exec -u 33 master-nextcloud-1 mysql -u nextcloud -p nextcloud \\\n  -e 'SHOW INDEX FROM openregister_objects WHERE Key_name LIKE \"%perf%\";'\n"})}),"\n",(0,r.jsx)(n.h3,{id:"expected-performance-improvements",children:"Expected Performance Improvements"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"After Index Migration:"})}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Endpoint"}),(0,r.jsx)(n.th,{children:"Before"}),(0,r.jsx)(n.th,{children:"After"}),(0,r.jsx)(n.th,{children:"Improvement"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"/api/objects/voorzieningen/product"})}),(0,r.jsx)(n.td,{children:"30s"}),(0,r.jsx)(n.td,{children:"<1s"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"97% faster"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"/api/objects/voorzieningen/organisatie"})}),(0,r.jsx)(n.td,{children:"30s"}),(0,r.jsx)(n.td,{children:"<1s"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"97% faster"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"General object searches"}),(0,r.jsx)(n.td,{children:"5-15s"}),(0,r.jsx)(n.td,{children:"0.1-0.5s"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"95% faster"})})]})]})]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"After Cache Fix:"})}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Endpoint"}),(0,r.jsx)(n.th,{children:"Before"}),(0,r.jsx)(n.th,{children:"After"}),(0,r.jsx)(n.th,{children:"Improvement"})]})}),(0,r.jsx)(n.tbody,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"/api/apps/opencatalogi/api/publications"})}),(0,r.jsx)(n.td,{children:"4s every time"}),(0,r.jsx)(n.td,{children:"4s \u2192 50ms"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Cache Hit: 98% faster"})})]})})]}),"\n",(0,r.jsx)(n.h2,{id:"search-optimization",children:"Search Optimization"}),"\n",(0,r.jsx)(n.h3,{id:"database-index-optimization-1",children:"Database Index Optimization"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Migration"}),": ",(0,r.jsx)(n.code,{children:"lib/Migration/Version1Date20250102120000.php"})]}),"\n",(0,r.jsx)(n.p,{children:"Added critical indexes for search performance:"}),"\n",(0,r.jsx)(n.h4,{id:"single-column-search-indexes",children:"Single-Column Search Indexes"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"objects_name_search_idx"})," - Index on ",(0,r.jsx)(n.code,{children:"name"})," column"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"objects_summary_search_idx"})," - Index on ",(0,r.jsx)(n.code,{children:"summary"})," column"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"objects_description_search_idx"})," - Index on ",(0,r.jsx)(n.code,{children:"description"})," column"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"composite-search-indexes",children:"Composite Search Indexes"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"objects_name_deleted_published_idx"})," - Combined search + lifecycle filtering"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"objects_summary_deleted_published_idx"})," - Summary search + lifecycle filtering"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"objects_description_deleted_published_idx"})," - Description search + lifecycle filtering"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"objects_name_register_schema_idx"})," - Name search + register/schema filtering"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"objects_summary_register_schema_idx"})," - Summary search + register/schema filtering"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"objects_name_organisation_deleted_idx"})," - Name search + multi-tenancy filtering"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"objects_summary_organisation_deleted_idx"})," - Summary search + multi-tenancy filtering"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Performance Impact"}),": These indexes enable fast lookup on frequently searched metadata columns, reducing query times from seconds to milliseconds."]}),"\n",(0,r.jsx)(n.h3,{id:"schema-caching-system",children:"Schema Caching System"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Service"}),": ",(0,r.jsx)(n.code,{children:"lib/Service/SchemaCacheService.php"})]}),"\n",(0,r.jsx)(n.p,{children:"Implemented comprehensive schema caching with:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"In-memory caching"})," for frequently accessed schemas"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Database-backed cache"})," with configurable TTL"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Batch schema loading"})," for multiple schemas"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Automatic cache invalidation"})," when schemas are updated"]}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"Cache statistics and monitoring"})}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Performance Benefits"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Eliminates repeated database queries for schema loading"}),"\n",(0,r.jsx)(n.li,{children:"Reduces schema processing overhead"}),"\n",(0,r.jsx)(n.li,{children:"Enables predictable performance for schema-dependent operations"}),"\n",(0,r.jsx)(n.li,{children:"Supports high-concurrency scenarios"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"optimized-search-query-execution",children:"Optimized Search Query Execution"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Handler"}),": ",(0,r.jsx)(n.code,{children:"lib/Db/ObjectHandlers/MariaDbSearchHandler.php"})]}),"\n",(0,r.jsx)(n.p,{children:"Enhanced search performance with prioritized search strategy:"}),"\n",(0,r.jsx)(n.h4,{id:"search-priority-order",children:"Search Priority Order"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"PRIORITY 1"}),": Indexed metadata columns (name, summary, description)"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Fastest performance using database indexes"}),"\n",(0,r.jsx)(n.li,{children:"Direct column access with LOWER() function"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"PRIORITY 2"}),": Other metadata fields (image, etc.)"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Moderate performance with direct column access"}),"\n",(0,r.jsx)(n.li,{children:"No indexes but faster than JSON search"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"PRIORITY 3"}),": JSON object search"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Comprehensive fallback using JSON_SEARCH()"}),"\n",(0,r.jsx)(n.li,{children:"Slowest but ensures complete search coverage"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Performance Impact"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Dramatic improvement in search response times"}),"\n",(0,r.jsx)(n.li,{children:"Leverages database indexes for common searches"}),"\n",(0,r.jsx)(n.li,{children:"Maintains comprehensive search coverage"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"performance-expected-improvements",children:"Performance Expected Improvements"}),"\n",(0,r.jsx)(n.h4,{id:"search-performance",children:"Search Performance"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Metadata searches"}),": 10-50x improvement using indexes"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Full-text searches"}),": 3-10x improvement with prioritized strategy"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Complex searches"}),": 5-15x improvement with composite indexes"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"schema-loading-performance",children:"Schema Loading Performance"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Individual schemas"}),": 5-10x improvement with caching"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Batch schema loading"}),": 10-20x improvement with bulk operations"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Schema-dependent operations"}),": Consistent sub-millisecond performance"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/docs/development/ollama",children:"Ollama Setup"})," - Ollama configuration and GPU setup"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/docs/technical/vectorization#vector-search-backends",children:"Vector Search Backends"})," - Vector search backend options"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/docs/development/search-optimization",children:"Search Optimization"})," - Detailed search optimization guide"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}}}]);