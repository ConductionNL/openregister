"use strict";(self.webpackChunkopen_catalogi_docs=self.webpackChunkopen_catalogi_docs||[]).push([[6513],{28453:(e,n,i)=>{i.d(n,{R:()=>s,x:()=>d});var r=i(96540);const t={},l=r.createContext(t);function s(e){const n=r.useContext(l);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:s(e.components),r.createElement(l.Provider,{value:n},e.children)}},53195:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>d,default:()=>h,frontMatter:()=>s,metadata:()=>r,toc:()=>o});const r=JSON.parse('{"id":"technical/import-export-implementation","title":"Import/Export Implementation","description":"This document describes the technical implementation of the import/export functionality in OpenRegister.","source":"@site/docs/technical/import-export-implementation.md","sourceDirName":"technical","slug":"/technical/import-export-implementation","permalink":"/docs/technical/import-export-implementation","draft":false,"unlisted":false,"editUrl":"https://github.com/conductionnl/openregister/tree/main/website/docs/technical/import-export-implementation.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"File Processing: Supported Formats and Limits","permalink":"/docs/technical/file-processing-formats"},"next":{"title":"Import and Export","permalink":"/docs/technical/import-export"}}');var t=i(74848),l=i(28453);const s={},d="Import/Export Implementation",a={},o=[{value:"Overview",id:"overview",level:2},{value:"Export Service Implementation",id:"export-service-implementation",level:2},{value:"Class: <code>ExportService</code>",id:"class-exportservice",level:3},{value:"Key Methods",id:"key-methods",level:4},{value:"<code>exportToExcel()</code>",id:"exporttoexcel",level:5},{value:"<code>getHeaders()</code>",id:"getheaders",level:5},{value:"<code>getObjectValue()</code>",id:"getobjectvalue",level:5},{value:"Metadata Field Handling",id:"metadata-field-handling",level:4},{value:"Available Metadata Fields",id:"available-metadata-fields",level:4},{value:"Import Service Implementation",id:"import-service-implementation",level:2},{value:"Class: <code>ImportService</code>",id:"class-importservice",level:3},{value:"Key Methods",id:"key-methods-1",level:4},{value:"<code>importFromExcel()</code>",id:"importfromexcel",level:5},{value:"<code>processSpreadsheet()</code>",id:"processspreadsheet",level:5},{value:"<code>parseArrayFromString()</code>",id:"parsearrayfromstring",level:5},{value:"Metadata Column Filtering",id:"metadata-column-filtering",level:4},{value:"Data Flow",id:"data-flow",level:2},{value:"Export Flow",id:"export-flow",level:3},{value:"Import Flow",id:"import-flow",level:3},{value:"Column Structure",id:"column-structure",level:2},{value:"Export Column Order",id:"export-column-order",level:3},{value:"Example Export Structure",id:"example-export-structure",level:3},{value:"Error Handling",id:"error-handling",level:2},{value:"Export Errors",id:"export-errors",level:3},{value:"Import Errors",id:"import-errors",level:3},{value:"Performance Considerations",id:"performance-considerations",level:2},{value:"Export Optimizations",id:"export-optimizations",level:3},{value:"Import Optimizations",id:"import-optimizations",level:3},{value:"Security Considerations",id:"security-considerations",level:2},{value:"Export Security",id:"export-security",level:3},{value:"Import Security",id:"import-security",level:3},{value:"Testing",id:"testing",level:2},{value:"Unit Tests",id:"unit-tests",level:3},{value:"Integration Tests",id:"integration-tests",level:3},{value:"Future Enhancements",id:"future-enhancements",level:2},{value:"Planned Features",id:"planned-features",level:3},{value:"Technical Improvements",id:"technical-improvements",level:3}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"importexport-implementation",children:"Import/Export Implementation"})}),"\n",(0,t.jsx)(n.p,{children:"This document describes the technical implementation of the import/export functionality in OpenRegister."}),"\n",(0,t.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,t.jsx)(n.p,{children:"The import/export system consists of two main services:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"ExportService"}),": Handles data export to Excel and CSV formats"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"ImportService"}),": Handles data import from Excel and CSV formats"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"export-service-implementation",children:"Export Service Implementation"}),"\n",(0,t.jsxs)(n.h3,{id:"class-exportservice",children:["Class: ",(0,t.jsx)(n.code,{children:"ExportService"})]}),"\n",(0,t.jsxs)(n.p,{children:["Located in ",(0,t.jsx)(n.code,{children:"lib/Service/ExportService.php"})]}),"\n",(0,t.jsx)(n.h4,{id:"key-methods",children:"Key Methods"}),"\n",(0,t.jsx)(n.h5,{id:"exporttoexcel",children:(0,t.jsx)(n.code,{children:"exportToExcel()"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Creates a new PhpSpreadsheet instance"}),"\n",(0,t.jsx)(n.li,{children:"Handles both single schema and multi-schema exports"}),"\n",(0,t.jsx)(n.li,{children:"Returns a Spreadsheet object ready for download"}),"\n"]}),"\n",(0,t.jsx)(n.h5,{id:"getheaders",children:(0,t.jsx)(n.code,{children:"getHeaders()"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Generates column headers for export"}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Column Order"}),":","\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"id"})," (always first column)"]}),"\n",(0,t.jsx)(n.li,{children:"Schema properties (in schema order)"}),"\n",(0,t.jsxs)(n.li,{children:["Metadata fields with ",(0,t.jsx)(n.code,{children:"_"})," prefix (at the end)"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h5,{id:"getobjectvalue",children:(0,t.jsx)(n.code,{children:"getObjectValue()"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Retrieves values from ObjectEntity objects"}),"\n",(0,t.jsx)(n.li,{children:"Handles both regular fields and metadata fields"}),"\n",(0,t.jsx)(n.li,{children:"Uses reflection to dynamically call getter methods"}),"\n",(0,t.jsx)(n.li,{children:"Converts complex types (arrays, objects) to JSON strings"}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"metadata-field-handling",children:"Metadata Field Handling"}),"\n",(0,t.jsx)(n.p,{children:"Metadata fields are automatically included in exports with the following characteristics:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Prefix"}),": All metadata fields are prefixed with ",(0,t.jsx)(n.code,{children:"_"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Position"}),": Placed at the end of the export"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Types"}),": Handles DateTime, arrays, objects, and scalar values"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Null Safety"}),": Gracefully handles null values"]}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"available-metadata-fields",children:"Available Metadata Fields"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"$metadataFields = [\n    'created',\n    'updated', \n    'published',\n    'depublished',\n    'deleted',\n    'locked',\n    'owner',\n    'organisation',\n    'application',\n    'folder',\n    'size',\n    'version',\n    'schemaVersion',\n    'uri',\n    'register',\n    'schema',\n    'name',\n    'description',\n    'validation',\n    'geo',\n    'retention',\n    'authorization',\n    'groups',\n];\n"})}),"\n",(0,t.jsx)(n.h2,{id:"import-service-implementation",children:"Import Service Implementation"}),"\n",(0,t.jsxs)(n.h3,{id:"class-importservice",children:["Class: ",(0,t.jsx)(n.code,{children:"ImportService"})]}),"\n",(0,t.jsxs)(n.p,{children:["Located in ",(0,t.jsx)(n.code,{children:"lib/Service/ImportService.php"})]}),"\n",(0,t.jsx)(n.h4,{id:"key-methods-1",children:"Key Methods"}),"\n",(0,t.jsx)(n.h5,{id:"importfromexcel",children:(0,t.jsx)(n.code,{children:"importFromExcel()"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Loads Excel files using PhpSpreadsheet"}),"\n",(0,t.jsx)(n.li,{children:"Supports multi-schema imports (one sheet per schema)"}),"\n",(0,t.jsx)(n.li,{children:"Returns detailed import summary"}),"\n"]}),"\n",(0,t.jsx)(n.h5,{id:"processspreadsheet",children:(0,t.jsx)(n.code,{children:"processSpreadsheet()"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Processes individual spreadsheet sheets"}),"\n",(0,t.jsx)(n.li,{children:"Validates headers against schema properties"}),"\n",(0,t.jsx)(n.li,{children:"Handles data type conversion and array parsing"}),"\n"]}),"\n",(0,t.jsx)(n.h5,{id:"parsearrayfromstring",children:(0,t.jsx)(n.code,{children:"parseArrayFromString()"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Converts string representations to arrays"}),"\n",(0,t.jsx)(n.li,{children:"Supports JSON arrays, comma-separated values, and quoted values"}),"\n",(0,t.jsx)(n.li,{children:"Includes memory management for large datasets"}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"metadata-column-filtering",children:"Metadata Column Filtering"}),"\n",(0,t.jsx)(n.p,{children:"The import service automatically filters out metadata columns:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"// Skip metadata columns (headers starting with _)\nif (str_starts_with($header, '_')) {\n    continue;\n}\n"})}),"\n",(0,t.jsx)(n.p,{children:"This ensures that:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"System metadata is not modified during import"}),"\n",(0,t.jsx)(n.li,{children:"Only schema-defined properties are processed"}),"\n",(0,t.jsx)(n.li,{children:"Import integrity is maintained"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"data-flow",children:"Data Flow"}),"\n",(0,t.jsx)(n.h3,{id:"export-flow",children:"Export Flow"}),"\n",(0,t.jsx)(n.mermaid,{value:"graph TD\n    A[User Request Export] --\x3e B[ExportService.exportToExcel]\n    B --\x3e C[getHeaders - Generate Column Structure]\n    C --\x3e D[id Column First]\n    D --\x3e E[Schema Properties]\n    E --\x3e F[Metadata Fields with _ prefix]\n    F --\x3e G[populateSheet - Write Data]\n    G --\x3e H[getObjectValue - Extract Values]\n    H --\x3e I[convertValueToString - Format Data]\n    I --\x3e J[Return Spreadsheet]"}),"\n",(0,t.jsx)(n.h3,{id:"import-flow",children:"Import Flow"}),"\n",(0,t.jsx)(n.mermaid,{value:"graph TD\n    A[User Upload File] --\x3e B[ImportService.importFromExcel]\n    B --\x3e C[Load Spreadsheet]\n    C --\x3e D[Extract Headers]\n    D --\x3e E[Filter Metadata Columns]\n    E --\x3e F[Process Each Row]\n    F --\x3e G[Validate Against Schema]\n    G --\x3e H[Parse Arrays if Needed]\n    H --\x3e I[Save via ObjectService]\n    I --\x3e J[Return Summary]"}),"\n",(0,t.jsx)(n.h2,{id:"column-structure",children:"Column Structure"}),"\n",(0,t.jsx)(n.h3,{id:"export-column-order",children:"Export Column Order"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"Column A: id (UUID)\nColumns B-N: Schema properties (naam, website, type, etc.)\nColumns N+1 onwards: Metadata fields (_created, _updated, etc.)\n"})}),"\n",(0,t.jsx)(n.h3,{id:"example-export-structure",children:"Example Export Structure"}),"\n",(0,t.jsxs)(n.p,{children:["For a schema with properties ",(0,t.jsx)(n.code,{children:"naam"}),", ",(0,t.jsx)(n.code,{children:"website"}),", ",(0,t.jsx)(n.code,{children:"type"}),":"]}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"id"}),(0,t.jsx)(n.th,{children:"naam"}),(0,t.jsx)(n.th,{children:"website"}),(0,t.jsx)(n.th,{children:"type"}),(0,t.jsx)(n.th,{children:"_created"}),(0,t.jsx)(n.th,{children:"_updated"}),(0,t.jsx)(n.th,{children:"_owner"}),(0,t.jsx)(n.th,{children:"_organisation"})]})}),(0,t.jsx)(n.tbody,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"uuid-1"}),(0,t.jsx)(n.td,{children:"Test Org"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.a,{href:"https://example.com",children:"https://example.com"})}),(0,t.jsx)(n.td,{children:"Leverancier"}),(0,t.jsx)(n.td,{children:"2024-01-01 10:00:00"}),(0,t.jsx)(n.td,{children:"2024-01-01 10:00:00"}),(0,t.jsx)(n.td,{children:"admin"}),(0,t.jsx)(n.td,{children:"Test Org"})]})})]}),"\n",(0,t.jsx)(n.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,t.jsx)(n.h3,{id:"export-errors",children:"Export Errors"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Invalid schema references"}),"\n",(0,t.jsx)(n.li,{children:"Missing object data"}),"\n",(0,t.jsx)(n.li,{children:"File system permissions"}),"\n",(0,t.jsx)(n.li,{children:"Memory limits for large datasets"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"import-errors",children:"Import Errors"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Invalid file format"}),"\n",(0,t.jsx)(n.li,{children:"Missing required fields"}),"\n",(0,t.jsx)(n.li,{children:"Schema validation failures"}),"\n",(0,t.jsx)(n.li,{children:"Duplicate object detection"}),"\n",(0,t.jsx)(n.li,{children:"Memory management for large files"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"performance-considerations",children:"Performance Considerations"}),"\n",(0,t.jsx)(n.h3,{id:"export-optimizations",children:"Export Optimizations"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Lazy loading of object data"}),"\n",(0,t.jsx)(n.li,{children:"Streaming for large datasets"}),"\n",(0,t.jsx)(n.li,{children:"Memory-efficient value conversion"}),"\n",(0,t.jsx)(n.li,{children:"Batch processing for multiple schemas"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"import-optimizations",children:"Import Optimizations"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Memory management with garbage collection"}),"\n",(0,t.jsx)(n.li,{children:"Duplicate detection to prevent loops"}),"\n",(0,t.jsx)(n.li,{children:"Batch processing of rows"}),"\n",(0,t.jsx)(n.li,{children:"Error recovery and continuation"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"security-considerations",children:"Security Considerations"}),"\n",(0,t.jsx)(n.h3,{id:"export-security",children:"Export Security"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Validate user permissions before export"}),"\n",(0,t.jsx)(n.li,{children:"Sanitize sensitive data in metadata fields"}),"\n",(0,t.jsx)(n.li,{children:"Limit export size to prevent DoS attacks"}),"\n",(0,t.jsx)(n.li,{children:"Audit export activities"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"import-security",children:"Import Security"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Validate file types and content"}),"\n",(0,t.jsx)(n.li,{children:"Sanitize imported data"}),"\n",(0,t.jsx)(n.li,{children:"Prevent code injection in array parsing"}),"\n",(0,t.jsx)(n.li,{children:"Rate limiting for import operations"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"testing",children:"Testing"}),"\n",(0,t.jsx)(n.h3,{id:"unit-tests",children:"Unit Tests"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Test individual service methods"}),"\n",(0,t.jsx)(n.li,{children:"Mock ObjectEntity and Schema objects"}),"\n",(0,t.jsx)(n.li,{children:"Test error conditions and edge cases"}),"\n",(0,t.jsx)(n.li,{children:"Validate column structure and data types"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"integration-tests",children:"Integration Tests"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Test full export/import cycles"}),"\n",(0,t.jsx)(n.li,{children:"Validate data integrity across operations"}),"\n",(0,t.jsx)(n.li,{children:"Test multi-schema scenarios"}),"\n",(0,t.jsx)(n.li,{children:"Performance testing with large datasets"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"future-enhancements",children:"Future Enhancements"}),"\n",(0,t.jsx)(n.h3,{id:"planned-features",children:"Planned Features"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Support for additional file formats (XML, YAML)"}),"\n",(0,t.jsx)(n.li,{children:"Incremental export/import"}),"\n",(0,t.jsx)(n.li,{children:"Delta synchronization"}),"\n",(0,t.jsx)(n.li,{children:"Advanced filtering and selection"}),"\n",(0,t.jsx)(n.li,{children:"Export templates and customization"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"technical-improvements",children:"Technical Improvements"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Async processing for large datasets"}),"\n",(0,t.jsx)(n.li,{children:"Compression for export files"}),"\n",(0,t.jsx)(n.li,{children:"Caching for frequently accessed data"}),"\n",(0,t.jsx)(n.li,{children:"Enhanced error reporting and recovery"}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}}}]);