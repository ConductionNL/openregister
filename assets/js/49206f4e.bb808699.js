"use strict";(self.webpackChunkopen_catalogi_docs=self.webpackChunkopen_catalogi_docs||[]).push([[7545],{28453:(e,n,i)=>{i.d(n,{R:()=>c,x:()=>l});var s=i(96540);const r={},t=s.createContext(r);function c(e){const n=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),s.createElement(t.Provider,{value:n},e.children)}},28849:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>c,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"Features/access-control","title":"Acces Control","description":"An overview of how core concepts in Open Register interact with each other.","source":"@site/docs/Features/access-control.md","sourceDirName":"Features","slug":"/Features/access-control","permalink":"/docs/Features/access-control","draft":false,"unlisted":false,"editUrl":"https://github.com/conductionnl/openregister/tree/main/website/docs/Features/access-control.md","tags":[],"version":"current","sidebarPosition":7,"frontMatter":{"title":"Acces Control","sidebar_position":7,"description":"An overview of how core concepts in Open Register interact with each other.","keywords":["Open Register","Core Concepts","Relationships"]},"sidebar":"tutorialSidebar","previous":{"title":"Files","permalink":"/docs/Features/files"},"next":{"title":"Enhanced Validation Errors","permalink":"/docs/Features/enhanced-validation-errors"}}');var r=i(74848),t=i(28453);const c={title:"Acces Control",sidebar_position:7,description:"An overview of how core concepts in Open Register interact with each other.",keywords:["Open Register","Core Concepts","Relationships"]},l="Access Control",o={},a=[{value:"Overview",id:"overview",level:2},{value:"Permission Levels",id:"permission-levels",level:2},{value:"Permission Types",id:"permission-types",level:2},{value:"Implementation",id:"implementation",level:2},{value:"Technical Implementation",id:"technical-implementation",level:2},{value:"Architecture Overview",id:"architecture-overview",level:3},{value:"Authorization Flow",id:"authorization-flow",level:3},{value:"Schema Authorization Configuration",id:"schema-authorization-configuration",level:3},{value:"Authorization Exception System",id:"authorization-exception-system",level:3},{value:"RBAC Query Filtering Process",id:"rbac-query-filtering-process",level:3},{value:"Database Schema",id:"database-schema",level:3},{value:"Permission Resolution Algorithm",id:"permission-resolution-algorithm",level:3},{value:"Code Examples",id:"code-examples",level:3},{value:"Schema Authorization Configuration",id:"schema-authorization-configuration-1",level:4},{value:"Creating Authorization Exceptions",id:"creating-authorization-exceptions",level:4},{value:"RBAC Query Filtering (MagicMapper)",id:"rbac-query-filtering-magicmapper",level:4},{value:"Object-Level Authorization",id:"object-level-authorization",level:4},{value:"RBAC Configuration",id:"rbac-configuration",level:3},{value:"Performance Optimizations",id:"performance-optimizations",level:3},{value:"Integration Points",id:"integration-points",level:3},{value:"1. ObjectEntityMapper",id:"1-objectentitymapper",level:4},{value:"2. MagicMapper (Dynamic Tables)",id:"2-magicmapper-dynamic-tables",level:4},{value:"3. Solr Search",id:"3-solr-search",level:4},{value:"4. API Controllers",id:"4-api-controllers",level:4},{value:"Best Practices",id:"best-practices",level:3},{value:"Debugging &amp; Monitoring",id:"debugging--monitoring",level:3},{value:"Enable Debug Logging",id:"enable-debug-logging",level:4},{value:"Check Authorization Config",id:"check-authorization-config",level:4},{value:"Query Authorization Exceptions",id:"query-authorization-exceptions",level:4},{value:"Security Considerations",id:"security-considerations",level:3},{value:"Future Enhancements",id:"future-enhancements",level:3}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"access-control",children:"Access Control"})}),"\n",(0,r.jsx)(n.p,{children:"Access Control provides enterprise-grade permissions management through integration with Nextcloud RBAC (Role-Based Access Control) and Keycloak."}),"\n",(0,r.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsx)(n.p,{children:"The access control system integrates with:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"ADFS (Active Directory Federation Services) for user and group management via Keycloak"}),"\n",(0,r.jsx)(n.li,{children:"Nextcloud RBAC for role-based permissions"}),"\n",(0,r.jsx)(n.li,{children:"FCS (Federal Cloud Services) compliance requirements"}),"\n",(0,r.jsx)(n.li,{children:"Verwerkingen registers for process tracking"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"permission-levels",children:"Permission Levels"}),"\n",(0,r.jsx)(n.p,{children:"Access can be controlled at multiple levels:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Register level - Control access to entire registers"}),"\n",(0,r.jsx)(n.li,{children:"Schema level - Manage permissions for specific register/schema combinations"}),"\n",(0,r.jsx)(n.li,{children:"Object level - Set permissions on individual objects"}),"\n",(0,r.jsx)(n.li,{children:"Property level - Fine-grained control over specific object properties"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"permission-types",children:"Permission Types"}),"\n",(0,r.jsx)(n.p,{children:"Permissions are granted through:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"User Rights"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"CRUD (Create, Read, Update, Delete) operations"}),"\n",(0,r.jsx)(n.li,{children:"Inherited from ADFS groups via Keycloak"}),"\n",(0,r.jsx)(n.li,{children:"Role-based access control through Nextcloud"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Contract Rights"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Application-level permissions"}),"\n",(0,r.jsx)(n.li,{children:"Process-specific authorizations"}),"\n",(0,r.jsx)(n.li,{children:"Compliance with FCS requirements"}),"\n",(0,r.jsx)(n.li,{children:"Integration with verwerkingen registers"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"implementation",children:"Implementation"}),"\n",(0,r.jsx)(n.p,{children:"Access control is implemented through:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"User Authentication"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Direct integration with Keycloak for identity management"}),"\n",(0,r.jsx)(n.li,{children:"ADFS synchronization for user and group information"}),"\n",(0,r.jsx)(n.li,{children:"Single Sign-On (SSO) capabilities"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Permission Management"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"CRUD-level permissions for all system entities"}),"\n",(0,r.jsx)(n.li,{children:"Hierarchical permission inheritance"}),"\n",(0,r.jsx)(n.li,{children:"Fine-grained access control at multiple levels"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Process Integration"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Compliance with FCS guidelines"}),"\n",(0,r.jsx)(n.li,{children:"Integration with verwerkingen registers for process tracking"}),"\n",(0,r.jsx)(n.li,{children:"Application-specific permission contracts"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"technical-implementation",children:"Technical Implementation"}),"\n",(0,r.jsx)(n.h3,{id:"architecture-overview",children:"Architecture Overview"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-mermaid",children:'graph TB\n    subgraph "Authentication Layer"\n        KC[Keycloak/ADFS]\n        NC[Nextcloud User Session]\n        UM[User Manager]\n        GM[Group Manager]\n    end\n    \n    subgraph "Authorization Layer"\n        RBAC[RBAC Handler]\n        AUTH[Authorization Config]\n        EXCEPT[Authorization Exceptions]\n    end\n    \n    subgraph "Data Access Layer"\n        OBJ[Object Mapper]\n        SCHEMA[Schema Mapper]\n        REG[Register Mapper]\n        MAGIC[MagicMapper]\n    end\n    \n    subgraph "Search Layer"\n        SOLR[Solr Service]\n        FACET[Facet Service]\n    end\n    \n    KC --\x3e NC\n    NC --\x3e UM\n    NC --\x3e GM\n    \n    UM --\x3e RBAC\n    GM --\x3e RBAC\n    AUTH --\x3e RBAC\n    EXCEPT --\x3e RBAC\n    \n    RBAC --\x3e OBJ\n    RBAC --\x3e MAGIC\n    RBAC --\x3e SOLR\n    \n    SCHEMA --\x3e OBJ\n    SCHEMA --\x3e MAGIC\n    REG --\x3e OBJ\n    \n    OBJ --\x3e FACET\n    SOLR --\x3e FACET\n    \n    style RBAC fill:#4A90E2\n    style AUTH fill:#50E3C2\n    style EXCEPT fill:#F5A623\n'})}),"\n",(0,r.jsx)(n.h3,{id:"authorization-flow",children:"Authorization Flow"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-mermaid",children:"sequenceDiagram\n    participant User\n    participant API\n    participant RBAC\n    participant UM as User Manager\n    participant GM as Group Manager\n    participant Schema\n    participant AuthExcept as Authorization Exceptions\n    participant DB as Database\n    \n    User->>API: Request Object\n    API->>RBAC: Check Permissions\n    RBAC->>UM: Get User ID\n    UM--\x3e>RBAC: User ID\n    \n    RBAC->>GM: Get User Groups\n    GM--\x3e>RBAC: [group1, group2, ...]\n    \n    RBAC->>Schema: Get Authorization Config\n    Schema--\x3e>RBAC: Authorization Rules\n    \n    RBAC->>AuthExcept: Check Exceptions\n    AuthExcept--\x3e>RBAC: Inclusions/Exclusions\n    \n    RBAC->>RBAC: Apply Permission Rules\n    \n    alt Admin Override Enabled && User is Admin\n        RBAC--\x3e>API: Full Access Granted\n    else User is Owner\n        RBAC--\x3e>API: Access Granted\n    else User's Group in Read Permissions\n        RBAC--\x3e>API: Access Granted\n    else Public Access Configured\n        RBAC--\x3e>API: Access Granted\n    else No Access\n        RBAC--\x3e>API: Access Denied\n    end\n    \n    alt Access Granted\n        API->>DB: Fetch Object\n        DB--\x3e>API: Object Data\n        API--\x3e>User: Return Object\n    else Access Denied\n        API--\x3e>User: 403 Forbidden\n    end\n"})}),"\n",(0,r.jsx)(n.h3,{id:"schema-authorization-configuration",children:"Schema Authorization Configuration"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-mermaid",children:'graph TB\n    subgraph "Schema Authorization Object"\n        CONFIG[Authorization Config]\n        CREATE[Create Permissions]\n        READ[Read Permissions]\n        UPDATE[Update Permissions]\n        DELETE[Delete Permissions]\n    end\n    \n    subgraph "Permission Targets"\n        USERS[User IDs]\n        GROUPS[Group IDs]\n        PUBLIC[Public Access]\n    end\n    \n    subgraph "Access Control Evaluation"\n        OWNER[Owner Check]\n        GROUP[Group Membership]\n        EXCEPTION[Exception Override]\n        ADMIN[Admin Override]\n    end\n    \n    CONFIG --\x3e CREATE\n    CONFIG --\x3e READ\n    CONFIG --\x3e UPDATE\n    CONFIG --\x3e DELETE\n    \n    CREATE --\x3e USERS\n    CREATE --\x3e GROUPS\n    CREATE --\x3e PUBLIC\n    \n    READ --\x3e USERS\n    READ --\x3e GROUPS\n    READ --\x3e PUBLIC\n    \n    UPDATE --\x3e USERS\n    UPDATE --\x3e GROUPS\n    UPDATE --\x3e PUBLIC\n    \n    DELETE --\x3e USERS\n    DELETE --\x3e GROUPS\n    DELETE --\x3e PUBLIC\n    \n    USERS --\x3e OWNER\n    GROUPS --\x3e GROUP\n    OWNER --\x3e EXCEPTION\n    GROUP --\x3e EXCEPTION\n    EXCEPTION --\x3e ADMIN\n    \n    style CONFIG fill:#4A90E2\n    style EXCEPTION fill:#F5A623\n    style ADMIN fill:#E74C3C\n'})}),"\n",(0,r.jsx)(n.h3,{id:"authorization-exception-system",children:"Authorization Exception System"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-mermaid",children:'graph TB\n    subgraph "Exception Types"\n        INCL[Inclusion Exception]\n        EXCL[Exclusion Exception]\n    end\n    \n    subgraph "Subject Types"\n        UEXC[User Exception]\n        GEXC[Group Exception]\n    end\n    \n    subgraph "Scope"\n        GLOBAL[Global Scope]\n        ORG[Organisation Scope]\n        REG[Register Scope]\n        SCHEMA[Schema Scope]\n    end\n    \n    subgraph "Actions"\n        ACREATE[Create]\n        AREAD[Read]\n        AUPDATE[Update]\n        ADELETE[Delete]\n    end\n    \n    subgraph "Resolution"\n        PRIORITY[Priority Sorting]\n        MATCH[Match Criteria]\n        ACTIVE[Active Status Check]\n        APPLY[Apply Exception]\n    end\n    \n    INCL --\x3e UEXC\n    INCL --\x3e GEXC\n    EXCL --\x3e UEXC\n    EXCL --\x3e GEXC\n    \n    UEXC --\x3e GLOBAL\n    UEXC --\x3e ORG\n    UEXC --\x3e REG\n    UEXC --\x3e SCHEMA\n    \n    GEXC --\x3e GLOBAL\n    GEXC --\x3e ORG\n    GEXC --\x3e REG\n    GEXC --\x3e SCHEMA\n    \n    GLOBAL --\x3e ACREATE\n    GLOBAL --\x3e AREAD\n    GLOBAL --\x3e AUPDATE\n    GLOBAL --\x3e ADELETE\n    \n    ACREATE --\x3e PRIORITY\n    AREAD --\x3e PRIORITY\n    AUPDATE --\x3e PRIORITY\n    ADELETE --\x3e PRIORITY\n    \n    PRIORITY --\x3e MATCH\n    MATCH --\x3e ACTIVE\n    ACTIVE --\x3e APPLY\n    \n    style INCL fill:#50E3C2\n    style EXCL fill:#E74C3C\n    style PRIORITY fill:#F5A623\n'})}),"\n",(0,r.jsx)(n.h3,{id:"rbac-query-filtering-process",children:"RBAC Query Filtering Process"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-mermaid",children:"sequenceDiagram\n    participant QB as Query Builder\n    participant RBAC as RBAC Handler\n    participant US as User Session\n    participant GM as Group Manager\n    participant Schema\n    participant AuthExcept as Authorization Exceptions\n    \n    QB->>RBAC: applyRbacFilters()\n    \n    alt RBAC Disabled\n        RBAC--\x3e>QB: No Filtering\n    end\n    \n    RBAC->>US: Get Current User\n    \n    alt User Not Authenticated\n        RBAC->>Schema: Get Authorization Config\n        Schema--\x3e>RBAC: Config\n        RBAC->>RBAC: Check Public Access\n        alt Public Access Granted\n            RBAC--\x3e>QB: No Filtering\n        else Public Access Denied\n            RBAC--\x3e>QB: Restrict to Published Objects\n        end\n    end\n    \n    US--\x3e>RBAC: User ID\n    RBAC->>GM: Get User Groups\n    GM--\x3e>RBAC: [admin, group1, group2]\n    \n    alt Admin Override Enabled && User in Admin Group\n        RBAC--\x3e>QB: No Filtering (Full Access)\n    end\n    \n    RBAC->>Schema: Get Authorization Config\n    Schema--\x3e>RBAC: Authorization Rules\n    \n    alt No Authorization Config\n        RBAC--\x3e>QB: No Filtering (Open Access)\n    end\n    \n    RBAC->>RBAC: Build Read Conditions\n    \n    Note over RBAC: Condition 1: User is Owner\n    Note over RBAC: Condition 2: User's Group in Read Perms\n    Note over RBAC: Condition 3: Public Read Access\n    \n    RBAC->>AuthExcept: Check Exceptions\n    AuthExcept--\x3e>RBAC: Apply Inclusions/Exclusions\n    \n    RBAC--\x3e>QB: Apply WHERE Conditions\n"})}),"\n",(0,r.jsx)(n.h3,{id:"database-schema",children:"Database Schema"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsxs)(n.strong,{children:["Authorization Exception Table: ",(0,r.jsx)(n.code,{children:"oc_openregister_authorization_exceptions"})]})}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Column"}),(0,r.jsx)(n.th,{children:"Type"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"id"})}),(0,r.jsx)(n.td,{children:"INTEGER"}),(0,r.jsx)(n.td,{children:"Primary key"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"uuid"})}),(0,r.jsx)(n.td,{children:"VARCHAR(36)"}),(0,r.jsx)(n.td,{children:"Unique identifier"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"type"})}),(0,r.jsx)(n.td,{children:"VARCHAR(20)"}),(0,r.jsxs)(n.td,{children:["Exception type: ",(0,r.jsx)(n.code,{children:"inclusion"})," or ",(0,r.jsx)(n.code,{children:"exclusion"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"subject_type"})}),(0,r.jsx)(n.td,{children:"VARCHAR(20)"}),(0,r.jsxs)(n.td,{children:["Subject type: ",(0,r.jsx)(n.code,{children:"user"})," or ",(0,r.jsx)(n.code,{children:"group"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"subject_id"})}),(0,r.jsx)(n.td,{children:"VARCHAR(255)"}),(0,r.jsx)(n.td,{children:"User ID or Group ID"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"schema_uuid"})}),(0,r.jsx)(n.td,{children:"VARCHAR(36)"}),(0,r.jsx)(n.td,{children:"Schema UUID (nullable for global)"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"register_uuid"})}),(0,r.jsx)(n.td,{children:"VARCHAR(36)"}),(0,r.jsx)(n.td,{children:"Register UUID (nullable)"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"organization_uuid"})}),(0,r.jsx)(n.td,{children:"VARCHAR(36)"}),(0,r.jsx)(n.td,{children:"Organisation UUID (nullable)"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"action"})}),(0,r.jsx)(n.td,{children:"VARCHAR(20)"}),(0,r.jsxs)(n.td,{children:["CRUD action: ",(0,r.jsx)(n.code,{children:"create"}),", ",(0,r.jsx)(n.code,{children:"read"}),", ",(0,r.jsx)(n.code,{children:"update"}),", ",(0,r.jsx)(n.code,{children:"delete"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"priority"})}),(0,r.jsx)(n.td,{children:"INTEGER"}),(0,r.jsx)(n.td,{children:"Priority for resolution (higher = more important)"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"active"})}),(0,r.jsx)(n.td,{children:"BOOLEAN"}),(0,r.jsx)(n.td,{children:"Whether exception is active"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"description"})}),(0,r.jsx)(n.td,{children:"TEXT"}),(0,r.jsx)(n.td,{children:"Human-readable description"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"created_by"})}),(0,r.jsx)(n.td,{children:"VARCHAR(255)"}),(0,r.jsx)(n.td,{children:"User who created the exception"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"created_at"})}),(0,r.jsx)(n.td,{children:"DATETIME"}),(0,r.jsx)(n.td,{children:"Creation timestamp"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"updated_at"})}),(0,r.jsx)(n.td,{children:"DATETIME"}),(0,r.jsx)(n.td,{children:"Last update timestamp"})]})]})]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Schema Authorization Field:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Stored in ",(0,r.jsx)(n.code,{children:"oc_openregister_schemas.authorization"})," (JSON)"]}),"\n",(0,r.jsx)(n.li,{children:"Format:"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "create": ["admin", "editors"],\n  "read": ["admin", "editors", "viewers", "public"],\n  "update": ["admin", "editors"],\n  "delete": ["admin"]\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Object Authorization Field:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Stored in ",(0,r.jsx)(n.code,{children:"oc_openregister_objects.authorization"})," (JSON)"]}),"\n",(0,r.jsx)(n.li,{children:"Inherits from schema but can be overridden per-object"}),"\n",(0,r.jsx)(n.li,{children:"Same format as schema authorization"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"permission-resolution-algorithm",children:"Permission Resolution Algorithm"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-mermaid",children:"graph TB\n    START[Permission Check Request]\n    \n    START --\x3e RBAC_ENABLED{RBAC Enabled?}\n    RBAC_ENABLED --\x3e|No| ALLOW[Allow Access]\n    RBAC_ENABLED --\x3e|Yes| USER_AUTH{User Authenticated?}\n    \n    USER_AUTH --\x3e|No| PUBLIC_CHECK{Public Access?}\n    PUBLIC_CHECK --\x3e|Yes| ALLOW\n    PUBLIC_CHECK --\x3e|No| DENY[Deny Access]\n    \n    USER_AUTH --\x3e|Yes| GET_USER[Get User & Groups]\n    GET_USER --\x3e ADMIN_CHECK{Admin Override && Is Admin?}\n    ADMIN_CHECK --\x3e|Yes| ALLOW\n    ADMIN_CHECK --\x3e|No| AUTH_CONFIG{Authorization Config Exists?}\n    \n    AUTH_CONFIG --\x3e|No| ALLOW\n    AUTH_CONFIG --\x3e|Yes| OWNER_CHECK{User is Owner?}\n    OWNER_CHECK --\x3e|Yes| EXCEPTION_CHECK\n    OWNER_CHECK --\x3e|No| GROUP_CHECK{User's Group in Permissions?}\n    \n    GROUP_CHECK --\x3e|Yes| EXCEPTION_CHECK\n    GROUP_CHECK --\x3e|No| PUBLIC_PERM{Public in Permissions?}\n    PUBLIC_PERM --\x3e|Yes| EXCEPTION_CHECK\n    PUBLIC_PERM --\x3e|No| DENY\n    \n    EXCEPTION_CHECK[Check Authorization Exceptions]\n    EXCEPTION_CHECK --\x3e EXCLUSION{Exclusion Match?}\n    EXCLUSION --\x3e|Yes| DENY\n    EXCLUSION --\x3e|No| INCLUSION{Inclusion Match?}\n    INCLUSION --\x3e|Yes| ALLOW\n    INCLUSION --\x3e|No| BASE_PERM{Base Permission Granted?}\n    \n    BASE_PERM --\x3e|Yes| ALLOW\n    BASE_PERM --\x3e|No| DENY\n    \n    style ALLOW fill:#50E3C2\n    style DENY fill:#E74C3C\n    style EXCEPTION_CHECK fill:#F5A623\n"})}),"\n",(0,r.jsx)(n.h3,{id:"code-examples",children:"Code Examples"}),"\n",(0,r.jsx)(n.h4,{id:"schema-authorization-configuration-1",children:"Schema Authorization Configuration"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"// Setting authorization on a schema\n$schema->setAuthorization([\n    'create' => ['admin', 'editors'],\n    'read' => ['admin', 'editors', 'viewers', 'public'],\n    'update' => ['admin', 'editors'],\n    'delete' => ['admin']\n]);\n\n// Checking if a user has permission\n$hasPermission = $schema->hasPermission('read', $userGroups);\n"})}),"\n",(0,r.jsx)(n.h4,{id:"creating-authorization-exceptions",children:"Creating Authorization Exceptions"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"use OCA\\OpenRegister\\Db\\AuthorizationException;\n\n// Create an inclusion exception (grant extra permission)\n$inclusion = new AuthorizationException();\n$inclusion->setType(AuthorizationException::TYPE_INCLUSION);\n$inclusion->setSubjectType(AuthorizationException::SUBJECT_TYPE_USER);\n$inclusion->setSubjectId('user123');\n$inclusion->setSchemaUuid($schemaUuid);\n$inclusion->setAction(AuthorizationException::ACTION_UPDATE);\n$inclusion->setPriority(10);\n$inclusion->setActive(true);\n$inclusion->setDescription('Allow user123 to update objects in this schema');\n\n// Create an exclusion exception (deny permission)\n$exclusion = new AuthorizationException();\n$exclusion->setType(AuthorizationException::TYPE_EXCLUSION);\n$exclusion->setSubjectType(AuthorizationException::SUBJECT_TYPE_GROUP);\n$exclusion->setSubjectId('restricted_group');\n$exclusion->setRegisterUuid($registerUuid);\n$exclusion->setAction(AuthorizationException::ACTION_DELETE);\n$exclusion->setPriority(20);\n$exclusion->setActive(true);\n$exclusion->setDescription('Prevent restricted_group from deleting objects in this register');\n\n// Check if an exception matches criteria\n$matches = $exception->matches(\n    subjectType: 'user',\n    subjectId: 'user123',\n    action: 'update',\n    schemaUuid: $schemaUuid\n);\n"})}),"\n",(0,r.jsx)(n.h4,{id:"rbac-query-filtering-magicmapper",children:"RBAC Query Filtering (MagicMapper)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"use OCA\\OpenRegister\\Service\\MagicMapperHandlers\\MagicRbacHandler;\n\n// Apply RBAC filters to a dynamic table query\n$rbacHandler->applyRbacFilters(\n    qb: $queryBuilder,\n    register: $register,\n    schema: $schema,\n    tableAlias: 't',\n    userId: $currentUserId,\n    rbac: true\n);\n\n// Check if current user is admin\n$isAdmin = $rbacHandler->isCurrentUserAdmin();\n\n// Get current user's groups\n$userGroups = $rbacHandler->getCurrentUserGroups();\n"})}),"\n",(0,r.jsx)(n.h4,{id:"object-level-authorization",children:"Object-Level Authorization"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"// Get object authorization (inherits from schema if not set)\n$objectAuth = $object->getAuthorization();\n\n// Override schema authorization for specific object\n$object->setAuthorization([\n    'read' => ['admin', 'special_viewers'],\n    'update' => ['admin']\n]);\n"})}),"\n",(0,r.jsx)(n.h3,{id:"rbac-configuration",children:"RBAC Configuration"}),"\n",(0,r.jsx)(n.p,{children:"RBAC can be configured in Nextcloud app settings:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "enabled": true,\n  "adminOverride": true\n}\n'})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"enabled"})}),": Master switch for RBAC system"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"adminOverride"})}),": Allow users in 'admin' group to bypass all RBAC checks"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"performance-optimizations",children:"Performance Optimizations"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Lazy Group Loading"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"User groups are only fetched when RBAC is enabled"}),"\n",(0,r.jsx)(n.li,{children:"Results are cached within the request lifecycle"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Admin Fast Path"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Admin users bypass permission checks entirely when override is enabled"}),"\n",(0,r.jsx)(n.li,{children:"Reduces database queries for administrative operations"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Query-Level Filtering"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"RBAC filters are applied at the database query level"}),"\n",(0,r.jsx)(n.li,{children:"Prevents loading unauthorized objects into memory"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Authorization Config Caching"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Schema authorization configs are cached with schema entities"}),"\n",(0,r.jsx)(n.li,{children:"Reduces redundant JSON parsing"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Exception Priority Indexing"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Database index on ",(0,r.jsx)(n.code,{children:"priority"})," field for fast exception sorting"]}),"\n",(0,r.jsxs)(n.li,{children:["Composite index on ",(0,r.jsx)(n.code,{children:"(subject_type, subject_id, action, active)"})," for fast matching"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"integration-points",children:"Integration Points"}),"\n",(0,r.jsx)(n.h4,{id:"1-objectentitymapper",children:"1. ObjectEntityMapper"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Applies RBAC filters to all object queries via ",(0,r.jsx)(n.code,{children:"findAll()"}),", ",(0,r.jsx)(n.code,{children:"find()"}),", ",(0,r.jsx)(n.code,{children:"count()"})]}),"\n",(0,r.jsxs)(n.li,{children:["Respects ",(0,r.jsx)(n.code,{children:"rbac"})," parameter (default: true)"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"2-magicmapper-dynamic-tables",children:"2. MagicMapper (Dynamic Tables)"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Uses ",(0,r.jsx)(n.code,{children:"MagicRbacHandler"})," for schema-specific table filtering"]}),"\n",(0,r.jsx)(n.li,{children:"Consistent security across schema-generated tables"}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"3-solr-search",children:"3. Solr Search"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["RBAC filtering applied via ",(0,r.jsx)(n.code,{children:"applyAdditionalFilters()"})," in ",(0,r.jsx)(n.code,{children:"GuzzleSolrService"})]}),"\n",(0,r.jsx)(n.li,{children:"Currently logs RBAC application but full implementation pending"}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"4-api-controllers",children:"4. API Controllers"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["RBAC checks in ",(0,r.jsx)(n.code,{children:"ObjectsController"}),", ",(0,r.jsx)(n.code,{children:"RegistersController"}),", ",(0,r.jsx)(n.code,{children:"SchemasController"})]}),"\n",(0,r.jsx)(n.li,{children:"Validates permissions before CRUD operations"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"best-practices",children:"Best Practices"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Use Schema-Level Authorization"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Define authorization at the schema level for consistency"}),"\n",(0,r.jsx)(n.li,{children:"Only override at object level when necessary"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Leverage Group-Based Permissions"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Use Nextcloud groups for role management"}),"\n",(0,r.jsx)(n.li,{children:"Avoid user-specific permissions unless absolutely required"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Authorization Exceptions as Last Resort"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Use exceptions sparingly for edge cases"}),"\n",(0,r.jsx)(n.li,{children:"Document the reason for each exception"}),"\n",(0,r.jsx)(n.li,{children:"Set appropriate priorities to avoid conflicts"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Test Permission Scenarios"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Test unauthenticated access"}),"\n",(0,r.jsx)(n.li,{children:"Test group membership changes"}),"\n",(0,r.jsx)(n.li,{children:"Test admin override behavior"}),"\n",(0,r.jsx)(n.li,{children:"Test exception priority resolution"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Monitor Authorization Exceptions"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Regularly audit active exceptions"}),"\n",(0,r.jsx)(n.li,{children:"Deactivate or delete obsolete exceptions"}),"\n",(0,r.jsx)(n.li,{children:"Review exception conflicts (overlapping priorities)"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"debugging--monitoring",children:"Debugging & Monitoring"}),"\n",(0,r.jsx)(n.h4,{id:"enable-debug-logging",children:"Enable Debug Logging"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"// In GuzzleSolrService\n$this->logger->debug('[SOLR] RBAC filtering applied');\n\n// In MagicRbacHandler\n$this->logger->debug('Applying RBAC filters', [\n    'user_id' => $userId,\n    'user_groups' => $userGroups,\n    'schema_uuid' => $schema->getUuid()\n]);\n"})}),"\n",(0,r.jsx)(n.h4,{id:"check-authorization-config",children:"Check Authorization Config"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# Query schema authorization\ndocker exec -u 33 master-nextcloud-1 php -r "\n\\$schema = \\OC::$server->get(\\OCA\\OpenRegister\\Db\\SchemaMapper::class)->find(1);\nvar_dump(\\$schema->getAuthorization());\n"\n'})}),"\n",(0,r.jsx)(n.h4,{id:"query-authorization-exceptions",children:"Query Authorization Exceptions"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# List active exceptions\ndocker exec -it master-database-mysql-1 mysql -u nextcloud -pnextcloud nextcloud -e "\nSELECT type, subject_type, subject_id, action, priority, description \nFROM oc_openregister_authorization_exceptions \nWHERE active = 1 \nORDER BY priority DESC;\n"\n'})}),"\n",(0,r.jsx)(n.h3,{id:"security-considerations",children:"Security Considerations"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Default Deny"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"When authorization is configured, default behavior is to deny access"}),"\n",(0,r.jsx)(n.li,{children:"Explicitly configure 'public' in read permissions for public access"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Admin Override"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Admin override can be disabled for high-security environments"}),"\n",(0,r.jsx)(n.li,{children:"When disabled, even admins must have explicit permissions"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Authorization Inheritance"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Objects inherit authorization from schemas"}),"\n",(0,r.jsx)(n.li,{children:"Object-level overrides take precedence"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Exception Priority"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Exclusions should have higher priority than inclusions to ensure security"}),"\n",(0,r.jsx)(n.li,{children:"Use priority > 50 for security-critical exclusions"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Unauthenticated Access"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Unauthenticated users only see objects with 'public' in read permissions"}),"\n",(0,r.jsx)(n.li,{children:"Fallback to published object filtering can be enabled (currently disabled)"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"future-enhancements",children:"Future Enhancements"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Field-Level Authorization"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Control access to specific object properties"}),"\n",(0,r.jsx)(n.li,{children:"Redact sensitive fields based on user permissions"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Time-Based Permissions"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Temporary permission grants with expiration"}),"\n",(0,r.jsx)(n.li,{children:"Scheduled permission changes"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Audit Logging"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Log all authorization decisions"}),"\n",(0,r.jsx)(n.li,{children:"Track permission changes over time"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Permission Testing Tool"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"UI for testing user permissions"}),"\n",(0,r.jsx)(n.li,{children:"Visualize effective permissions for users/groups"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"RBAC Analytics"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Permission usage statistics"}),"\n",(0,r.jsx)(n.li,{children:"Identify over-privileged users"}),"\n",(0,r.jsx)(n.li,{children:"Suggest permission optimizations"}),"\n"]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}}}]);