(self.webpackChunkopen_catalogi_docs=self.webpackChunkopen_catalogi_docs||[]).push([[1327],{7411:()=>{},28453:(e,n,t)=>{"use strict";t.d(n,{R:()=>c,x:()=>l});var s=t(96540);const i={},r=s.createContext(i);function c(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),s.createElement(r.Provider,{value:n},e.children)}},28825:()=>{},45673:(e,n,t)=>{"use strict";t.d(n,{A:()=>j});var s=t(96540),i=t(20053),r=t(44404),c=(t(34345),t(28794)),l=t(54022),d=t(72077);function a(e){const n=(0,d.kh)("docusaurus-plugin-redoc");return e?n?.[e]:Object.values(n??{})?.[0]}var o=t(74848);const h=e=>{let{id:n,example:t,pointer:d,...h}=e;const j=a(n),{store:u}=(0,l.r)(j);return(0,s.useEffect)((()=>{u.menu.dispose()}),[u]),(0,o.jsx)(r.ThemeProvider,{theme:u.options.theme,children:(0,o.jsx)("div",{className:(0,i.A)(["redocusaurus","redocusaurus-schema",t?null:"hide-example"]),children:(0,o.jsx)(c.SchemaDefinition,{parser:u.spec.parser,options:u.options,schemaRef:d,...h})})})};h.defaultProps={example:!1};const j=h},65537:(e,n,t)=>{"use strict";t.d(n,{A:()=>O});var s=t(96540),i=t(18215),r=t(65627),c=t(56347),l=t(50372),d=t(30604),a=t(11861),o=t(78749);function h(e){return s.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,s.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function j(e){const{values:n,children:t}=e;return(0,s.useMemo)((()=>{const e=n??function(e){return h(e).map((e=>{let{props:{value:n,label:t,attributes:s,default:i}}=e;return{value:n,label:t,attributes:s,default:i}}))}(t);return function(e){const n=(0,a.XI)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,t])}function u(e){let{value:n,tabValues:t}=e;return t.some((e=>e.value===n))}function v(e){let{queryString:n=!1,groupId:t}=e;const i=(0,c.W6)(),r=function(e){let{queryString:n=!1,groupId:t}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!t)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return t??null}({queryString:n,groupId:t});return[(0,d.aZ)(r),(0,s.useCallback)((e=>{if(!r)return;const n=new URLSearchParams(i.location.search);n.set(r,e),i.replace({...i.location,search:n.toString()})}),[r,i])]}function g(e){const{defaultValue:n,queryString:t=!1,groupId:i}=e,r=j(e),[c,d]=(0,s.useState)((()=>function(e){let{defaultValue:n,tabValues:t}=e;if(0===t.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!u({value:n,tabValues:t}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${n}" but none of its children has the corresponding value. Available values are: ${t.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return n}const s=t.find((e=>e.default))??t[0];if(!s)throw new Error("Unexpected error: 0 tabValues");return s.value}({defaultValue:n,tabValues:r}))),[a,h]=v({queryString:t,groupId:i}),[g,x]=function(e){let{groupId:n}=e;const t=function(e){return e?`docusaurus.tab.${e}`:null}(n),[i,r]=(0,o.Dv)(t);return[i,(0,s.useCallback)((e=>{t&&r.set(e)}),[t,r])]}({groupId:i}),p=(()=>{const e=a??g;return u({value:e,tabValues:r})?e:null})();(0,l.A)((()=>{p&&d(p)}),[p]);return{selectedValue:c,selectValue:(0,s.useCallback)((e=>{if(!u({value:e,tabValues:r}))throw new Error(`Can't select invalid tab value=${e}`);d(e),h(e),x(e)}),[h,x,r]),tabValues:r}}var x=t(9136);const p={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var b=t(74848);function m(e){let{className:n,block:t,selectedValue:s,selectValue:c,tabValues:l}=e;const d=[],{blockElementScrollPositionUntilNextRender:a}=(0,r.a_)(),o=e=>{const n=e.currentTarget,t=d.indexOf(n),i=l[t].value;i!==s&&(a(n),c(i))},h=e=>{let n=null;switch(e.key){case"Enter":o(e);break;case"ArrowRight":{const t=d.indexOf(e.currentTarget)+1;n=d[t]??d[0];break}case"ArrowLeft":{const t=d.indexOf(e.currentTarget)-1;n=d[t]??d[d.length-1];break}}n?.focus()};return(0,b.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.A)("tabs",{"tabs--block":t},n),children:l.map((e=>{let{value:n,label:t,attributes:r}=e;return(0,b.jsx)("li",{role:"tab",tabIndex:s===n?0:-1,"aria-selected":s===n,ref:e=>{d.push(e)},onKeyDown:h,onClick:o,...r,className:(0,i.A)("tabs__item",p.tabItem,r?.className,{"tabs__item--active":s===n}),children:t??n},n)}))})}function E(e){let{lazy:n,children:t,selectedValue:r}=e;const c=(Array.isArray(t)?t:[t]).filter(Boolean);if(n){const e=c.find((e=>e.props.value===r));return e?(0,s.cloneElement)(e,{className:(0,i.A)("margin-top--md",e.props.className)}):null}return(0,b.jsx)("div",{className:"margin-top--md",children:c.map(((e,n)=>(0,s.cloneElement)(e,{key:n,hidden:e.props.value!==r})))})}function f(e){const n=g(e);return(0,b.jsxs)("div",{className:(0,i.A)("tabs-container",p.tabList),children:[(0,b.jsx)(m,{...n,...e}),(0,b.jsx)(E,{...n,...e})]})}function O(e){const n=(0,x.A)();return(0,b.jsx)(f,{...e,children:h(e.children)},String(n))}},67992:()=>{},72869:(e,n,t)=>{"use strict";t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>h,frontMatter:()=>c,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"Features/events","title":"Core Features","description":"An overview of how core concepts in Open Register interact with each other.","source":"@site/docs/Features/events.md","sourceDirName":"Features","slug":"/Features/events","permalink":"/docs/Features/events","draft":false,"unlisted":false,"editUrl":"https://github.com/conductionnl/openregister/tree/main/website/docs/Features/events.md","tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"title":"Core Features","sidebar_position":6,"description":"An overview of how core concepts in Open Register interact with each other.","keywords":["Open Register","Core Concepts","Relationships"]},"sidebar":"tutorialSidebar","previous":{"title":"Search","permalink":"/docs/Features/search"},"next":{"title":"Files","permalink":"/docs/Features/files"}}');var i=t(74848),r=t(28453);t(45673),t(65537),t(79329);const c={title:"Core Features",sidebar_position:6,description:"An overview of how core concepts in Open Register interact with each other.",keywords:["Open Register","Core Concepts","Relationships"]},l="Events",d={},a=[{value:"What are Events in Open Register?",id:"what-are-events-in-open-register",level:2},{value:"Event Structure",id:"event-structure",level:2},{value:"Event Categories",id:"event-categories",level:2},{value:"1. Schema Events",id:"1-schema-events",level:3},{value:"2. Register Events",id:"2-register-events",level:3},{value:"3. Object Events",id:"3-object-events",level:3},{value:"4. File Events",id:"4-file-events",level:3},{value:"5. Validation Events",id:"5-validation-events",level:3},{value:"Schema Events",id:"schema-events",level:3},{value:"SchemaCreatedEvent",id:"schemacreatedevent",level:4},{value:"SchemaUpdatedEvent",id:"schemaupdatedevent",level:4},{value:"SchemaDeletedEvent",id:"schemadeletedevent",level:4},{value:"Register Events",id:"register-events",level:3},{value:"RegisterCreatedEvent",id:"registercreatedevent",level:4},{value:"RegisterUpdatedEvent",id:"registerupdatedevent",level:4},{value:"RegisterDeletedEvent",id:"registerdeletedevent",level:4},{value:"Object Events",id:"object-events",level:3},{value:"ObjectCreatedEvent",id:"objectcreatedevent",level:4},{value:"ObjectUpdatedEvent",id:"objectupdatedevent",level:4},{value:"ObjectDeletedEvent",id:"objectdeletedevent",level:4},{value:"Example Event",id:"example-event",level:2},{value:"Event-Driven Architecture",id:"event-driven-architecture",level:2},{value:"1. Loose Coupling",id:"1-loose-coupling",level:3},{value:"2. Extensibility",id:"2-extensibility",level:3},{value:"3. Scalability",id:"3-scalability",level:3},{value:"4. Observability",id:"4-observability",level:3},{value:"Working with Events",id:"working-with-events",level:2},{value:"Listening to Events",id:"listening-to-events",level:3},{value:"Registering Event Listeners",id:"registering-event-listeners",level:3},{value:"Event Relationships",id:"event-relationships",level:2},{value:"Events and Objects",id:"events-and-objects",level:3},{value:"Events and Schemas",id:"events-and-schemas",level:3},{value:"Events and Registers",id:"events-and-registers",level:3},{value:"Events and Files",id:"events-and-files",level:3},{value:"Use Cases",id:"use-cases",level:2},{value:"1. Integration",id:"1-integration",level:3},{value:"2. Workflow Automation",id:"2-workflow-automation",level:3},{value:"3. Audit and Compliance",id:"3-audit-and-compliance",level:3},{value:"4. Custom Business Logic",id:"4-custom-business-logic",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"Conclusion",id:"conclusion",level:2},{value:"Technical Implementation",id:"technical-implementation",level:2},{value:"Architecture Overview",id:"architecture-overview",level:3},{value:"Event Flow",id:"event-flow",level:3},{value:"Event Lifecycle",id:"event-lifecycle",level:3},{value:"Event Class Structure",id:"event-class-structure",level:3},{value:"Event Catalog",id:"event-catalog",level:3},{value:"Built-in Event Listeners",id:"built-in-event-listeners",level:3},{value:"Event Registration",id:"event-registration",level:3},{value:"Creating Custom Event Listeners",id:"creating-custom-event-listeners",level:3},{value:"Event Priority and Ordering",id:"event-priority-and-ordering",level:3},{value:"Error Handling in Listeners",id:"error-handling-in-listeners",level:3},{value:"Asynchronous Event Processing",id:"asynchronous-event-processing",level:3},{value:"Performance Considerations",id:"performance-considerations",level:3},{value:"Testing Event Listeners",id:"testing-event-listeners",level:3},{value:"Monitoring and Debugging",id:"monitoring-and-debugging",level:3},{value:"Best Practices Summary",id:"best-practices-summary",level:3},{value:"Code Examples",id:"code-examples",level:3}];function o(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"events",children:"Events"})}),"\n",(0,i.jsx)(n.h2,{id:"what-are-events-in-open-register",children:"What are Events in Open Register?"}),"\n",(0,i.jsxs)(n.p,{children:["In Open Register, ",(0,i.jsx)(n.strong,{children:"Events"})," are notifications that are triggered when significant actions occur within the system. They form the foundation of Open Register's event-driven architecture, enabling loose coupling between components while facilitating rich integration possibilities."]}),"\n",(0,i.jsx)(n.p,{children:"Events in Open Register are:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Triggered automatically at key points in the application lifecycle"}),"\n",(0,i.jsx)(n.li,{children:"Standardized messages containing relevant data about what occurred"}),"\n",(0,i.jsx)(n.li,{children:"Available for other components to listen and respond to"}),"\n",(0,i.jsx)(n.li,{children:"Essential for building extensible, integrated systems"}),"\n",(0,i.jsx)(n.li,{children:"Compatible with Nextcloud's event dispatcher system"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"event-structure",children:"Event Structure"}),"\n",(0,i.jsx)(n.p,{children:"An event in Open Register consists of the following key components:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Component"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Event Class"}),(0,i.jsx)(n.td,{children:"The PHP class that defines the event type"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Event Data"}),(0,i.jsx)(n.td,{children:"The data payload carried by the event"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Timestamp"}),(0,i.jsx)(n.td,{children:"When the event occurred"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Source"}),(0,i.jsx)(n.td,{children:"The component that triggered the event"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Context"}),(0,i.jsx)(n.td,{children:"Additional contextual information"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"event-categories",children:"Event Categories"}),"\n",(0,i.jsx)(n.p,{children:"Open Register provides several categories of events:"}),"\n",(0,i.jsx)(n.h3,{id:"1-schema-events",children:"1. Schema Events"}),"\n",(0,i.jsx)(n.p,{children:"Events related to schema lifecycle:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"SchemaCreatedEvent"}),": Triggered when a new schema is created"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"SchemaUpdatedEvent"}),": Triggered when a schema is updated"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"SchemaDeletedEvent"}),": Triggered when a schema is deleted"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"2-register-events",children:"2. Register Events"}),"\n",(0,i.jsx)(n.p,{children:"Events related to register lifecycle:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"RegisterCreatedEvent"}),": Triggered when a new register is created"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"RegisterUpdatedEvent"}),": Triggered when a register is updated"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"RegisterDeletedEvent"}),": Triggered when a register is deleted"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"3-object-events",children:"3. Object Events"}),"\n",(0,i.jsx)(n.p,{children:"Events related to object lifecycle:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"ObjectCreatedEvent"}),": Triggered when a new object is created"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"ObjectUpdatedEvent"}),": Triggered when an object is updated"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"ObjectDeletedEvent"}),": Triggered when an object is deleted"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"ObjectCreatingEvent"}),": Triggered just before an object is created"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"ObjectUpdatingEvent"}),": Triggered just before an object is updated"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"ObjectDeletingEvent"}),": Triggered just before an object is deleted"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"4-file-events",children:"4. File Events"}),"\n",(0,i.jsx)(n.p,{children:"Events related to file operations:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"FileUploadedEvent"}),": Triggered when a file is uploaded"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"FileUpdatedEvent"}),": Triggered when a file is updated"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"FileDeletedEvent"}),": Triggered when a file is deleted"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"5-validation-events",children:"5. Validation Events"}),"\n",(0,i.jsx)(n.p,{children:"Events related to validation:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"ValidationSucceededEvent"}),": Triggered when validation succeeds"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"ValidationFailedEvent"}),": Triggered when validation fails"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"schema-events",children:"Schema Events"}),"\n",(0,i.jsx)(n.h4,{id:"schemacreatedevent",children:"SchemaCreatedEvent"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Class"}),": ",(0,i.jsx)(n.code,{children:"OCA\\OpenRegister\\Event\\SchemaCreatedEvent"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Triggered"}),": When a new schema is created in the system"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Data Provided"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"getSchema()"}),": Returns the Schema object that was created"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Usage"}),": Can be used to perform additional setup or trigger notifications when new schemas are created"]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"schemaupdatedevent",children:"SchemaUpdatedEvent"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Class"}),": ",(0,i.jsx)(n.code,{children:"OCA\\OpenRegister\\Event\\SchemaUpdatedEvent"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Triggered"}),": When a schema is updated"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Data Provided"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"getSchema()"}),": Returns the updated Schema object"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"getOldSchema()"}),": Returns the Schema object before updates"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Usage"}),": Useful for tracking changes to schemas and triggering related actions"]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"schemadeletedevent",children:"SchemaDeletedEvent"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Class"}),": ",(0,i.jsx)(n.code,{children:"OCA\\OpenRegister\\Event\\SchemaDeletedEvent"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Triggered"}),": When a schema is deleted from the system"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Data Provided"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"getSchema()"}),": Returns the Schema object that was deleted"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Usage"}),": Can be used to perform cleanup or trigger additional actions when schemas are removed"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"register-events",children:"Register Events"}),"\n",(0,i.jsx)(n.h4,{id:"registercreatedevent",children:"RegisterCreatedEvent"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Class"}),": ",(0,i.jsx)(n.code,{children:"OCA\\OpenRegister\\Event\\RegisterCreatedEvent"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Triggered"}),": When a new register is created"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Data Provided"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"getRegister()"}),": Returns the Register object that was created"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Usage"}),": Can be used to perform additional setup or trigger notifications when new registers are created"]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"registerupdatedevent",children:"RegisterUpdatedEvent"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Class"}),": ",(0,i.jsx)(n.code,{children:"OCA\\OpenRegister\\Event\\RegisterUpdatedEvent"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Triggered"}),": When a register is updated"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Data Provided"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"getRegister()"}),": Returns the updated Register object"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"getOldRegister()"}),": Returns the Register object before updates"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Usage"}),": Useful for tracking changes to registers and triggering related actions"]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"registerdeletedevent",children:"RegisterDeletedEvent"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Class"}),": ",(0,i.jsx)(n.code,{children:"OCA\\OpenRegister\\Event\\RegisterDeletedEvent"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Triggered"}),": When a register is deleted"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Data Provided"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"getRegister()"}),": Returns the Register object that was deleted"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Usage"}),": Can be used for cleanup operations or notifications when registers are removed"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"object-events",children:"Object Events"}),"\n",(0,i.jsx)(n.h4,{id:"objectcreatedevent",children:"ObjectCreatedEvent"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Class"}),": ",(0,i.jsx)(n.code,{children:"OCA\\OpenRegister\\Event\\ObjectCreatedEvent"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Triggered"}),": When a new object is created in a register"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Data Provided"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"getObject()"}),": Returns the ObjectEntity that was created"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Usage"}),": Useful for tracking new entries, triggering notifications, or performing additional processing on new objects"]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"objectupdatedevent",children:"ObjectUpdatedEvent"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Class"}),": ",(0,i.jsx)(n.code,{children:"OCA\\OpenRegister\\Event\\ObjectUpdatedEvent"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Triggered"}),": When an existing object is updated in a register"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Data Provided"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"getObject()"}),": Returns the updated ObjectEntity"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"getOldObject()"}),": Returns the ObjectEntity before updates"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Usage"}),": Useful for tracking changes to objects, auditing modifications, or triggering follow-up actions"]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"objectdeletedevent",children:"ObjectDeletedEvent"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Class"}),": ",(0,i.jsx)(n.code,{children:"OCA\\OpenRegister\\Event\\ObjectDeletedEvent"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Triggered"}),": When an object is deleted from a register"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Data Provided"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"getObject()"}),": Returns the ObjectEntity that was deleted"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Usage"}),": Can be used for cleanup operations, maintaining related data integrity, or sending notifications about deletions"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"example-event",children:"Example Event"}),"\n",(0,i.jsxs)(n.p,{children:["Here's an example of an ",(0,i.jsx)(n.code,{children:"ObjectCreatedEvent"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"namespace OCA\\OpenRegister\\Event;\n\nuse OCA\\OpenRegister\\Entity\\ObjectEntity;\nuse OCP\\EventDispatcher\\Event;\n\nclass ObjectCreatedEvent extends Event {\n    private ObjectEntity $object;\n\n    public function __construct(ObjectEntity $object) {\n        parent::__construct();\n        $this->object = $object;\n    }\n\n    public function getObject(): ObjectEntity {\n        return $this->object;\n    }\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"event-driven-architecture",children:"Event-Driven Architecture"}),"\n",(0,i.jsx)(n.p,{children:"Open Register uses an event-driven architecture to provide several benefits:"}),"\n",(0,i.jsx)(n.h3,{id:"1-loose-coupling",children:"1. Loose Coupling"}),"\n",(0,i.jsx)(n.p,{children:"Components can interact without direct dependencies:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"The event publisher doesn't need to know who is listening"}),"\n",(0,i.jsx)(n.li,{children:"Listeners can be added or removed without changing the publisher"}),"\n",(0,i.jsx)(n.li,{children:"Different parts of the system can evolve independently"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"2-extensibility",children:"2. Extensibility"}),"\n",(0,i.jsx)(n.p,{children:"The event system makes Open Register highly extensible:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"New functionality can be added by listening to existing events"}),"\n",(0,i.jsx)(n.li,{children:"Third-party applications can integrate without modifying core code"}),"\n",(0,i.jsx)(n.li,{children:"Custom business logic can be implemented through event listeners"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"3-scalability",children:"3. Scalability"}),"\n",(0,i.jsx)(n.p,{children:"Event-driven architectures support better scalability:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Processing can be distributed across different components"}),"\n",(0,i.jsx)(n.li,{children:"Asynchronous handling allows for better resource management"}),"\n",(0,i.jsx)(n.li,{children:"Event queues can buffer processing during peak loads"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"4-observability",children:"4. Observability"}),"\n",(0,i.jsx)(n.p,{children:"Events provide better system observability:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"System activities can be monitored through events"}),"\n",(0,i.jsx)(n.li,{children:"Audit trails can be built by capturing events"}),"\n",(0,i.jsx)(n.li,{children:"Debugging is easier with a clear event timeline"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"working-with-events",children:"Working with Events"}),"\n",(0,i.jsx)(n.h3,{id:"listening-to-events",children:"Listening to Events"}),"\n",(0,i.jsx)(n.p,{children:"To listen to events in Open Register, you need to:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Create an event listener class"}),"\n",(0,i.jsx)(n.li,{children:"Register it with Nextcloud's event dispatcher"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Here's an example of a listener for ",(0,i.jsx)(n.code,{children:"ObjectCreatedEvent"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"namespace OCA\\MyApp\\Listener;\n\nuse OCA\\OpenRegister\\Event\\ObjectCreatedEvent;\nuse OCP\\EventDispatcher\\Event;\nuse OCP\\EventDispatcher\\IEventListener;\n\nclass ObjectCreatedListener implements IEventListener {\n    public function handle(Event $event): void {\n        if (!($event instanceof ObjectCreatedEvent)) {\n            return;\n        }\n        \n        $object = $event->getObject();\n        // Perform actions with the new object\n    }\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"registering-event-listeners",children:"Registering Event Listeners"}),"\n",(0,i.jsxs)(n.p,{children:["Register your listener in your app's ",(0,i.jsx)(n.code,{children:"Application.php"})," file:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"use OCA\\OpenRegister\\Event\\ObjectCreatedEvent;\nuse OCA\\MyApp\\Listener\\ObjectCreatedListener;\nuse OCP\\EventDispatcher\\IEventDispatcher;\n\n// In the register() method:\n$dispatcher = $this->getContainer()->get(IEventDispatcher::class);\n$dispatcher->addServiceListener(ObjectCreatedEvent::class, ObjectCreatedListener::class);\n"})}),"\n",(0,i.jsxs)(n.p,{children:["If you're extending Open Register, you might need to dispatch your own events. You can read more about event handling in the ",(0,i.jsx)(n.a,{href:"https://docs.nextcloud.com/server/latest/developer_manual/basics/events.html",children:"Nextcloud documentation"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"event-relationships",children:"Event Relationships"}),"\n",(0,i.jsx)(n.p,{children:"Events have important relationships with other core concepts:"}),"\n",(0,i.jsx)(n.h3,{id:"events-and-objects",children:"Events and Objects"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Events are triggered by changes to objects"}),"\n",(0,i.jsx)(n.li,{children:"Events carry object data"}),"\n",(0,i.jsx)(n.li,{children:"Events enable tracking object lifecycle"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"events-and-schemas",children:"Events and Schemas"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Schema changes trigger events"}),"\n",(0,i.jsx)(n.li,{children:"Events can be used to validate schema compatibility"}),"\n",(0,i.jsx)(n.li,{children:"Events enable schema evolution tracking"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"events-and-registers",children:"Events and Registers"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Register operations trigger events"}),"\n",(0,i.jsx)(n.li,{children:"Events can be used to monitor register usage"}),"\n",(0,i.jsx)(n.li,{children:"Events enable register lifecycle management"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"events-and-files",children:"Events and Files"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"File operations trigger events"}),"\n",(0,i.jsx)(n.li,{children:"Events carry file metadata"}),"\n",(0,i.jsx)(n.li,{children:"Events enable file processing workflows"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"use-cases",children:"Use Cases"}),"\n",(0,i.jsx)(n.h3,{id:"1-integration",children:"1. Integration"}),"\n",(0,i.jsx)(n.p,{children:"Use events to integrate with other systems:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Sync data with external systems"}),"\n",(0,i.jsx)(n.li,{children:"Trigger notifications in messaging platforms"}),"\n",(0,i.jsx)(n.li,{children:"Update search indexes"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"2-workflow-automation",children:"2. Workflow Automation"}),"\n",(0,i.jsx)(n.p,{children:"Build automated workflows:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Generate documents when objects are created"}),"\n",(0,i.jsx)(n.li,{children:"Send approval requests when objects are updated"}),"\n",(0,i.jsx)(n.li,{children:"Archive data when objects are deleted"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"3-audit-and-compliance",children:"3. Audit and Compliance"}),"\n",(0,i.jsx)(n.p,{children:"Implement audit and compliance features:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Log all changes to sensitive data"}),"\n",(0,i.jsx)(n.li,{children:"Track who did what and when"}),"\n",(0,i.jsx)(n.li,{children:"Generate compliance reports"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"4-custom-business-logic",children:"4. Custom Business Logic"}),"\n",(0,i.jsx)(n.p,{children:"Implement custom business logic:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Validate complex business rules"}),"\n",(0,i.jsx)(n.li,{children:"Enforce data quality standards"}),"\n",(0,i.jsx)(n.li,{children:"Implement approval workflows"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Keep Listeners Focused"}),": Each listener should have a single responsibility"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Handle Errors Gracefully"}),": Listeners should not break the system if they fail"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Consider Performance"}),": Heavy processing should be done asynchronously"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Document Events"}),": Clearly document what events are available and when they're triggered"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Version Events"}),": Consider versioning events to handle changes over time"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Test Event Handling"}),": Write tests for event listeners"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Monitor Event Flow"}),": Implement monitoring for event processing"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,i.jsx)(n.p,{children:"Events in Open Register provide a powerful mechanism for extending functionality, integrating with other systems, and building loosely coupled architectures. By leveraging the event-driven approach, you can create flexible, scalable applications that can evolve over time while maintaining a clean separation of concerns."}),"\n",(0,i.jsx)(n.h2,{id:"technical-implementation",children:"Technical Implementation"}),"\n",(0,i.jsx)(n.h3,{id:"architecture-overview",children:"Architecture Overview"}),"\n",(0,i.jsx)(n.p,{children:"OpenRegister's event system is built on Nextcloud's event dispatcher, providing a pub-sub architecture:"}),"\n",(0,i.jsx)(n.mermaid,{value:'graph TB\n    subgraph "Event Publishers"\n        ObjectMapper[Object Mapper]\n        SchemaMapper[Schema Mapper]\n        RegisterMapper[Register Mapper]\n        FileService[File Service]\n    end\n    \n    subgraph "Event Dispatcher"\n        Dispatcher[Nextcloud Event<br/>Dispatcher]\n    end\n    \n    subgraph "Event Listeners"\n        SolrListener[Solr Event Listener<br/>Search Indexing]\n        CacheListener[Object Cache Listener<br/>Cache Management]\n        FileListener[File Change Listener<br/>Text Extraction]\n        CustomListener[Custom Listeners<br/>Your App Logic]\n    end\n    \n    subgraph "Event Types"\n        ObjectEvents[Object Events<br/>Created/Updated/Deleted]\n        SchemaEvents[Schema Events<br/>Created/Updated/Deleted]\n        RegisterEvents[Register Events<br/>Created/Updated/Deleted]\n        LockEvents[Lock Events<br/>Locked/Unlocked/Reverted]\n    end\n    \n    ObjectMapper --\x3e|dispatch| Dispatcher\n    SchemaMapper --\x3e|dispatch| Dispatcher\n    RegisterMapper --\x3e|dispatch| Dispatcher\n    FileService --\x3e|dispatch| Dispatcher\n    \n    Dispatcher --\x3e|notify| SolrListener\n    Dispatcher --\x3e|notify| CacheListener\n    Dispatcher --\x3e|notify| FileListener\n    Dispatcher --\x3e|notify| CustomListener\n    \n    ObjectEvents -.->|type| Dispatcher\n    SchemaEvents -.->|type| Dispatcher\n    RegisterEvents -.->|type| Dispatcher\n    LockEvents -.->|type| Dispatcher\n    \n    style Dispatcher fill:#e1f5ff\n    style ObjectEvents fill:#fff4e1'}),"\n",(0,i.jsx)(n.h3,{id:"event-flow",children:"Event Flow"}),"\n",(0,i.jsx)(n.p,{children:"Complete lifecycle of an event from dispatch to handling:"}),"\n",(0,i.jsx)(n.mermaid,{value:"sequenceDiagram\n    participant Service as Service Layer<br/>(ObjectMapper)\n    participant Dispatcher as Event Dispatcher\n    participant Listener1 as Solr Listener\n    participant Listener2 as Cache Listener\n    participant Listener3 as Custom Listener\n    \n    Note over Service: Object Creation\n    \n    Service->>Service: insert(object)\n    Service->>Service: Database INSERT\n    \n    Service->>Dispatcher: dispatch(ObjectCreatedEvent)\n    Note over Dispatcher: Event Published\n    \n    par Parallel Notification\n        Dispatcher->>Listener1: handle(ObjectCreatedEvent)\n        Listener1->>Listener1: Index object in Solr\n        Listener1--\x3e>Dispatcher: Complete\n    and\n        Dispatcher->>Listener2: handle(ObjectCreatedEvent)\n        Listener2->>Listener2: Update cache\n        Listener2--\x3e>Dispatcher: Complete\n    and\n        Dispatcher->>Listener3: handle(ObjectCreatedEvent)\n        Listener3->>Listener3: Custom logic\n        Listener3--\x3e>Dispatcher: Complete\n    end\n    \n    Dispatcher--\x3e>Service: All listeners notified\n    Service--\x3e>Service: Return created object"}),"\n",(0,i.jsx)(n.h3,{id:"event-lifecycle",children:"Event Lifecycle"}),"\n",(0,i.jsx)(n.p,{children:"Before and after events for transaction-safe operations:"}),"\n",(0,i.jsx)(n.mermaid,{value:"graph TD\n    Start[API Request] --\x3e BeforeEvent[Dispatch *ing Event<br/>ObjectCreatingEvent]\n    \n    BeforeEvent --\x3e Validate{Validation<br/>Passed?}\n    Validate --\x3e|No| ErrorValidation[\u274c Validation Error<br/>Return 400]\n    Validate --\x3e|Yes| Transaction[Begin Transaction]\n    \n    Transaction --\x3e SaveDB[Save to Database]\n    SaveDB --\x3e Commit{Commit<br/>Success?}\n    \n    Commit --\x3e|No| Rollback[Rollback Transaction]\n    Rollback --\x3e ErrorDB[\u274c Database Error<br/>Return 500]\n    \n    Commit --\x3e|Yes| AfterEvent[Dispatch *ed Event<br/>ObjectCreatedEvent]\n    \n    AfterEvent --\x3e NotifyListeners[Notify All Listeners]\n    NotifyListeners --\x3e SolrIndex[Solr Indexing]\n    NotifyListeners --\x3e CacheUpdate[Cache Update]\n    NotifyListeners --\x3e CustomLogic[Custom Business Logic]\n    \n    SolrIndex --\x3e Success[\u2713 Object Created<br/>Return 201]\n    CacheUpdate --\x3e Success\n    CustomLogic --\x3e Success\n    \n    style ErrorValidation fill:#FFB6C1\n    style ErrorDB fill:#FFB6C1\n    style Success fill:#90EE90"}),"\n",(0,i.jsx)(n.h3,{id:"event-class-structure",children:"Event Class Structure"}),"\n",(0,i.jsx)(n.p,{children:"All events follow a consistent structure:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"namespace OCA\\OpenRegister\\Event;\n\nuse OCA\\OpenRegister\\Db\\ObjectEntity;\nuse OCP\\EventDispatcher\\Event;\n\nclass ObjectCreatedEvent extends Event\n{\n    private ObjectEntity $object;\n    \n    public function __construct(ObjectEntity $object)\n    {\n        parent::__construct();\n        $this->object = $object;\n    }\n    \n    public function getObject(): ObjectEntity\n    {\n        return $this->object;\n    }\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"event-catalog",children:"Event Catalog"}),"\n",(0,i.jsx)(n.p,{children:"Complete list of events by category:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Category"}),(0,i.jsx)(n.th,{children:"Event Class"}),(0,i.jsx)(n.th,{children:"Triggered When"}),(0,i.jsx)(n.th,{children:"Data Provided"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Object"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ObjectCreatingEvent"})}),(0,i.jsx)(n.td,{children:"Before object creation"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"getObject()"})," (draft)"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ObjectCreatedEvent"})}),(0,i.jsx)(n.td,{children:"After object created"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"getObject()"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ObjectUpdatingEvent"})}),(0,i.jsx)(n.td,{children:"Before object update"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"getObject()"}),", ",(0,i.jsx)(n.code,{children:"getOldObject()"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ObjectUpdatedEvent"})}),(0,i.jsx)(n.td,{children:"After object updated"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"getObject()"}),", ",(0,i.jsx)(n.code,{children:"getOldObject()"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ObjectDeletingEvent"})}),(0,i.jsx)(n.td,{children:"Before object deletion"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"getObject()"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ObjectDeletedEvent"})}),(0,i.jsx)(n.td,{children:"After object deleted"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"getObject()"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ObjectLockedEvent"})}),(0,i.jsx)(n.td,{children:"Object locked"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"getObject()"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ObjectUnlockedEvent"})}),(0,i.jsx)(n.td,{children:"Object unlocked"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"getObject()"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ObjectRevertedEvent"})}),(0,i.jsx)(n.td,{children:"Object reverted to version"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"getObject()"}),", ",(0,i.jsx)(n.code,{children:"getVersion()"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Schema"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"SchemaCreatedEvent"})}),(0,i.jsx)(n.td,{children:"After schema created"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"getSchema()"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"SchemaUpdatedEvent"})}),(0,i.jsx)(n.td,{children:"After schema updated"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"getSchema()"}),", ",(0,i.jsx)(n.code,{children:"getOldSchema()"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"SchemaDeletedEvent"})}),(0,i.jsx)(n.td,{children:"After schema deleted"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"getSchema()"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Register"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"RegisterCreatedEvent"})}),(0,i.jsx)(n.td,{children:"After register created"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"getRegister()"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"RegisterUpdatedEvent"})}),(0,i.jsx)(n.td,{children:"After register updated"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"getRegister()"}),", ",(0,i.jsx)(n.code,{children:"getOldRegister()"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"RegisterDeletedEvent"})}),(0,i.jsx)(n.td,{children:"After register deleted"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"getRegister()"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Organisation"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"OrganisationCreatedEvent"})}),(0,i.jsx)(n.td,{children:"After organisation created"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"getOrganisation()"})})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"built-in-event-listeners",children:"Built-in Event Listeners"}),"\n",(0,i.jsx)(n.p,{children:"OpenRegister includes several built-in listeners:"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"1. Solr Event Listener"})," (",(0,i.jsx)(n.code,{children:"SolrEventListener.php"}),")"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Listens to: ",(0,i.jsx)(n.code,{children:"ObjectCreatedEvent"}),", ",(0,i.jsx)(n.code,{children:"ObjectUpdatedEvent"}),", ",(0,i.jsx)(n.code,{children:"ObjectDeletedEvent"})]}),"\n",(0,i.jsx)(n.li,{children:"Purpose: Automatically indexes/updates/removes objects in Solr"}),"\n",(0,i.jsx)(n.li,{children:"Priority: High (ensures search index stays synchronized)"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"2. Object Cache Listener"})," (",(0,i.jsx)(n.code,{children:"ObjectCacheListener.php"}),")"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Listens to: ",(0,i.jsx)(n.code,{children:"ObjectCreatedEvent"}),", ",(0,i.jsx)(n.code,{children:"ObjectUpdatedEvent"}),", ",(0,i.jsx)(n.code,{children:"ObjectDeletedEvent"})]}),"\n",(0,i.jsx)(n.li,{children:"Purpose: Manages object cache for UUID resolution"}),"\n",(0,i.jsx)(n.li,{children:"Priority: High (maintains cache consistency)"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"3. File Change Listener"})," (",(0,i.jsx)(n.code,{children:"FileChangeListener.php"}),")"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Listens to: File system events"}),"\n",(0,i.jsx)(n.li,{children:"Purpose: Queues text extraction jobs for uploaded files"}),"\n",(0,i.jsx)(n.li,{children:"Priority: Normal (background processing)"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"event-registration",children:"Event Registration"}),"\n",(0,i.jsxs)(n.p,{children:["Events are registered in ",(0,i.jsx)(n.code,{children:"Application.php"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"use OCP\\EventDispatcher\\IEventDispatcher;\nuse OCA\\OpenRegister\\Event\\ObjectCreatedEvent;\nuse OCA\\OpenRegister\\EventListener\\SolrEventListener;\n\npublic function register(IRegistrationContext $context): void\n{\n    // Register event listeners\n    $context->registerEventListener(\n        ObjectCreatedEvent::class,\n        SolrEventListener::class\n    );\n    \n    $context->registerEventListener(\n        ObjectUpdatedEvent::class,\n        SolrEventListener::class\n    );\n    \n    $context->registerEventListener(\n        ObjectDeletedEvent::class,\n        SolrEventListener::class\n    );\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"creating-custom-event-listeners",children:"Creating Custom Event Listeners"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Step 1: Create Listener Class"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"namespace OCA\\MyApp\\Listener;\n\nuse OCA\\OpenRegister\\Event\\ObjectCreatedEvent;\nuse OCP\\EventDispatcher\\Event;\nuse OCP\\EventDispatcher\\IEventListener;\nuse Psr\\Log\\LoggerInterface;\n\nclass MyObjectListener implements IEventListener\n{\n    private LoggerInterface $logger;\n    \n    public function __construct(LoggerInterface $logger)\n    {\n        $this->logger = $logger;\n    }\n    \n    public function handle(Event $event): void\n    {\n        if (!($event instanceof ObjectCreatedEvent)) {\n            return;\n        }\n        \n        $object = $event->getObject();\n        \n        // Your custom logic here\n        $this->logger->info('New object created', [\n            'uuid' => $object->getUuid(),\n            'schema' => $object->getSchema(),\n            'register' => $object->getRegister()\n        ]);\n        \n        // Example: Send notification\n        $this->sendNotification($object);\n        \n        // Example: Update external system\n        $this->syncToExternalSystem($object);\n    }\n    \n    private function sendNotification(ObjectEntity $object): void\n    {\n        // Implementation\n    }\n    \n    private function syncToExternalSystem(ObjectEntity $object): void\n    {\n        // Implementation\n    }\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Step 2: Register in Application.php"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"public function register(IRegistrationContext $context): void\n{\n    $context->registerEventListener(\n        ObjectCreatedEvent::class,\n        MyObjectListener::class\n    );\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"event-priority-and-ordering",children:"Event Priority and Ordering"}),"\n",(0,i.jsx)(n.p,{children:"Listeners execute in registration order. For custom ordering:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// High priority listener (executes first)\n$context->registerEventListener(\n    ObjectCreatedEvent::class,\n    CriticalListener::class,\n    -100  // Negative priority = earlier execution\n);\n\n// Normal priority\n$context->registerEventListener(\n    ObjectCreatedEvent::class,\n    StandardListener::class,\n    0  // Default priority\n);\n\n// Low priority listener (executes last)\n$context->registerEventListener(\n    ObjectCreatedEvent::class,\n    CleanupListener::class,\n    100  // Positive priority = later execution\n);\n"})}),"\n",(0,i.jsx)(n.h3,{id:"error-handling-in-listeners",children:"Error Handling in Listeners"}),"\n",(0,i.jsx)(n.p,{children:"Best practices for handling errors:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"public function handle(Event $event): void\n{\n    if (!($event instanceof ObjectCreatedEvent)) {\n        return;\n    }\n    \n    try {\n        $object = $event->getObject();\n        $this->processObject($object);\n        \n    } catch (\\Exception $e) {\n        // Log error but don't break event chain\n        $this->logger->error('Failed to process object event', [\n            'error' => $e->getMessage(),\n            'trace' => $e->getTraceAsString()\n        ]);\n        \n        // Optionally: Queue for retry\n        $this->queueForRetry($object);\n        \n        // Don't throw - let other listeners execute\n    }\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"asynchronous-event-processing",children:"Asynchronous Event Processing"}),"\n",(0,i.jsx)(n.p,{children:"For heavy operations, use background jobs:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"use OCP\\BackgroundJob\\IJobList;\n\npublic function handle(Event $event): void\n{\n    if (!($event instanceof ObjectCreatedEvent)) {\n        return;\n    }\n    \n    $object = $event->getObject();\n    \n    // Queue background job instead of processing immediately\n    $this->jobList->add(ProcessObjectJob::class, [\n        'objectId' => $object->getId(),\n        'objectUuid' => $object->getUuid()\n    ]);\n    \n    $this->logger->debug('Queued object processing job');\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"performance-considerations",children:"Performance Considerations"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"1. Lightweight Listeners"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Keep listener logic minimal"}),"\n",(0,i.jsx)(n.li,{children:"Delegate heavy work to background jobs"}),"\n",(0,i.jsx)(n.li,{children:"Avoid blocking operations"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"2. Conditional Processing"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Check event type early"}),"\n",(0,i.jsx)(n.li,{children:"Return quickly if not relevant"}),"\n",(0,i.jsx)(n.li,{children:"Use property checks before full processing"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"3. Error Isolation"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Catch all exceptions"}),"\n",(0,i.jsx)(n.li,{children:"Log errors comprehensively"}),"\n",(0,i.jsx)(n.li,{children:"Don't break the event chain"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"4. Monitoring"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Log listener execution time"}),"\n",(0,i.jsx)(n.li,{children:"Track processing failures"}),"\n",(0,i.jsx)(n.li,{children:"Monitor queue depths"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"testing-event-listeners",children:"Testing Event Listeners"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Unit Test Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"use PHPUnit\\Framework\\TestCase;\n\nclass MyObjectListenerTest extends TestCase\n{\n    public function testHandlesObjectCreatedEvent()\n    {\n        $object = $this->createMock(ObjectEntity::class);\n        $object->method('getUuid')->willReturn('test-uuid');\n        \n        $event = new ObjectCreatedEvent($object);\n        \n        $listener = new MyObjectListener($this->logger);\n        $listener->handle($event);\n        \n        // Assert expected behavior\n        $this->assertTrue(true); // Add real assertions\n    }\n    \n    public function testIgnoresOtherEvents()\n    {\n        $event = new SchemaCreatedEvent($this->createMock(Schema::class));\n        \n        $listener = new MyObjectListener($this->logger);\n        $listener->handle($event);\n        \n        // Should return early without processing\n        $this->assertTrue(true);\n    }\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"monitoring-and-debugging",children:"Monitoring and Debugging"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Event Flow Debugging:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# Enable debug logging\ndocker exec nextcloud-container occ config:app:set openregister log_level --value=debug\n\n# Watch event dispatching\ndocker logs -f nextcloud-container | grep "Event.*dispatched"\n\n# Check listener execution\ndocker logs -f nextcloud-container | grep "Listener.*handle"\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Event Statistics:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# Count events by type (from logs)\ndocker logs nextcloud-container | grep "Event dispatched" | awk \'{print $NF}\' | sort | uniq -c\n\n# Find failed event handlers\ndocker logs nextcloud-container | grep "Failed to.*event" | wc -l\n'})}),"\n",(0,i.jsx)(n.h3,{id:"best-practices-summary",children:"Best Practices Summary"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\u2713 DO:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Keep listeners focused on single responsibility"}),"\n",(0,i.jsx)(n.li,{children:"Handle errors gracefully without breaking event chain"}),"\n",(0,i.jsx)(n.li,{children:"Use background jobs for heavy processing"}),"\n",(0,i.jsx)(n.li,{children:"Log listener activity for debugging"}),"\n",(0,i.jsx)(n.li,{children:"Test listeners thoroughly"}),"\n",(0,i.jsx)(n.li,{children:"Document what your listeners do"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\u2717 DON'T:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Don't perform blocking operations in listeners"}),"\n",(0,i.jsx)(n.li,{children:"Don't throw exceptions unless critical"}),"\n",(0,i.jsx)(n.li,{children:"Don't modify event data (events should be immutable)"}),"\n",(0,i.jsx)(n.li,{children:"Don't create circular event dependencies"}),"\n",(0,i.jsx)(n.li,{children:"Don't bypass the event system for convenience"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"code-examples",children:"Code Examples"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Complete Custom Listener:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"namespace OCA\\MyApp\\Listener;\n\nuse OCA\\OpenRegister\\Event\\ObjectCreatedEvent;\nuse OCA\\OpenRegister\\Event\\ObjectUpdatedEvent;\nuse OCP\\EventDispatcher\\Event;\nuse OCP\\EventDispatcher\\IEventListener;\nuse Psr\\Log\\LoggerInterface;\n\nclass AuditLogListener implements IEventListener\n{\n    private LoggerInterface $logger;\n    private AuditService $auditService;\n    \n    public function __construct(\n        LoggerInterface $logger,\n        AuditService $auditService\n    ) {\n        $this->logger = $logger;\n        $this->auditService = $auditService;\n    }\n    \n    public function handle(Event $event): void\n    {\n        try {\n            if ($event instanceof ObjectCreatedEvent) {\n                $this->handleCreated($event);\n            } elseif ($event instanceof ObjectUpdatedEvent) {\n                $this->handleUpdated($event);\n            }\n        } catch (\\Exception $e) {\n            $this->logger->error('Audit logging failed', [\n                'error' => $e->getMessage(),\n                'event' => get_class($event)\n            ]);\n        }\n    }\n    \n    private function handleCreated(ObjectCreatedEvent $event): void\n    {\n        $object = $event->getObject();\n        \n        $this->auditService->log([\n            'action' => 'object_created',\n            'object_uuid' => $object->getUuid(),\n            'schema' => $object->getSchema(),\n            'register' => $object->getRegister(),\n            'timestamp' => time(),\n            'user' => \\OC::$server->getUserSession()->getUser()->getUID()\n        ]);\n    }\n    \n    private function handleUpdated(ObjectUpdatedEvent $event): void\n    {\n        $object = $event->getObject();\n        $oldObject = $event->getOldObject();\n        \n        $changes = $this->detectChanges($oldObject, $object);\n        \n        $this->auditService->log([\n            'action' => 'object_updated',\n            'object_uuid' => $object->getUuid(),\n            'changes' => $changes,\n            'timestamp' => time(),\n            'user' => \\OC::$server->getUserSession()->getUser()->getUID()\n        ]);\n    }\n    \n    private function detectChanges($old, $new): array\n    {\n        // Implementation to detect what changed\n        return [];\n    }\n}\n"})})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},79329:(e,n,t)=>{"use strict";t.d(n,{A:()=>c});t(96540);var s=t(18215);const i={tabItem:"tabItem_Ymn6"};var r=t(74848);function c(e){let{children:n,hidden:t,className:c}=e;return(0,r.jsx)("div",{role:"tabpanel",className:(0,s.A)(i.tabItem,c),hidden:t,children:n})}},92441:()=>{},93290:()=>{}}]);