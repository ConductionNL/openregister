"use strict";(self.webpackChunkopen_catalogi_docs=self.webpackChunkopen_catalogi_docs||[]).push([[513],{28453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>s});var t=i(96540);const r={},l=t.createContext(r);function o(e){const n=t.useContext(l);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),t.createElement(l.Provider,{value:n},e.children)}},97940:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>s,default:()=>h,frontMatter:()=>o,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"technical/entity-relationship-model-updated","title":"Entity Relationship Model Update","description":"Overview","source":"@site/docs/technical/entity-relationship-model-updated.md","sourceDirName":"technical","slug":"/technical/entity-relationship-model-updated","permalink":"/docs/technical/entity-relationship-model-updated","draft":false,"unlisted":false,"editUrl":"https://github.com/conductionnl/openregister/tree/main/website/docs/technical/entity-relationship-model-updated.md","tags":[],"version":"current","sidebarPosition":121,"frontMatter":{"title":"Entity Relationship Model Update","sidebar_position":121},"sidebar":"tutorialSidebar","previous":{"title":"Enhanced Text Extraction Implementation Plan","permalink":"/docs/technical/enhanced-text-extraction-implementation-plan"},"next":{"title":"Entity Relationships Addition","permalink":"/docs/technical/entity-relationships-addition"}}');var r=i(74848),l=i(28453);const o={title:"Entity Relationship Model Update",sidebar_position:121},s="Entity Relationship Model - Updated Structure",a={},d=[{value:"Overview",id:"overview",level:2},{value:"Key Changes",id:"key-changes",level:2},{value:"1. BelongsTo Field on Entity (Many-to-One)",id:"1-belongsto-field-on-entity-many-to-one",level:3},{value:"2. Role Field on EntityRelation",id:"2-role-field-on-entityrelation",level:3},{value:"3. Source Tracking on EntityRelation",id:"3-source-tracking-on-entityrelation",level:3},{value:"4. Source Tracking on Chunk",id:"4-source-tracking-on-chunk",level:3},{value:"Updated Entity Structure",id:"updated-entity-structure",level:2},{value:"Entity Table Schema",id:"entity-table-schema",level:3},{value:"EntityRelation Table Schema",id:"entityrelation-table-schema",level:3},{value:"Relationship Pattern",id:"relationship-pattern",level:2},{value:"Parent-Child (BelongsTo)",id:"parent-child-belongsto",level:3},{value:"Query Patterns",id:"query-patterns",level:3},{value:"Role-Based Anonymization",id:"role-based-anonymization",level:2},{value:"Example Detection",id:"example-detection",level:3},{value:"Example: Private Individual",id:"example-private-individual",level:3},{value:"Source Tracking Benefits",id:"source-tracking-benefits",level:2},{value:"Scenario: File Re-chunking",id:"scenario-file-re-chunking",level:3},{value:"Scenario: GDPR Request",id:"scenario-gdpr-request",level:3},{value:"PHP Entity Class Updates",id:"php-entity-class-updates",level:2},{value:"GdprEntity Class",id:"gdprentity-class",level:3},{value:"EntityRelation Class",id:"entityrelation-class",level:3},{value:"Migration from EntityLink Table",id:"migration-from-entitylink-table",level:2},{value:"Current State (Before)",id:"current-state-before",level:3},{value:"New State (After)",id:"new-state-after",level:3},{value:"Migration Strategy",id:"migration-strategy",level:3},{value:"Benefits Summary",id:"benefits-summary",level:2},{value:"1. Simpler Data Model",id:"1-simpler-data-model",level:3},{value:"2. GDPR Compliance",id:"2-gdpr-compliance",level:3},{value:"3. Robust Source Tracking",id:"3-robust-source-tracking",level:3},{value:"4. Query Performance",id:"4-query-performance",level:3},{value:"5. Flexibility",id:"5-flexibility",level:3},{value:"Example Use Cases",id:"example-use-cases",level:2},{value:"Use Case 1: Complete Contact Profile",id:"use-case-1-complete-contact-profile",level:3},{value:"Use Case 2: Role-Based Anonymization",id:"use-case-2-role-based-anonymization",level:3},{value:"Use Case 3: Source Document Retrieval",id:"use-case-3-source-document-retrieval",level:3},{value:"Conclusion",id:"conclusion",level:2}];function c(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"entity-relationship-model---updated-structure",children:"Entity Relationship Model - Updated Structure"})}),"\n",(0,r.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsxs)(n.p,{children:["This document describes the ",(0,r.jsx)(n.strong,{children:"updated entity relationship model"})," based on user feedback to create a more efficient and intuitive structure for GDPR entity management."]}),"\n",(0,r.jsx)(n.h2,{id:"key-changes",children:"Key Changes"}),"\n",(0,r.jsx)(n.h3,{id:"1-belongsto-field-on-entity-many-to-one",children:"1. BelongsTo Field on Entity (Many-to-One)"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Instead of"}),": Separate ",(0,r.jsx)(n.code,{children:"EntityLink"})," table for all relationships (many-to-many)"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Now"}),": Direct ",(0,r.jsx)(n.code,{children:"belongs_to_entity_id"})," field on each entity (many-to-one)"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Rationale"}),": Most contact information belongs to exactly ONE person or organization, making a foreign key more efficient than a join table."]}),"\n",(0,r.jsx)(n.h3,{id:"2-role-field-on-entityrelation",children:"2. Role Field on EntityRelation"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Added"}),": ",(0,r.jsx)(n.code,{children:"role"})," field to track entity context for GDPR compliance"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Purpose"}),": Determine if an entity occurrence requires anonymization:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"public_figure"}),": May not require anonymization"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"employee"}),": In official capacity, may not require anonymization"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"private_individual"}),": Always requires anonymization"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"customer"}),", ",(0,r.jsx)(n.strong,{children:"contractor"}),", ",(0,r.jsx)(n.strong,{children:"author"}),", ",(0,r.jsx)(n.strong,{children:"recipient"}),", ",(0,r.jsx)(n.strong,{children:"mentioned"}),": Context-dependent"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"3-source-tracking-on-entityrelation",children:"3. Source Tracking on EntityRelation"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Added"}),": ",(0,r.jsx)(n.code,{children:"file_id"}),", ",(0,r.jsx)(n.code,{children:"object_id"}),", ",(0,r.jsx)(n.code,{children:"email_id"})," fields to track ultimate source"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Purpose"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Chunks may change over time (re-chunking, updates)"}),"\n",(0,r.jsx)(n.li,{children:"GDPR requests need original source documents"}),"\n",(0,r.jsx)(n.li,{children:"Anonymization must trace back to original files"}),"\n",(0,r.jsx)(n.li,{children:"Audit trails require source document references"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"4-source-tracking-on-chunk",children:"4. Source Tracking on Chunk"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Clarified"}),": ",(0,r.jsx)(n.code,{children:"source_type"})," and ",(0,r.jsx)(n.code,{children:"source_id"})," track the ",(0,r.jsx)(n.strong,{children:"ultimate source"}),", not intermediate text entities"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Values"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"source_type"}),": 'file', 'object', 'mail', 'chat'"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"source_id"}),": The actual file/object/email/chat ID (not the text extraction record ID)"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"updated-entity-structure",children:"Updated Entity Structure"}),"\n",(0,r.jsx)(n.h3,{id:"entity-table-schema",children:"Entity Table Schema"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE oc_openregister_entities (\n    id BIGINT AUTO_INCREMENT PRIMARY KEY,\n    uuid VARCHAR(255) NOT NULL UNIQUE,\n    type VARCHAR(50) NOT NULL,\n    value TEXT NOT NULL,\n    category VARCHAR(50) NOT NULL,\n    belongs_to_entity_id BIGINT,  -- NEW: Direct parent reference\n    metadata JSON,\n    owner VARCHAR(255),\n    organisation VARCHAR(255),\n    detected_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n    \n    INDEX idx_type (type),\n    INDEX idx_category (category),\n    INDEX idx_belongs_to (belongs_to_entity_id),  -- NEW: Index for parent lookups\n    \n    FOREIGN KEY (belongs_to_entity_id) REFERENCES oc_openregister_entities(id) ON DELETE SET NULL\n);\n"})}),"\n",(0,r.jsx)(n.h3,{id:"entityrelation-table-schema",children:"EntityRelation Table Schema"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE oc_openregister_entity_relations (\n    id BIGINT AUTO_INCREMENT PRIMARY KEY,\n    entity_id BIGINT NOT NULL,\n    chunk_id BIGINT NOT NULL,\n    role VARCHAR(50),              -- NEW: Entity role/context\n    file_id BIGINT,                -- NEW: Original file source\n    object_id BIGINT,              -- NEW: Original object source\n    email_id BIGINT,               -- NEW: Original email source\n    position_start INT NOT NULL,\n    position_end INT NOT NULL,\n    confidence DECIMAL(3,2) NOT NULL,\n    detection_method VARCHAR(50) NOT NULL,\n    context TEXT,\n    anonymized BOOLEAN NOT NULL DEFAULT FALSE,\n    anonymized_value VARCHAR(255),\n    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    \n    INDEX idx_role (role),         -- NEW: Query by role\n    INDEX idx_file (file_id),      -- NEW: Find entities in file\n    INDEX idx_object (object_id),  -- NEW: Find entities in object\n    INDEX idx_email (email_id),    -- NEW: Find entities in email\n    \n    FOREIGN KEY (entity_id) REFERENCES oc_openregister_entities(id) ON DELETE CASCADE,\n    FOREIGN KEY (chunk_id) REFERENCES oc_openregister_chunks(id) ON DELETE CASCADE\n);\n"})}),"\n",(0,r.jsx)(n.h2,{id:"relationship-pattern",children:"Relationship Pattern"}),"\n",(0,r.jsx)(n.h3,{id:"parent-child-belongsto",children:"Parent-Child (BelongsTo)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Person: John Doe (id=1)\n  \u251c\u2500 Phone: +31612345678 (id=2, belongs_to_entity_id=1)\n  \u251c\u2500 Phone: +31687654321 (id=3, belongs_to_entity_id=1)\n  \u251c\u2500 Email: john.doe@example.com (id=4, belongs_to_entity_id=1)\n  \u251c\u2500 Email: j.doe@company.com (id=5, belongs_to_entity_id=1)\n  \u2514\u2500 Address: 123 Main St, Amsterdam (id=6, belongs_to_entity_id=1)\n\nOrganization: Acme Corp (id=10)\n  \u251c\u2500 Phone: +31201234567 (id=11, belongs_to_entity_id=10)\n  \u251c\u2500 Email: info@acme.com (id=12, belongs_to_entity_id=10)\n  \u251c\u2500 Email: sales@acme.com (id=13, belongs_to_entity_id=10)\n  \u2514\u2500 Address: 456 Business Park (id=14, belongs_to_entity_id=10)\n"})}),"\n",(0,r.jsx)(n.h3,{id:"query-patterns",children:"Query Patterns"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Get all contact info for a person"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"SELECT * FROM oc_openregister_entities \nWHERE belongs_to_entity_id = 1;\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Get parent entity for a phone number"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"SELECT parent.* FROM oc_openregister_entities phone\nJOIN oc_openregister_entities parent ON phone.belongs_to_entity_id = parent.id\nWHERE phone.id = 2;\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Find all persons with a specific email domain"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"SELECT DISTINCT parent.* FROM oc_openregister_entities email\nJOIN oc_openregister_entities parent ON email.belongs_to_entity_id = parent.id\nWHERE email.type = 'email' \n  AND email.value LIKE '%@acme.com'\n  AND parent.type = 'person';\n"})}),"\n",(0,r.jsx)(n.h2,{id:"role-based-anonymization",children:"Role-Based Anonymization"}),"\n",(0,r.jsx)(n.h3,{id:"example-detection",children:"Example Detection"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Text: \"Contact John Doe (Sales Manager) at +31612345678\"\n\nEntities Detected:\n1. Person: John Doe (id=1)\n2. Phone: +31612345678 (id=2, belongs_to_entity_id=1)\n\nEntityRelation Records:\n1. entity_id=1, chunk_id=123, role='employee', position_start=8, position_end=16\n2. entity_id=2, chunk_id=123, role='employee', position_start=37, position_end=50\n\nAnonymization Decision:\n- John Doe: role='employee' \u2192 May not require anonymization (business context)\n- Phone: role='employee' \u2192 May not require anonymization (business contact)\n"})}),"\n",(0,r.jsx)(n.h3,{id:"example-private-individual",children:"Example: Private Individual"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Text: \"Please forward this to Jane Smith (customer) at jane.smith@gmail.com\"\n\nEntities Detected:\n1. Person: Jane Smith (id=20)\n2. Email: jane.smith@gmail.com (id=21, belongs_to_entity_id=20)\n\nEntityRelation Records:\n1. entity_id=20, chunk_id=456, role='customer', position_start=23, position_end=33\n2. entity_id=21, chunk_id=456, role='customer', position_start=48, position_end=69\n\nAnonymization Decision:\n- Jane Smith: role='customer' \u2192 Requires anonymization (private individual)\n- Email: role='customer' \u2192 Requires anonymization (personal email)\n"})}),"\n",(0,r.jsx)(n.h2,{id:"source-tracking-benefits",children:"Source Tracking Benefits"}),"\n",(0,r.jsx)(n.h3,{id:"scenario-file-re-chunking",children:"Scenario: File Re-chunking"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Initial State:\n- File: contract.pdf (file_id=100)\n- FileText: id=200 (extraction record)\n- Chunks: Created from file_id=100\n- Entities found in chunks\n\nAfter Re-chunking:\n- File: contract.pdf (file_id=100) - UNCHANGED\n- FileText: id=200 - Updated with new chunks\n- Chunks: NEW chunks created\n- EntityRelations: Still reference file_id=100 (original source)\n\nBenefit: Can always trace entities back to original file, even after re-chunking\n"})}),"\n",(0,r.jsx)(n.h3,{id:"scenario-gdpr-request",children:"Scenario: GDPR Request"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Request: 'Give me all documents containing John Doe'\n\nQuery:\nSELECT DISTINCT \n    er.file_id,\n    er.object_id,\n    er.email_id,\n    er.role,\n    er.created_at\nFROM oc_openregister_entities e\nJOIN oc_openregister_entity_relations er ON e.id = er.entity_id\nWHERE e.value = 'John Doe' AND e.type = 'person'\n\nResult:\nfile_id | object_id | email_id | role              | created_at\n--------|-----------|----------|-------------------|-------------------\n100     | NULL      | NULL     | employee          | 2024-01-15 10:30\nNULL    | 500       | NULL     | mentioned         | 2024-02-20 14:15\nNULL    | NULL      | 300      | recipient         | 2024-03-10 09:00\n150     | NULL      | NULL     | private_individual| 2024-04-05 16:45\n\nInterpretation:\n- contract.pdf (file 100): John Doe as employee\n- Customer record (object 500): John Doe mentioned\n- Email thread (email 300): John Doe as recipient\n- Personal letter (file 150): John Doe as private individual (requires anonymization)\n"})}),"\n",(0,r.jsx)(n.h2,{id:"php-entity-class-updates",children:"PHP Entity Class Updates"}),"\n",(0,r.jsx)(n.h3,{id:"gdprentity-class",children:"GdprEntity Class"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"class GdprEntity extends Entity implements JsonSerializable\n{\n    protected ?int $belongsToEntityId = null;  // NEW\n    \n    /**\n     * Get all child entities (contact info) for this entity\n     *\n     * @param EntityMapper $mapper\n     * @return GdprEntity[]\n     */\n    public function getChildren(EntityMapper $mapper): array\n    {\n        return $mapper->findByBelongsTo($this->id);\n    }\n    \n    /**\n     * Get the parent entity this belongs to\n     *\n     * @param EntityMapper $mapper\n     * @return GdprEntity|null\n     */\n    public function getParent(EntityMapper $mapper): ?GdprEntity\n    {\n        if ($this->belongsToEntityId === null) {\n            return null;\n        }\n        return $mapper->find($this->belongsToEntityId);\n    }\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"entityrelation-class",children:"EntityRelation Class"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"class EntityRelation extends Entity implements JsonSerializable\n{\n    protected ?string $role = null;     // NEW\n    protected ?int $fileId = null;      // NEW\n    protected ?int $objectId = null;    // NEW\n    protected ?int $emailId = null;     // NEW\n    \n    // Role constants\n    public const ROLE_PUBLIC_FIGURE = 'public_figure';\n    public const ROLE_EMPLOYEE = 'employee';\n    public const ROLE_PRIVATE_INDIVIDUAL = 'private_individual';\n    public const ROLE_CUSTOMER = 'customer';\n    \n    /**\n     * Check if this entity occurrence requires anonymization\n     *\n     * @return bool\n     */\n    public function requiresAnonymization(): bool\n    {\n        $nonPrivateRoles = [\n            self::ROLE_PUBLIC_FIGURE,\n            self::ROLE_EMPLOYEE,\n        ];\n        \n        if ($this->role && in_array($this->role, $nonPrivateRoles)) {\n            return false;\n        }\n        \n        return true; // Default: require anonymization\n    }\n    \n    /**\n     * Get source type and ID\n     *\n     * @return array{type: string, id: int}|null\n     */\n    public function getSource(): ?array\n    {\n        if ($this->fileId) return ['type' => 'file', 'id' => $this->fileId];\n        if ($this->objectId) return ['type' => 'object', 'id' => $this->objectId];\n        if ($this->emailId) return ['type' => 'email', 'id' => $this->emailId];\n        return null;\n    }\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"migration-from-entitylink-table",children:"Migration from EntityLink Table"}),"\n",(0,r.jsx)(n.h3,{id:"current-state-before",children:"Current State (Before)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"EntityLink table with many-to-many relationships:\n- source_entity_id\n- target_entity_id\n- relationship_type ('belongs_to', 'associated_with', etc.)\n"})}),"\n",(0,r.jsx)(n.h3,{id:"new-state-after",children:"New State (After)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Entity table with belongs_to_entity_id:\n- Direct foreign key to parent entity\n- Simpler queries\n- Better performance\n- More intuitive data model\n"})}),"\n",(0,r.jsx)(n.h3,{id:"migration-strategy",children:"Migration Strategy"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"-- Migrate EntityLink 'belongs_to' relationships to Entity.belongs_to_entity_id\nUPDATE oc_openregister_entities e\nJOIN oc_openregister_entity_links el ON e.id = el.source_entity_id\nSET e.belongs_to_entity_id = el.target_entity_id\nWHERE el.relationship_type = 'belongs_to';\n\n-- Drop EntityLink table (if no other relationship types needed)\nDROP TABLE oc_openregister_entity_links;\n"})}),"\n",(0,r.jsx)(n.h2,{id:"benefits-summary",children:"Benefits Summary"}),"\n",(0,r.jsx)(n.h3,{id:"1-simpler-data-model",children:"1. Simpler Data Model"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u2705 Direct foreign key instead of join table for belongs_to"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 One query instead of two to get contact info"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Intuitive parent-child structure"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"2-gdpr-compliance",children:"2. GDPR Compliance"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u2705 Role-based anonymization decisions"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Context-aware entity handling"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Public figures vs private individuals"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"3-robust-source-tracking",children:"3. Robust Source Tracking"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u2705 Always trace back to original document"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Survives re-chunking operations"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Complete audit trail"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"4-query-performance",children:"4. Query Performance"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u2705 Indexed belongs_to lookups"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Indexed role-based queries"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Indexed source-based queries"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"5-flexibility",children:"5. Flexibility"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u2705 Still supports complex relationships via EntityLink if needed"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Role field extensible for future needs"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Multiple source types supported"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"example-use-cases",children:"Example Use Cases"}),"\n",(0,r.jsx)(n.h3,{id:"use-case-1-complete-contact-profile",children:"Use Case 1: Complete Contact Profile"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"// Find person\n$person = $entityMapper->findByValue('John Doe', GdprEntity::TYPE_PERSON);\n\n// Get all contact info (one query)\n$contactInfo = $entityMapper->findByBelongsTo($person->getId());\n\nforeach ($contactInfo as $info) {\n    echo \"{$info->getType()}: {$info->getValue()}\\n\";\n}\n\n// Output:\n// phone: +31612345678\n// phone: +31687654321\n// email: john.doe@example.com\n// email: j.doe@company.com\n// address: 123 Main St, Amsterdam\n"})}),"\n",(0,r.jsx)(n.h3,{id:"use-case-2-role-based-anonymization",children:"Use Case 2: Role-Based Anonymization"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"// Find all entity occurrences requiring anonymization\n$relations = $entityRelationMapper->findAll();\n\nforeach ($relations as $relation) {\n    if ($relation->requiresAnonymization()) {\n        $entity = $entityMapper->find($relation->getEntityId());\n        \n        // Anonymize this occurrence\n        $anonymizedValue = $this->anonymize($entity->getType(), $entity->getId());\n        $relation->setAnonymized(true);\n        $relation->setAnonymizedValue($anonymizedValue);\n        $entityRelationMapper->update($relation);\n    }\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"use-case-3-source-document-retrieval",children:"Use Case 3: Source Document Retrieval"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"// Find all files containing a specific entity\n$entity = $entityMapper->findByValue('john.doe@example.com', GdprEntity::TYPE_EMAIL);\n$relations = $entityRelationMapper->findByEntityId($entity->getId());\n\n$files = [];\n$objects = [];\n$emails = [];\n\nforeach ($relations as $relation) {\n    if ($relation->getFileId()) {\n        $files[] = $relation->getFileId();\n    }\n    if ($relation->getObjectId()) {\n        $objects[] = $relation->getObjectId();\n    }\n    if ($relation->getEmailId()) {\n        $emails[] = $relation->getEmailId();\n    }\n}\n\n// Now retrieve actual documents\n$fileEntities = $fileMapper->findByIds(array_unique($files));\n$objectEntities = $objectMapper->findByIds(array_unique($objects));\n$emailEntities = $emailMapper->findByIds(array_unique($emails));\n"})}),"\n",(0,r.jsx)(n.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,r.jsx)(n.p,{children:"The updated entity relationship model provides:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Simpler structure"}),": Direct parent-child relationships via ",(0,r.jsx)(n.code,{children:"belongs_to_entity_id"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"GDPR compliance"}),": Role-based anonymization decisions"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Robust tracking"}),": Ultimate source document references"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Better performance"}),": Indexed queries for common patterns"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Flexibility"}),": Extensible for future requirements"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"This model is ready for implementation and addresses all the requirements for efficient GDPR entity management in the OpenRegister text extraction system."})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}}}]);