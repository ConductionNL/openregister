"use strict";(self.webpackChunkopen_catalogi_docs=self.webpackChunkopen_catalogi_docs||[]).push([[4383],{28453:(e,n,i)=>{i.d(n,{R:()=>l,x:()=>c});var s=i(96540);const r={},t=s.createContext(r);function l(e){const n=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),s.createElement(t.Provider,{value:n},e.children)}},62933:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>c,default:()=>h,frontMatter:()=>l,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"fixes/SCHEMA_FIX_SUMMARY","title":"Organisatie Schema Fix Summary","description":"Problem Description","source":"@site/docs/fixes/SCHEMA_FIX_SUMMARY.md","sourceDirName":"fixes","slug":"/fixes/SCHEMA_FIX_SUMMARY","permalink":"/docs/fixes/SCHEMA_FIX_SUMMARY","draft":false,"unlisted":false,"editUrl":"https://github.com/conductionnl/openregister/tree/main/website/docs/fixes/SCHEMA_FIX_SUMMARY.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"InversedBy Relaties Fixes - Samenvatting","permalink":"/docs/fixes/INVERSEDBY_FIXES_SUMMARY"},"next":{"title":"Search Optimization Implementation","permalink":"/docs/fixes/SEARCH_OPTIMIZATION"}}');var r=i(74848),t=i(28453);const l={},c="Organisatie Schema Fix Summary",o={},d=[{value:"Problem Description",id:"problem-description",level:2},{value:"Root Cause Analysis",id:"root-cause-analysis",level:2},{value:"Investigation Results",id:"investigation-results",level:3},{value:"Schema Configuration Differences",id:"schema-configuration-differences",level:3},{value:"Solution Implemented",id:"solution-implemented",level:2},{value:"1. Schema Investigation",id:"1-schema-investigation",level:3},{value:"2. Schema Update",id:"2-schema-update",level:3},{value:"3. Verification",id:"3-verification",level:3},{value:"Fix Results",id:"fix-results",level:2},{value:"\u2705 Schema Updates Successful",id:"-schema-updates-successful",level:3},{value:"\u2705 Configuration Verified",id:"-configuration-verified",level:3},{value:"How the Write-Back System Works",id:"how-the-write-back-system-works",level:2},{value:"Process Flow",id:"process-flow",level:3},{value:"Example",id:"example",level:3},{value:"Testing Instructions",id:"testing-instructions",level:2},{value:"1. Test Import Functionality",id:"1-test-import-functionality",level:3},{value:"2. Expected Results",id:"2-expected-results",level:3},{value:"3. Verification Steps",id:"3-verification-steps",level:3},{value:"4. API Testing Commands",id:"4-api-testing-commands",level:3},{value:"Files Created/Modified",id:"files-createdmodified",level:2},{value:"Investigation Scripts",id:"investigation-scripts",level:3},{value:"Exported Files",id:"exported-files",level:3},{value:"Documentation",id:"documentation",level:3},{value:"Technical Details",id:"technical-details",level:2},{value:"Backend Implementation",id:"backend-implementation",level:3},{value:"Key Configuration Properties",id:"key-configuration-properties",level:3},{value:"Processing Order",id:"processing-order",level:3},{value:"Conclusion",id:"conclusion",level:2}];function a(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"organisatie-schema-fix-summary",children:"Organisatie Schema Fix Summary"})}),"\n",(0,r.jsx)(n.h2,{id:"problem-description",children:"Problem Description"}),"\n",(0,r.jsxs)(n.p,{children:["The import of ",(0,r.jsx)(n.code,{children:"voorzieningen_organisaties.xlsx"})," was working correctly on the local environment but failing on the test environments (Accept and Test). The key issue was that the ",(0,r.jsx)(n.code,{children:"deelnemers"})," and ",(0,r.jsx)(n.code,{children:"deelnames"})," relationship was not being established properly during import."]}),"\n",(0,r.jsx)(n.h2,{id:"root-cause-analysis",children:"Root Cause Analysis"}),"\n",(0,r.jsx)(n.h3,{id:"investigation-results",children:"Investigation Results"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Local Environment"}),": \u2705 Working correctly"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"deelnemers"})," property present with ",(0,r.jsx)(n.code,{children:"writeBack: true"})]}),"\n",(0,r.jsxs)(n.li,{children:["Write-back functionality properly updates ",(0,r.jsx)(n.code,{children:"deelnames"})," arrays"]}),"\n",(0,r.jsx)(n.li,{children:"Import process establishes relationships correctly"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Test Environments"}),": \u274c Not working"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"deelnemers"})," property was ",(0,r.jsx)(n.strong,{children:"completely missing"})," from the organisatie schema"]}),"\n",(0,r.jsx)(n.li,{children:"No write-back functionality available"}),"\n",(0,r.jsx)(n.li,{children:"Import process could not establish relationships"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"schema-configuration-differences",children:"Schema Configuration Differences"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Local Environment (Working)"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "deelnemers": {\n    "type": "array",\n    "title": "deelnemers",\n    "description": "Organisaties die deelnemen aan deze community",\n    "items": {\n      "type": "object",\n      "objectConfiguration": {\n        "handling": "related-object"\n      },\n      "$ref": "#/components/schemas/organisatie",\n      "inversedBy": "deelnames",\n      "writeBack": true,\n      "removeAfterWriteBack": true\n    },\n    "facetable": false\n  }\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Test Environments (Before Fix)"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:"{\n  // deelnemers property was completely missing\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"solution-implemented",children:"Solution Implemented"}),"\n",(0,r.jsx)(n.h3,{id:"1-schema-investigation",children:"1. Schema Investigation"}),"\n",(0,r.jsxs)(n.p,{children:["Created ",(0,r.jsx)(n.code,{children:"investigate_schema_diff.php"})," to:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Compare schema configurations between environments"}),"\n",(0,r.jsx)(n.li,{children:"Export the working schema from local environment"}),"\n",(0,r.jsx)(n.li,{children:"Identify missing properties and configurations"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"2-schema-update",children:"2. Schema Update"}),"\n",(0,r.jsxs)(n.p,{children:["Created ",(0,r.jsx)(n.code,{children:"update_test_schemas.php"})," to:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Update test environments with the correct schema configuration"}),"\n",(0,r.jsxs)(n.li,{children:["Add the missing ",(0,r.jsx)(n.code,{children:"deelnemers"})," property with proper write-back configuration"]}),"\n",(0,r.jsx)(n.li,{children:"Test the functionality after update"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"3-verification",children:"3. Verification"}),"\n",(0,r.jsxs)(n.p,{children:["Created ",(0,r.jsx)(n.code,{children:"verify_schema_update.php"})," to:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Confirm that schema updates were successful"}),"\n",(0,r.jsx)(n.li,{children:"Verify that all required properties are present"}),"\n",(0,r.jsx)(n.li,{children:"Check that configuration values are correct"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"fix-results",children:"Fix Results"}),"\n",(0,r.jsx)(n.h3,{id:"-schema-updates-successful",children:"\u2705 Schema Updates Successful"}),"\n",(0,r.jsx)(n.p,{children:"Both test environments now have the correct configuration:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Accept Environment"}),": \u2705 Updated successfully"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Test Environment"}),": \u2705 Updated successfully"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"-configuration-verified",children:"\u2705 Configuration Verified"}),"\n",(0,r.jsx)(n.p,{children:"All environments now have:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"deelnemers"})," property present"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"writeBack: true"})," - Enables automatic updates to ",(0,r.jsx)(n.code,{children:"deelnames"})," arrays"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"removeAfterWriteBack: true"})," - Removes ",(0,r.jsx)(n.code,{children:"deelnemers"})," from source after processing"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:'inversedBy: "deelnames"'})," - Specifies the target property to update"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"how-the-write-back-system-works",children:"How the Write-Back System Works"}),"\n",(0,r.jsx)(n.h3,{id:"process-flow",children:"Process Flow"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Import Process"}),": Excel file contains samenwerking objects with ",(0,r.jsx)(n.code,{children:"deelnemers"})," arrays"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Object Creation"}),": Samenwerking objects are created with ",(0,r.jsx)(n.code,{children:"deelnemers"})," property"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Write-Back Processing"}),": ",(0,r.jsx)(n.code,{children:"handleInverseRelationsWriteBack()"})," method:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Detects properties with ",(0,r.jsx)(n.code,{children:"writeBack: true"})]}),"\n",(0,r.jsx)(n.li,{children:"Finds referenced organisations using UUIDs"}),"\n",(0,r.jsxs)(n.li,{children:["Updates each organisation's ",(0,r.jsx)(n.code,{children:"deelnames"})," array"]}),"\n",(0,r.jsxs)(n.li,{children:["Adds the samenwerking UUID to the ",(0,r.jsx)(n.code,{children:"deelnames"})," array"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Cleanup"}),": ",(0,r.jsx)(n.code,{children:"deelnemers"})," property is removed from samenwerking (if ",(0,r.jsx)(n.code,{children:"removeAfterWriteBack: true"}),")"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"example",children:"Example"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Before Import"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'// Organisation A\n{\n  "id": "org-a-uuid",\n  "naam": "Gemeente Amsterdam",\n  "type": "Gemeente",\n  "deelnames": []\n}\n\n// Samenwerking (from Excel)\n{\n  "naam": "Test Samenwerking",\n  "type": "Samenwerking", \n  "deelnemers": ["org-a-uuid"]\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"After Import"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'// Organisation A (updated)\n{\n  "id": "org-a-uuid",\n  "naam": "Gemeente Amsterdam",\n  "type": "Gemeente",\n  "deelnames": ["samenwerking-uuid"]  // \u2190 Automatically updated\n}\n\n// Samenwerking (created)\n{\n  "id": "samenwerking-uuid",\n  "naam": "Test Samenwerking",\n  "type": "Samenwerking",\n  "deelnemers": []  // \u2190 Removed after write-back\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"testing-instructions",children:"Testing Instructions"}),"\n",(0,r.jsx)(n.h3,{id:"1-test-import-functionality",children:"1. Test Import Functionality"}),"\n",(0,r.jsx)(n.p,{children:"You can now test the import functionality on all environments:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Local Environment"}),": Should continue working as before"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Accept Environment"}),": Should now work correctly"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Test Environment"}),": Should now work correctly"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"2-expected-results",children:"2. Expected Results"}),"\n",(0,r.jsxs)(n.p,{children:["After importing ",(0,r.jsx)(n.code,{children:"voorzieningen_organisaties.xlsx"}),":"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Samenwerking objects"})," should be created successfully"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Gemeente objects"})," should have their ",(0,r.jsx)(n.code,{children:"deelnames"})," arrays updated with samenwerking UUIDs"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Samenwerking objects"})," should have empty ",(0,r.jsx)(n.code,{children:"deelnemers"})," arrays (due to ",(0,r.jsx)(n.code,{children:"removeAfterWriteBack: true"}),")"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"3-verification-steps",children:"3. Verification Steps"}),"\n",(0,r.jsx)(n.p,{children:"To verify the fix is working:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Check Samenwerking objects"}),": Should exist with empty ",(0,r.jsx)(n.code,{children:"deelnemers"})," arrays"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Check Gemeente objects"}),": Should have samenwerking UUIDs in their ",(0,r.jsx)(n.code,{children:"deelnames"})," arrays"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Test API calls"}),": Use ",(0,r.jsx)(n.code,{children:"?extend=deelnemers"})," to verify inverse relationships are populated"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"4-api-testing-commands",children:"4. API Testing Commands"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Check a samenwerking object\ncurl -u 'admin:admin' -H 'OCS-APIREQUEST: true' \\\n  'https://vng.accept.commonground.nu/index.php/apps/openregister/api/objects/6/35/SAMENWERKING-UUID'\n\n# Check a gemeente object to see deelnames\ncurl -u 'admin:admin' -H 'OCS-APIREQUEST: true' \\\n  'https://vng.accept.commonground.nu/index.php/apps/openregister/api/objects/6/35/GEMEENTE-UUID'\n\n# Test inverse relationship population\ncurl -u 'admin:admin' -H 'OCS-APIREQUEST: true' \\\n  'https://vng.accept.commonground.nu/index.php/apps/openregister/api/objects/6/35/SAMENWERKING-UUID?extend=deelnemers'\n"})}),"\n",(0,r.jsx)(n.h2,{id:"files-createdmodified",children:"Files Created/Modified"}),"\n",(0,r.jsx)(n.h3,{id:"investigation-scripts",children:"Investigation Scripts"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"investigate_schema_diff.php"})," - Schema comparison and export"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"update_test_schemas.php"})," - Schema update automation"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"verify_schema_update.php"})," - Update verification"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"exported-files",children:"Exported Files"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"organisatie_schema_local.json"})," - Working schema configuration"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"documentation",children:"Documentation"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"SCHEMA_FIX_SUMMARY.md"})," - This summary document"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"technical-details",children:"Technical Details"}),"\n",(0,r.jsx)(n.h3,{id:"backend-implementation",children:"Backend Implementation"}),"\n",(0,r.jsx)(n.p,{children:"The write-back functionality is implemented in:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"File"}),": ",(0,r.jsx)(n.code,{children:"lib/Service/ObjectHandlers/SaveObject.php"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Method"}),": ",(0,r.jsx)(n.code,{children:"handleInverseRelationsWriteBack()"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Order"}),": Called after cascading but before default values"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"key-configuration-properties",children:"Key Configuration Properties"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"writeBack: true"})}),": Enables automatic updates to target objects"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"removeAfterWriteBack: true"})}),": Removes source property after processing"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:'inversedBy: "deelnames"'})}),": Specifies target property to update"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:'objectConfiguration.handling: "related-object"'})}),": Handles as related objects"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"processing-order",children:"Processing Order"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Sanitization"}),": Clean empty values"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Cascading"}),": Handle object cascading (skips writeBack properties)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Write-Back"}),": Process inverse relationships with write-back"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Default Values"}),": Set any default values"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,r.jsxs)(n.p,{children:["The issue has been successfully resolved by updating the organisatie schema on the test environments to include the missing ",(0,r.jsx)(n.code,{children:"deelnemers"})," property with the correct write-back configuration. The import functionality should now work consistently across all environments."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Status"}),": \u2705 ",(0,r.jsx)(n.strong,{children:"RESOLVED"})]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}}}]);