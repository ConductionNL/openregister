"use strict";(self.webpackChunkopen_catalogi_docs=self.webpackChunkopen_catalogi_docs||[]).push([[8135],{28453:(e,n,i)=>{i.d(n,{R:()=>r,x:()=>l});var a=i(96540);const t={},s=a.createContext(t);function r(e){const n=a.useContext(s);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),a.createElement(s.Provider,{value:n},e.children)}},34468:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>r,metadata:()=>a,toc:()=>d});const a=JSON.parse('{"id":"developers/self-metadata-handling","title":"@self Metadata Handling","description":"The OpenRegister application uses a sophisticated @self metadata system to manage object ownership, organization assignment, and publication states. This system ensures proper data integrity and supports advanced features like organization self-ownership.","source":"@site/docs/developers/self-metadata-handling.md","sourceDirName":"developers","slug":"/developers/self-metadata-handling","permalink":"/docs/developers/self-metadata-handling","draft":false,"unlisted":false,"editUrl":"https://github.com/conductionnl/openregister/tree/main/website/docs/developers/self-metadata-handling.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Response Classes","permalink":"/docs/developers/response-classes"},"next":{"title":"Tool Registration","permalink":"/docs/development/tool-registration"}}');var t=i(74848),s=i(28453);const r={},l="@self Metadata Handling",o={},d=[{value:"Overview",id:"overview",level:2},{value:"@self Metadata Fields",id:"self-metadata-fields",level:2},{value:"Core Fields",id:"core-fields",level:3},{value:"Ownership and Organization",id:"ownership-and-organization",level:3},{value:"Publication State",id:"publication-state",level:3},{value:"Setting @self Metadata via API",id:"setting-self-metadata-via-api",level:2},{value:"Allowed Properties",id:"allowed-properties",level:3},{value:"Supported @self Properties",id:"supported-self-properties",level:3},{value:"Organization Self-Ownership",id:"organization-self-ownership",level:2},{value:"Use Case: Organization Activation",id:"use-case-organization-activation",level:3},{value:"Implementation Details",id:"implementation-details",level:3},{value:"1. ObjectsController Filtering",id:"1-objectscontroller-filtering",level:4},{value:"2. SaveObject Metadata Handling",id:"2-saveobject-metadata-handling",level:4},{value:"3. Active Organization Override Prevention",id:"3-active-organization-override-prevention",level:4},{value:"Best Practices",id:"best-practices",level:2},{value:"1. Organization Self-Ownership",id:"1-organization-self-ownership",level:3},{value:"2. Publication Management",id:"2-publication-management",level:3},{value:"3. Ownership Transfer",id:"3-ownership-transfer",level:3},{value:"Security Considerations",id:"security-considerations",level:2},{value:"1. Access Control",id:"1-access-control",level:3},{value:"2. Data Integrity",id:"2-data-integrity",level:3},{value:"3. Audit Trail",id:"3-audit-trail",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Common Issues",id:"common-issues",level:3},{value:"1. @self Metadata Not Applied",id:"1-self-metadata-not-applied",level:4},{value:"2. Organization Not Self-Owning",id:"2-organization-not-self-owning",level:4},{value:"3. Active Organization Override",id:"3-active-organization-override",level:4},{value:"API Examples",id:"api-examples",level:2},{value:"Create Object with Self-Ownership",id:"create-object-with-self-ownership",level:3},{value:"Update Object Publication State",id:"update-object-publication-state",level:3},{value:"Transfer Object Ownership",id:"transfer-object-ownership",level:3},{value:"Related Documentation",id:"related-documentation",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"self-metadata-handling",children:"@self Metadata Handling"})}),"\n",(0,t.jsx)(n.p,{children:"The OpenRegister application uses a sophisticated @self metadata system to manage object ownership, organization assignment, and publication states. This system ensures proper data integrity and supports advanced features like organization self-ownership."}),"\n",(0,t.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,t.jsxs)(n.p,{children:["The @self metadata is a special object property that contains system-managed information about an object. It includes fields like ",(0,t.jsx)(n.code,{children:"owner"}),", ",(0,t.jsx)(n.code,{children:"organisation"}),", ",(0,t.jsx)(n.code,{children:"published"}),", ",(0,t.jsx)(n.code,{children:"depublished"}),", and other metadata that control object behavior and access."]}),"\n",(0,t.jsx)(n.h2,{id:"self-metadata-fields",children:"@self Metadata Fields"}),"\n",(0,t.jsx)(n.h3,{id:"core-fields",children:"Core Fields"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.code,{children:"id"})}),": Object UUID"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.code,{children:"name"})}),": Object display name"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.code,{children:"register"})}),": Register identifier"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.code,{children:"schema"})}),": Schema identifier"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.code,{children:"created"})}),": Creation timestamp"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.code,{children:"updated"})}),": Last update timestamp"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"ownership-and-organization",children:"Ownership and Organization"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.code,{children:"owner"})}),": UUID of the user or entity that owns this object"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.code,{children:"organisation"})}),": UUID of the organization this object belongs to"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"publication-state",children:"Publication State"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.code,{children:"published"})}),": Publication timestamp (when object becomes publicly visible)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.code,{children:"depublished"})}),": Depublication timestamp (when object becomes private again)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.code,{children:"deleted"})}),": Soft deletion timestamp"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"setting-self-metadata-via-api",children:"Setting @self Metadata via API"}),"\n",(0,t.jsx)(n.h3,{id:"allowed-properties",children:"Allowed Properties"}),"\n",(0,t.jsx)(n.p,{children:"When creating or updating objects via the API, you can explicitly set certain @self metadata properties:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "naam": "My Organization",\n  "type": "Leverancier",\n  "@self": {\n    "owner": "organization-uuid",\n    "organisation": "organization-uuid",\n    "published": "2024-01-01T00:00:00Z",\n    "depublished": null\n  }\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"supported-self-properties",children:"Supported @self Properties"}),"\n",(0,t.jsx)(n.p,{children:"The following @self properties can be explicitly set via API requests:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"owner"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"organisation"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"published"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"depublished"})}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Other @self properties are system-managed and cannot be overridden."}),"\n",(0,t.jsx)(n.h2,{id:"organization-self-ownership",children:"Organization Self-Ownership"}),"\n",(0,t.jsx)(n.p,{children:"A key feature of the @self metadata system is support for organization self-ownership, where an organization object owns itself."}),"\n",(0,t.jsx)(n.h3,{id:"use-case-organization-activation",children:"Use Case: Organization Activation"}),"\n",(0,t.jsx)(n.p,{children:"When an organization is activated in external applications (like softwarecatalog), the organization should become the owner of its own object:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "status": "Actief",\n  "@self": {\n    "owner": "organization-uuid",\n    "organisation": "organization-uuid"\n  }\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"implementation-details",children:"Implementation Details"}),"\n",(0,t.jsx)(n.p,{children:"The system handles organization self-ownership through several components:"}),"\n",(0,t.jsx)(n.h4,{id:"1-objectscontroller-filtering",children:"1. ObjectsController Filtering"}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"ObjectsController"})," allows specific @self properties to pass through request filtering:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"// Allow specific @self metadata properties for organization activation\n$requestParams = $this->request->getParams();\nif (isset($requestParams['@self']) && is_array($requestParams['@self'])) {\n    $allowedSelfProperties = ['owner', 'organisation', 'published', 'depublished'];\n    $filteredSelf = array_intersect_key(\n        $requestParams['@self'],\n        array_flip($allowedSelfProperties)\n    );\n    if (!empty($filteredSelf)) {\n        $object['@self'] = $filteredSelf;\n    }\n}\n"})}),"\n",(0,t.jsx)(n.h4,{id:"2-saveobject-metadata-handling",children:"2. SaveObject Metadata Handling"}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"SaveObject"})," service processes @self metadata and applies it to the object entity:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"// Set organisation from @self metadata if provided\nif (array_key_exists('organisation', $selfData) && !empty($selfData['organisation'])) {\n    $objectEntity->setOrganisation($selfData['organisation']);\n}\n\n// Set owner from @self metadata if provided  \nif (array_key_exists('owner', $selfData) && !empty($selfData['owner'])) {\n    $objectEntity->setOwner($selfData['owner']);\n}\n"})}),"\n",(0,t.jsx)(n.h4,{id:"3-active-organization-override-prevention",children:"3. Active Organization Override Prevention"}),"\n",(0,t.jsx)(n.p,{children:"The system prevents automatic organization assignment from overriding explicit @self metadata:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"// Set organisation from active organisation if not already set\n// BUT: Don't override if organisation was explicitly set via @self metadata\nif (($objectEntity->getOrganisation() === null || $objectEntity->getOrganisation() === '') \n    && !isset($selfData['organisation'])) {\n    $organisationUuid = $this->organisationService->getOrganisationForNewEntity();\n    $objectEntity->setOrganisation($organisationUuid);\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,t.jsx)(n.h3,{id:"1-organization-self-ownership",children:"1. Organization Self-Ownership"}),"\n",(0,t.jsx)(n.p,{children:"When implementing organization activation:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"// \u2705 Correct: Set both owner and organisation to the organization's UUID\n$updateData = [\n    'status' => 'Actief',\n    '@self' => [\n        'owner' => $organizationUuid,\n        'organisation' => $organizationUuid\n    ]\n];\n"})}),"\n",(0,t.jsx)(n.h3,{id:"2-publication-management",children:"2. Publication Management"}),"\n",(0,t.jsx)(n.p,{children:"When managing object publication:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"// \u2705 Publish an object\n$updateData = [\n    '@self' => [\n        'published' => date('c'), // Current timestamp\n        'depublished' => null\n    ]\n];\n\n// \u2705 Depublish an object\n$updateData = [\n    '@self' => [\n        'depublished' => date('c') // Current timestamp\n    ]\n];\n"})}),"\n",(0,t.jsx)(n.h3,{id:"3-ownership-transfer",children:"3. Ownership Transfer"}),"\n",(0,t.jsx)(n.p,{children:"When transferring object ownership:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"// \u2705 Transfer ownership to another user/organization\n$updateData = [\n    '@self' => [\n        'owner' => $newOwnerUuid,\n        'organisation' => $newOrganisationUuid\n    ]\n];\n"})}),"\n",(0,t.jsx)(n.h2,{id:"security-considerations",children:"Security Considerations"}),"\n",(0,t.jsx)(n.h3,{id:"1-access-control",children:"1. Access Control"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Only authorized users can modify @self metadata"}),"\n",(0,t.jsx)(n.li,{children:"RBAC rules apply to @self metadata modifications"}),"\n",(0,t.jsx)(n.li,{children:"Admin users have broader @self metadata modification rights"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"2-data-integrity",children:"2. Data Integrity"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"The system validates @self metadata values"}),"\n",(0,t.jsx)(n.li,{children:"Invalid UUIDs are rejected"}),"\n",(0,t.jsx)(n.li,{children:"Circular ownership references are prevented"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"3-audit-trail",children:"3. Audit Trail"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"All @self metadata changes are logged"}),"\n",(0,t.jsx)(n.li,{children:"Ownership transfers are tracked"}),"\n",(0,t.jsx)(n.li,{children:"Publication state changes are recorded"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,t.jsx)(n.h3,{id:"common-issues",children:"Common Issues"}),"\n",(0,t.jsx)(n.h4,{id:"1-self-metadata-not-applied",children:"1. @self Metadata Not Applied"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Problem"}),": @self metadata in API request is ignored"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Solution"}),": Ensure you're setting allowed properties (",(0,t.jsx)(n.code,{children:"owner"}),", ",(0,t.jsx)(n.code,{children:"organisation"}),", ",(0,t.jsx)(n.code,{children:"published"}),", ",(0,t.jsx)(n.code,{children:"depublished"}),")"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:'// \u274c Wrong: Setting non-allowed property\n{\n  "@self": {\n    "created": "2024-01-01T00:00:00Z"  // This will be ignored\n  }\n}\n\n// \u2705 Correct: Setting allowed property\n{\n  "@self": {\n    "owner": "user-uuid"  // This will be applied\n  }\n}\n'})}),"\n",(0,t.jsx)(n.h4,{id:"2-organization-not-self-owning",children:"2. Organization Not Self-Owning"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Problem"}),": Organization activation doesn't set self-ownership"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Solution"}),": Explicitly set both ",(0,t.jsx)(n.code,{children:"owner"})," and ",(0,t.jsx)(n.code,{children:"organisation"})," in @self metadata:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"// \u2705 Correct approach\n$updateData = [\n    'status' => 'Actief',\n    '@self' => [\n        'owner' => $organizationUuid,\n        'organisation' => $organizationUuid\n    ]\n];\n"})}),"\n",(0,t.jsx)(n.h4,{id:"3-active-organization-override",children:"3. Active Organization Override"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Problem"}),": System overrides explicit @self.organisation with active organization"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Solution"}),": The system now respects explicit @self metadata and won't override it with active organization settings."]}),"\n",(0,t.jsx)(n.h2,{id:"api-examples",children:"API Examples"}),"\n",(0,t.jsx)(n.h3,{id:"create-object-with-self-ownership",children:"Create Object with Self-Ownership"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'POST /api/objects/1/7\nContent-Type: application/json\n\n{\n  "naam": "My Organization",\n  "type": "Leverancier",\n  "@self": {\n    "owner": "org-uuid-123",\n    "organisation": "org-uuid-123"\n  }\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"update-object-publication-state",children:"Update Object Publication State"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'PATCH /api/objects/1/7/object-uuid\nContent-Type: application/json\n\n{\n  "@self": {\n    "published": "2024-01-01T00:00:00Z",\n    "depublished": null\n  }\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"transfer-object-ownership",children:"Transfer Object Ownership"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'PATCH /api/objects/1/7/object-uuid\nContent-Type: application/json\n\n{\n  "@self": {\n    "owner": "new-owner-uuid",\n    "organisation": "new-org-uuid"\n  }\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/docs/api/objects",children:"Objects API"})," - Complete API reference"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/docs/developers/object-handling",children:"Object Handling"})," - Object service usage"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/docs/Features/multi-tenancy",children:"Multi-tenancy"})," - Organization-based access control"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/docs/Features/access-control",children:"Access Control"})," - RBAC and permissions"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}}}]);