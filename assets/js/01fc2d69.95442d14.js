"use strict";(self.webpackChunkopen_catalogi_docs=self.webpackChunkopen_catalogi_docs||[]).push([[5190],{28453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>a});var i=t(96540);const o={},s=i.createContext(o);function r(e){const n=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),i.createElement(s.Provider,{value:n},e.children)}},79715:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>r,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"technical/text-extraction-entities","title":"Text Extraction Database Entities","description":"This document describes the database schema for the enhanced text extraction system including chunking, GDPR entity tracking, and language analysis.","source":"@site/docs/technical/text-extraction-entities.md","sourceDirName":"technical","slug":"/technical/text-extraction-entities","permalink":"/docs/technical/text-extraction-entities","draft":false,"unlisted":false,"editUrl":"https://github.com/conductionnl/openregister/tree/main/website/docs/technical/text-extraction-entities.md","tags":[],"version":"current","sidebarPosition":30,"frontMatter":{"title":"Text Extraction Database Entities","sidebar_position":30},"sidebar":"tutorialSidebar","previous":{"title":"Authorization Exceptions Performance","permalink":"/docs/technical/authorization-exceptions-performance"},"next":{"title":"Property Validation Test Matrix","permalink":"/docs/technical/property-validation"}}');var o=t(74848),s=t(28453);const r={title:"Text Extraction Database Entities",sidebar_position:30},a="Text Extraction Database Entities",l={},d=[{value:"Multi-Tenancy Support",id:"multi-tenancy-support",level:2},{value:"Entity Relationship Diagram",id:"entity-relationship-diagram",level:2},{value:"Processing Architecture Overview",id:"processing-architecture-overview",level:2},{value:"Service Responsibility Diagram",id:"service-responsibility-diagram",level:2},{value:"1. FileText Entity (Existing, Updated)",id:"1-filetext-entity-existing-updated",level:2},{value:"Current Schema",id:"current-schema",level:3},{value:"Changes Required",id:"changes-required",level:3},{value:"2. ObjectText Entity (New)",id:"2-objecttext-entity-new",level:2},{value:"Schema",id:"schema",level:3},{value:"Fields",id:"fields",level:3},{value:"PHP Entity Class",id:"php-entity-class",level:3},{value:"3. Chunk Entity (New)",id:"3-chunk-entity-new",level:2},{value:"Schema",id:"schema-1",level:3},{value:"Fields",id:"fields-1",level:3},{value:"PHP Entity Class",id:"php-entity-class-1",level:3},{value:"4. Entity (GDPR) Entity (New)",id:"4-entity-gdpr-entity-new",level:2},{value:"Schema",id:"schema-2",level:3},{value:"Fields",id:"fields-2",level:3},{value:"PHP Entity Class",id:"php-entity-class-2",level:3},{value:"5. EntityRelation Entity (New)",id:"5-entityrelation-entity-new",level:2},{value:"Schema",id:"schema-3",level:3},{value:"Fields",id:"fields-3",level:3},{value:"PHP Entity Class",id:"php-entity-class-3",level:3},{value:"6. EntityLink Entity (New)",id:"6-entitylink-entity-new",level:2},{value:"Schema",id:"schema-4",level:3},{value:"Fields",id:"fields-4",level:3},{value:"Relationship Types",id:"relationship-types",level:3},{value:"belongs_to: Contact Information Ownership",id:"belongs_to-contact-information-ownership",level:4},{value:"associated_with: Generic Association",id:"associated_with-generic-association",level:4},{value:"primary_contact / alternate_contact: Contact Priority",id:"primary_contact--alternate_contact-contact-priority",level:4},{value:"PHP Entity Class",id:"php-entity-class-4",level:3},{value:"Detection Methods",id:"detection-methods",level:3},{value:"1. Proximity Detection",id:"1-proximity-detection",level:4},{value:"2. Pattern Matching",id:"2-pattern-matching",level:4},{value:"3. LLM Analysis",id:"3-llm-analysis",level:4},{value:"4. Inference",id:"4-inference",level:4},{value:"Use Cases",id:"use-cases",level:3},{value:"1. Complete GDPR Profile",id:"1-complete-gdpr-profile",level:4},{value:"2. Organization Profile",id:"2-organization-profile",level:4},{value:"3. Anonymization Planning",id:"3-anonymization-planning",level:4},{value:"4. Entity Deduplication",id:"4-entity-deduplication",level:4},{value:"5. Role-Based Anonymization",id:"5-role-based-anonymization",level:4},{value:"6. Source Document Retrieval for GDPR Requests",id:"6-source-document-retrieval-for-gdpr-requests",level:4},{value:"Relationship Scope Clarification",id:"relationship-scope-clarification",level:3},{value:"Query Patterns",id:"query-patterns",level:3},{value:"Using belongs_to_entity_id (Direct Parent-Child)",id:"using-belongs_to_entity_id-direct-parent-child",level:4},{value:"Get Parent Entity for Contact Info",id:"get-parent-entity-for-contact-info",level:4},{value:"Find All Persons with Specific Email Domain",id:"find-all-persons-with-specific-email-domain",level:4},{value:"Find All Entities Requiring Anonymization (Role-Based)",id:"find-all-entities-requiring-anonymization-role-based",level:4},{value:"Knowledge Graph Queries",id:"knowledge-graph-queries",level:3},{value:"Get All Contact Info for a Person",id:"get-all-contact-info-for-a-person",level:4},{value:"Find Who a Phone Number Belongs To",id:"find-who-a-phone-number-belongs-to",level:4},{value:"Get All Contact Methods for Organization",id:"get-all-contact-methods-for-organization",level:4},{value:"Migration Strategy",id:"migration-strategy",level:2},{value:"Phase 1: Add New Tables (Immediate)",id:"phase-1-add-new-tables-immediate",level:3},{value:"Phase 2: Populate Chunks Table (Background Job)",id:"phase-2-populate-chunks-table-background-job",level:3},{value:"Phase 3: Language Detection (Optional, Background Job)",id:"phase-3-language-detection-optional-background-job",level:3},{value:"Phase 4: Entity Extraction (Optional, Background Job)",id:"phase-4-entity-extraction-optional-background-job",level:3},{value:"Phase 5: Deprecate chunks_json (Future)",id:"phase-5-deprecate-chunks_json-future",level:3},{value:"Indexes and Performance",id:"indexes-and-performance",level:2},{value:"Recommended Indexes",id:"recommended-indexes",level:3},{value:"Query Performance Estimates",id:"query-performance-estimates",level:3},{value:"Storage Requirements",id:"storage-requirements",level:2},{value:"Estimated Space",id:"estimated-space",level:3},{value:"Example: 10,000 Documents",id:"example-10000-documents",level:3},{value:"Maintenance",id:"maintenance",level:2},{value:"Cleanup Strategies",id:"cleanup-strategies",level:3},{value:"Monitoring",id:"monitoring",level:3},{value:"API Query Examples",id:"api-query-examples",level:2},{value:"Get All Chunks for a File",id:"get-all-chunks-for-a-file",level:3},{value:"Find Entities in a Chunk",id:"find-entities-in-a-chunk",level:3},{value:"GDPR Report: All Persons",id:"gdpr-report-all-persons",level:3},{value:"Find All Chunks in a Specific Language",id:"find-all-chunks-in-a-specific-language",level:3},{value:"Conclusion",id:"conclusion",level:2}];function c(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"text-extraction-database-entities",children:"Text Extraction Database Entities"})}),"\n",(0,o.jsx)(n.p,{children:"This document describes the database schema for the enhanced text extraction system including chunking, GDPR entity tracking, and language analysis."}),"\n",(0,o.jsx)(n.h2,{id:"multi-tenancy-support",children:"Multi-Tenancy Support"}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"All new entities support multi-tenancy"})," with owner and organisation fields:"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"owner"}),": User ID of the content owner (inherited from source file/object)"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"organisation"}),": Organisation UUID (inherited from source file/object)"]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"This ensures:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Users only see chunks/entities from their own content or shared content"}),"\n",(0,o.jsx)(n.li,{children:"Organisation-level access control"}),"\n",(0,o.jsx)(n.li,{children:"Proper data isolation in multi-tenant deployments"}),"\n",(0,o.jsx)(n.li,{children:"GDPR compliance per organisation"}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Inheritance Rules"}),":"]}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"File chunks"}),": Inherit owner/organisation from file metadata"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Object chunks"}),": Inherit owner/organisation from object entity"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Entities"}),": Inherit from the chunk where first detected"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Entity relations"}),": No separate owner (use entity's owner)"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"entity-relationship-diagram",children:"Entity Relationship Diagram"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-mermaid",children:"erDiagram\n    FileText ||--o{ Chunk : contains\n    ObjectText ||--o{ Chunk : contains\n    Chunk ||--o{ EntityRelation : has\n    Entity ||--o{ EntityRelation : appears-in\n    Entity ||--o{ EntityLink : source\n    Entity ||--o{ EntityLink : target\n    Chunk ||--o| VectorEmbedding : has\n    \n    FileText {\n        bigint id PK\n        string uuid UK\n        bigint file_id UK\n        string file_path\n        string file_name\n        string mime_type\n        bigint file_size\n        string file_checksum\n        mediumtext text_content\n        int text_length\n        string extraction_method\n        string extraction_status\n        text extraction_error\n        boolean chunked\n        int chunk_count\n        longtext chunks_json\n        boolean indexed_in_solr\n        boolean vectorized\n        datetime created_at\n        datetime updated_at\n        datetime extracted_at\n    }\n    \n    ObjectText {\n        bigint id PK\n        string uuid UK\n        bigint object_id UK\n        string register\n        string schema\n        mediumtext text_blob\n        int text_length\n        json property_map\n        string extraction_status\n        boolean chunked\n        int chunk_count\n        datetime created_at\n        datetime updated_at\n    }\n    \n    Chunk {\n        bigint id PK\n        string uuid UK\n        string source_type\n        bigint source_id\n        text text_content\n        int start_offset\n        int end_offset\n        int chunk_index\n        json position_reference\n        string language\n        string language_level\n        float language_confidence\n        string detection_method\n        boolean indexed_in_solr\n        boolean vectorized\n        datetime created_at\n        datetime updated_at\n    }\n    \n    Entity {\n        bigint id PK\n        string uuid UK\n        string type\n        text value\n        string category\n        bigint belongs_to_entity_id FK\n        json metadata\n        datetime detected_at\n        datetime updated_at\n    }\n    \n    EntityRelation {\n        bigint id PK\n        bigint entity_id FK\n        bigint chunk_id FK\n        string role\n        bigint file_id FK\n        bigint object_id FK\n        bigint email_id FK\n        int position_start\n        int position_end\n        decimal confidence\n        string detection_method\n        text context\n        boolean anonymized\n        string anonymized_value\n        datetime created_at\n    }\n    \n    EntityLink {\n        bigint id PK\n        bigint source_entity_id FK\n        bigint target_entity_id FK\n        string relationship_type\n        decimal confidence\n        string detection_method\n        json metadata\n        datetime created_at\n    }\n    \n    VectorEmbedding {\n        bigint id PK\n        bigint chunk_id FK\n        string model\n        blob vector_data\n        int dimensions\n        datetime created_at\n    }\n"})}),"\n",(0,o.jsx)(n.h2,{id:"processing-architecture-overview",children:"Processing Architecture Overview"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-mermaid",children:"flowchart LR\n    subgraph Sources\n        Files(Files & attachments)\n        Objects(OpenRegister objects)\n        Mail(Mail threads)\n        Talk(Talk chats)\n        Calendar(Calendar items)\n    end\n\n    Files --\x3e|File upload| FileExtract(FileTextExtractionService)\n    Objects --\x3e|Object save| ObjectExtract(ObjectTextExtractionService)\n    Mail --\x3e StreamIngest(Stream Ingestion Bridge)\n    Talk --\x3e StreamIngest\n    Calendar --\x3e StreamIngest\n\n    FileExtract --\x3e Chunker(ChunkService)\n    ObjectExtract --\x3e Chunker\n    StreamIngest --\x3e Chunker\n\n    Chunker --\x3e LangDetect(LanguageDetectionJob)\n    LangDetect --\x3e EntityDetect(EntityExtractionService)\n    Chunker --\x3e Vectorize(VectorizationService)\n    Chunker --\x3e SolrPush(SolrFileService)\n\n    EntityDetect --\x3e GdprEntities(GdprEntityMapper)\n    EntityDetect --\x3e EntityRelations(EntityRelationMapper)\n    EntityRelations --\x3e GdprReports(GDPR Report API)\n\n    GdprEntities --\x3e Classification(ClassificationService)\n    Chunker --\x3e StatsAggregator(TextExtractionService.getStats)\n    GdprEntities --\x3e StatsAggregator\n"})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Key points"}),":"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"All inputs (files, object attachments, mails, chats, calendar items) converge on the same chunking pipeline, guaranteeing consistent language detection and embedding preparation."}),"\n",(0,o.jsx)(n.li,{children:"Vectorization and Solr indexing operate purely on chunks so that future sources automatically benefit."}),"\n",(0,o.jsx)(n.li,{children:"GDPR entities always originate from chunks, ensuring accurate role/source tracking before classification or reporting."}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"service-responsibility-diagram",children:"Service Responsibility Diagram"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-mermaid",children:"flowchart TD\n    SettingsUI(Settings UI)\n    SettingsAPI(SettingsController)\n    TextService(TextExtractionService)\n    ObjectTextService(ObjectTextExtractionService)\n    ChunkServiceNode(ChunkService)\n    EntityService(EntityExtractionService)\n    StatsService(TextExtractionService.getStats)\n    GdprMapper(GdprEntityMapper / EntityRelationMapper)\n    ClassificationSvc(ClassificationService)\n\n    SettingsUI --\x3e|/api/settings/files| SettingsAPI\n    SettingsAPI --\x3e TextService\n    SettingsAPI --\x3e ObjectTextService\n    TextService --\x3e ChunkServiceNode\n    ObjectTextService --\x3e ChunkServiceNode\n    ChunkServiceNode --\x3e EntityService\n    EntityService --\x3e GdprMapper\n    GdprMapper --\x3e ClassificationSvc\n    TextService --\x3e StatsService\n"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"SettingsController"})," coordinates requests initiated from the UI; it delegates to the existing ",(0,o.jsx)(n.code,{children:"TextExtractionService"})," for file extraction and to the upcoming ",(0,o.jsx)(n.code,{children:"ObjectTextExtractionService"})," for object blobs."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"ChunkService"})," centralises chunk persistence, language detection, and handoff to vector/Solr pipelines."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"EntityExtractionService"})," writes to ",(0,o.jsx)(n.code,{children:"GdprEntityMapper"})," and ",(0,o.jsx)(n.code,{children:"EntityRelationMapper"}),", enabling GDPR reports and anonymisation planning."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"TextExtractionService::getStats()"})," now aggregates totals across files, chunks, objects, and entities for the dashboard tiles."]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"1-filetext-entity-existing-updated",children:"1. FileText Entity (Existing, Updated)"}),"\n",(0,o.jsx)(n.p,{children:"Stores extracted text from files."}),"\n",(0,o.jsx)(n.h3,{id:"current-schema",children:"Current Schema"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE oc_openregister_file_texts (\n    id BIGINT AUTO_INCREMENT PRIMARY KEY,\n    uuid VARCHAR(255) NOT NULL UNIQUE,\n    file_id BIGINT NOT NULL UNIQUE,\n    file_path VARCHAR(4000) NOT NULL,\n    file_name VARCHAR(255) NOT NULL,\n    mime_type VARCHAR(255) NOT NULL,\n    file_size BIGINT NOT NULL,\n    file_checksum VARCHAR(255),\n    text_content MEDIUMTEXT,\n    text_length INT NOT NULL DEFAULT 0,\n    extraction_method VARCHAR(50) NOT NULL DEFAULT 'text_extract',\n    extraction_status VARCHAR(50) NOT NULL DEFAULT 'pending',\n    extraction_error TEXT,\n    chunked BOOLEAN NOT NULL DEFAULT FALSE,\n    chunk_count INT NOT NULL DEFAULT 0,\n    chunks_json LONGTEXT,\n    indexed_in_solr BOOLEAN NOT NULL DEFAULT FALSE,\n    vectorized BOOLEAN NOT NULL DEFAULT FALSE,\n    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n    extracted_at DATETIME,\n    \n    INDEX idx_file_id (file_id),\n    INDEX idx_extraction_status (extraction_status),\n    INDEX idx_mime_type (mime_type),\n    INDEX idx_chunked (chunked),\n    INDEX idx_indexed (indexed_in_solr),\n    INDEX idx_vectorized (vectorized),\n    INDEX idx_created (created_at)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\n"})}),"\n",(0,o.jsx)(n.h3,{id:"changes-required",children:"Changes Required"}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"None"})," - This entity already supports chunks via 'chunks_json'. Language and language_level will be stored at the chunk level in the new Chunk entity."]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Future Migration"}),": In a later phase, we may migrate chunks from 'chunks_json' (LONGTEXT) to a dedicated 'Chunk' table for better performance and querying capabilities."]}),"\n",(0,o.jsx)(n.h2,{id:"2-objecttext-entity-new",children:"2. ObjectText Entity (New)"}),"\n",(0,o.jsx)(n.p,{children:"Stores text blobs created from OpenRegister objects."}),"\n",(0,o.jsx)(n.h3,{id:"schema",children:"Schema"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE oc_openregister_object_texts (\n    id BIGINT AUTO_INCREMENT PRIMARY KEY,\n    uuid VARCHAR(255) NOT NULL UNIQUE,\n    object_id BIGINT NOT NULL UNIQUE,\n    register VARCHAR(255) NOT NULL,\n    schema VARCHAR(255) NOT NULL,\n    text_blob MEDIUMTEXT NOT NULL,\n    text_length INT NOT NULL DEFAULT 0,\n    property_map JSON,\n    extraction_status VARCHAR(50) NOT NULL DEFAULT 'completed',\n    chunked BOOLEAN NOT NULL DEFAULT FALSE,\n    chunk_count INT NOT NULL DEFAULT 0,\n    owner VARCHAR(255),\n    organisation VARCHAR(255),\n    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n    \n    INDEX idx_object_id (object_id),\n    INDEX idx_register (register),\n    INDEX idx_schema (schema),\n    INDEX idx_extraction_status (extraction_status),\n    INDEX idx_chunked (chunked),\n    INDEX idx_owner (owner),\n    INDEX idx_organisation (organisation),\n    \n    FOREIGN KEY (object_id) REFERENCES oc_openregister_objects(id) ON DELETE CASCADE\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\n"})}),"\n",(0,o.jsx)(n.h3,{id:"fields",children:"Fields"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"id"}),": Primary key"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"uuid"}),": Unique identifier for API access"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"object_id"}),": Reference to oc_openregister_objects.id"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"register"}),": Register name for context"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"schema"}),": Schema name for context"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"text_blob"}),": Concatenated property values"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"text_length"}),": Character count"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"property_map"}),": JSON mapping of which properties contributed to which text sections","\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:"{\n  'firstName': {'start': 0, 'end': 15, 'value': 'firstName: John'},\n  'lastName': {'start': 16, 'end': 30, 'value': 'lastName: Doe'}\n}\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"extraction_status"}),": Status ('pending', 'completed', 'failed')"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"chunked"}),": Whether text has been chunked"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"chunk_count"}),": Number of chunks created"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"created_at"}),": Creation timestamp"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"updated_at"}),": Last modification timestamp"]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"php-entity-class",children:"PHP Entity Class"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-php",children:"namespace OCA\\OpenRegister\\Db;\n\nuse DateTime;\nuse JsonSerializable;\nuse OCP\\AppFramework\\Db\\Entity;\n\n/**\n * ObjectText Entity\n * \n * Represents text extracted from an OpenRegister object for searching and analysis.\n * \n * @category Db\n * @package  OCA\\OpenRegister\\Db\n * @author   OpenRegister Team\n * @license  AGPL-3.0-or-later\n * \n * @method string getUuid()\n * @method void setUuid(string $uuid)\n * @method int getObjectId()\n * @method void setObjectId(int $objectId)\n * @method string getRegister()\n * @method void setRegister(string $register)\n * @method string getSchema()\n * @method void setSchema(string $schema)\n * @method string getTextBlob()\n * @method void setTextBlob(string $textBlob)\n * @method int getTextLength()\n * @method void setTextLength(int $textLength)\n * @method array|null getPropertyMap()\n * @method void setPropertyMap(?array $propertyMap)\n * @method string getExtractionStatus()\n * @method void setExtractionStatus(string $extractionStatus)\n * @method bool getChunked()\n * @method void setChunked(bool $chunked)\n * @method int getChunkCount()\n * @method void setChunkCount(int $chunkCount)\n * @method DateTime getCreatedAt()\n * @method void setCreatedAt(DateTime $createdAt)\n * @method DateTime getUpdatedAt()\n * @method void setUpdatedAt(DateTime $updatedAt)\n */\nclass ObjectText extends Entity implements JsonSerializable\n{\n    protected ?string $uuid = null;\n    protected ?int $objectId = null;\n    protected ?string $register = null;\n    protected ?string $schema = null;\n    protected ?string $textBlob = null;\n    protected int $textLength = 0;\n    protected ?array $propertyMap = null;\n    protected string $extractionStatus = 'completed';\n    protected bool $chunked = false;\n    protected int $chunkCount = 0;\n    protected ?DateTime $createdAt = null;\n    protected ?DateTime $updatedAt = null;\n\n    public function __construct()\n    {\n        $this->addType('id', 'integer');\n        $this->addType('uuid', 'string');\n        $this->addType('objectId', 'integer');\n        $this->addType('register', 'string');\n        $this->addType('schema', 'string');\n        $this->addType('textBlob', 'string');\n        $this->addType('textLength', 'integer');\n        $this->addType('propertyMap', 'json');\n        $this->addType('extractionStatus', 'string');\n        $this->addType('chunked', 'boolean');\n        $this->addType('chunkCount', 'integer');\n        $this->addType('createdAt', 'datetime');\n        $this->addType('updatedAt', 'datetime');\n    }\n\n    public function jsonSerialize(): array\n    {\n        return [\n            'id' => $this->id,\n            'uuid' => $this->uuid,\n            'objectId' => $this->objectId,\n            'register' => $this->register,\n            'schema' => $this->schema,\n            'textLength' => $this->textLength,\n            'propertyMap' => $this->propertyMap,\n            'extractionStatus' => $this->extractionStatus,\n            'chunked' => $this->chunked,\n            'chunkCount' => $this->chunkCount,\n            'createdAt' => $this->createdAt?->format('c'),\n            'updatedAt' => $this->updatedAt?->format('c'),\n        ];\n    }\n}\n"})}),"\n",(0,o.jsx)(n.h2,{id:"3-chunk-entity-new",children:"3. Chunk Entity (New)"}),"\n",(0,o.jsx)(n.p,{children:"Stores individual text chunks with language metadata."}),"\n",(0,o.jsx)(n.h3,{id:"schema-1",children:"Schema"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE oc_openregister_chunks (\n    id BIGINT AUTO_INCREMENT PRIMARY KEY,\n    uuid VARCHAR(255) NOT NULL UNIQUE,\n    source_type VARCHAR(50) NOT NULL,\n    source_id BIGINT NOT NULL,\n    text_content TEXT NOT NULL,\n    start_offset INT NOT NULL,\n    end_offset INT NOT NULL,\n    chunk_index INT NOT NULL,\n    language VARCHAR(10),\n    language_level VARCHAR(20),\n    language_confidence DECIMAL(3,2),\n    detection_method VARCHAR(50),\n    indexed_in_solr BOOLEAN NOT NULL DEFAULT FALSE,\n    vectorized BOOLEAN NOT NULL DEFAULT FALSE,\n    owner VARCHAR(255),\n    organisation VARCHAR(255),\n    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n    \n    INDEX idx_source (source_type, source_id),\n    INDEX idx_language (language),\n    INDEX idx_language_level (language_level),\n    INDEX idx_indexed (indexed_in_solr),\n    INDEX idx_vectorized (vectorized),\n    INDEX idx_owner (owner),\n    INDEX idx_organisation (organisation)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\n"})}),"\n",(0,o.jsx)(n.h3,{id:"fields-1",children:"Fields"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"id"}),": Primary key"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"uuid"}),": Unique identifier for API access"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"source_type"}),": Type of source ('file', 'object', 'mail', 'chat')"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"source_id"}),": ID of ",(0,o.jsx)(n.strong,{children:"ultimate source"})," (file ID, object ID, email ID, chat ID - NOT the text extraction record ID)"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"text_content"}),": The actual chunk text"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"start_offset"}),": Character position in original text where chunk starts"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"end_offset"}),": Character position in original text where chunk ends"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"chunk_index"}),": Sequential chunk number (0, 1, 2, ...)"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"position_reference"}),": JSON payload describing how to retrace the chunk:","\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'// File-based chunk\n{\n  "type": "file",\n  "start": 1024,\n  "end": 2048,\n  "length": 1024\n}\n// Object-based chunk\n{\n  "type": "object",\n  "property": "address.street",\n  "register": "contracts",\n  "schema": "supplier"\n}\n'})}),"\n","This guarantees every chunk can be mapped back either to an exact text span (files) or to the specific property path that produced it (objects/mail/chat entries)."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"language"}),": ISO 639-1 language code ('en', 'nl', 'de', etc.)"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"language_level"}),": Reading level ('A1', 'B2', 'Grade 8', '65', etc.)"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"language_confidence"}),": Confidence score for language detection (0.00-1.00)"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"detection_method"}),": How language was detected ('local', 'api', 'llm', 'hybrid')"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"indexed_in_solr"}),": Whether chunk is indexed in Solr"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"vectorized"}),": Whether chunk has vector embedding"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"created_at"}),": Creation timestamp"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"updated_at"}),": Last modification timestamp"]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"php-entity-class-1",children:"PHP Entity Class"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-php",children:"namespace OCA\\OpenRegister\\Db;\n\nuse DateTime;\nuse JsonSerializable;\nuse OCP\\AppFramework\\Db\\Entity;\n\n/**\n * Chunk Entity\n * \n * Represents a text chunk with language metadata.\n * \n * @category Db\n * @package  OCA\\OpenRegister\\Db\n * @author   OpenRegister Team\n * @license  AGPL-3.0-or-later\n */\nclass Chunk extends Entity implements JsonSerializable\n{\n    protected ?string $uuid = null;\n    protected ?string $sourceType = null;\n    protected ?int $sourceId = null;\n    protected ?string $textContent = null;\n    protected int $startOffset = 0;\n    protected int $endOffset = 0;\n    protected int $chunkIndex = 0;\n    protected ?string $language = null;\n    protected ?string $languageLevel = null;\n    protected ?float $languageConfidence = null;\n    protected ?string $detectionMethod = null;\n    protected bool $indexedInSolr = false;\n    protected bool $vectorized = false;\n    protected ?DateTime $createdAt = null;\n    protected ?DateTime $updatedAt = null;\n\n    public function __construct()\n    {\n        $this->addType('id', 'integer');\n        $this->addType('uuid', 'string');\n        $this->addType('sourceType', 'string');\n        $this->addType('sourceId', 'integer');\n        $this->addType('textContent', 'string');\n        $this->addType('startOffset', 'integer');\n        $this->addType('endOffset', 'integer');\n        $this->addType('chunkIndex', 'integer');\n        $this->addType('language', 'string');\n        $this->addType('languageLevel', 'string');\n        $this->addType('languageConfidence', 'float');\n        $this->addType('detectionMethod', 'string');\n        $this->addType('indexedInSolr', 'boolean');\n        $this->addType('vectorized', 'boolean');\n        $this->addType('createdAt', 'datetime');\n        $this->addType('updatedAt', 'datetime');\n    }\n\n    public function jsonSerialize(): array\n    {\n        return [\n            'id' => $this->id,\n            'uuid' => $this->uuid,\n            'sourceType' => $this->sourceType,\n            'sourceId' => $this->sourceId,\n            'textContent' => $this->textContent,\n            'startOffset' => $this->startOffset,\n            'endOffset' => $this->endOffset,\n            'chunkIndex' => $this->chunkIndex,\n            'language' => $this->language,\n            'languageLevel' => $this->languageLevel,\n            'languageConfidence' => $this->languageConfidence,\n            'detectionMethod' => $this->detectionMethod,\n            'indexedInSolr' => $this->indexedInSolr,\n            'vectorized' => $this->vectorized,\n            'createdAt' => $this->createdAt?->format('c'),\n            'updatedAt' => $this->updatedAt?->format('c'),\n        ];\n    }\n}\n"})}),"\n",(0,o.jsx)(n.h2,{id:"4-entity-gdpr-entity-new",children:"4. Entity (GDPR) Entity (New)"}),"\n",(0,o.jsx)(n.p,{children:"Stores unique entities (persons, emails, organizations) found in content."}),"\n",(0,o.jsx)(n.h3,{id:"schema-2",children:"Schema"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE oc_openregister_entities (\n    id BIGINT AUTO_INCREMENT PRIMARY KEY,\n    uuid VARCHAR(255) NOT NULL UNIQUE,\n    type VARCHAR(50) NOT NULL,\n    value TEXT NOT NULL,\n    category VARCHAR(50) NOT NULL,\n    belongs_to_entity_id BIGINT,\n    metadata JSON,\n    owner VARCHAR(255),\n    organisation VARCHAR(255),\n    detected_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n    \n    INDEX idx_type (type),\n    INDEX idx_category (category),\n    INDEX idx_detected (detected_at),\n    INDEX idx_value_hash (value(255)),\n    INDEX idx_owner (owner),\n    INDEX idx_organisation (organisation),\n    INDEX idx_belongs_to (belongs_to_entity_id),\n    \n    FOREIGN KEY (belongs_to_entity_id) REFERENCES oc_openregister_entities(id) ON DELETE SET NULL\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\n"})}),"\n",(0,o.jsx)(n.h3,{id:"fields-2",children:"Fields"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"id"}),": Primary key"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"uuid"}),": Unique identifier for API access"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"type"}),": Entity type ('person', 'email', 'phone', 'organization', 'location', 'date_of_birth', 'id_number', 'bank_account', 'ip_address', 'other_pii')"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"value"}),": The entity value (e.g., '",(0,o.jsx)(n.a,{href:"mailto:john.doe@example.com",children:"john.doe@example.com"}),"')"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"category"}),": Classification ('pii', 'sensitive_pii', 'business_data')"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"belongs_to_entity_id"}),": Parent entity this belongs to (e.g., phone belongs to person, email belongs to organization)"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"metadata"}),": Additional context","\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:"{\n  'normalized': 'john.doe@example.com',\n  'aliases': ['j.doe@example.com'],\n  'first_seen': '2024-01-15T10:30:00Z',\n  'occurrence_count': 42,\n  'sources': ['file', 'object', 'email'],\n  'relationship_confidence': 0.92,\n  'detection_method': 'proximity'\n}\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"detected_at"}),": First detection timestamp"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"updated_at"}),": Last occurrence timestamp"]}),"\n"]}),"\n",(0,o.jsxs)(n.admonition,{title:"Parent-Child Relationships",type:"tip",children:[(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"belongs_to_entity_id"})," field creates direct parent-child relationships:"]}),(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Phone"})," \u2192 belongs to \u2192 ",(0,o.jsx)(n.strong,{children:"Person"})," (phone.belongs_to_entity_id = person.id)"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Email"})," \u2192 belongs to \u2192 ",(0,o.jsx)(n.strong,{children:"Person"})," (email.belongs_to_entity_id = person.id)"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Address"})," \u2192 belongs to \u2192 ",(0,o.jsx)(n.strong,{children:"Organization"})," (address.belongs_to_entity_id = organization.id)"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Phone"})," \u2192 belongs to \u2192 ",(0,o.jsx)(n.strong,{children:"Organization"})," (phone.belongs_to_entity_id = organization.id)"]}),"\n"]}),(0,o.jsxs)(n.p,{children:["To get all contact info for a person: ",(0,o.jsx)(n.code,{children:"SELECT * FROM oc_openregister_entities WHERE belongs_to_entity_id = {person_id}"})]}),(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Note"}),": We do NOT track person-to-person or person-to-organization relationships here. Only attributes/contact info belonging to entities."]})]}),"\n",(0,o.jsx)(n.h3,{id:"php-entity-class-2",children:"PHP Entity Class"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-php",children:"namespace OCA\\OpenRegister\\Db;\n\nuse DateTime;\nuse JsonSerializable;\nuse OCP\\AppFramework\\Db\\Entity;\n\n/**\n * Entity (GDPR) Entity\n * \n * Represents a unique entity (person, email, organization) found in content.\n * \n * @category Db\n * @package  OCA\\OpenRegister\\Db\n * @author   OpenRegister Team\n * @license  AGPL-3.0-or-later\n * \n * @method string getUuid()\n * @method void setUuid(string $uuid)\n * @method string getType()\n * @method void setType(string $type)\n * @method string getValue()\n * @method void setValue(string $value)\n * @method string getCategory()\n * @method void setCategory(string $category)\n * @method int|null getBelongsToEntityId()\n * @method void setBelongsToEntityId(?int $belongsToEntityId)\n * @method array|null getMetadata()\n * @method void setMetadata(?array $metadata)\n * @method DateTime getDetectedAt()\n * @method void setDetectedAt(DateTime $detectedAt)\n * @method DateTime getUpdatedAt()\n * @method void setUpdatedAt(DateTime $updatedAt)\n */\nclass GdprEntity extends Entity implements JsonSerializable\n{\n    protected ?string $uuid = null;\n    protected ?string $type = null;\n    protected ?string $value = null;\n    protected ?string $category = null;\n    protected ?int $belongsToEntityId = null;\n    protected ?array $metadata = null;\n    protected ?DateTime $detectedAt = null;\n    protected ?DateTime $updatedAt = null;\n\n    // Constants for entity types\n    public const TYPE_PERSON = 'person';\n    public const TYPE_EMAIL = 'email';\n    public const TYPE_PHONE = 'phone';\n    public const TYPE_ORGANIZATION = 'organization';\n    public const TYPE_LOCATION = 'location';\n    public const TYPE_DATE_OF_BIRTH = 'date_of_birth';\n    public const TYPE_ID_NUMBER = 'id_number';\n    public const TYPE_BANK_ACCOUNT = 'bank_account';\n    public const TYPE_IP_ADDRESS = 'ip_address';\n    public const TYPE_OTHER_PII = 'other_pii';\n\n    // Constants for categories\n    public const CATEGORY_PII = 'pii';\n    public const CATEGORY_SENSITIVE_PII = 'sensitive_pii';\n    public const CATEGORY_BUSINESS_DATA = 'business_data';\n\n    public function __construct()\n    {\n        $this->addType('id', 'integer');\n        $this->addType('uuid', 'string');\n        $this->addType('type', 'string');\n        $this->addType('value', 'string');\n        $this->addType('category', 'string');\n        $this->addType('belongsToEntityId', 'integer');\n        $this->addType('metadata', 'json');\n        $this->addType('detectedAt', 'datetime');\n        $this->addType('updatedAt', 'datetime');\n    }\n\n    /**\n     * Get the parent entity (person or organization) this entity belongs to\n     *\n     * @return GdprEntity|null The parent entity or null if this is a root entity\n     */\n    public function getParentEntity(): ?GdprEntity\n    {\n        if ($this->belongsToEntityId === null) {\n            return null;\n        }\n        \n        // Will be implemented by service layer using EntityMapper\n        return null;\n    }\n\n    /**\n     * Check if this entity has child entities (contact info)\n     *\n     * @return bool True if this is a person or organization that can have contact info\n     */\n    public function canHaveChildren(): bool\n    {\n        return in_array($this->type, [self::TYPE_PERSON, self::TYPE_ORGANIZATION]);\n    }\n\n    public function jsonSerialize(): array\n    {\n        return [\n            'id' => $this->id,\n            'uuid' => $this->uuid,\n            'type' => $this->type,\n            'value' => $this->value,\n            'category' => $this->category,\n            'belongsToEntityId' => $this->belongsToEntityId,\n            'metadata' => $this->metadata,\n            'detectedAt' => $this->detectedAt?->format('c'),\n            'updatedAt' => $this->updatedAt?->format('c'),\n        ];\n    }\n}\n"})}),"\n",(0,o.jsx)(n.h2,{id:"5-entityrelation-entity-new",children:"5. EntityRelation Entity (New)"}),"\n",(0,o.jsx)(n.p,{children:"Links entities to specific positions within chunks."}),"\n",(0,o.jsx)(n.admonition,{type:"note",children:(0,o.jsxs)(n.p,{children:["This entity links ",(0,o.jsx)(n.strong,{children:"entities to chunks"})," (where they appear). For ",(0,o.jsx)(n.strong,{children:"entity-to-entity relationships"})," (e.g., phone belongs to person), see EntityLink below."]})}),"\n",(0,o.jsx)(n.h3,{id:"schema-3",children:"Schema"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE oc_openregister_entity_relations (\n    id BIGINT AUTO_INCREMENT PRIMARY KEY,\n    entity_id BIGINT NOT NULL,\n    chunk_id BIGINT NOT NULL,\n    role VARCHAR(50),\n    file_id BIGINT,\n    object_id BIGINT,\n    email_id BIGINT,\n    position_start INT NOT NULL,\n    position_end INT NOT NULL,\n    confidence DECIMAL(3,2) NOT NULL,\n    detection_method VARCHAR(50) NOT NULL,\n    context TEXT,\n    anonymized BOOLEAN NOT NULL DEFAULT FALSE,\n    anonymized_value VARCHAR(255),\n    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    \n    INDEX idx_entity (entity_id),\n    INDEX idx_chunk (chunk_id),\n    INDEX idx_role (role),\n    INDEX idx_file (file_id),\n    INDEX idx_object (object_id),\n    INDEX idx_email (email_id),\n    INDEX idx_confidence (confidence),\n    INDEX idx_anonymized (anonymized),\n    \n    FOREIGN KEY (entity_id) REFERENCES oc_openregister_entities(id) ON DELETE CASCADE,\n    FOREIGN KEY (chunk_id) REFERENCES oc_openregister_chunks(id) ON DELETE CASCADE\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\n"})}),"\n",(0,o.jsx)(n.h3,{id:"fields-3",children:"Fields"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"id"}),": Primary key"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"entity_id"}),": Reference to Entity"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"chunk_id"}),": Reference to Chunk"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"role"}),": Role/context of the entity in this occurrence","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"'public_figure' - Public figure (may not require anonymization)"}),"\n",(0,o.jsx)(n.li,{children:"'employee' - Employee in official capacity (may not require anonymization)"}),"\n",(0,o.jsx)(n.li,{children:"'private_individual' - Private individual (requires anonymization)"}),"\n",(0,o.jsx)(n.li,{children:"'customer' - Customer/client"}),"\n",(0,o.jsx)(n.li,{children:"'contractor' - External contractor"}),"\n",(0,o.jsx)(n.li,{children:"'author' - Document author"}),"\n",(0,o.jsx)(n.li,{children:"'recipient' - Document recipient"}),"\n",(0,o.jsx)(n.li,{children:"'mentioned' - Mentioned in passing"}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"file_id"}),": Reference to original file (if chunk came from file)"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"object_id"}),": Reference to original object (if chunk came from object)"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"email_id"}),": Reference to original email (if chunk came from email)"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"position_start"}),": Character position where entity starts in chunk"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"position_end"}),": Character position where entity ends in chunk"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"confidence"}),": Detection confidence (0.00-1.00)"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"detection_method"}),": How it was found ('regex', 'presidio', 'llm', 'hybrid')"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"context"}),": Surrounding text (\xb150 characters) for verification"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"anonymized"}),": Whether this occurrence has been anonymized"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"anonymized_value"}),": Replacement value if anonymized (e.g., '[PERSON_1]')"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"created_at"}),": Detection timestamp"]}),"\n"]}),"\n",(0,o.jsxs)(n.admonition,{title:"Source Tracking",type:"tip",children:[(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"file_id"}),", ",(0,o.jsx)(n.code,{children:"object_id"}),", and ",(0,o.jsx)(n.code,{children:"email_id"})," fields track the ",(0,o.jsx)(n.strong,{children:"ultimate source"})," of the chunk, not just the intermediate text entity. This is crucial because:"]}),(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Chunks may change over time"})," (re-chunking, content updates)"]}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.strong,{children:"GDPR requests need original source documents"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.strong,{children:"Anonymization must trace back to original files"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.strong,{children:"Audit trails require source document references"})}),"\n"]}),(0,o.jsxs)(n.p,{children:["Example: If a chunk comes from ",(0,o.jsx)(n.code,{children:"file_texts.id=123"})," which references ",(0,o.jsx)(n.code,{children:"files.id=456"}),", store ",(0,o.jsx)(n.code,{children:"file_id=456"})," (the actual file), not 123 (the text extraction record)."]})]}),"\n",(0,o.jsx)(n.h3,{id:"php-entity-class-3",children:"PHP Entity Class"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-php",children:"namespace OCA\\OpenRegister\\Db;\n\nuse DateTime;\nuse JsonSerializable;\nuse OCP\\AppFramework\\Db\\Entity;\n\n/**\n * EntityRelation Entity\n * \n * Links entities to specific positions within chunks, with source tracking and role information.\n * \n * @category Db\n * @package  OCA\\OpenRegister\\Db\n * @author   OpenRegister Team\n * @license  AGPL-3.0-or-later\n * \n * @method int getEntityId()\n * @method void setEntityId(int $entityId)\n * @method int getChunkId()\n * @method void setChunkId(int $chunkId)\n * @method string|null getRole()\n * @method void setRole(?string $role)\n * @method int|null getFileId()\n * @method void setFileId(?int $fileId)\n * @method int|null getObjectId()\n * @method void setObjectId(?int $objectId)\n * @method int|null getEmailId()\n * @method void setEmailId(?int $emailId)\n * @method int getPositionStart()\n * @method void setPositionStart(int $positionStart)\n * @method int getPositionEnd()\n * @method void setPositionEnd(int $positionEnd)\n * @method float getConfidence()\n * @method void setConfidence(float $confidence)\n * @method string getDetectionMethod()\n * @method void setDetectionMethod(string $detectionMethod)\n * @method string|null getContext()\n * @method void setContext(?string $context)\n * @method bool getAnonymized()\n * @method void setAnonymized(bool $anonymized)\n * @method string|null getAnonymizedValue()\n * @method void setAnonymizedValue(?string $anonymizedValue)\n * @method DateTime getCreatedAt()\n * @method void setCreatedAt(DateTime $createdAt)\n */\nclass EntityRelation extends Entity implements JsonSerializable\n{\n    protected ?int $entityId = null;\n    protected ?int $chunkId = null;\n    protected ?string $role = null;\n    protected ?int $fileId = null;\n    protected ?int $objectId = null;\n    protected ?int $emailId = null;\n    protected int $positionStart = 0;\n    protected int $positionEnd = 0;\n    protected float $confidence = 0.0;\n    protected ?string $detectionMethod = null;\n    protected ?string $context = null;\n    protected bool $anonymized = false;\n    protected ?string $anonymizedValue = null;\n    protected ?DateTime $createdAt = null;\n\n    // Constants for roles\n    public const ROLE_PUBLIC_FIGURE = 'public_figure';\n    public const ROLE_EMPLOYEE = 'employee';\n    public const ROLE_PRIVATE_INDIVIDUAL = 'private_individual';\n    public const ROLE_CUSTOMER = 'customer';\n    public const ROLE_CONTRACTOR = 'contractor';\n    public const ROLE_AUTHOR = 'author';\n    public const ROLE_RECIPIENT = 'recipient';\n    public const ROLE_MENTIONED = 'mentioned';\n\n    // Constants for detection methods\n    public const METHOD_REGEX = 'regex';\n    public const METHOD_PRESIDIO = 'presidio';\n    public const METHOD_LLM = 'llm';\n    public const METHOD_HYBRID = 'hybrid';\n    public const METHOD_MANUAL = 'manual';\n\n    public function __construct()\n    {\n        $this->addType('id', 'integer');\n        $this->addType('entityId', 'integer');\n        $this->addType('chunkId', 'integer');\n        $this->addType('role', 'string');\n        $this->addType('fileId', 'integer');\n        $this->addType('objectId', 'integer');\n        $this->addType('emailId', 'integer');\n        $this->addType('positionStart', 'integer');\n        $this->addType('positionEnd', 'integer');\n        $this->addType('confidence', 'float');\n        $this->addType('detectionMethod', 'string');\n        $this->addType('context', 'string');\n        $this->addType('anonymized', 'boolean');\n        $this->addType('anonymizedValue', 'string');\n        $this->addType('createdAt', 'datetime');\n    }\n\n    /**\n     * Check if this entity occurrence requires anonymization based on role\n     *\n     * @return bool True if this occurrence should be anonymized\n     */\n    public function requiresAnonymization(): bool\n    {\n        // Public figures and employees in official capacity may not require anonymization\n        $nonPrivateRoles = [\n            self::ROLE_PUBLIC_FIGURE,\n            self::ROLE_EMPLOYEE,\n        ];\n\n        // If role is set and is non-private, may not require anonymization\n        if ($this->role && in_array($this->role, $nonPrivateRoles)) {\n            return false;\n        }\n\n        // Private individuals always require anonymization\n        if ($this->role === self::ROLE_PRIVATE_INDIVIDUAL) {\n            return true;\n        }\n\n        // Default: assume anonymization required for safety\n        return true;\n    }\n\n    /**\n     * Get the source type based on which ID is set\n     *\n     * @return string|null 'file', 'object', 'email', or null\n     */\n    public function getSourceType(): ?string\n    {\n        if ($this->fileId !== null) {\n            return 'file';\n        }\n        if ($this->objectId !== null) {\n            return 'object';\n        }\n        if ($this->emailId !== null) {\n            return 'email';\n        }\n        return null;\n    }\n\n    /**\n     * Get the source ID based on which ID is set\n     *\n     * @return int|null The source ID\n     */\n    public function getSourceId(): ?int\n    {\n        return $this->fileId ?? $this->objectId ?? $this->emailId;\n    }\n\n    public function jsonSerialize(): array\n    {\n        return [\n            'id' => $this->id,\n            'entityId' => $this->entityId,\n            'chunkId' => $this->chunkId,\n            'role' => $this->role,\n            'fileId' => $this->fileId,\n            'objectId' => $this->objectId,\n            'emailId' => $this->emailId,\n            'sourceType' => $this->getSourceType(),\n            'sourceId' => $this->getSourceId(),\n            'positionStart' => $this->positionStart,\n            'positionEnd' => $this->positionEnd,\n            'confidence' => $this->confidence,\n            'detectionMethod' => $this->detectionMethod,\n            'context' => $this->context,\n            'anonymized' => $this->anonymized,\n            'anonymizedValue' => $this->anonymizedValue,\n            'requiresAnonymization' => $this->requiresAnonymization(),\n            'createdAt' => $this->createdAt?->format('c'),\n        ];\n    }\n}\n"})}),"\n",(0,o.jsx)(n.h2,{id:"6-entitylink-entity-new",children:"6. EntityLink Entity (New)"}),"\n",(0,o.jsx)(n.p,{children:"Links entities to each other to create a knowledge graph of relationships."}),"\n",(0,o.jsxs)(n.admonition,{title:"Entity Knowledge Graph",type:"tip",children:[(0,o.jsx)(n.p,{children:"EntityLink enables tracking which contact information belongs to which person or organization:"}),(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Phone number \u2192 belongs to \u2192 Person"}),"\n",(0,o.jsx)(n.li,{children:"Phone number \u2192 belongs to \u2192 Organization"}),"\n",(0,o.jsx)(n.li,{children:"Email \u2192 belongs to \u2192 Person"}),"\n",(0,o.jsx)(n.li,{children:"Email \u2192 belongs to \u2192 Organization"}),"\n",(0,o.jsx)(n.li,{children:"Address \u2192 belongs to \u2192 Person"}),"\n",(0,o.jsx)(n.li,{children:"Address \u2192 belongs to \u2192 Organization"}),"\n"]}),(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Note"}),": We track contact info relationships, NOT employment/family relationships."]})]}),"\n",(0,o.jsx)(n.h3,{id:"schema-4",children:"Schema"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE oc_openregister_entity_links (\n    id BIGINT AUTO_INCREMENT PRIMARY KEY,\n    source_entity_id BIGINT NOT NULL,\n    target_entity_id BIGINT NOT NULL,\n    relationship_type VARCHAR(100) NOT NULL,\n    confidence DECIMAL(3,2) NOT NULL,\n    detection_method VARCHAR(50) NOT NULL,\n    metadata JSON,\n    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n    \n    INDEX idx_source (source_entity_id),\n    INDEX idx_target (target_entity_id),\n    INDEX idx_relationship (relationship_type),\n    INDEX idx_confidence (confidence),\n    INDEX idx_both (source_entity_id, target_entity_id),\n    \n    FOREIGN KEY (source_entity_id) REFERENCES oc_openregister_entities(id) ON DELETE CASCADE,\n    FOREIGN KEY (target_entity_id) REFERENCES oc_openregister_entities(id) ON DELETE CASCADE,\n    \n    UNIQUE KEY unique_link (source_entity_id, target_entity_id, relationship_type)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\n"})}),"\n",(0,o.jsx)(n.h3,{id:"fields-4",children:"Fields"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"id"}),": Primary key"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"source_entity_id"}),": The entity that is the source of the relationship"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"target_entity_id"}),": The entity that is the target of the relationship"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"relationship_type"}),": Type of relationship between entities","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"'belongs_to' - Contact info (phone/email/address) belongs to person or organization"}),"\n",(0,o.jsx)(n.li,{children:"'associated_with' - Generic association (for flexible use cases)"}),"\n",(0,o.jsx)(n.li,{children:"'primary_contact' - Marks primary contact method"}),"\n",(0,o.jsx)(n.li,{children:"'alternate_contact' - Marks alternate contact method"}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"confidence"}),": Confidence score for the relationship (0.00-1.00)"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"detection_method"}),": How the relationship was detected","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"'proximity' - Found near each other in text"}),"\n",(0,o.jsx)(n.li,{children:"'pattern' - Detected via pattern matching"}),"\n",(0,o.jsx)(n.li,{children:"'llm' - Detected by LLM analysis"}),"\n",(0,o.jsx)(n.li,{children:"'manual' - Manually added by user"}),"\n",(0,o.jsx)(n.li,{children:"'inference' - Inferred from other data"}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"metadata"}),": Additional context about the relationship","\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:"{\n  'evidence': 'Found in same sentence: John Doe, phone: +31612345678',\n  'chunk_ids': [123, 456],\n  'source_documents': ['contract.pdf', 'email.eml'],\n  'verified': false,\n  'verified_by': null,\n  'verified_at': null,\n  'notes': 'Automatically detected from contact block'\n}\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"created_at"}),": When relationship was first detected"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"updated_at"}),": Last modification timestamp"]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"relationship-types",children:"Relationship Types"}),"\n",(0,o.jsx)(n.h4,{id:"belongs_to-contact-information-ownership",children:"belongs_to: Contact Information Ownership"}),"\n",(0,o.jsx)(n.p,{children:"The primary relationship type - links contact information to persons or organizations:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"Phone Numbers:\n- Phone(+31612345678) \u2192 belongs_to \u2192 Person(John Doe)\n- Phone(+31201234567) \u2192 belongs_to \u2192 Organization(Acme Corp)\n\nEmail Addresses:\n- Email(john.doe@example.com) \u2192 belongs_to \u2192 Person(John Doe)\n- Email(info@acme.com) \u2192 belongs_to \u2192 Organization(Acme Corp)\n- Email(support@acme.com) \u2192 belongs_to \u2192 Organization(Acme Corp)\n\nPhysical Addresses:\n- Address(123 Main St, Amsterdam) \u2192 belongs_to \u2192 Person(John Doe)\n- Address(456 Business Park) \u2192 belongs_to \u2192 Organization(Acme Corp)\n\nIP Addresses:\n- IP(192.168.1.100) \u2192 belongs_to \u2192 Organization(Acme Corp)\n"})}),"\n",(0,o.jsx)(n.h4,{id:"associated_with-generic-association",children:"associated_with: Generic Association"}),"\n",(0,o.jsx)(n.p,{children:"For flexible use cases or uncertain relationships:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"Examples:\n- Phone(+31612345678) \u2192 associated_with \u2192 Person(Jane Doe) (uncertain ownership)\n- Email(shared@team.com) \u2192 associated_with \u2192 Organization(Acme Corp) (shared mailbox)\n"})}),"\n",(0,o.jsx)(n.h4,{id:"primary_contact--alternate_contact-contact-priority",children:"primary_contact / alternate_contact: Contact Priority"}),"\n",(0,o.jsx)(n.p,{children:"Marks which contact method is primary:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"Examples:\nPerson(John Doe):\n- Email(john.doe@work.com) \u2192 primary_contact \u2192 Person(John Doe)\n- Email(john.personal@gmail.com) \u2192 alternate_contact \u2192 Person(John Doe)\n- Phone(+31612345678) \u2192 primary_contact \u2192 Person(John Doe)\n- Phone(+31687654321) \u2192 alternate_contact \u2192 Person(John Doe)\n"})}),"\n",(0,o.jsx)(n.h3,{id:"php-entity-class-4",children:"PHP Entity Class"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-php",children:"namespace OCA\\OpenRegister\\Db;\n\nuse DateTime;\nuse JsonSerializable;\nuse OCP\\AppFramework\\Db\\Entity;\n\n/**\n * EntityLink Entity\n * \n * Links entities to each other to create a knowledge graph.\n * \n * @category Db\n * @package  OCA\\OpenRegister\\Db\n * @author   OpenRegister Team\n * @license  AGPL-3.0-or-later\n * \n * @method int getSourceEntityId()\n * @method void setSourceEntityId(int $sourceEntityId)\n * @method int getTargetEntityId()\n * @method void setTargetEntityId(int $targetEntityId)\n * @method string getRelationshipType()\n * @method void setRelationshipType(string $relationshipType)\n * @method float getConfidence()\n * @method void setConfidence(float $confidence)\n * @method string getDetectionMethod()\n * @method void setDetectionMethod(string $detectionMethod)\n * @method array|null getMetadata()\n * @method void setMetadata(?array $metadata)\n * @method DateTime getCreatedAt()\n * @method void setCreatedAt(DateTime $createdAt)\n * @method DateTime getUpdatedAt()\n * @method void setUpdatedAt(DateTime $updatedAt)\n */\nclass EntityLink extends Entity implements JsonSerializable\n{\n    protected ?int $sourceEntityId = null;\n    protected ?int $targetEntityId = null;\n    protected ?string $relationshipType = null;\n    protected float $confidence = 0.0;\n    protected ?string $detectionMethod = null;\n    protected ?array $metadata = null;\n    protected ?DateTime $createdAt = null;\n    protected ?DateTime $updatedAt = null;\n\n    // Constants for relationship types\n    public const TYPE_BELONGS_TO = 'belongs_to';\n    public const TYPE_ASSOCIATED_WITH = 'associated_with';\n    public const TYPE_PRIMARY_CONTACT = 'primary_contact';\n    public const TYPE_ALTERNATE_CONTACT = 'alternate_contact';\n\n    // Constants for detection methods\n    public const METHOD_PROXIMITY = 'proximity';\n    public const METHOD_PATTERN = 'pattern';\n    public const METHOD_LLM = 'llm';\n    public const METHOD_MANUAL = 'manual';\n    public const METHOD_INFERENCE = 'inference';\n\n    public function __construct()\n    {\n        $this->addType('id', 'integer');\n        $this->addType('sourceEntityId', 'integer');\n        $this->addType('targetEntityId', 'integer');\n        $this->addType('relationshipType', 'string');\n        $this->addType('confidence', 'float');\n        $this->addType('detectionMethod', 'string');\n        $this->addType('metadata', 'json');\n        $this->addType('createdAt', 'datetime');\n        $this->addType('updatedAt', 'datetime');\n    }\n\n    public function jsonSerialize(): array\n    {\n        return [\n            'id' => $this->id,\n            'sourceEntityId' => $this->sourceEntityId,\n            'targetEntityId' => $this->targetEntityId,\n            'relationshipType' => $this->relationshipType,\n            'confidence' => $this->confidence,\n            'detectionMethod' => $this->detectionMethod,\n            'metadata' => $this->metadata,\n            'createdAt' => $this->createdAt?->format('c'),\n            'updatedAt' => $this->updatedAt?->format('c'),\n        ];\n    }\n}\n"})}),"\n",(0,o.jsx)(n.h3,{id:"detection-methods",children:"Detection Methods"}),"\n",(0,o.jsx)(n.h4,{id:"1-proximity-detection",children:"1. Proximity Detection"}),"\n",(0,o.jsx)(n.p,{children:"Entities found near each other in text are likely related:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:'Text: "Contact John Doe at +31612345678 or john.doe@example.com"\n\nDetection:\n- Person(John Doe) found at position 8-16\n- Phone(+31612345678) found at position 20-33\n- Email(john.doe@example.com) found at position 37-59\n\nLinks Created:\n- Phone \u2192 belongs_to \u2192 Person (confidence: 0.85, method: proximity)\n- Email \u2192 belongs_to \u2192 Person (confidence: 0.85, method: proximity)\n'})}),"\n",(0,o.jsx)(n.h4,{id:"2-pattern-matching",children:"2. Pattern Matching"}),"\n",(0,o.jsx)(n.p,{children:"Known patterns indicate relationships:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:'Patterns:\n- "X works for Y" \u2192 works_for\n- "X at Y" \u2192 works_for\n- "Y\'s X" \u2192 belongs_to\n- "X (Y)" \u2192 belongs_to\n\nExample:\nText: "John Doe works for Acme Corp"\n\nLink Created:\n- Person(John Doe) \u2192 works_for \u2192 Organization(Acme Corp)\n  (confidence: 0.95, method: pattern)\n'})}),"\n",(0,o.jsx)(n.h4,{id:"3-llm-analysis",children:"3. LLM Analysis"}),"\n",(0,o.jsx)(n.p,{children:"AI understands context and relationships:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:'Text: "Please contact our sales manager regarding this proposal"\n\nContext:\n- Email signature: "John Doe, Sales Manager, Acme Corp"\n- Email metadata: from john.doe@acme.com\n\nLLM Analysis:\n- Person(John Doe) works for Organization(Acme Corp)\n- Email(john.doe@acme.com) belongs to Person(John Doe)\n- Role: Sales Manager (stored in Person metadata)\n\nLinks Created:\n- Person \u2192 works_for \u2192 Organization (confidence: 0.92, method: llm)\n- Email \u2192 belongs_to \u2192 Person (confidence: 0.98, method: llm)\n'})}),"\n",(0,o.jsx)(n.h4,{id:"4-inference",children:"4. Inference"}),"\n",(0,o.jsx)(n.p,{children:"Derive relationships from existing data:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"Known:\n- Email(john.doe@acme.com) belongs to Person(John Doe)\n- Email domain: @acme.com\n\nInference:\n- Organization(Acme Corp) has domain acme.com\n- Person(John Doe) likely works for Organization(Acme Corp)\n\nLink Created:\n- Person \u2192 works_for \u2192 Organization (confidence: 0.75, method: inference)\n"})}),"\n",(0,o.jsx)(n.h3,{id:"use-cases",children:"Use Cases"}),"\n",(0,o.jsx)(n.h4,{id:"1-complete-gdpr-profile",children:"1. Complete GDPR Profile"}),"\n",(0,o.jsx)(n.p,{children:"When a data subject requests their information:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-php",children:"// Find person entity\n$person = $entityMapper->findByValue('John Doe', GdprEntity::TYPE_PERSON);\n\n// Get all linked entities\n$links = $entityLinkMapper->findBySourceEntity($person->getId());\n\n// Result includes:\n// - All phone numbers belonging to this person\n// - All email addresses\n// - Organizations they work for\n// - Addresses associated with them\n// - Related persons (family, colleagues)\n"})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Output"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"Data Subject: John Doe\n\nContact Information:\n- Phone: +31612345678 (belongs_to, confidence: 0.85, primary)\n- Phone: +31687654321 (belongs_to, confidence: 0.78, alternate)\n- Email: john.doe@example.com (belongs_to, confidence: 0.92, primary)\n- Email: j.doe@company.com (belongs_to, confidence: 0.80, alternate)\n- Address: 123 Main St, Amsterdam (belongs_to, confidence: 0.88)\n\nFound in Documents:\n- contract-2024.pdf (5 occurrences)\n- email-thread.eml (12 occurrences)\n- meeting-notes.docx (3 occurrences)\n"})}),"\n",(0,o.jsx)(n.h4,{id:"2-organization-profile",children:"2. Organization Profile"}),"\n",(0,o.jsx)(n.p,{children:"View all entities related to an organization:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-php",children:"$org = $entityMapper->findByValue('Acme Corp', GdprEntity::TYPE_ORGANIZATION);\n$links = $entityLinkMapper->findByTargetEntity($org->getId());\n"})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Output"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"Organization: Acme Corp\n\nContact Information:\n- Phone: +31201234567 (belongs_to, confidence: 0.95, primary)\n- Phone: +31201234568 (belongs_to, confidence: 0.90, alternate - support line)\n- Email: info@acme.com (belongs_to, confidence: 0.98, primary)\n- Email: sales@acme.com (belongs_to, confidence: 0.95)\n- Email: support@acme.com (belongs_to, confidence: 0.95)\n- Address: 456 Business Park, Amsterdam (belongs_to, confidence: 0.92, headquarters)\n- Address: 789 Industrial Ave, Rotterdam (belongs_to, confidence: 0.88, warehouse)\n\nFound in Documents:\n- company-profile.pdf\n- contracts/ (multiple)\n- correspondence/ (multiple)\n"})}),"\n",(0,o.jsx)(n.h4,{id:"3-anonymization-planning",children:"3. Anonymization Planning"}),"\n",(0,o.jsx)(n.p,{children:"Before anonymizing, understand all contact information:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"Plan to anonymize: Person(John Doe)\n\nCheck Links:\n- Email(john.doe@example.com) belongs_to Person(John Doe)\n- Email(j.doe@company.com) belongs_to Person(John Doe)\n- Phone(+31612345678) belongs_to Person(John Doe)\n- Phone(+31687654321) belongs_to Person(John Doe)\n- Address(123 Main St) belongs_to Person(John Doe)\n\nAnonymization Strategy:\n1. Replace john.doe@example.com \u2192 [EMAIL_42]\n2. Replace j.doe@company.com \u2192 [EMAIL_43]\n3. Replace +31612345678 \u2192 [PHONE_15]\n4. Replace +31687654321 \u2192 [PHONE_16]\n5. Replace 123 Main St \u2192 [ADDRESS_8]\n6. Replace John Doe \u2192 [PERSON_1]\n7. Update all entity links to reference anonymized IDs\n8. Maintain relationship structure for audit trail\n"})}),"\n",(0,o.jsx)(n.h4,{id:"4-entity-deduplication",children:"4. Entity Deduplication"}),"\n",(0,o.jsx)(n.p,{children:"Merge duplicate entities using shared contact information:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"Detection:\n- Phone(+31612345678) belongs_to Person(John Doe)\n- Phone(+31612345678) belongs_to Person(J. Doe)\n- Email(john.doe@example.com) belongs_to Person(John Doe)\n- Email(john.doe@example.com) belongs_to Person(J. Doe)\n\nAnalysis:\n- Same phone number (100% match)\n- Same email (100% match)\n- Similar names (likely same person)\n- High confidence these are duplicates\n\nAction:\n1. Merge Person(J. Doe) into Person(John Doe)\n2. Consolidate all contact information\n3. Update all belongs_to_entity_id references\n4. Update all EntityLink references (if used)\n5. Update all EntityRelation references (chunks)\n6. Maintain audit trail of merge\n7. Mark J. Doe as merged/alias\n\nResult:\nPerson(John Doe) now has:\n- All contact info from both entities\n- All chunk occurrences from both entities\n- Audit trail showing merge operation\n"})}),"\n",(0,o.jsx)(n.h4,{id:"5-role-based-anonymization",children:"5. Role-Based Anonymization"}),"\n",(0,o.jsx)(n.p,{children:"Use role information to determine anonymization requirements:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-php",children:'// Find all entity occurrences requiring anonymization\n$relations = $entityRelationMapper->findAll();\n\nforeach ($relations as $relation) {\n    if ($relation->requiresAnonymization()) {\n        $entity = $entityMapper->find($relation->getEntityId());\n        \n        // Get source document for context\n        $sourceType = $relation->getSourceType();\n        $sourceId = $relation->getSourceId();\n        \n        echo "Entity: {$entity->getValue()} ({$entity->getType()})\\n";\n        echo "Role: {$relation->getRole()}\\n";\n        echo "Source: {$sourceType} #{$sourceId}\\n";\n        echo "Requires anonymization: Yes\\n\\n";\n    }\n}\n'})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Example Output"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"Entity: John Doe (person)\nRole: employee\nSource: file #100\nRequires anonymization: No (business context)\n\nEntity: Jane Smith (person)\nRole: private_individual\nSource: file #150\nRequires anonymization: Yes (personal data)\n\nEntity: john.doe@example.com (email)\nRole: customer\nSource: object #500\nRequires anonymization: Yes (customer data)\n"})}),"\n",(0,o.jsx)(n.h4,{id:"6-source-document-retrieval-for-gdpr-requests",children:"6. Source Document Retrieval for GDPR Requests"}),"\n",(0,o.jsx)(n.p,{children:"Retrieve all source documents containing a specific entity:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-php",children:"// GDPR request: All documents containing John Doe\n$person = $entityMapper->findByValue('John Doe', GdprEntity::TYPE_PERSON);\n$relations = $entityRelationMapper->findByEntityId($person->getId());\n\n$sources = [\n    'files' => [],\n    'objects' => [],\n    'emails' => []\n];\n\nforeach ($relations as $relation) {\n    $sourceType = $relation->getSourceType();\n    $sourceId = $relation->getSourceId();\n    \n    if ($sourceType === 'file') {\n        $sources['files'][] = [\n            'id' => $sourceId,\n            'role' => $relation->getRole(),\n            'confidence' => $relation->getConfidence()\n        ];\n    } elseif ($sourceType === 'object') {\n        $sources['objects'][] = [\n            'id' => $sourceId,\n            'role' => $relation->getRole(),\n            'confidence' => $relation->getConfidence()\n        ];\n    } elseif ($sourceType === 'email') {\n        $sources['emails'][] = [\n            'id' => $sourceId,\n            'role' => $relation->getRole(),\n            'confidence' => $relation->getConfidence()\n        ];\n    }\n}\n\n// Retrieve actual documents\n$files = $fileMapper->findByIds(array_unique(array_column($sources['files'], 'id')));\n$objects = $objectMapper->findByIds(array_unique(array_column($sources['objects'], 'id')));\n$emails = $emailMapper->findByIds(array_unique(array_column($sources['emails'], 'id')));\n"})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Result"}),": Complete list of all documents containing the entity, with role context for each occurrence."]}),"\n",(0,o.jsx)(n.h3,{id:"relationship-scope-clarification",children:"Relationship Scope Clarification"}),"\n",(0,o.jsxs)(n.admonition,{title:"Contact Information Ownership Only",type:"important",children:[(0,o.jsxs)(n.p,{children:["The entity relationship system is ",(0,o.jsx)(n.strong,{children:"ONLY for tracking contact information ownership"}),":"]}),(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"\u2705 Supported Relationships"}),":"]}),(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Phone \u2192 belongs_to \u2192 Person"}),"\n",(0,o.jsx)(n.li,{children:"Phone \u2192 belongs_to \u2192 Organization"}),"\n",(0,o.jsx)(n.li,{children:"Email \u2192 belongs_to \u2192 Person"}),"\n",(0,o.jsx)(n.li,{children:"Email \u2192 belongs_to \u2192 Organization"}),"\n",(0,o.jsx)(n.li,{children:"Address \u2192 belongs_to \u2192 Person"}),"\n",(0,o.jsx)(n.li,{children:"Address \u2192 belongs_to \u2192 Organization"}),"\n"]}),(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"\u274c NOT Supported"}),":"]}),(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Person \u2192 related_to \u2192 Person (family relationships)"}),"\n",(0,o.jsx)(n.li,{children:"Person \u2192 works_for \u2192 Organization (employment relationships)"}),"\n",(0,o.jsx)(n.li,{children:"Person \u2192 reports_to \u2192 Person (organizational hierarchy)"}),"\n",(0,o.jsx)(n.li,{children:"Organization \u2192 part_of \u2192 Organization (organizational structure)"}),"\n"]}),(0,o.jsx)(n.p,{children:"Employment, family, and organizational relationships should be handled through the object data model, not the entity link system."})]}),"\n",(0,o.jsx)(n.h3,{id:"query-patterns",children:"Query Patterns"}),"\n",(0,o.jsx)(n.h4,{id:"using-belongs_to_entity_id-direct-parent-child",children:"Using belongs_to_entity_id (Direct Parent-Child)"}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"belongs_to_entity_id"})," field provides efficient direct parent-child relationships:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-php",children:"// Find person\n$person = $entityMapper->findByValue('John Doe', GdprEntity::TYPE_PERSON);\n\n// Get all contact info for this person (single query)\n$contactInfo = $entityMapper->findByBelongsTo($person->getId());\n\nforeach ($contactInfo as $info) {\n    echo \"{$info->getType()}: {$info->getValue()}\\n\";\n}\n"})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"SQL Equivalent"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sql",children:"SELECT * FROM oc_openregister_entities \nWHERE belongs_to_entity_id = {person_id};\n"})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Performance"}),": ~5-20ms (single indexed query)"]}),"\n",(0,o.jsx)(n.h4,{id:"get-parent-entity-for-contact-info",children:"Get Parent Entity for Contact Info"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-php",children:"// Find phone number\n$phone = $entityMapper->findByValue('+31612345678', GdprEntity::TYPE_PHONE);\n\n// Get parent entity (person or organization)\nif ($phone->getBelongsToEntityId()) {\n    $parent = $entityMapper->find($phone->getBelongsToEntityId());\n    echo \"Phone belongs to: {$parent->getType()} '{$parent->getValue()}'\\n\";\n}\n"})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"SQL Equivalent"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sql",children:"SELECT parent.* FROM oc_openregister_entities phone\nJOIN oc_openregister_entities parent ON phone.belongs_to_entity_id = parent.id\nWHERE phone.id = {phone_id};\n"})}),"\n",(0,o.jsx)(n.h4,{id:"find-all-persons-with-specific-email-domain",children:"Find All Persons with Specific Email Domain"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sql",children:"SELECT DISTINCT parent.* \nFROM oc_openregister_entities email\nJOIN oc_openregister_entities parent ON email.belongs_to_entity_id = parent.id\nWHERE email.type = 'email' \n  AND email.value LIKE '%@acme.com'\n  AND parent.type = 'person';\n"})}),"\n",(0,o.jsx)(n.h4,{id:"find-all-entities-requiring-anonymization-role-based",children:"Find All Entities Requiring Anonymization (Role-Based)"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sql",children:"SELECT DISTINCT e.* \nFROM oc_openregister_entities e\nJOIN oc_openregister_entity_relations er ON e.id = er.entity_id\nWHERE er.role IN ('private_individual', 'customer')\n  AND er.anonymized = FALSE;\n"})}),"\n",(0,o.jsx)(n.h3,{id:"knowledge-graph-queries",children:"Knowledge Graph Queries"}),"\n",(0,o.jsx)(n.h4,{id:"get-all-contact-info-for-a-person",children:"Get All Contact Info for a Person"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Method 1: Using belongs_to_entity_id (Recommended)"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-php",children:"// Find person\n$person = $entityMapper->findByValue('John Doe', GdprEntity::TYPE_PERSON);\n\n// Get all contact info directly (single query)\n$contactInfo = $entityMapper->findByBelongsTo($person->getId());\n\nforeach ($contactInfo as $info) {\n    echo \"{$info->getType()}: {$info->getValue()}\\n\";\n}\n"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Method 2: Using EntityLink (If Many-to-Many Needed)"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-php",children:'// Find person\n$person = $entityMapper->findByValue(\'John Doe\', GdprEntity::TYPE_PERSON);\n\n// Get all contact info linked to this person\n$links = $entityLinkMapper->findByTargetAndType(\n    $person->getId(), \n    EntityLink::TYPE_BELONGS_TO\n);\n\nforeach ($links as $link) {\n    $contactInfo = $entityMapper->find($link->getSourceEntityId());\n    $isPrimary = $link->getRelationshipType() === EntityLink::TYPE_PRIMARY_CONTACT;\n    \n    echo "{$contactInfo->getType()}: {$contactInfo->getValue()}";\n    echo " (confidence: {$link->getConfidence()}";\n    echo $isPrimary ? ", PRIMARY)" : ")\\n";\n}\n'})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Output"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"phone: +31612345678 (confidence: 0.85, PRIMARY)\nphone: +31687654321 (confidence: 0.78)\nemail: john.doe@example.com (confidence: 0.92, PRIMARY)\nemail: j.doe@company.com (confidence: 0.80)\n"})}),"\n",(0,o.jsx)(n.h4,{id:"find-who-a-phone-number-belongs-to",children:"Find Who a Phone Number Belongs To"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-php",children:"// Find phone entity\n$phone = $entityMapper->findByValue('+31612345678', GdprEntity::TYPE_PHONE);\n\n// Get all persons/orgs this phone belongs to\n$links = $entityLinkMapper->findBySourceAndType(\n    $phone->getId(),\n    EntityLink::TYPE_BELONGS_TO\n);\n\nforeach ($links as $link) {\n    $owner = $entityMapper->find($link->getTargetEntityId());\n    echo \"Phone belongs to: {$owner->getType()} '{$owner->getValue()}' \";\n    echo \"(confidence: {$link->getConfidence()})\\n\";\n}\n"})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Output"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"Phone belongs to: person 'John Doe' (confidence: 0.92)\nPhone belongs to: person 'Jane Doe' (confidence: 0.65)\n"})}),"\n",(0,o.jsx)(n.h4,{id:"get-all-contact-methods-for-organization",children:"Get All Contact Methods for Organization"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-php",children:"// Find organization\n$org = $entityMapper->findByValue('Acme Corp', GdprEntity::TYPE_ORGANIZATION);\n\n// Get all contact info\n$links = $entityLinkMapper->findByTargetAndType(\n    $org->getId(),\n    EntityLink::TYPE_BELONGS_TO\n);\n\n// Group by type\n$contacts = [];\nforeach ($links as $link) {\n    $contactInfo = $entityMapper->find($link->getSourceEntityId());\n    $type = $contactInfo->getType();\n    \n    if (!isset($contacts[$type])) {\n        $contacts[$type] = [];\n    }\n    \n    $contacts[$type][] = [\n        'value' => $contactInfo->getValue(),\n        'confidence' => $link->getConfidence(),\n        'isPrimary' => $link->getRelationshipType() === EntityLink::TYPE_PRIMARY_CONTACT\n    ];\n}\n\n// Display grouped\nforeach ($contacts as $type => $items) {\n    echo ucfirst($type) . \"s:\\n\";\n    foreach ($items as $item) {\n        echo \"  - {$item['value']} (conf: {$item['confidence']}\";\n        echo $item['isPrimary'] ? \", PRIMARY)\\n\" : \")\\n\";\n    }\n}\n"})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Output"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"Phones:\n  - +31201234567 (conf: 0.95, PRIMARY)\n  - +31201234568 (conf: 0.90)\nEmails:\n  - info@acme.com (conf: 0.98, PRIMARY)\n  - sales@acme.com (conf: 0.95)\n  - support@acme.com (conf: 0.95)\nAddresses:\n  - 456 Business Park, Amsterdam (conf: 0.92)\n"})}),"\n",(0,o.jsx)(n.h2,{id:"migration-strategy",children:"Migration Strategy"}),"\n",(0,o.jsx)(n.h3,{id:"phase-1-add-new-tables-immediate",children:"Phase 1: Add New Tables (Immediate)"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:"Create 'oc_openregister_object_texts' table"}),"\n",(0,o.jsx)(n.li,{children:"Create 'oc_openregister_chunks' table"}),"\n",(0,o.jsx)(n.li,{children:"Create 'oc_openregister_entities' table"}),"\n",(0,o.jsx)(n.li,{children:"Create 'oc_openregister_entity_relations' table"}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"phase-2-populate-chunks-table-background-job",children:"Phase 2: Populate Chunks Table (Background Job)"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:"Read existing 'chunks_json' from 'oc_openregister_file_texts'"}),"\n",(0,o.jsx)(n.li,{children:"Create Chunk entities for each JSON chunk"}),"\n",(0,o.jsx)(n.li,{children:"Maintain backward compatibility (keep chunks_json populated)"}),"\n",(0,o.jsx)(n.li,{children:"Mark migration status in settings"}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"phase-3-language-detection-optional-background-job",children:"Phase 3: Language Detection (Optional, Background Job)"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:"Process all existing chunks"}),"\n",(0,o.jsx)(n.li,{children:"Detect language for each chunk"}),"\n",(0,o.jsx)(n.li,{children:"Update 'language' and 'language_confidence' fields"}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"phase-4-entity-extraction-optional-background-job",children:"Phase 4: Entity Extraction (Optional, Background Job)"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:"Process all existing chunks"}),"\n",(0,o.jsx)(n.li,{children:"Extract entities using configured method"}),"\n",(0,o.jsx)(n.li,{children:"Create Entity and EntityRelation records"}),"\n",(0,o.jsx)(n.li,{children:"Generate GDPR register report"}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"phase-5-deprecate-chunks_json-future",children:"Phase 5: Deprecate chunks_json (Future)"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:"Once all chunks migrated to table"}),"\n",(0,o.jsx)(n.li,{children:"Remove 'chunks_json' column"}),"\n",(0,o.jsx)(n.li,{children:"Update services to use Chunk table only"}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"indexes-and-performance",children:"Indexes and Performance"}),"\n",(0,o.jsx)(n.h3,{id:"recommended-indexes",children:"Recommended Indexes"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sql",children:"-- Chunk lookups by source\nCREATE INDEX idx_chunk_source ON oc_openregister_chunks(source_type, source_id);\n\n-- Language filtering\nCREATE INDEX idx_chunk_language ON oc_openregister_chunks(language);\n\n-- Entity lookups\nCREATE INDEX idx_entity_type_value ON oc_openregister_entities(type, value(255));\n\n-- Relation lookups\nCREATE INDEX idx_relation_entity_chunk ON oc_openregister_entity_relations(entity_id, chunk_id);\n\n-- GDPR queries\nCREATE INDEX idx_entity_category ON oc_openregister_entities(category);\nCREATE INDEX idx_relation_anonymized ON oc_openregister_entity_relations(anonymized);\n"})}),"\n",(0,o.jsx)(n.h3,{id:"query-performance-estimates",children:"Query Performance Estimates"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Get chunks for file"}),": ~5-50ms (indexed on source_id)"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Get all entities of type"}),": ~10-100ms (indexed on type)"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Get all occurrences of entity"}),": ~5-50ms (indexed on entity_id)"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"GDPR report generation"}),": ~500-5000ms (depends on total entities)"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"storage-requirements",children:"Storage Requirements"}),"\n",(0,o.jsx)(n.h3,{id:"estimated-space",children:"Estimated Space"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"FileText"}),": ~5KB per file (with 10 chunks)"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"ObjectText"}),": ~1KB per object"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Chunk"}),": ~1-2KB per chunk"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Entity"}),": ~500 bytes per unique entity"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"EntityRelation"}),": ~200 bytes per occurrence"]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"example-10000-documents",children:"Example: 10,000 Documents"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"10,000 files \xd7 5KB = 50 MB (FileText)\n10,000 files \xd7 10 chunks \xd7 1.5KB = 150 MB (Chunk)\n1,000 unique entities \xd7 500 bytes = 500 KB (Entity)\n50,000 occurrences \xd7 200 bytes = 10 MB (EntityRelation)\n\nTotal: ~210 MB\n"})}),"\n",(0,o.jsx)(n.h2,{id:"maintenance",children:"Maintenance"}),"\n",(0,o.jsx)(n.h3,{id:"cleanup-strategies",children:"Cleanup Strategies"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Orphaned Chunks"}),": Delete chunks where source no longer exists"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Old Entities"}),": Archive entities not seen in X months"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Low Confidence"}),": Remove entity relations below threshold"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Duplicate Detection"}),": Merge duplicate entities"]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"monitoring",children:"Monitoring"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sql",children:"-- Chunks without language detection\nSELECT COUNT(*) FROM oc_openregister_chunks WHERE language IS NULL;\n\n-- Low confidence entities\nSELECT COUNT(*) FROM oc_openregister_entity_relations WHERE confidence < 0.7;\n\n-- Entities by type\nSELECT type, COUNT(*) as count \nFROM oc_openregister_entities \nGROUP BY type \nORDER BY count DESC;\n\n-- Most common entities\nSELECT type, value, COUNT(*) as occurrences\nFROM oc_openregister_entities e\nJOIN oc_openregister_entity_relations er ON e.id = er.entity_id\nGROUP BY e.id\nORDER BY occurrences DESC\nLIMIT 20;\n"})}),"\n",(0,o.jsx)(n.h2,{id:"api-query-examples",children:"API Query Examples"}),"\n",(0,o.jsx)(n.h3,{id:"get-all-chunks-for-a-file",children:"Get All Chunks for a File"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-php",children:"$chunks = $chunkMapper->findBySource('file', $fileId);\n"})}),"\n",(0,o.jsx)(n.h3,{id:"find-entities-in-a-chunk",children:"Find Entities in a Chunk"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-php",children:"$relations = $entityRelationMapper->findByChunkId($chunkId);\n$entities = array_map(fn($rel) => $entityMapper->find($rel->getEntityId()), $relations);\n"})}),"\n",(0,o.jsx)(n.h3,{id:"gdpr-report-all-persons",children:"GDPR Report: All Persons"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-php",children:"$persons = $entityMapper->findByType(GdprEntity::TYPE_PERSON);\nforeach ($persons as $person) {\n    $occurrences = $entityRelationMapper->findByEntityId($person->getId());\n    // Generate report...\n}\n"})}),"\n",(0,o.jsx)(n.h3,{id:"find-all-chunks-in-a-specific-language",children:"Find All Chunks in a Specific Language"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-php",children:"$chunks = $chunkMapper->findByLanguage('nl');\n"})}),"\n",(0,o.jsx)(n.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,o.jsx)(n.p,{children:"This database schema provides:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Unified Chunking"}),": Both files and objects processed into common structure"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"GDPR Compliance"}),": Complete tracking of entities with precise locations"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Language Support"}),": Detection and filtering by language and reading level"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Scalability"}),": Indexed for performance on large datasets"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Future-Ready"}),": Prepared for anonymization, translation, and advanced analysis"]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"The schema balances normalization (separate tables) with performance (denormalized chunks in JSON during transition) to provide flexibility during implementation."})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}}}]);