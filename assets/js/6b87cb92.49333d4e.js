"use strict";(self.webpackChunkopen_catalogi_docs=self.webpackChunkopen_catalogi_docs||[]).push([[614],{28453:(e,n,i)=>{i.d(n,{R:()=>r,x:()=>o});var s=i(96540);const l={},t=s.createContext(l);function r(e){const n=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:r(e.components),s.createElement(t.Provider,{value:n},e.children)}},88672:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"technical/solr-published-only-indexing","title":"Solr Published-Only Indexing","description":"Overview","source":"@site/docs/technical/solr-published-only-indexing.md","sourceDirName":"technical","slug":"/technical/solr-published-only-indexing","permalink":"/docs/technical/solr-published-only-indexing","draft":false,"unlisted":false,"editUrl":"https://github.com/conductionnl/openregister/tree/main/website/docs/technical/solr-published-only-indexing.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"SOLR Guzzle Migration Progress","permalink":"/docs/technical/solr-guzzle-migration"},"next":{"title":"SOLR Setup and Configuration Guide","permalink":"/docs/technical/solr-setup-configuration"}}');var l=i(74848),t=i(28453);const r={},o="Solr Published-Only Indexing",d={},c=[{value:"Overview",id:"overview",level:2},{value:"Architecture Decision",id:"architecture-decision",level:2},{value:"Why Published-Only?",id:"why-published-only",level:3},{value:"Implementation Strategy",id:"implementation-strategy",level:3},{value:"Technical Implementation",id:"technical-implementation",level:2},{value:"Code Locations",id:"code-locations",level:3},{value:"Affected Methods",id:"affected-methods",level:3},{value:"Monitoring and Statistics",id:"monitoring-and-statistics",level:3},{value:"Database vs Solr Metrics",id:"database-vs-solr-metrics",level:4},{value:"Dashboard Display",id:"dashboard-display",level:4},{value:"Operational Considerations",id:"operational-considerations",level:2},{value:"Indexing Workflow",id:"indexing-workflow",level:3},{value:"Maintenance Tasks",id:"maintenance-tasks",level:3},{value:"Regular Monitoring",id:"regular-monitoring",level:4},{value:"Cleanup Operations",id:"cleanup-operations",level:4},{value:"Logging and Debugging",id:"logging-and-debugging",level:2},{value:"Log Levels",id:"log-levels",level:3},{value:"Example Log Entries",id:"example-log-entries",level:3},{value:"Troubleshooting",id:"troubleshooting",level:3},{value:"Common Issues",id:"common-issues",level:4},{value:"Future Roadmap",id:"future-roadmap",level:2},{value:"TODO: Comprehensive Indexing",id:"todo-comprehensive-indexing",level:3},{value:"Migration Considerations",id:"migration-considerations",level:3},{value:"Implementation Steps",id:"implementation-steps",level:3},{value:"Configuration",id:"configuration",level:2},{value:"Default Behavior",id:"default-behavior",level:3},{value:"Customization",id:"customization",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"Content Management",id:"content-management",level:3},{value:"System Administration",id:"system-administration",level:3},{value:"Development",id:"development",level:3}];function a(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"solr-published-only-indexing",children:"Solr Published-Only Indexing"})}),"\n",(0,l.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,l.jsxs)(n.p,{children:["OpenRegister implements a ",(0,l.jsx)(n.strong,{children:"published-only indexing strategy"})," for Apache Solr search functionality. This design decision ensures that only objects with a ",(0,l.jsx)(n.code,{children:"published"})," date are indexed to Solr, keeping search results relevant and secure by only showing publicly available content."]}),"\n",(0,l.jsx)(n.h2,{id:"architecture-decision",children:"Architecture Decision"}),"\n",(0,l.jsx)(n.h3,{id:"why-published-only",children:"Why Published-Only?"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"User Experience"}),": Search results only contain content that users should see"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Performance"}),": Smaller index size improves search speed and reduces resource usage"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Security"}),": Prevents accidental exposure of draft or unpublished content"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Relevance"}),": Maintains high-quality search results by excluding work-in-progress items"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"implementation-strategy",children:"Implementation Strategy"}),"\n",(0,l.jsx)(n.p,{children:"The published-only filtering is implemented at the indexing level rather than the search level:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Indexing Time"}),": Objects are filtered before being sent to Solr"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Search Time"}),": No additional filtering needed since only published objects exist in the index"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Performance"}),": Optimal search performance with smaller index size"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"technical-implementation",children:"Technical Implementation"}),"\n",(0,l.jsx)(n.h3,{id:"code-locations",children:"Code Locations"}),"\n",(0,l.jsxs)(n.p,{children:["The published-only logic is implemented in ",(0,l.jsx)(n.code,{children:"lib/Service/GuzzleSolrService.php"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-php",children:"// Single object indexing\npublic function indexObject(ObjectEntity $object, bool $commit = false): bool\n{\n    // Check if object is published\n    if (!$object->getPublished()) {\n        return true; // Skip unpublished objects\n    }\n    // ... continue with indexing\n}\n\n// Bulk indexing\nforeach ($objects as $object) {\n    if ($objectEntity && $objectEntity->getPublished()) {\n        $documents[] = $this->createSolrDocument($objectEntity, $solrFieldTypes);\n    } else {\n        $skippedUnpublished++;\n    }\n}\n"})}),"\n",(0,l.jsx)(n.h3,{id:"affected-methods",children:"Affected Methods"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:(0,l.jsx)(n.code,{children:"indexObject()"})})," - Single object indexing from object subscribers"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:(0,l.jsx)(n.code,{children:"bulkIndexFromDatabase()"})})," - Serial bulk indexing for warmup operations"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:(0,l.jsx)(n.code,{children:"bulkIndexFromDatabaseOptimized()"})})," - Optimized bulk indexing for large datasets"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"monitoring-and-statistics",children:"Monitoring and Statistics"}),"\n",(0,l.jsx)(n.p,{children:"The system provides comprehensive monitoring through the Solr Configuration dashboard:"}),"\n",(0,l.jsx)(n.h4,{id:"database-vs-solr-metrics",children:"Database vs Solr Metrics"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Published Count"}),": Objects in database with ",(0,l.jsx)(n.code,{children:"published IS NOT NULL"})]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Indexed Count"}),": Documents actually stored in Solr index"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Comparison"}),": Dashboard shows both counts to identify indexing gaps"]}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"dashboard-display",children:"Dashboard Display"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-vue",children:'<div class="stat-card">\n    <h5>Indexed Documents</h5>\n    <p>{{ formatNumber(solrStats.document_count || 0) }}</p>\n    <small v-if="solrStats.published_count" class="published-info">\n        {{ formatNumber(solrStats.published_count) }} published objects available\n    </small>\n</div>\n'})}),"\n",(0,l.jsx)(n.h2,{id:"operational-considerations",children:"Operational Considerations"}),"\n",(0,l.jsx)(n.h3,{id:"indexing-workflow",children:"Indexing Workflow"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Object Creation"}),": New objects are not indexed until published"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Publishing"}),": When an object gets a ",(0,l.jsx)(n.code,{children:"published"})," date, it becomes eligible for indexing"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Updates"}),": Published objects are re-indexed when modified"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Unpublishing"}),": Objects lose their ",(0,l.jsx)(n.code,{children:"published"})," date but remain in Solr (manual cleanup needed)"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"maintenance-tasks",children:"Maintenance Tasks"}),"\n",(0,l.jsx)(n.h4,{id:"regular-monitoring",children:"Regular Monitoring"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Check published vs indexed count alignment"}),"\n",(0,l.jsx)(n.li,{children:"Monitor skipped object logs for bulk operations"}),"\n",(0,l.jsx)(n.li,{children:"Verify search results contain expected published content"}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"cleanup-operations",children:"Cleanup Operations"}),"\n",(0,l.jsx)(n.p,{children:"Since unpublishing doesn't automatically remove objects from Solr:"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Clear and Re-index"}),": Periodically clear the entire index and rebuild from published objects"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Selective Removal"}),": Implement cleanup jobs to remove unpublished objects from Solr"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Monitoring"}),": Track objects that were unpublished but remain indexed"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"logging-and-debugging",children:"Logging and Debugging"}),"\n",(0,l.jsx)(n.h3,{id:"log-levels",children:"Log Levels"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"DEBUG"}),": Individual unpublished objects skipped"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"INFO"}),": Batch statistics showing skipped counts"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"WARNING"}),": Indexing errors or configuration issues"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"example-log-entries",children:"Example Log Entries"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"DEBUG: Skipping indexing of unpublished object [object_id: 123, uuid: abc-def]\nINFO: Skipped unpublished objects in batch [batch: 5, skipped: 15, published: 85]\n"})}),"\n",(0,l.jsx)(n.h3,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,l.jsx)(n.h4,{id:"common-issues",children:"Common Issues"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Count Mismatch"}),": Published count > Indexed count"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Cause"}),": Some published objects failed to index"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Solution"}),": Run Solr warmup to re-index all published objects"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Missing Search Results"}),": Expected objects don't appear"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Cause"}),": Objects may not have ",(0,l.jsx)(n.code,{children:"published"})," date set"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Solution"}),": Verify object publication status in database"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Performance Degradation"}),": Search becomes slow"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Cause"}),": Index size growing unexpectedly"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Solution"}),": Check for unpublished objects remaining in index"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"future-roadmap",children:"Future Roadmap"}),"\n",(0,l.jsx)(n.h3,{id:"todo-comprehensive-indexing",children:"TODO: Comprehensive Indexing"}),"\n",(0,l.jsx)(n.p,{children:"The codebase contains TODO comments indicating future plans for comprehensive indexing:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-php",children:"// TODO: In the future, we want to index all objects to Solr for comprehensive search.\n// Currently, we only index published objects to keep the search results relevant.\n"})}),"\n",(0,l.jsx)(n.h3,{id:"migration-considerations",children:"Migration Considerations"}),"\n",(0,l.jsx)(n.p,{children:"When moving to full indexing:"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Access Control"}),": Implement query-time filtering based on user permissions"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Search Filters"}),": Add published/unpublished toggles to search interfaces"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Performance"}),": Handle larger index sizes and more complex queries"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Security"}),": Ensure proper access control prevents unauthorized content access"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"implementation-steps",children:"Implementation Steps"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"Remove published-only filtering from indexing methods"}),"\n",(0,l.jsx)(n.li,{children:"Add access control middleware to search endpoints"}),"\n",(0,l.jsx)(n.li,{children:"Implement published status filters in search queries"}),"\n",(0,l.jsx)(n.li,{children:"Update monitoring to track all objects vs accessible objects"}),"\n",(0,l.jsx)(n.li,{children:"Migrate existing indexes with full object set"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,l.jsx)(n.h3,{id:"default-behavior",children:"Default Behavior"}),"\n",(0,l.jsx)(n.p,{children:"Published-only indexing is enabled by default with no configuration required. The system automatically:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Filters objects during indexing based on ",(0,l.jsx)(n.code,{children:"published"})," field"]}),"\n",(0,l.jsx)(n.li,{children:"Tracks statistics for monitoring"}),"\n",(0,l.jsx)(n.li,{children:"Logs skipped objects for debugging"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"customization",children:"Customization"}),"\n",(0,l.jsx)(n.p,{children:"Currently, there are no configuration options to disable published-only indexing. This is by design to maintain consistency and security across all OpenRegister installations."}),"\n",(0,l.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,l.jsx)(n.h3,{id:"content-management",children:"Content Management"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Publishing Workflow"}),": Establish clear processes for when content should be published"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Review Process"}),": Implement content review before setting ",(0,l.jsx)(n.code,{children:"published"})," dates"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Bulk Publishing"}),": Use bulk operations for large content releases"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"system-administration",children:"System Administration"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Regular Monitoring"}),": Check dashboard statistics weekly"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Index Maintenance"}),": Schedule periodic full re-indexing"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Log Review"}),": Monitor for unusual patterns in skipped objects"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"development",children:"Development"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Testing"}),": Always test with both published and unpublished objects"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Documentation"}),": Update this documentation when modifying indexing logic"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Backwards Compatibility"}),": Consider impact on existing search functionality"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(a,{...e})}):a(e)}}}]);