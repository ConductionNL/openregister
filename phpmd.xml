<?xml version="1.0"?>
<ruleset name="OpenCatalogi Nextcloud Rules"
    xmlns="http://pmd.sourceforge.net/ruleset/2.0.0"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://pmd.sourceforge.net/ruleset/2.0.0
                        http://pmd.sourceforge.net/ruleset_xml_schema.xsd">

    <description>
        This is a custom ruleset for OpenCatalogi Nextcloud.
    </description>

    <!-- Clean Code Rules -->
    <!-- BooleanArgumentFlag: Disabled - Boolean flags for $_rbac and $_multitenancy are established API pattern -->
    <!-- <rule ref="rulesets/cleancode.xml/BooleanArgumentFlag"/> -->
    
    <!-- ElseExpression: Disabled - Else clauses improve readability in complex conditional logic -->
    <!-- <rule ref="rulesets/cleancode.xml/ElseExpression"/> -->
    
    <!-- StaticAccess: Allowed for framework utilities (Symfony YAML, OC_App, etc.) -->
    <!-- <rule ref="rulesets/cleancode.xml/StaticAccess"/> -->
    <rule ref="rulesets/cleancode.xml/IfStatementAssignment"/>
    <rule ref="rulesets/cleancode.xml/DuplicatedArrayKey"/>
    <rule ref="rulesets/cleancode.xml/MissingImport"/>
    <rule ref="rulesets/cleancode.xml/UndefinedVariable"/>
    <rule ref="rulesets/cleancode.xml/ErrorControlOperator"/>

    <!-- Code Size Rules -->
    <!-- Relaxed thresholds for complex business logic -->
    <rule ref="rulesets/codesize.xml/CyclomaticComplexity">
        <properties>
            <property name="reportLevel" value="15" />
        </properties>
    </rule>
    <rule ref="rulesets/codesize.xml/NPathComplexity">
        <properties>
            <property name="minimum" value="5000" />
        </properties>
    </rule>
    <rule ref="rulesets/codesize.xml/ExcessiveMethodLength">
        <properties>
            <property name="minimum" value="200" />
        </properties>
    </rule>
    <rule ref="rulesets/codesize.xml/ExcessiveClassLength">
        <properties>
            <property name="minimum" value="1500" />
        </properties>
    </rule>
    <rule ref="rulesets/codesize.xml/ExcessiveParameterList"/>
    <rule ref="rulesets/codesize.xml/ExcessivePublicCount"/>
    <rule ref="rulesets/codesize.xml/TooManyFields"/>
    <rule ref="rulesets/codesize.xml/TooManyMethods"/>
    <rule ref="rulesets/codesize.xml/TooManyPublicMethods"/>
    <rule ref="rulesets/codesize.xml/ExcessiveClassComplexity"/>

    <!-- Controversial Rules -->
    <rule ref="rulesets/controversial.xml/Superglobals"/>
    <rule ref="rulesets/controversial.xml/CamelCaseClassName"/>
    <rule ref="rulesets/controversial.xml/CamelCasePropertyName"/>
    <rule ref="rulesets/controversial.xml/CamelCaseMethodName"/>
    <!-- CamelCaseParameterName removed - we allow leading underscores on parameters (convention for unused/config params) -->
    <!-- <rule ref="rulesets/controversial.xml/CamelCaseParameterName"/> -->
    <!-- CamelCaseVariableName removed - we allow leading underscores on variables (convention for unused loop vars) -->
    <!-- <rule ref="rulesets/controversial.xml/CamelCaseVariableName"/> -->

    <!-- Design Rules -->
    <rule ref="rulesets/design.xml/ExitExpression"/>
    <rule ref="rulesets/design.xml/EvalExpression"/>
    <rule ref="rulesets/design.xml/GotoStatement"/>
    <rule ref="rulesets/design.xml/NumberOfChildren"/>
    <rule ref="rulesets/design.xml/DepthOfInheritance"/>
    <rule ref="rulesets/design.xml/CouplingBetweenObjects"/>
    <rule ref="rulesets/design.xml/DevelopmentCodeFragment"/>
    <rule ref="rulesets/design.xml/EmptyCatchBlock"/>
    <rule ref="rulesets/design.xml/CountInLoopExpression"/>

    <!-- Naming Rules -->
    <rule ref="rulesets/naming.xml/LongClassName"/>
    <rule ref="rulesets/naming.xml/ShortClassName"/>
    <!-- ShortVariable configured with allowlist of idiomatic short names -->
    <rule ref="rulesets/naming.xml/ShortVariable">
        <properties>
            <property name="minimum" value="3" />
            <property name="exceptions" value="id,db,qb,op,ui,io,gc,tz,pk,fk,to,ch,a,b,l,v,c,t,r,f,n,k,e" />
        </properties>
    </rule>
    <rule ref="rulesets/naming.xml/LongVariable"/>
    <rule ref="rulesets/naming.xml/ShortMethodName"/>
    <rule ref="rulesets/naming.xml/ConstructorWithNameAsEnclosingClass"/>
    <rule ref="rulesets/naming.xml/ConstantNamingConventions"/>
    <rule ref="rulesets/naming.xml/BooleanGetMethodName"/>

    <!-- Unused Code Rules -->
    <rule ref="rulesets/unusedcode.xml/UnusedPrivateField"/>
    <rule ref="rulesets/unusedcode.xml/UnusedLocalVariable"/>
    <rule ref="rulesets/unusedcode.xml/UnusedPrivateMethod"/>
    <!-- UnusedFormalParameter: This rule is excluded globally as the codebase uses underscore-prefixed
         parameters to indicate interface requirements, reserved parameters, or API compatibility.
         Parameters prefixed with _ are intentionally unused. -->
    <!-- <rule ref="rulesets/unusedcode.xml/UnusedFormalParameter"/> -->
</ruleset>
