<?xml version="1.0"?>
<psalm
    errorLevel="4"
    resolveFromConfigFile="true"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns="https://getpsalm.org/schema/config"
    findUnusedBaselineEntry="true"
    findUnusedCode="true"
    findUnusedVariablesAndParams="true"
    errorBaseline="psalm-baseline.xml"
>
    <projectFiles>
        <directory name="lib" />
        <ignoreFiles>
            <directory name="vendor" />
        </ignoreFiles>
    </projectFiles>
    <stubs>
        <file name="vendor/nextcloud/ocp/OCP/Capabilities/ICapability.php" preloadClasses="true" />
    </stubs>
    <issueHandlers>
        <UndefinedDocblockClass errorLevel="suppress"/>
        <UndefinedClass>
            <errorLevel type="suppress">
                <referencedClass name="OC"/>
                <referencedClass name="Doctrine\DBAL\Types\Types"/>
                <referencedClass name="Doctrine\DBAL\Types\Type"/>
                <referencedClass name="Doctrine\DBAL\Connection"/>
                <referencedClass name="Doctrine\DBAL\Schema\Schema"/>
                <referencedClass name="Symfony\Component\HttpFoundation\Response"/>
                <referencedClass name="Doctrine\DBAL\Platforms\AbstractPlatform"/>
                <referencedClass name="Doctrine\DBAL\Platforms\MySQLPlatform"/>
                <referencedClass name="Doctrine\DBAL\ParameterType"/>
                <referencedClass name="APCUIterator"/>
                <referencedClass name="React\Async\PromiseInterface"/>
                <referencedClass name="Solarium\Client"/>
                <referencedClass name="Solarium\Core\Client\Adapter\Curl"/>
                <referencedClass name="Solarium\Exception\HttpException"/>
                <referencedClass name="Symfony\Component\EventDispatcher\EventDispatcher"/>
                <referencedClass name="Ramsey\Uuid\Uuid"/>
                <!-- Nextcloud OCP Classes -->
                <referencedClass name="OCP\AppFramework\App"/>
                <referencedClass name="OCP\AppFramework\Bootstrap\IBootstrap"/>
                <referencedClass name="OCP\AppFramework\Controller"/>
                <referencedClass name="OCP\AppFramework\IAppContainer"/>
                <referencedClass name="OCP\App\IAppManager"/>
                <referencedClass name="OCP\BackgroundJob\IJobList"/>
                <referencedClass name="OCP\BackgroundJob\QueuedJob"/>
                <referencedClass name="OCP\BackgroundJob\TimedJob"/>
                <referencedClass name="OCP\EventDispatcher\Event"/>
                <referencedClass name="OCP\EventDispatcher\IEventListener"/>
                <referencedClass name="OCP\IAppConfig"/>
                <referencedClass name="OCP\ICacheFactory"/>
                <referencedClass name="OCP\IConfig"/>
                <referencedClass name="OCP\IDBConnection"/>
                <referencedClass name="OCP\IGroupManager"/>
                <referencedClass name="OCP\IUserManager"/>
                <referencedClass name="OCP\IUserSession"/>
                <referencedClass name="OCP\Search\IFilteringProvider"/>
            </errorLevel>
        </UndefinedClass>
        <UndefinedMagicMethod errorLevel="suppress"/>
        <UnusedClass errorLevel="suppress"/>
        <PossiblyUnusedMethod errorLevel="suppress"/>
        <UnusedMethod errorLevel="suppress"/>
        <UnusedProperty errorLevel="suppress"/>
        <PossiblyUnusedParam errorLevel="suppress"/>
        <UnusedDocblockParam errorLevel="suppress"/>
        <UnusedVariable errorLevel="suppress"/>
        <PossiblyUnusedReturnValue errorLevel="suppress"/>
        <RedundantCondition errorLevel="suppress"/>
        <RedundantFunctionCall errorLevel="suppress"/>
        <RedundantCast errorLevel="suppress"/>
        <RedundantPropertyInitializationCheck errorLevel="suppress"/>
        <StringIncrement errorLevel="suppress"/>
        <InvalidDocblock errorLevel="suppress"/>
        <MoreSpecificImplementedParamType errorLevel="suppress"/>
        <MissingDependency errorLevel="suppress"/>
        <UnevaluatedCode errorLevel="suppress"/>
        <!-- Suppress external library/interface method issues -->
        <UndefinedInterfaceMethod>
            <errorLevel type="suppress">
                <!-- Doctrine DBAL methods -->
                <referencedMethod name="OCP\IDBConnection::getSchemaManager"/>
                <!-- Nextcloud QueryBuilder methods -->
                <referencedMethod name="OCP\DB\QueryBuilder\IQueryBuilder::escapeLikeParameter"/>
                <!-- Nextcloud File methods -->
                <referencedMethod name="OCP\Files\Node::fopen"/>
                <referencedMethod name="OCP\Files\Node::getContent"/>
                <!-- Search backend implementation methods -->
                <referencedMethod name="OCA\OpenRegister\Service\Index\SearchBackendInterface::indexFiles"/>
                <referencedMethod name="OCA\OpenRegister\Service\Index\SearchBackendInterface::getFileIndexStats"/>
                <referencedMethod name="OCA\OpenRegister\Service\Index\SearchBackendInterface::fixMismatchedFields"/>
            </errorLevel>
        </UndefinedInterfaceMethod>
        <!-- Suppress React library function calls -->
        <UndefinedFunction>
            <errorLevel type="suppress">
                <referencedFunction name="React\Async\await"/>
            </errorLevel>
        </UndefinedFunction>
        <!-- Suppress LLPhant dynamic property access -->
        <UndefinedPropertyAssignment>
            <errorLevel type="suppress">
                <referencedProperty name="LLPhant\OpenAIConfig::$temperature"/>
                <referencedProperty name="LLPhant\OpenAIConfig::$organizationId"/>
            </errorLevel>
        </UndefinedPropertyAssignment>
        <UndefinedPropertyFetch>
            <errorLevel type="suppress">
                <referencedProperty name="LLPhant\OllamaConfig::$apiKey"/>
                <referencedProperty name="LLPhant\OpenAIConfig::$apiKey"/>
                <referencedProperty name="LLPhant\OpenAIConfig::$model"/>
                <referencedProperty name="LLPhant\OpenAIConfig::$url"/>
            </errorLevel>
        </UndefinedPropertyFetch>
        <!-- Suppress OrganisationMapper method calls from trait -->
        <UndefinedMethod>
            <errorLevel type="suppress">
                <referencedMethod name="OCA\OpenRegister\Service\OrganisationService::getActiveOrganisationWithFallback"/>
                <referencedMethod name="OCA\OpenRegister\Service\OrganisationService::getDefaultOrganisationFromConfig"/>
                <referencedMethod name="OCA\OpenRegister\Service\OrganisationService::getOrganisationHierarchy"/>
            </errorLevel>
        </UndefinedMethod>
        <!-- Suppress dead code warnings for defensive null checks -->
        <NoValue errorLevel="suppress"/>
        <TypeDoesNotContainNull errorLevel="suppress"/>
        <TypeDoesNotContainType errorLevel="suppress"/>
        <InvalidArrayOffset errorLevel="suppress"/>
        <InvalidCast errorLevel="suppress"/>
        <InvalidArgument errorLevel="suppress"/>
        <InvalidTemplateParam errorLevel="suppress"/>
        <InvalidReturnType errorLevel="suppress"/>
        <InvalidReturnStatement errorLevel="suppress"/>
        <MismatchingDocblockReturnType errorLevel="suppress"/>
        <EmptyArrayAccess errorLevel="suppress"/>
        <ImplementedReturnTypeMismatch errorLevel="suppress"/>
    </issueHandlers>
    <extraFiles>
        <directory name="vendor/nextcloud/ocp" />
    </extraFiles>
</psalm>
